let t,e,r;var n=globalThis;function i(t,e,r,n){Object.defineProperty(t,e,{get:r,set:n,enumerable:!0,configurable:!0})}var o={},s={},a=n.parcelRequire3536;null==a&&((a=function(t){if(t in o)return o[t].exports;if(t in s){var e=s[t];delete s[t];var r={id:t,exports:{}};return o[t]=r,e.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(t,e){s[t]=e},n.parcelRequire3536=a);var u=a.register;function c(t,e){return function(){return t.apply(e,arguments)}}u("bCzyS",function(t,e){var r=a("2ozqO");t.exports=r("24DnT").then(()=>a("6Uwhg"))}),u("2ozqO",function(t,e){t.exports=function(t){return import(a("dRo73").resolve(t))}}),u("1MZgh",function(t,e){var r=a("2ozqO");t.exports=r("700OJ").then(()=>a("c1Bjq"))});var l={},p=l={};function h(){throw Error("setTimeout has not been defined")}function f(){throw Error("clearTimeout has not been defined")}function d(t){if(nf===setTimeout)return setTimeout(t,0);if((nf===h||!nf)&&setTimeout)return nf=setTimeout,setTimeout(t,0);try{return nf(t,0)}catch(e){try{return nf.call(null,t,0)}catch(e){return nf.call(this,t,0)}}}!function(){try{nf="function"==typeof setTimeout?setTimeout:h}catch(t){nf=h}try{nd="function"==typeof clearTimeout?clearTimeout:f}catch(t){nd=f}}();var y=[],g=!1,v=-1;function m(){g&&ny&&(g=!1,ny.length?y=ny.concat(y):v=-1,y.length&&b())}function b(){if(!g){var t=d(m);g=!0;for(var e=y.length;e;){for(ny=y,y=[];++v<e;)ny&&ny[v].run();v=-1,e=y.length}ny=null,g=!1,function(t){if(nd===clearTimeout)return clearTimeout(t);if((nd===f||!nd)&&clearTimeout)return nd=clearTimeout,clearTimeout(t);try{nd(t)}catch(e){try{return nd.call(null,t)}catch(e){return nd.call(this,t)}}}(t)}}function _(t,e){this.fun=t,this.array=e}function w(){}p.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];y.push(new _(t,e)),1!==y.length||g||d(b)},_.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=w,p.addListener=w,p.once=w,p.off=w,p.removeListener=w,p.removeAllListeners=w,p.emit=w,p.prependListener=w,p.prependOnceListener=w,p.listeners=function(t){return[]},p.binding=function(t){throw Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw Error("process.chdir is not supported")},p.umask=function(){return 0};const{toString:E}=Object.prototype,{getPrototypeOf:P}=Object,O=(t=Object.create(null),e=>{let r=E.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())}),S=t=>(t=t.toLowerCase(),e=>O(e)===t),T=t=>e=>typeof e===t,{isArray:x}=Array,A=T("undefined"),R=S("ArrayBuffer"),C=T("string"),N=T("function"),k=T("number"),I=t=>null!==t&&"object"==typeof t,j=t=>{if("object"!==O(t))return!1;let e=P(t);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},U=S("Date"),L=S("File"),F=S("Blob"),B=S("FileList"),D=S("URLSearchParams"),[M,V,G,q]=["ReadableStream","Request","Response","Headers"].map(S);function z(t,e,{allOwnKeys:r=!1}={}){let n,i;if(null!=t){if("object"!=typeof t&&(t=[t]),x(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{let i;let o=r?Object.getOwnPropertyNames(t):Object.keys(t),s=o.length;for(n=0;n<s;n++)i=o[n],e.call(null,t[i],i,t)}}}function W(t,e){let r;e=e.toLowerCase();let n=Object.keys(t),i=n.length;for(;i-- >0;)if(e===(r=n[i]).toLowerCase())return r;return null}const Y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n,H=t=>!A(t)&&t!==Y,J=(e="undefined"!=typeof Uint8Array&&P(Uint8Array),t=>e&&t instanceof e),$=S("HTMLFormElement"),X=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),Z=S("RegExp"),K=(t,e)=>{let r=Object.getOwnPropertyDescriptors(t),n={};z(r,(r,i)=>{let o;!1!==(o=e(r,i,t))&&(n[i]=o||r)}),Object.defineProperties(t,n)},Q="abcdefghijklmnopqrstuvwxyz",tt="0123456789",te={DIGIT:tt,ALPHA:Q,ALPHA_DIGIT:Q+Q.toUpperCase()+tt},tr=S("AsyncFunction"),tn=(nu="function"==typeof setImmediate,nc=N(Y.postMessage),nu?setImmediate:nc?(nl=`axios@${Math.random()}`,np=[],Y.addEventListener("message",({source:t,data:e})=>{t===Y&&e===nl&&np.length&&np.shift()()},!1),t=>{np.push(t),Y.postMessage(nl,"*")}):t=>setTimeout(t)),ti="undefined"!=typeof queueMicrotask?queueMicrotask.bind(Y):void 0!==l&&l.nextTick||tn;var to={isArray:x,isArrayBuffer:R,isBuffer:function(t){return null!==t&&!A(t)&&null!==t.constructor&&!A(t.constructor)&&N(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&("function"==typeof FormData&&t instanceof FormData||N(t.append)&&("formdata"===(e=O(t))||"object"===e&&N(t.toString)&&"[object FormData]"===t.toString()))},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&R(t.buffer)},isString:C,isNumber:k,isBoolean:t=>!0===t||!1===t,isObject:I,isPlainObject:j,isReadableStream:M,isRequest:V,isResponse:G,isHeaders:q,isUndefined:A,isDate:U,isFile:L,isBlob:F,isRegExp:Z,isFunction:N,isStream:t=>I(t)&&N(t.pipe),isURLSearchParams:D,isTypedArray:J,isFileList:B,forEach:z,merge:function t(){let{caseless:e}=H(this)&&this||{},r={},n=(n,i)=>{let o=e&&W(r,i)||i;j(r[o])&&j(n)?r[o]=t(r[o],n):j(n)?r[o]=t({},n):x(n)?r[o]=n.slice():r[o]=n};for(let t=0,e=arguments.length;t<e;t++)arguments[t]&&z(arguments[t],n);return r},extend:(t,e,r,{allOwnKeys:n}={})=>(z(e,(e,n)=>{r&&N(e)?t[n]=c(e,r):t[n]=e},{allOwnKeys:n}),t),trim:t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(65279===t.charCodeAt(0)&&(t=t.slice(1)),t),inherits:(t,e,r,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},toFlatObject:(t,e,r,n)=>{let i,o,s;let a={};if(e=e||{},null==t)return e;do{for(o=(i=Object.getOwnPropertyNames(t)).length;o-- >0;)s=i[o],(!n||n(s,t,e))&&!a[s]&&(e[s]=t[s],a[s]=!0);t=!1!==r&&P(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype)return e},kindOf:O,kindOfTest:S,endsWith:(t,e,r)=>{t=String(t),(void 0===r||r>t.length)&&(r=t.length),r-=e.length;let n=t.indexOf(e,r);return -1!==n&&n===r},toArray:t=>{if(!t)return null;if(x(t))return t;let e=t.length;if(!k(e))return null;let r=Array(e);for(;e-- >0;)r[e]=t[e];return r},forEachEntry:(t,e)=>{let r;let n=(t&&t[Symbol.iterator]).call(t);for(;(r=n.next())&&!r.done;){let n=r.value;e.call(t,n[0],n[1])}},matchAll:(t,e)=>{let r;let n=[];for(;null!==(r=t.exec(e));)n.push(r);return n},isHTMLForm:$,hasOwnProperty:X,hasOwnProp:X,reduceDescriptors:K,freezeMethods:t=>{K(t,(e,r)=>{if(N(t)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;if(N(t[r])){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},toObjectSet:(t,e)=>{let r={};return(t=>{t.forEach(t=>{r[t]=!0})})(x(t)?t:String(t).split(e)),r},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,e,r){return e.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(t,e)=>null!=t&&Number.isFinite(t=+t)?t:e,findKey:W,global:Y,isContextDefined:H,ALPHABET:te,generateString:(t=16,e=te.ALPHA_DIGIT)=>{let r="",{length:n}=e;for(;t--;)r+=e[Math.random()*n|0];return r},isSpecCompliantForm:function(t){return!!(t&&N(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])},toJSONObject:t=>{let e=Array(10),r=(t,n)=>{if(I(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[n]=t;let i=x(t)?[]:{};return z(t,(t,e)=>{let o=r(t,n+1);A(o)||(i[e]=o)}),e[n]=void 0,i}}return t};return r(t,0)},isAsyncFn:tr,isThenable:t=>t&&(I(t)||N(t))&&N(t.then)&&N(t.catch),setImmediate:tn,asap:ti};function ts(t,e,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}to.inherits(ts,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:to.toJSONObject(this.config),code:this.code,status:this.status}}});const ta=ts.prototype,tu={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{tu[t]={value:t}}),Object.defineProperties(ts,tu),Object.defineProperty(ta,"isAxiosError",{value:!0}),ts.from=(t,e,r,n,i,o)=>{let s=Object.create(ta);return to.toFlatObject(t,s,function(t){return t!==Error.prototype},t=>"isAxiosError"!==t),ts.call(s,t.message,e,r,n,i),s.cause=t,s.name=t.name,o&&Object.assign(s,o),s},ng=function(t){var e,r,n=function(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}(t),i=n[0],o=n[1],s=new tp((i+o)*3/4-o),a=0,u=o>0?i-4:i;for(r=0;r<u;r+=4)e=tl[t.charCodeAt(r)]<<18|tl[t.charCodeAt(r+1)]<<12|tl[t.charCodeAt(r+2)]<<6|tl[t.charCodeAt(r+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=255&e;return 2===o&&(e=tl[t.charCodeAt(r)]<<2|tl[t.charCodeAt(r+1)]>>4,s[a++]=255&e),1===o&&(e=tl[t.charCodeAt(r)]<<10|tl[t.charCodeAt(r+1)]<<4|tl[t.charCodeAt(r+2)]>>2,s[a++]=e>>8&255,s[a++]=255&e),s},nv=function(t){for(var e,r=t.length,n=r%3,i=[],o=0,s=r-n;o<s;o+=16383)i.push(function(t,e,r){for(var n,i=[],o=e;o<r;o+=3)i.push(tc[(n=(t[o]<<16&0xff0000)+(t[o+1]<<8&65280)+(255&t[o+2]))>>18&63]+tc[n>>12&63]+tc[n>>6&63]+tc[63&n]);return i.join("")}(t,o,o+16383>s?s:o+16383));return 1===n?i.push(tc[(e=t[r-1])>>2]+tc[e<<4&63]+"=="):2===n&&i.push(tc[(e=(t[r-2]<<8)+t[r-1])>>10]+tc[e>>4&63]+tc[e<<2&63]+"="),i.join("")};for(var tc=[],tl=[],tp="undefined"!=typeof Uint8Array?Uint8Array:Array,th="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tf=0,td=th.length;tf<td;++tf)tc[tf]=th[tf],tl[th.charCodeAt(tf)]=tf;tl["-".charCodeAt(0)]=62,tl["_".charCodeAt(0)]=63,nm=function(t,e,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,p=r?i-1:0,h=r?-1:1,f=t[e+p];for(p+=h,o=f&(1<<-l)-1,f>>=-l,l+=a;l>0;o=256*o+t[e+p],p+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+t[e+p],p+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),o-=c}return(f?-1:1)*s*Math.pow(2,o-n)},nb=function(t,e,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,p=l>>1,h=23===i?5960464477539062e-23:0,f=n?0:o-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),s+p>=1?e+=h/u:e+=h*Math.pow(2,1-p),e*u>=2&&(s++,u/=2),s+p>=l?(a=0,s=l):s+p>=1?(a=(e*u-1)*Math.pow(2,i),s+=p):(a=e*Math.pow(2,p-1)*Math.pow(2,i),s=0));i>=8;t[r+f]=255&a,f+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;t[r+f]=255&s,f+=d,s/=256,c-=8);t[r+f-d]|=128*y};const ty="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function tg(t){if(t>0x7fffffff)throw RangeError('The value "'+t+'" is invalid for option "size"');let e=new Uint8Array(t);return Object.setPrototypeOf(e,tv.prototype),e}function tv(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return t_(t)}return tm(t,e,r)}function tm(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!tv.isEncoding(e))throw TypeError("Unknown encoding: "+e);let r=0|tO(t,e),n=tg(r),i=n.write(t,e);return i!==r&&(n=n.slice(0,i)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(tH(t,Uint8Array)){let e=new Uint8Array(t);return tE(e.buffer,e.byteOffset,e.byteLength)}return tw(t)}(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(tH(t,ArrayBuffer)||t&&tH(t.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(tH(t,SharedArrayBuffer)||t&&tH(t.buffer,SharedArrayBuffer)))return tE(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');let n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return tv.from(n,e,r);let i=function(t){var e;if(tv.isBuffer(t)){let e=0|tP(t.length),r=tg(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||(e=t.length)!=e?tg(0):tw(t):"Buffer"===t.type&&Array.isArray(t.data)?tw(t.data):void 0}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return tv.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function tb(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function t_(t){return tb(t),tg(t<0?0:0|tP(t))}function tw(t){let e=t.length<0?0:0|tP(t.length),r=tg(e);for(let n=0;n<e;n+=1)r[n]=255&t[n];return r}function tE(t,e,r){let n;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),tv.prototype),n}function tP(t){if(t>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function tO(t,e){if(tv.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||tH(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);let r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return tz(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return tW(t).length;default:if(i)return n?-1:tz(t).length;e=(""+e).toLowerCase(),i=!0}}function tS(t,e,r){let n=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(e>>>=0)))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){let n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=e;n<r;++n)i+=tJ[t[n]];return i}(this,e,r);case"utf8":case"utf-8":return tR(this,e,r);case"ascii":return function(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}(this,e,r);case"latin1":case"binary":return function(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}(this,e,r);case"base64":var i,o;return i=e,o=r,0===i&&o===this.length?nv(this):nv(this.slice(i,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){let n=t.slice(e,r),i="";for(let t=0;t<n.length-1;t+=2)i+=String.fromCharCode(n[t]+256*n[t+1]);return i}(this,e,r);default:if(n)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function tT(t,e,r){let n=t[e];t[e]=t[r],t[r]=n}function tx(t,e,r,n,i){var o;if(0===t.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(o=r=+r)!=o&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return -1;r=t.length-1}else if(r<0){if(!i)return -1;r=0}if("string"==typeof e&&(e=tv.from(e,n)),tv.isBuffer(e))return 0===e.length?-1:tA(t,e,r,n,i);if("number"==typeof e)return(e&=255,"function"==typeof Uint8Array.prototype.indexOf)?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):tA(t,[e],r,n,i);throw TypeError("val must be string, number or Buffer")}function tA(t,e,r,n,i){let o,s=1,a=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return -1;s=2,a/=2,u/=2,r/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){let n=-1;for(o=r;o<a;o++)if(c(t,o)===c(e,-1===n?0:o-n)){if(-1===n&&(n=o),o-n+1===u)return n*s}else -1!==n&&(o-=o-n),n=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){let r=!0;for(let n=0;n<u;n++)if(c(t,o+n)!==c(e,n)){r=!1;break}if(r)return o}return -1}function tR(t,e,r){r=Math.min(t.length,r);let n=[],i=e;for(;i<r;){let e=t[i],o=null,s=e>239?4:e>223?3:e>191?2:1;if(i+s<=r){let r,n,a,u;switch(s){case 1:e<128&&(o=e);break;case 2:(192&(r=t[i+1]))==128&&(u=(31&e)<<6|63&r)>127&&(o=u);break;case 3:r=t[i+1],n=t[i+2],(192&r)==128&&(192&n)==128&&(u=(15&e)<<12|(63&r)<<6|63&n)>2047&&(u<55296||u>57343)&&(o=u);break;case 4:r=t[i+1],n=t[i+2],a=t[i+3],(192&r)==128&&(192&n)==128&&(192&a)==128&&(u=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&a)>65535&&u<1114112&&(o=u)}}null===o?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=s}return function(t){let e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}function tC(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function tN(t,e,r,n,i,o){if(!tv.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw RangeError('"value" argument is out of bounds');if(r+n>t.length)throw RangeError("Index out of range")}function tk(t,e,r,n,i){tM(e,n,i,t,r,7);let o=Number(e&BigInt(0xffffffff));t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o;let s=Number(e>>BigInt(32)&BigInt(0xffffffff));return t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,r}function tI(t,e,r,n,i){tM(e,n,i,t,r,7);let o=Number(e&BigInt(0xffffffff));t[r+7]=o,o>>=8,t[r+6]=o,o>>=8,t[r+5]=o,o>>=8,t[r+4]=o;let s=Number(e>>BigInt(32)&BigInt(0xffffffff));return t[r+3]=s,s>>=8,t[r+2]=s,s>>=8,t[r+1]=s,s>>=8,t[r]=s,r+8}function tj(t,e,r,n,i,o){if(r+n>t.length||r<0)throw RangeError("Index out of range")}function tU(t,e,r,n,i){return e=+e,r>>>=0,i||tj(t,e,r,4,34028234663852886e22,-34028234663852886e22),nb(t,e,r,n,23,4),r+4}function tL(t,e,r,n,i){return e=+e,r>>>=0,i||tj(t,e,r,8,17976931348623157e292,-17976931348623157e292),nb(t,e,r,n,52,8),r+8}tv.TYPED_ARRAY_SUPPORT=function(){try{let t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),tv.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(tv.prototype,"parent",{enumerable:!0,get:function(){if(tv.isBuffer(this))return this.buffer}}),Object.defineProperty(tv.prototype,"offset",{enumerable:!0,get:function(){if(tv.isBuffer(this))return this.byteOffset}}),tv.poolSize=8192,tv.from=function(t,e,r){return tm(t,e,r)},Object.setPrototypeOf(tv.prototype,Uint8Array.prototype),Object.setPrototypeOf(tv,Uint8Array),tv.alloc=function(t,e,r){return(tb(t),t<=0)?tg(t):void 0!==e?"string"==typeof r?tg(t).fill(e,r):tg(t).fill(e):tg(t)},tv.allocUnsafe=function(t){return t_(t)},tv.allocUnsafeSlow=function(t){return t_(t)},tv.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==tv.prototype},tv.compare=function(t,e){if(tH(t,Uint8Array)&&(t=tv.from(t,t.offset,t.byteLength)),tH(e,Uint8Array)&&(e=tv.from(e,e.offset,e.byteLength)),!tv.isBuffer(t)||!tv.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,n=e.length;for(let i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},tv.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},tv.concat=function(t,e){let r;if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return tv.alloc(0);if(void 0===e)for(r=0,e=0;r<t.length;++r)e+=t[r].length;let n=tv.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){let e=t[r];if(tH(e,Uint8Array))i+e.length>n.length?(tv.isBuffer(e)||(e=tv.from(e)),e.copy(n,i)):Uint8Array.prototype.set.call(n,e,i);else if(tv.isBuffer(e))e.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=e.length}return n},tv.byteLength=tO,tv.prototype._isBuffer=!0,tv.prototype.swap16=function(){let t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)tT(this,e,e+1);return this},tv.prototype.swap32=function(){let t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)tT(this,e,e+3),tT(this,e+1,e+2);return this},tv.prototype.swap64=function(){let t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)tT(this,e,e+7),tT(this,e+1,e+6),tT(this,e+2,e+5),tT(this,e+3,e+4);return this},tv.prototype.toString=function(){let t=this.length;return 0===t?"":0==arguments.length?tR(this,0,t):tS.apply(this,arguments)},tv.prototype.toLocaleString=tv.prototype.toString,tv.prototype.equals=function(t){if(!tv.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===tv.compare(this,t)},tv.prototype.inspect=function(){let t="";return t=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(t+=" ... "),"<Buffer "+t+">"},ty&&(tv.prototype[ty]=tv.prototype.inspect),tv.prototype.compare=function(t,e,r,n,i){if(tH(t,Uint8Array)&&(t=tv.from(t,t.offset,t.byteLength)),!tv.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;let o=i-n,s=r-e,a=Math.min(o,s),u=this.slice(n,i),c=t.slice(e,r);for(let t=0;t<a;++t)if(u[t]!==c[t]){o=u[t],s=c[t];break}return o<s?-1:s<o?1:0},tv.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},tv.prototype.indexOf=function(t,e,r){return tx(this,t,e,r,!0)},tv.prototype.lastIndexOf=function(t,e,r){return tx(this,t,e,r,!1)},tv.prototype.write=function(t,e,r,n){var i,o,s,a,u,c,l,p;if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let h=this.length-e;if((void 0===r||r>h)&&(r=h),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let f=!1;for(;;)switch(n){case"hex":return function(t,e,r,n){let i;r=Number(r)||0;let o=t.length-r;n?(n=Number(n))>o&&(n=o):n=o;let s=e.length;for(n>s/2&&(n=s/2),i=0;i<n;++i){let n=parseInt(e.substr(2*i,2),16);if(n!=n)break;t[r+i]=n}return i}(this,t,e,r);case"utf8":case"utf-8":return i=e,o=r,tY(tz(t,this.length-i),this,i,o);case"ascii":case"latin1":case"binary":return s=e,a=r,tY(function(t){let e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(t),this,s,a);case"base64":return u=e,c=r,tY(tW(t),this,u,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l=e,p=r,tY(function(t,e){let r,n;let i=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)n=(r=t.charCodeAt(o))>>8,i.push(r%256),i.push(n);return i}(t,this.length-l),this,l,p);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},tv.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},tv.prototype.slice=function(t,e){let r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);let n=this.subarray(t,e);return Object.setPrototypeOf(n,tv.prototype),n},tv.prototype.readUintLE=tv.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||tC(t,e,this.length);let n=this[t],i=1,o=0;for(;++o<e&&(i*=256);)n+=this[t+o]*i;return n},tv.prototype.readUintBE=tv.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||tC(t,e,this.length);let n=this[t+--e],i=1;for(;e>0&&(i*=256);)n+=this[t+--e]*i;return n},tv.prototype.readUint8=tv.prototype.readUInt8=function(t,e){return t>>>=0,e||tC(t,1,this.length),this[t]},tv.prototype.readUint16LE=tv.prototype.readUInt16LE=function(t,e){return t>>>=0,e||tC(t,2,this.length),this[t]|this[t+1]<<8},tv.prototype.readUint16BE=tv.prototype.readUInt16BE=function(t,e){return t>>>=0,e||tC(t,2,this.length),this[t]<<8|this[t+1]},tv.prototype.readUint32LE=tv.prototype.readUInt32LE=function(t,e){return t>>>=0,e||tC(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+0x1000000*this[t+3]},tv.prototype.readUint32BE=tv.prototype.readUInt32BE=function(t,e){return t>>>=0,e||tC(t,4,this.length),0x1000000*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},tv.prototype.readBigUInt64LE=t$(function(t){tV(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&tG(t,this.length-8);let n=e+256*this[++t]+65536*this[++t]+0x1000000*this[++t],i=this[++t]+256*this[++t]+65536*this[++t]+0x1000000*r;return BigInt(n)+(BigInt(i)<<BigInt(32))}),tv.prototype.readBigUInt64BE=t$(function(t){tV(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&tG(t,this.length-8);let n=0x1000000*e+65536*this[++t]+256*this[++t]+this[++t],i=0x1000000*this[++t]+65536*this[++t]+256*this[++t]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),tv.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||tC(t,e,this.length);let n=this[t],i=1,o=0;for(;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},tv.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||tC(t,e,this.length);let n=e,i=1,o=this[t+--n];for(;n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},tv.prototype.readInt8=function(t,e){return(t>>>=0,e||tC(t,1,this.length),128&this[t])?-((255-this[t]+1)*1):this[t]},tv.prototype.readInt16LE=function(t,e){t>>>=0,e||tC(t,2,this.length);let r=this[t]|this[t+1]<<8;return 32768&r?0xffff0000|r:r},tv.prototype.readInt16BE=function(t,e){t>>>=0,e||tC(t,2,this.length);let r=this[t+1]|this[t]<<8;return 32768&r?0xffff0000|r:r},tv.prototype.readInt32LE=function(t,e){return t>>>=0,e||tC(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},tv.prototype.readInt32BE=function(t,e){return t>>>=0,e||tC(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},tv.prototype.readBigInt64LE=t$(function(t){tV(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&tG(t,this.length-8),(BigInt(this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24))<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+0x1000000*this[++t])}),tv.prototype.readBigInt64BE=t$(function(t){tV(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&tG(t,this.length-8),(BigInt((e<<24)+65536*this[++t]+256*this[++t]+this[++t])<<BigInt(32))+BigInt(0x1000000*this[++t]+65536*this[++t]+256*this[++t]+r)}),tv.prototype.readFloatLE=function(t,e){return t>>>=0,e||tC(t,4,this.length),nm(this,t,!0,23,4)},tv.prototype.readFloatBE=function(t,e){return t>>>=0,e||tC(t,4,this.length),nm(this,t,!1,23,4)},tv.prototype.readDoubleLE=function(t,e){return t>>>=0,e||tC(t,8,this.length),nm(this,t,!0,52,8)},tv.prototype.readDoubleBE=function(t,e){return t>>>=0,e||tC(t,8,this.length),nm(this,t,!1,52,8)},tv.prototype.writeUintLE=tv.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;tN(this,t,e,r,n,0)}let i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},tv.prototype.writeUintBE=tv.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;tN(this,t,e,r,n,0)}let i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},tv.prototype.writeUint8=tv.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,1,255,0),this[e]=255&t,e+1},tv.prototype.writeUint16LE=tv.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},tv.prototype.writeUint16BE=tv.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},tv.prototype.writeUint32LE=tv.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,4,0xffffffff,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},tv.prototype.writeUint32BE=tv.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,4,0xffffffff,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},tv.prototype.writeBigUInt64LE=t$(function(t,e=0){return tk(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),tv.prototype.writeBigUInt64BE=t$(function(t,e=0){return tI(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),tv.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){let n=Math.pow(2,8*r-1);tN(this,t,e,r,n-1,-n)}let i=0,o=1,s=0;for(this[e]=255&t;++i<r&&(o*=256);)t<0&&0===s&&0!==this[e+i-1]&&(s=1),this[e+i]=(t/o>>0)-s&255;return e+r},tv.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){let n=Math.pow(2,8*r-1);tN(this,t,e,r,n-1,-n)}let i=r-1,o=1,s=0;for(this[e+i]=255&t;--i>=0&&(o*=256);)t<0&&0===s&&0!==this[e+i+1]&&(s=1),this[e+i]=(t/o>>0)-s&255;return e+r},tv.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},tv.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},tv.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},tv.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,4,0x7fffffff,-0x80000000),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},tv.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||tN(this,t,e,4,0x7fffffff,-0x80000000),t<0&&(t=0xffffffff+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},tv.prototype.writeBigInt64LE=t$(function(t,e=0){return tk(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),tv.prototype.writeBigInt64BE=t$(function(t,e=0){return tI(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),tv.prototype.writeFloatLE=function(t,e,r){return tU(this,t,e,!0,r)},tv.prototype.writeFloatBE=function(t,e,r){return tU(this,t,e,!1,r)},tv.prototype.writeDoubleLE=function(t,e,r){return tL(this,t,e,!0,r)},tv.prototype.writeDoubleBE=function(t,e,r){return tL(this,t,e,!1,r)},tv.prototype.copy=function(t,e,r,n){if(!tv.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);let i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},tv.prototype.fill=function(t,e,r,n){let i;if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!tv.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){let e=t.charCodeAt(0);("utf8"===n&&e<128||"latin1"===n)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{let o=tv.isBuffer(t)?t:tv.from(t,n),s=o.length;if(0===s)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=o[i%s]}return this};const tF={};function tB(t,e,r){tF[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function tD(t){let e="",r=t.length,n="-"===t[0]?1:0;for(;r>=n+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function tM(t,e,r,n,i,o){if(t>r||t<e){let n;let i="bigint"==typeof e?"n":"";throw n=o>3?0===e||e===BigInt(0)?`>= 0${i} and < 2${i} ** ${(o+1)*8}${i}`:`>= -(2${i} ** ${(o+1)*8-1}${i}) and < 2 ** ${(o+1)*8-1}${i}`:`>= ${e}${i} and <= ${r}${i}`,new tF.ERR_OUT_OF_RANGE("value",n,t)}tV(i,"offset"),(void 0===n[i]||void 0===n[i+o])&&tG(i,n.length-(o+1))}function tV(t,e){if("number"!=typeof t)throw new tF.ERR_INVALID_ARG_TYPE(e,"number",t)}function tG(t,e,r){if(Math.floor(t)!==t)throw tV(t,r),new tF.ERR_OUT_OF_RANGE(r||"offset","an integer",t);if(e<0)throw new tF.ERR_BUFFER_OUT_OF_BOUNDS;throw new tF.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}tB("ERR_BUFFER_OUT_OF_BOUNDS",function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),tB("ERR_INVALID_ARG_TYPE",function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`},TypeError),tB("ERR_OUT_OF_RANGE",function(t,e,r){let n=`The value of "${t}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>0x100000000?i=tD(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=tD(i)),i+="n"),n+=` It must be ${e}. Received ${i}`},RangeError);const tq=/[^+/0-9A-Za-z-_]/g;function tz(t,e){let r;e=e||1/0;let n=t.length,i=null,o=[];for(let s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319||s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return o}function tW(t){return ng(function(t){if((t=(t=t.split("=")[0]).trim().replace(tq,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function tY(t,e,r,n){let i;for(i=0;i<n&&!(i+r>=e.length)&&!(i>=t.length);++i)e[i+r]=t[i];return i}function tH(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}const tJ=function(){let t="0123456789abcdef",e=Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)e[n+i]=t[r]+t[i]}return e}();function t$(t){return"undefined"==typeof BigInt?tX:t}function tX(){throw Error("BigInt not supported")}function tZ(t){return to.isPlainObject(t)||to.isArray(t)}function tK(t){return to.endsWith(t,"[]")?t.slice(0,-2):t}function tQ(t,e,r){return t?t.concat(e).map(function(t,e){return t=tK(t),!r&&e?"["+t+"]":t}).join(r?".":""):e}const t0=to.toFlatObject(to,{},null,function(t){return/^is[A-Z]/.test(t)});var t1=function(t,e,r){if(!to.isObject(t))throw TypeError("target must be an object");e=e||new FormData;let n=(r=to.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(t,e){return!to.isUndefined(e[t])})).metaTokens,i=r.visitor||c,o=r.dots,s=r.indexes,a=(r.Blob||"undefined"!=typeof Blob&&Blob)&&to.isSpecCompliantForm(e);if(!to.isFunction(i))throw TypeError("visitor must be a function");function u(t){if(null===t)return"";if(to.isDate(t))return t.toISOString();if(!a&&to.isBlob(t))throw new ts("Blob is not supported. Use a Buffer instead.");return to.isArrayBuffer(t)||to.isTypedArray(t)?a&&"function"==typeof Blob?new Blob([t]):tv.from(t):t}function c(t,r,i){let a=t;if(t&&!i&&"object"==typeof t){if(to.endsWith(r,"{}"))r=n?r:r.slice(0,-2),t=JSON.stringify(t);else{var c;if(to.isArray(t)&&(c=t,to.isArray(c)&&!c.some(tZ))||(to.isFileList(t)||to.endsWith(r,"[]"))&&(a=to.toArray(t)))return r=tK(r),a.forEach(function(t,n){to.isUndefined(t)||null===t||e.append(!0===s?tQ([r],n,o):null===s?r:r+"[]",u(t))}),!1}}return!!tZ(t)||(e.append(tQ(i,r,o),u(t)),!1)}let l=[],p=Object.assign(t0,{defaultVisitor:c,convertValue:u,isVisitable:tZ});if(!to.isObject(t))throw TypeError("data must be an object");return!function t(r,n){if(!to.isUndefined(r)){if(-1!==l.indexOf(r))throw Error("Circular reference detected in "+n.join("."));l.push(r),to.forEach(r,function(r,o){!0===(!(to.isUndefined(r)||null===r)&&i.call(e,r,to.isString(o)?o.trim():o,n,p))&&t(r,n?n.concat(o):[o])}),l.pop()}}(t),e};function t2(t){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function t3(t,e){this._pairs=[],t&&t1(t,this,e)}const t4=t3.prototype;function t5(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function t6(t,e,r){let n;if(!e)return t;let i=r&&r.encode||t5,o=r&&r.serialize;if(n=o?o(e,r):to.isURLSearchParams(e)?e.toString():new t3(e,r).toString(i)){let e=t.indexOf("#");-1!==e&&(t=t.slice(0,e)),t+=(-1===t.indexOf("?")?"?":"&")+n}return t}t4.append=function(t,e){this._pairs.push([t,e])},t4.toString=function(t){let e=t?function(e){return t.call(this,e,t2)}:t2;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};var t8=class{constructor(){this.handlers=[]}use(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){to.forEach(this.handlers,function(e){null!==e&&t(e)})}},t7={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},t9="undefined"!=typeof URLSearchParams?URLSearchParams:t3,et="undefined"!=typeof FormData?FormData:null,ee="undefined"!=typeof Blob?Blob:null,er={};i(er,"hasBrowserEnv",()=>en),i(er,"navigator",()=>ei),i(er,"hasStandardBrowserEnv",()=>eo),i(er,"hasStandardBrowserWebWorkerEnv",()=>es),i(er,"origin",()=>ea);const en="undefined"!=typeof window&&"undefined"!=typeof document,ei="object"==typeof navigator&&navigator||void 0,eo=en&&(!ei||0>["ReactNative","NativeScript","NS"].indexOf(ei.product)),es="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,ea=en&&window.location.href||"http://localhost";var eu={...er,isBrowser:!0,classes:{URLSearchParams:t9,FormData:et,Blob:ee},protocols:["http","https","file","blob","url","data"]},ec=function(t){if(to.isFormData(t)&&to.isFunction(t.entries)){let e={};return to.forEachEntry(t,(t,r)=>{!function t(e,r,n,i){let o=e[i++];if("__proto__"===o)return!0;let s=Number.isFinite(+o),a=i>=e.length;return(o=!o&&to.isArray(n)?n.length:o,a)?to.hasOwnProp(n,o)?n[o]=[n[o],r]:n[o]=r:(n[o]&&to.isObject(n[o])||(n[o]=[]),t(e,r,n[o],i)&&to.isArray(n[o])&&(n[o]=function(t){let e,r;let n={},i=Object.keys(t),o=i.length;for(e=0;e<o;e++)n[r=i[e]]=t[r];return n}(n[o]))),!s}(to.matchAll(/\w+|\[(\w*)]/g,t).map(t=>"[]"===t[0]?"":t[1]||t[0]),r,e,0)}),e}return null};const el={transitional:t7,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){let r;let n=e.getContentType()||"",i=n.indexOf("application/json")>-1,o=to.isObject(t);if(o&&to.isHTMLForm(t)&&(t=new FormData(t)),to.isFormData(t))return i?JSON.stringify(ec(t)):t;if(to.isArrayBuffer(t)||to.isBuffer(t)||to.isStream(t)||to.isFile(t)||to.isBlob(t)||to.isReadableStream(t))return t;if(to.isArrayBufferView(t))return t.buffer;if(to.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1){var s,a;return(s=t,a=this.formSerializer,t1(s,new eu.classes.URLSearchParams,Object.assign({visitor:function(t,e,r,n){return eu.isNode&&to.isBuffer(t)?(this.append(e,t.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},a))).toString()}if((r=to.isFileList(t))||n.indexOf("multipart/form-data")>-1){let e=this.env&&this.env.FormData;return t1(r?{"files[]":t}:t,e&&new e,this.formSerializer)}}return o||i?(e.setContentType("application/json",!1),function(t,e,r){if(to.isString(t))try{return(0,JSON.parse)(t),to.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(0,JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){let e=this.transitional||el.transitional,r=e&&e.forcedJSONParsing,n="json"===this.responseType;if(to.isResponse(t)||to.isReadableStream(t))return t;if(t&&to.isString(t)&&(r&&!this.responseType||n)){let r=e&&e.silentJSONParsing;try{return JSON.parse(t)}catch(t){if(!r&&n){if("SyntaxError"===t.name)throw ts.from(t,ts.ERR_BAD_RESPONSE,this,null,this.response);throw t}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:eu.classes.FormData,Blob:eu.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};to.forEach(["delete","get","head","post","put","patch"],t=>{el.headers[t]={}});const ep=to.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);var eh=t=>{let e,r,n;let i={};return t&&t.split("\n").forEach(function(t){n=t.indexOf(":"),e=t.substring(0,n).trim().toLowerCase(),r=t.substring(n+1).trim(),!e||i[e]&&ep[e]||("set-cookie"===e?i[e]?i[e].push(r):i[e]=[r]:i[e]=i[e]?i[e]+", "+r:r)}),i};const ef=Symbol("internals");function ed(t){return t&&String(t).trim().toLowerCase()}function ey(t){return!1===t||null==t?t:to.isArray(t)?t.map(ey):String(t)}const eg=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ev(t,e,r,n,i){if(to.isFunction(n))return n.call(this,e,r);if(i&&(e=r),to.isString(e)){if(to.isString(n))return -1!==e.indexOf(n);if(to.isRegExp(n))return n.test(e)}}class em{constructor(t){t&&this.set(t)}set(t,e,r){let n=this;function i(t,e,r){let i=ed(e);if(!i)throw Error("header name must be a non-empty string");let o=to.findKey(n,i);o&&void 0!==n[o]&&!0!==r&&(void 0!==r||!1===n[o])||(n[o||e]=ey(t))}let o=(t,e)=>to.forEach(t,(t,r)=>i(t,r,e));if(to.isPlainObject(t)||t instanceof this.constructor)o(t,e);else if(to.isString(t)&&(t=t.trim())&&!eg(t))o(eh(t),e);else if(to.isHeaders(t))for(let[e,n]of t.entries())i(n,e,r);else null!=t&&i(e,t,r);return this}get(t,e){if(t=ed(t)){let r=to.findKey(this,t);if(r){let t=this[r];if(!e)return t;if(!0===e)return function(t){let e;let r=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;for(;e=n.exec(t);)r[e[1]]=e[2];return r}(t);if(to.isFunction(e))return e.call(this,t,r);if(to.isRegExp(e))return e.exec(t);throw TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=ed(t)){let r=to.findKey(this,t);return!!(r&&void 0!==this[r]&&(!e||ev(this,this[r],r,e)))}return!1}delete(t,e){let r=this,n=!1;function i(t){if(t=ed(t)){let i=to.findKey(r,t);i&&(!e||ev(r,r[i],i,e))&&(delete r[i],n=!0)}}return to.isArray(t)?t.forEach(i):i(t),n}clear(t){let e=Object.keys(this),r=e.length,n=!1;for(;r--;){let i=e[r];(!t||ev(this,this[i],i,t,!0))&&(delete this[i],n=!0)}return n}normalize(t){let e=this,r={};return to.forEach(this,(n,i)=>{let o=to.findKey(r,i);if(o){e[o]=ey(n),delete e[i];return}let s=t?i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,r)=>e.toUpperCase()+r):String(i).trim();s!==i&&delete e[i],e[s]=ey(n),r[s]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){let e=Object.create(null);return to.forEach(this,(r,n)=>{null!=r&&!1!==r&&(e[n]=t&&to.isArray(r)?r.join(", "):r)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){let r=new this(t);return e.forEach(t=>r.set(t)),r}static accessor(t){let e=(this[ef]=this[ef]={accessors:{}}).accessors,r=this.prototype;function n(t){let n=ed(t);e[n]||(!function(t,e){let r=to.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+r,{value:function(t,r,i){return this[n].call(this,e,t,r,i)},configurable:!0})})}(r,t),e[n]=!0)}return to.isArray(t)?t.forEach(n):n(t),this}}function eb(t,e){let r=this||el,n=e||r,i=em.from(n.headers),o=n.data;return to.forEach(t,function(t){o=t.call(r,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function e_(t){return!!(t&&t.__CANCEL__)}function ew(t,e,r){ts.call(this,null==t?"canceled":t,ts.ERR_CANCELED,e,r),this.name="CanceledError"}function eE(t,e,r){let n=r.config.validateStatus;!r.status||!n||n(r.status)?t(r):e(new ts("Request failed with status code "+r.status,[ts.ERR_BAD_REQUEST,ts.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}em.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),to.reduceDescriptors(em.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(t){this[r]=t}}}),to.freezeMethods(em),to.inherits(ew,ts,{__CANCEL__:!0});var eP=function(t,e){let r;let n=Array(t=t||10),i=Array(t),o=0,s=0;return e=void 0!==e?e:1e3,function(a){let u=Date.now(),c=i[s];r||(r=u),n[o]=a,i[o]=u;let l=s,p=0;for(;l!==o;)p+=n[l++],l%=t;if((o=(o+1)%t)===s&&(s=(s+1)%t),u-r<e)return;let h=c&&u-c;return h?Math.round(1e3*p/h):void 0}},eO=function(t,e){let r,n,i=0,o=1e3/e,s=(e,o=Date.now())=>{i=o,r=null,n&&(clearTimeout(n),n=null),t.apply(null,e)};return[(...t)=>{let e=Date.now(),a=e-i;a>=o?s(t,e):(r=t,n||(n=setTimeout(()=>{n=null,s(r)},o-a)))},()=>r&&s(r)]};const eS=(t,e,r=3)=>{let n=0,i=eP(50,250);return eO(r=>{let o=r.loaded,s=r.lengthComputable?r.total:void 0,a=o-n,u=i(a);n=o,t({loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:u||void 0,estimated:u&&s&&o<=s?(s-o)/u:void 0,event:r,lengthComputable:null!=s,[e?"download":"upload"]:!0})},r)},eT=(t,e)=>{let r=null!=t;return[n=>e[0]({lengthComputable:r,total:t,loaded:n}),e[1]]},ex=t=>(...e)=>to.asap(()=>t(...e));var eA=eu.hasStandardBrowserEnv?function(){let t;let e=eu.navigator&&/(msie|trident)/i.test(eu.navigator.userAgent),r=document.createElement("a");function n(t){let n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=n(window.location.href),function(e){let r=to.isString(e)?n(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0},eR=eu.hasStandardBrowserEnv?{write(t,e,r,n,i,o){let s=[t+"="+encodeURIComponent(e)];to.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),to.isString(n)&&s.push("path="+n),to.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read(t){let e=document.cookie.match(RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function eC(t,e){return t&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)?e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t:e}const eN=t=>t instanceof em?{...t}:t;function ek(t,e){e=e||{};let r={};function n(t,e,r){return to.isPlainObject(t)&&to.isPlainObject(e)?to.merge.call({caseless:r},t,e):to.isPlainObject(e)?to.merge({},e):to.isArray(e)?e.slice():e}function i(t,e,r){return to.isUndefined(e)?to.isUndefined(t)?void 0:n(void 0,t,r):n(t,e,r)}function o(t,e){if(!to.isUndefined(e))return n(void 0,e)}function s(t,e){return to.isUndefined(e)?to.isUndefined(t)?void 0:n(void 0,t):n(void 0,e)}function a(r,i,o){return o in e?n(r,i):o in t?n(void 0,r):void 0}let u={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(t,e)=>i(eN(t),eN(e),!0)};return to.forEach(Object.keys(Object.assign({},t,e)),function(n){let o=u[n]||i,s=o(t[n],e[n],n);to.isUndefined(s)&&o!==a||(r[n]=s)}),r}var eI=t=>{let e;let r=ek({},t),{data:n,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:s,headers:a,auth:u}=r;if(r.headers=a=em.from(a),r.url=t6(eC(r.baseURL,r.url),t.params,t.paramsSerializer),u&&a.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),to.isFormData(n)){if(eu.hasStandardBrowserEnv||eu.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(e=a.getContentType())){let[t,...r]=e?e.split(";").map(t=>t.trim()).filter(Boolean):[];a.setContentType([t||"multipart/form-data",...r].join("; "))}}if(eu.hasStandardBrowserEnv&&(i&&to.isFunction(i)&&(i=i(r)),i||!1!==i&&eA(r.url))){let t=o&&s&&eR.read(s);t&&a.set(o,t)}return r},ej="undefined"!=typeof XMLHttpRequest&&function(t){return new Promise(function(e,r){let n,i,o,s,a;let u=eI(t),c=u.data,l=em.from(u.headers).normalize(),{responseType:p,onUploadProgress:h,onDownloadProgress:f}=u;function d(){s&&s(),a&&a(),u.cancelToken&&u.cancelToken.unsubscribe(n),u.signal&&u.signal.removeEventListener("abort",n)}let y=new XMLHttpRequest;function g(){if(!y)return;let n=em.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders());eE(function(t){e(t),d()},function(t){r(t),d()},{data:p&&"text"!==p&&"json"!==p?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:n,config:t,request:y}),y=null}y.open(u.method.toUpperCase(),u.url,!0),y.timeout=u.timeout,"onloadend"in y?y.onloadend=g:y.onreadystatechange=function(){y&&4===y.readyState&&(0!==y.status||y.responseURL&&0===y.responseURL.indexOf("file:"))&&setTimeout(g)},y.onabort=function(){y&&(r(new ts("Request aborted",ts.ECONNABORTED,t,y)),y=null)},y.onerror=function(){r(new ts("Network Error",ts.ERR_NETWORK,t,y)),y=null},y.ontimeout=function(){let e=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded",n=u.transitional||t7;u.timeoutErrorMessage&&(e=u.timeoutErrorMessage),r(new ts(e,n.clarifyTimeoutError?ts.ETIMEDOUT:ts.ECONNABORTED,t,y)),y=null},void 0===c&&l.setContentType(null),"setRequestHeader"in y&&to.forEach(l.toJSON(),function(t,e){y.setRequestHeader(e,t)}),to.isUndefined(u.withCredentials)||(y.withCredentials=!!u.withCredentials),p&&"json"!==p&&(y.responseType=u.responseType),f&&([o,a]=eS(f,!0),y.addEventListener("progress",o)),h&&y.upload&&([i,s]=eS(h),y.upload.addEventListener("progress",i),y.upload.addEventListener("loadend",s)),(u.cancelToken||u.signal)&&(n=e=>{y&&(r(!e||e.type?new ew(null,t,y):e),y.abort(),y=null)},u.cancelToken&&u.cancelToken.subscribe(n),u.signal&&(u.signal.aborted?n():u.signal.addEventListener("abort",n)));let v=function(t){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}(u.url);if(v&&-1===eu.protocols.indexOf(v)){r(new ts("Unsupported protocol "+v+":",ts.ERR_BAD_REQUEST,t));return}y.send(c||null)})},eU=(t,e)=>{let{length:r}=t=t?t.filter(Boolean):[];if(e||r){let r,n=new AbortController,i=function(t){if(!r){r=!0,s();let e=t instanceof Error?t:this.reason;n.abort(e instanceof ts?e:new ew(e instanceof Error?e.message:e))}},o=e&&setTimeout(()=>{o=null,i(new ts(`timeout ${e} of ms exceeded`,ts.ETIMEDOUT))},e),s=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(t=>{t.unsubscribe?t.unsubscribe(i):t.removeEventListener("abort",i)}),t=null)};t.forEach(t=>t.addEventListener("abort",i));let{signal:a}=n;return a.unsubscribe=()=>to.asap(s),a}};const eL=function*(t,e){let r,n=t.byteLength;if(!e||n<e){yield t;return}let i=0;for(;i<n;)r=i+e,yield t.slice(i,r),i=r},eF=async function*(t,e){for await(let r of eB(t))yield*eL(r,e)},eB=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}let e=t.getReader();try{for(;;){let{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},eD=(t,e,r,n)=>{let i;let o=eF(t,e),s=0,a=t=>{!i&&(i=!0,n&&n(t))};return new ReadableStream({async pull(t){try{let{done:e,value:n}=await o.next();if(e){a(),t.close();return}let i=n.byteLength;if(r){let t=s+=i;r(t)}t.enqueue(new Uint8Array(n))}catch(t){throw a(t),t}},cancel:t=>(a(t),o.return())},{highWaterMark:2})},eM="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,eV=eM&&"function"==typeof ReadableStream,eG=eM&&("function"==typeof TextEncoder?(r=new TextEncoder,t=>r.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer())),eq=(t,...e)=>{try{return!!t(...e)}catch(t){return!1}},ez=eV&&eq(()=>{let t=!1,e=new Request(eu.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),eW=eV&&eq(()=>to.isReadableStream(new Response("").body)),eY={stream:eW&&(t=>t.body)};eM&&(nh=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{eY[t]||(eY[t]=to.isFunction(nh[t])?e=>e[t]():(e,r)=>{throw new ts(`Response type '${t}' is not supported`,ts.ERR_NOT_SUPPORT,r)})}));const eH=async t=>{if(null==t)return 0;if(to.isBlob(t))return t.size;if(to.isSpecCompliantForm(t)){let e=new Request(eu.origin,{method:"POST",body:t});return(await e.arrayBuffer()).byteLength}return to.isArrayBufferView(t)||to.isArrayBuffer(t)?t.byteLength:(to.isURLSearchParams(t)&&(t+=""),to.isString(t))?(await eG(t)).byteLength:void 0},eJ=async(t,e)=>{let r=to.toFiniteNumber(t.getContentLength());return null==r?eH(e):r},e$={http:null,xhr:ej,fetch:eM&&(async t=>{let e,r,{url:n,method:i,data:o,signal:s,cancelToken:a,timeout:u,onDownloadProgress:c,onUploadProgress:l,responseType:p,headers:h,withCredentials:f="same-origin",fetchOptions:d}=eI(t);p=p?(p+"").toLowerCase():"text";let y=eU([s,a&&a.toAbortSignal()],u),g=y&&y.unsubscribe&&(()=>{y.unsubscribe()});try{if(l&&ez&&"get"!==i&&"head"!==i&&0!==(r=await eJ(h,o))){let t,e=new Request(n,{method:"POST",body:o,duplex:"half"});if(to.isFormData(o)&&(t=e.headers.get("content-type"))&&h.setContentType(t),e.body){let[t,n]=eT(r,eS(ex(l)));o=eD(e.body,65536,t,n)}}to.isString(f)||(f=f?"include":"omit");let s="credentials"in Request.prototype;e=new Request(n,{...d,signal:y,method:i.toUpperCase(),headers:h.normalize().toJSON(),body:o,duplex:"half",credentials:s?f:void 0});let a=await fetch(e),u=eW&&("stream"===p||"response"===p);if(eW&&(c||u&&g)){let t={};["status","statusText","headers"].forEach(e=>{t[e]=a[e]});let e=to.toFiniteNumber(a.headers.get("content-length")),[r,n]=c&&eT(e,eS(ex(c),!0))||[];a=new Response(eD(a.body,65536,r,()=>{n&&n(),g&&g()}),t)}p=p||"text";let v=await eY[to.findKey(eY,p)||"text"](a,t);return!u&&g&&g(),await new Promise((r,n)=>{eE(r,n,{data:v,headers:em.from(a.headers),status:a.status,statusText:a.statusText,config:t,request:e})})}catch(r){if(g&&g(),r&&"TypeError"===r.name&&/fetch/i.test(r.message))throw Object.assign(new ts("Network Error",ts.ERR_NETWORK,t,e),{cause:r.cause||r});throw ts.from(r,r&&r.code,t,e)}})};to.forEach(e$,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch(t){}Object.defineProperty(t,"adapterName",{value:e})}});const eX=t=>`- ${t}`,eZ=t=>to.isFunction(t)||null===t||!1===t;var eK=t=>{let e,r;let{length:n}=t=to.isArray(t)?t:[t],i={};for(let o=0;o<n;o++){let n;if(r=e=t[o],!eZ(e)&&void 0===(r=e$[(n=String(e)).toLowerCase()]))throw new ts(`Unknown adapter '${n}'`);if(r)break;i[n||"#"+o]=r}if(!r){let t=Object.entries(i).map(([t,e])=>`adapter ${t} `+(!1===e?"is not supported by the environment":"is not available in the build"));throw new ts("There is no suitable adapter to dispatch the request "+(n?t.length>1?"since :\n"+t.map(eX).join("\n"):" "+eX(t[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r};function eQ(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ew(null,t)}function e0(t){return eQ(t),t.headers=em.from(t.headers),t.data=eb.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1),eK(t.adapter||el.adapter)(t).then(function(e){return eQ(t),e.data=eb.call(t,t.transformResponse,e),e.headers=em.from(e.headers),e},function(e){return!e_(e)&&(eQ(t),e&&e.response&&(e.response.data=eb.call(t,t.transformResponse,e.response),e.response.headers=em.from(e.response.headers))),Promise.reject(e)})}const e1="1.7.7",e2={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{e2[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const e3={};e2.transitional=function(t,e,r){function n(t,e){return"[Axios v"+e1+"] Transitional option '"+t+"'"+e+(r?". "+r:"")}return(r,i,o)=>{if(!1===t)throw new ts(n(i," has been removed"+(e?" in "+e:"")),ts.ERR_DEPRECATED);return e&&!e3[i]&&(e3[i]=!0,console.warn(n(i," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,i,o)}};var e4={assertOptions:function(t,e,r){if("object"!=typeof t)throw new ts("options must be an object",ts.ERR_BAD_OPTION_VALUE);let n=Object.keys(t),i=n.length;for(;i-- >0;){let o=n[i],s=e[o];if(s){let e=t[o],r=void 0===e||s(e,o,t);if(!0!==r)throw new ts("option "+o+" must be "+r,ts.ERR_BAD_OPTION_VALUE);continue}if(!0!==r)throw new ts("Unknown option "+o,ts.ERR_BAD_OPTION)}},validators:e2};const e5=e4.validators;class e6{constructor(t){this.defaults=t,this.interceptors={request:new t8,response:new t8}}async request(t,e){try{return await this._request(t,e)}catch(t){if(t instanceof Error){let e;Error.captureStackTrace?Error.captureStackTrace(e={}):e=Error();let r=e.stack?e.stack.replace(/^.+\n/,""):"";try{t.stack?r&&!String(t.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(t.stack+="\n"+r):t.stack=r}catch(t){}}throw t}}_request(t,e){let r,n;"string"==typeof t?(e=e||{}).url=t:e=t||{};let{transitional:i,paramsSerializer:o,headers:s}=e=ek(this.defaults,e);void 0!==i&&e4.assertOptions(i,{silentJSONParsing:e5.transitional(e5.boolean),forcedJSONParsing:e5.transitional(e5.boolean),clarifyTimeoutError:e5.transitional(e5.boolean)},!1),null!=o&&(to.isFunction(o)?e.paramsSerializer={serialize:o}:e4.assertOptions(o,{encode:e5.function,serialize:e5.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=s&&to.merge(s.common,s[e.method]);s&&to.forEach(["delete","get","head","post","put","patch","common"],t=>{delete s[t]}),e.headers=em.concat(a,s);let u=[],c=!0;this.interceptors.request.forEach(function(t){("function"!=typeof t.runWhen||!1!==t.runWhen(e))&&(c=c&&t.synchronous,u.unshift(t.fulfilled,t.rejected))});let l=[];this.interceptors.response.forEach(function(t){l.push(t.fulfilled,t.rejected)});let p=0;if(!c){let t=[e0.bind(this),void 0];for(t.unshift.apply(t,u),t.push.apply(t,l),n=t.length,r=Promise.resolve(e);p<n;)r=r.then(t[p++],t[p++]);return r}n=u.length;let h=e;for(p=0;p<n;){let t=u[p++],e=u[p++];try{h=t(h)}catch(t){e.call(this,t);break}}try{r=e0.call(this,h)}catch(t){return Promise.reject(t)}for(p=0,n=l.length;p<n;)r=r.then(l[p++],l[p++]);return r}getUri(t){return t6(eC((t=ek(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}}to.forEach(["delete","get","head","options"],function(t){e6.prototype[t]=function(e,r){return this.request(ek(r||{},{method:t,url:e,data:(r||{}).data}))}}),to.forEach(["post","put","patch"],function(t){function e(e){return function(r,n,i){return this.request(ek(i||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}e6.prototype[t]=e(),e6.prototype[t+"Form"]=e(!0)});class e8{constructor(t){let e;if("function"!=typeof t)throw TypeError("executor must be a function.");this.promise=new Promise(function(t){e=t});let r=this;this.promise.then(t=>{if(!r._listeners)return;let e=r._listeners.length;for(;e-- >0;)r._listeners[e](t);r._listeners=null}),this.promise.then=t=>{let e;let n=new Promise(t=>{r.subscribe(t),e=t}).then(t);return n.cancel=function(){r.unsubscribe(e)},n},t(function(t,n,i){r.reason||(r.reason=new ew(t,n,i),e(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}toAbortSignal(){let t=new AbortController,e=e=>{t.abort(e)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new e8(function(e){t=e}),cancel:t}}}const e7={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(e7).forEach(([t,e])=>{e7[e]=t});const e9=function t(e){let r=new e6(e),n=c(e6.prototype.request,r);return to.extend(n,e6.prototype,r,{allOwnKeys:!0}),to.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return t(ek(e,r))},n}(el);e9.Axios=e6,e9.CanceledError=ew,e9.CancelToken=e8,e9.isCancel=e_,e9.VERSION=e1,e9.toFormData=t1,e9.AxiosError=ts,e9.Cancel=e9.CanceledError,e9.all=function(t){return Promise.all(t)},e9.spread=function(t){return function(e){return t.apply(null,e)}},e9.isAxiosError=function(t){return to.isObject(t)&&!0===t.isAxiosError},e9.mergeConfig=ek,e9.AxiosHeaders=em,e9.formToJSON=t=>ec(to.isHTMLForm(t)?new FormData(t):t),e9.getAdapter=eK,e9.HttpStatusCode=e7,e9.default=e9;const{Axios:rt,AxiosError:re,CanceledError:rr,isCancel:rn,CancelToken:ri,VERSION:ro,all:rs,Cancel:ra,isAxiosError:ru,spread:rc,toFormData:rl,AxiosHeaders:rp,HttpStatusCode:rh,formToJSON:rf,getAdapter:rd,mergeConfig:ry}=e9;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n||"undefined"!=typeof self&&self;var rg={};rg.sortedIndex=function(t,e,r){for(var n=r&&"number"!=typeof e?r(e):e,i=0,o=t.length;i<o;){var s=i+o>>>1;(r?r(t[s]):t[s])<n?i=s+1:o=s}return i},Object.defineProperty(rg,"__esModule",{value:!0});var rv={NONE:0,PHRASE:1,WORD:2,CHAR:4,GRAPHIC:8,ALL:63,PUBLIC:64},rm=/^https?:\/\/uploader\.ongaaccel\.jp\/files\?guid=([a-zA-Z0-9]+)/i,rb=/^https?:\/\/songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,r_=/^uploaded:([a-zA-Z0-9]+)$/i,rw=/^songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,rE=/^https?:\/\/piapro\.jp\/t\/([^/]+)(\/[0-9]+)?$/i,rP={getSongPathFromUrl:function(t){if(rP.isUploaderUrl(t)){var e=rb.exec(t);if(e)return"songle.jp/uploads/".concat(e[1],".mp3");var r=rm.exec(t);if(r)return"songle.jp/uploads/".concat(r[1],".mp3")}return/https?:\/\/(.+)/.exec(t)[1]},isUploaderUrl:function(t){return rb.test(t)||rm.test(t)},isUploaderPath:function(t){return rw.test(t)||r_.test(t)},getUploaderGuid:function(t){var e=rw.exec(t);if(e)return e[1];var r=r_.exec(t);return r?r[1]:null},getSongUrlFromUploaderGuid:function(t){return t?"https://songle.jp/uploads/".concat(t,".mp3"):null},getAltSongUrlFromUploaderGuid:function(t){return t?"https://api.textalive.jp/songle/me/uploads/".concat(t):null},getSongUrlFromPath:function(t){var e=rP.getUploaderGuid(t);return e?rP.getSongUrlFromUploaderGuid(e):"https://".concat(t)},isYouTubeUrl:function(t){return/^https?:\/\/((www|m)\.)?youtube\.com/i.test(t)},isNicovideoUrl:function(t){return/^https?:\/\/(www\.)?nicovideo.jp/i.test(t)},isVideoSiteUrl:function(t){return rP.isYouTubeUrl(t)||rP.isNicovideoUrl(t)},isPiaproUrl:function(t){return rE.test(t)}},rO=/^https:\/\/songle\.jp\/api\/v[0-9]+\/users\/(.+)\/uploads\/(.+)$/,rS=function(t){return rO.test(t)},rT=function(t){var e=rO.exec(t);return e?{user:e[1],identifier:e[2]}:{user:null,identifier:null}},rx=function(){function t(){}return t.prototype.isLicenseLoading=function(t){return!t||!t.song||void 0===t.lyrics||void 0===t.backgroundImage},t.prototype.checkLicenses=function(t){return!this.isLicenseLoading(t)&&this.checkLicense(t.song)&&this.checkLicense(t.lyrics)&&this.checkLicense(t.backgroundImage)},t.prototype.checkLicense=function(t){return null===t||(1===t.contentType?this.checkMusicLicense(t.license):2===t.contentType?this.checkTextLicense(t.license):0===t.contentType&&(!!this.isBackgroundColorAsset(t)||this.checkBackgroundImageLicense(t.license)))},t.prototype.checkMusicLicense=function(t){return t.condition&&t.condition.uploader||!(!t.condition||t.condition.ns||t.condition.nc||t.condition.org||t.condition.clb)},t.prototype.checkTextLicense=function(t){return t.condition&&t.condition.uploader||!(!t.condition||t.condition.ns||t.condition.org||t.condition.clb)},t.prototype.checkBackgroundImageLicense=function(t){return!(!t.condition||t.condition.ns||t.condition.nc||t.condition.org||t.condition.clb)},t.prototype.isUploaderAsset=function(t){return t&&t.url&&(rP.isUploaderUrl(t.url)||rS(t.url))},t.prototype.isPiaproAsset=function(t){return t&&t.url&&rP.isPiaproUrl(t.url)},t.prototype.isBlankBackgroundAsset=function(t){return!t||!t.originalUrl},t.prototype.isBackgroundColorAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return/^#[0-9a-fA-F]{3,6}$/.test(e)},t.prototype.isBackgroundPiaproImageAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return rP.isPiaproUrl(e)},t.prototype.isBackgroundSpecialImageAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return/^snowmiku2016-([0-9]{2})$/.test(e)},t.prototype.getQueryParameter=function(t){return t&&(!t.license||this.checkBackgroundImageLicense(t.license))?t.originalUrl:null},t}(),rA=function(t,e){return(rA=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},rR=function(){return(rR=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function rC(t,e,r,n){return new(r||(r=Promise))(function(e,i){function o(t){try{a(n.next(t))}catch(t){i(t)}}function s(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?e(t.value):((n=t.value)instanceof r?n:new r(function(t){t(n)})).then(o,s)}a((n=n.apply(t,[])).next())})}function rN(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(r)throw TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}"function"==typeof SuppressedError&&SuppressedError;var rk={fallback:{protocol:"https"},songle:{domain:"songle.jp"},textalive:{domain:"api.textalive.jp"},content:{domain:"content.textalive.jp"},client:{version:"0.10.0",axios:null}};function rI(t,e,r){var n,i,o;return rC(this,0,void 0,function(){var s;return rN(this,function(a){switch(a.label){case 0:s={responseType:(null==r?void 0:r.responseType)||"json"},e&&(s.params=e),(null==r?void 0:r.auth)&&(s.auth={username:null===(n=r.auth)||void 0===n?void 0:n.username,password:null===(i=r.auth)||void 0===i?void 0:i.password}),(null==r?void 0:r.withCredentials)&&(s.withCredentials=!0),s.headers={},0===t.indexOf(rk.textalive.server)&&(rk.textalive.appToken&&(s.headers["x-ta-app-token"]=rk.textalive.appToken),rk.textalive.authUser&&rk.textalive.authToken&&(s.headers["x-ta-auth-user"]=rk.textalive.authUser,s.headers["x-ta-auth-token"]=rk.textalive.authToken)),(null==r?void 0:r.headers)&&(s.headers=rR(rR({},s.headers),r.headers)),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,((null==r?void 0:r.client)||(null===(o=rk.client)||void 0===o?void 0:o.axios)||e9).get(t,s)];case 2:return[2,a.sent()];case 3:return a.sent(),[2,null];case 4:return[2]}})})}rk.songle.protocol=rk.songle.protocol||rk.fallback.protocol,rk.songle.server="".concat(rk.songle.protocol,"://").concat(rk.songle.domain),rk.textalive.protocol=rk.textalive.protocol||rk.fallback.protocol,rk.textalive.server="".concat(rk.textalive.protocol,"://").concat(rk.textalive.domain),rk.textalive.appToken=null,rk.content.protocol=rk.content.protocol||rk.fallback.protocol,rk.content.server="".concat(rk.content.protocol,"://").concat(rk.content.domain);var rj=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}rA(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),Object.defineProperty(e.prototype,"endpoint",{get:function(){return"".concat(rk.textalive.server,"/etc/license")},enumerable:!1,configurable:!0}),e.prototype.read=function(t,e){var r;return void 0===e&&(e=!0),rC(this,0,void 0,function(){var n,i;return rN(this,function(o){switch(o.label){case 0:return[4,rI(this.endpoint,{url:t,token:function(t){var e,r,n=0;if(0===t.length)return n;for(e=0,r=t.length;e<r;e++)n=(n<<5)-n+t.charCodeAt(e)|0;return n}("ta"+t),skipOptoutCheck:!!e||void 0})];case 1:return(n=o.sent())&&200===n.status&&(null===(r=n.data)||void 0===r||!r.error)?((i=n.data).license.code=n.status,0===i.contentType&&(i.css='url("'+i.contentUrl+'")'),[2,i]):[2,{originalUrl:null,license:{code:n?n.status:404}}]}})})},e}(rx));function rU(t,e,r){var n;return rC(this,0,void 0,function(){var i;return rN(this,function(o){switch(o.label){case 0:e||(e={}),i={responseType:(null==r?void 0:r.responseType)||"json"},(null==r?void 0:r.withCredentials)&&(i.withCredentials=!0),i.headers={},0===t.indexOf(rk.textalive.server)&&(rk.textalive.appToken&&(i.headers["x-ta-app-token"]=rk.textalive.appToken),rk.textalive.authUser&&rk.textalive.authToken&&(i.headers["x-ta-auth-user"]=rk.textalive.authUser,i.headers["x-ta-auth-token"]=rk.textalive.authToken)),(null==r?void 0:r.postToken)&&(i.headers["x-ta-post-token"]=r.postToken),(null==r?void 0:r.headers)&&(i.headers||(i.headers={}),i.headers=rR(rR({},i.headers),r.headers)),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,((null==r?void 0:r.client)||(null===(n=rk.client)||void 0===n?void 0:n.axios)||e9).post(t,e,i)];case 2:return[2,o.sent()];case 3:return o.sent(),[2,null];case 4:return[2]}})})}function rL(t){return"string"==typeof t&&0===t.indexOf("data:text/plain;base64,")}function rF(t){return rL(t)?decodeURIComponent(atob(t.split(",")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join("")):null}function rB(t,e,r,n,i){var o=void 0===window.screenLeft?screen.left:window.screenLeft,s=void 0===window.screenTop?screen.top:window.screenTop,a=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-r/2+o,u=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-n/2+s,c=window.open(t,e,"width="+r+",height="+n+",top="+u+",left="+a+","+i);return window.focus&&c.focus(),c}var rD=new(function(){function t(){this.listeners=[],this.pollingTimeout=null}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return"".concat(rk.textalive.server,"/")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songleEndpoint",{get:function(){return"".concat(rk.songle.server,"/")},enumerable:!1,configurable:!0}),t.prototype.isLoading=function(){return!!this.userProfile},t.prototype.spoof=function(t){this.userProfile=t},t.prototype.getServerStatus=function(){return rC(this,0,void 0,function(){return rN(this,function(t){return[2,this.serverStatus||this.doGetServerStatus()]})})},t.prototype.doGetServerStatus=function(){return rC(this,0,void 0,function(){var t;return rN(this,function(e){switch(e.label){case 0:return this.serverStatusRequest||(this.serverStatusRequest=rI(this.endpoint,null,{withCredentials:!0})),[4,this.serverStatusRequest];case 1:return t=e.sent(),this.serverStatusRequest=null,t&&200===t.status?(this.serverStatus=t.data,[2,this.serverStatus]):[2,null]}})})},t.prototype.getProfile=function(){return rC(this,0,void 0,function(){return rN(this,function(t){return[2,this.userProfile||this.doGetProfile()]})})},t.prototype.doGetProfile=function(){return rC(this,0,void 0,function(){var t;return rN(this,function(e){switch(e.label){case 0:return this.userProfileRequest||(this.userProfileRequest=rI("".concat(this.endpoint,"profile"),null,{withCredentials:!0})),[4,this.userProfileRequest];case 1:return t=e.sent(),this.userProfileRequest=null,t&&200===t.status?(this.emitUserProfile(t.data),this.userProfile=t.data,[2,this.userProfile]):[2,null]}})})},t.prototype.getMergingUsers=function(){return rC(this,0,void 0,function(){var t;return rN(this,function(e){switch(e.label){case 0:return[4,rI("".concat(this.endpoint,"profile/merge"),null,{withCredentials:!0})];case 1:return(t=e.sent())&&200===t.status&&t.data?[2,[t.data.user,t.data.mergeWith]]:[2,[null,null]]}})})},t.prototype.mergeUsers=function(){var t;return rC(this,0,void 0,function(){var e,r,n,i,o,s;return rN(this,function(a){switch(a.label){case 0:return[4,this.getToken()];case 1:return e=a.sent(),[4,rU("".concat(this.endpoint,"profile/merge"),null,{postToken:e,withCredentials:!0})];case 2:if(!(r=a.sent())||200!==r.status||!(null===(t=r.data)||void 0===t?void 0:t.success))return[2,null];for(n=r.data.user,i=0,o=this.listeners;i<o.length;i++)(s=o[i]).onUserMerged&&s.onUserMerged(n);return[2,n]}})})},t.prototype.updateUser=function(t){var e;return rC(this,0,void 0,function(){var r,n,i,o;return rN(this,function(s){switch(s.label){case 0:return[4,this.getToken()];case 1:return r=s.sent(),[4,rU("".concat(this.endpoint,"profile"),t,{postToken:r,withCredentials:!0})];case 2:return(n=s.sent())&&200===n.status&&(null===(e=n.data)||void 0===e?void 0:e.success)?(i=n.data.user,[4,this.getProfile()]):[2,null];case 3:return(o=s.sent()).user=i,this.emitUserProfile(o),[2,i]}})})},t.prototype.isYouTubeUser=function(t){return t&&t.user&&"string"==typeof t.user.youtubeIdString},t.prototype.isPiaproUser=function(t){return t&&t.user&&"string"==typeof t.user.piaproIdString},t.prototype.isSongleUser=function(t){return t&&t.user&&("number"==typeof t.user.songleUserId&&t.user.songleUserId>=0||"string"==typeof t.user.songleAccessToken)},t.prototype.isSpoofingSongleUser=function(t){return this.isSongleUser(t)&&("number"!=typeof t.user.id||t.user.id<0)},t.prototype.addListener=function(t){t&&this.listeners.push(t)},t.prototype.removeListener=function(t){this.listeners=this.listeners.filter(function(e){return e!==t})},t.prototype.emitUserProfile=function(t){this.userProfile=t;for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onUserProfileUpdated&&n.onUserProfileUpdated(t),this.userProfile.user?n.onUserLoggedIn&&n.onUserLoggedIn(t.user):n.onUserLoggedOut&&n.onUserLoggedOut()}},t.prototype.authenticate=function(t,e){return rC(this,0,void 0,function(){var r;return rN(this,function(n){switch(n.label){case 0:return[4,rI("".concat(this.endpoint,"profile/logins/basic"),null,{auth:{username:String(t),password:e},withCredentials:!0})];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,r.data]:[2,null]}})})},t.prototype.loginTwitter=function(t){return this.login(t,"twitter")},t.prototype.loginGitHub=function(t){return this.login(t,"github")},t.prototype.loginYouTube=function(t){return this.login(t,"youtube")},t.prototype.loginPiapro=function(t){return this.login(t,"piapro")},t.prototype.loginSongle=function(t){return this.login(t,"songle")},t.prototype.login=function(t,e){return t&&t.preventDefault(),!!e&&(rB("".concat(this.endpoint,"profile/logins/").concat(e),"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1)},t.prototype.logoutTwitter=function(t){return this.logout(t,"twitter")},t.prototype.logoutGitHub=function(t){return this.logout(t,"github")},t.prototype.logoutYouTube=function(t){return this.logout(t,"youtube")},t.prototype.logoutPiapro=function(t){return this.logout(t,"piapro")},t.prototype.logoutSongle=function(t){return this.logout(t,"songle")},t.prototype.logout=function(t,e){return void 0===e&&(e=null),t&&t.preventDefault(),rB("".concat(this.endpoint,"profile/logouts/").concat(e||"all"),"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1},t.prototype.startMonitoringAuthState=function(){var t=this;this.pollingTimeout&&(clearTimeout(this.pollingTimeout),this.pollingTimeout=null);var e=function(r){if(r.data&&r.data.textalive){if(r.source.postMessage("close",r.origin),r.data.merge)return t.getMergingUsers().then(function(e){for(var r=e[0],n=e[1],i=0,o=t.listeners;i<o.length;i++){var s=o[i];s.onUserMergeRequired&&s.onUserMergeRequired(r,n)}}).catch(function(){}),void window.removeEventListener("message",e);t.doGetProfile(),window.removeEventListener("message",e)}};window.addEventListener("message",e)},t.prototype.getToken=function(){return rC(this,0,void 0,function(){return rN(this,function(t){return this.userProfile?[2,this.userProfile.status.token]:this.token?[2,this.token]:[2,this.doGetToken()]})})},t.prototype.doGetToken=function(){var t;return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.endpoint,"profile/token"),null,{withCredentials:!0})];case 1:return(null===(t=null==(e=r.sent())?void 0:e.data)||void 0===t?void 0:t.token)&&(this.token=e.data.token),[2,this.token]}})})},t}()),rM=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return"".concat(rk.textalive.server,"/text-parser/")},enumerable:!1,configurable:!0}),t.prototype.parse=function(t){return rC(this,0,void 0,function(){var e,r;return rN(this,function(n){switch(n.label){case 0:return[4,rD.getToken()];case 1:return e=n.sent(),[4,rU(this.endpoint,{text:t},{postToken:e,withCredentials:!0})];case 2:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}})})},t}()),rV=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return"".concat(rk.content.server,"/fonts")},enumerable:!1,configurable:!0}),t.prototype.listAvailableFonts=function(){return rC(this,0,void 0,function(){var t=this;return rN(this,function(e){switch(e.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:e.sent(),e.label=2;case 2:return this.data&&this.data.fontFamilies?[2,Object.keys(this.data.fontFamilies).map(function(e){return rR({key:e},t.data.fontFamilies[e])})]:[2,[]]}})})},t.prototype.getFrequentChars=function(){return rC(this,0,void 0,function(){return rN(this,function(t){switch(t.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:t.sent(),t.label=2;case 2:return[2,this.data&&this.data.frequentChars||""]}})})},t.prototype.clearCache=function(){this.data=null},t.prototype.fetchInfo=function(){return rC(this,0,void 0,function(){var t,e,r,n;return rN(this,function(i){switch(i.label){case 0:return[4,rI("".concat(this.endpoint,"/index.json"))];case 1:if(!(t=i.sent())||200!==t.status||!t.data)return this.data=null,[2,null];for(r in this.data=t.data,e=this.data.fontUrlPrefix,this.data.fontFamilies)(n=this.data.fontFamilies[r]).typesquare||n.typekit||n.google||n.url||(n.url="".concat(e,"/").concat(r,"-all.css"),n.compactUrl="".concat(e,"/").concat(r,".css"));return[2]}})})},t}()),rG=RegExp("\\b([CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*(?:[CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*)*\\-){2}");function rq(t,e,r){return!rG.test(t)&&!t.match(/[(].+(?:|).*[)]/)&&(!t.match(/(|).+(|)/)||0!==e&&e!==r.length-2)}function rz(t){return!t.match(RegExp("[(]?"))}var rW={},rY={};function rH(t,e,r){var n,i=this;return"undefined"==typeof window||!(null===(n=null==window?void 0:window.navigator)||void 0===n?void 0:n.userAgent)||window.navigator.userAgent.includes("Node.js")||window.navigator.userAgent.includes("jsdom")?(r&&console.log("parse lyrics: loading on Node.js",t),new Promise(function(r,n){rI(t,{responseType:"text"}).then(function(t){var i=t.data,o=Function("let g=global;global={};".concat(i,";let res=global;global=g")),s={};try{o.bind(s)(),r(e(s))}catch(t){n(t)}}).catch(n)})):(r&&console.log("parse lyrics: loading",t),new Promise(function(n,o){try{var s=document.createElement("script"),a=null;window.module&&(a=window.module,delete window.module),s.src=t,s.onload=function(){return rC(i,0,void 0,function(){var i,u;return rN(this,function(c){switch(c.label){case 0:document.body.removeChild(s),r&&console.log("parse lyrics: load",t),window.Songle&&window.Songle.Utils&&window.Songle.Utils.url2Lyric||(a&&(window.module=a),o("url2Lyric not found")),c.label=1;case 1:return c.trys.push([1,3,4,5]),i=n,[4,e(window)];case 2:return i.apply(void 0,[c.sent()]),[3,5];case 3:return u=c.sent(),o(u),[3,5];case 4:return a&&(window.module=a),[7];case 5:return[2]}})})},s.onerror=function(t){return o(t.message)},document.body.appendChild(s)}catch(e){console.error("failed to call lyrics parser",t,e)}}))}var rJ=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return"".concat(rk.songle.server,"/lyrics/")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localLyricsEndpoint",{get:function(){return"".concat(rk.textalive.server,"/etc/lyrics")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timingEndpoint",{get:function(){return"".concat(rk.songle.server,"/songs/")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsParserEndpoint",{get:function(){return rk.songle.server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsPostEndpoint",{get:function(){return rk.songle.server},enumerable:!1,configurable:!0}),t.prototype.isUploaderUrl=function(t){return rS(t)},t.prototype.parseUploaderUrl=function(t){return rT(t)},t.prototype.getRecentlySynchronizedList=function(t){return void 0===t&&(t={}),rC(this,0,void 0,function(){var e,r;return rN(this,function(n){switch(n.label){case 0:return e={},"number"==typeof t?e.page=t:t&&(e.page=t.page,e.per_page=t.perPage),[4,rI("".concat(this.endpoint,"recently_synchronized.json"),e)];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}})})},t.prototype.load=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.timingEndpoint+t,"/lyrics.json"))];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}})})},t.prototype.clearCache=function(){rW={}},t.prototype.loadDetail=function(t,e){return rC(this,0,void 0,function(){var r,n;return rN(this,function(i){switch(i.label){case 0:return rW[t]&&rW[t][e]?[2,rW[t][e]]:[4,rI("".concat(this.timingEndpoint+t,"/lyrics/").concat(e<0?"latest":e,".json"))];case 1:return(r=i.sent())&&200===r.status?(n=r.data,rW[t]||(rW[t]={}),rW[t][n.id]=n,e<0&&(rW[t][-1]=n),[2,n]):[2,null]}})})},t.prototype.loadDiffs=function(t,e){return rC(this,0,void 0,function(){var r;return rN(this,function(n){switch(n.label){case 0:return[4,rI("".concat(this.timingEndpoint+t,"/lyrics/").concat(e,"/diffs.json"))];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}})})},t.prototype.loadDiff=function(t,e,r){return rC(this,0,void 0,function(){return rN(this,function(n){switch(n.label){case 0:return[4,rI("".concat(this.timingEndpoint+t,"/lyrics/").concat(e).concat(r<0?"":0===r?"/original":"/diffs/".concat(r,"/lyrics"),".json"))];case 1:return[2,n.sent().data]}})})},t.prototype.loadAllRevisionsForSong=function(t){return rC(this,0,void 0,function(){var e,r,n,i,o,s,a,u,c,l;return rN(this,function(p){switch(p.label){case 0:return[4,this.load(t)];case 1:if(!(e=p.sent()))return[2,null];r=[],n=0,i=e.lyrics,p.label=2;case 2:return n<i.length?(o=i[n],[4,this.loadDetail(t,o.id)]):[3,6];case 3:return s=p.sent(),[4,this.loadDiffs(t,s.id)];case 4:if(a=p.sent(),r.push({lyrics:s,updated_at:new Date(s.created_at)}),Array.isArray(a))for(u=0,c=a;u<c.length;u++)l=c[u],r.push({diff_id:l.id,source_id:l.source_id,lyrics:s,updated_at:new Date(l.updated_at)});p.label=5;case 5:return n++,[3,2];case 6:return[2,r.sort(function(t,e){var r=e.updated_at.getTime()-t.updated_at.getTime();return 0===r?e.diff_id-t.diff_id:r})]}})})},t.prototype.getLatestRevision=function(t){return t.filter(function(t){return!(t.lyrics.processing||t.lyrics.failed)})[0]},t.prototype.fetchLocalLyricBody=function(t){return rC(this,0,void 0,function(){var e,r,n,i;return rN(this,function(o){switch(o.label){case 0:return this.verbose&&("string"==typeof t?console.log("load locally-stored lyrics for song code",t):console.log("load locally-stored lyrics for lyric id",t)),e={},"string"==typeof t?e.code=t:e.lyricId=t,[4,rI("".concat(this.localLyricsEndpoint,"/token"),e)];case 1:return(r=o.sent())&&200===r.status&&!r.data.error?(n=r.data.token,e.token=n,[4,rI(this.localLyricsEndpoint,e)]):[2,null];case 2:return(i=o.sent())&&200===i.status?(this.verbose&&console.log("loaded locally-stored lyrics with params",e),[2,i.data]):[2,null]}})})},t.prototype.fetchSongleLyricBody=function(t,e){return rC(this,0,void 0,function(){var r,n,i,o,s,a,u,c;return rN(this,function(l){switch(l.label){case 0:if(!(r=this.parseUploaderUrl(t)).identifier)throw Error("unsupported lyrics url ".concat(t));return[4,rD.getProfile()];case 1:if(n=l.sent(),!rD.isSongleUser(n))throw Error("Songle authentication is required");return rY[i="".concat(t,"//").concat(e)]?[2,rY[i]]:(rD.isSpoofingSongleUser(n)&&(o={songleUserId:(s=n.user).songleUserId,songleAccessToken:s.songleAccessToken,songleRefreshToken:s.songleRefreshToken}),[4,rI("".concat(rk.textalive.server,"/songle/users/").concat(r.user,"/uploads/").concat(r.identifier),o,{withCredentials:!0,responseType:"text"})]);case 2:return c=(u=null==(a=l.sent())?void 0:a.data)?{text:u,url:t}:null,u&&(rY[i]=c),[2,c]}})})},t.prototype.fetchPiaproLyricBody=function(t,e){return rC(this,0,void 0,function(){var r,n,i,o,s;return rN(this,function(a){switch(a.label){case 0:if(!rP.isPiaproUrl(t))throw Error("unsupported lyrics url ".concat(t));return rY[r="".concat(t,"//").concat(e)]?[2,rY[r]]:[4,rj.read(t,!0)];case 1:if(n=a.sent(),!rj.isPiaproAsset(n))throw Error("unsupported piapro lyrics url ".concat(t));return i=rF(n.contentUrl),[4,this.parseLyricBody(i,e)];case 2:return(s=(o=a.sent())?{text:o,artist:{name:n.authorName,url:n.authorPath?"https://piapro.jp".concat(n.authorPath):null},name:n.name,url:t}:null)&&(rY[r]=s),[2,s]}})})},t.prototype.fetchInternalLyricBody=function(t,e){return rC(this,0,void 0,function(){var r;return rN(this,function(n){if(r=new URL(t),"undefined"==typeof location||location.protocol!==r.protocol||location.hostname!==r.hostname)throw Error("direct access not supported for lyrics url ".concat(t));return[2,this.fetchCrossOriginLyricBody(t,e)]})})},t.prototype.fetchCrossOriginLyricBody=function(t,e){return rC(this,0,void 0,function(){var r,n,i,o,s;return rN(this,function(a){switch(a.label){case 0:return rY[r="".concat(t,"//").concat(e)]?[2,rY[r]]:[4,rI(t,null,{responseType:"text"})];case 1:return i=null==(n=a.sent())?void 0:n.data,n&&200===n.status&&i?[4,this.parseLyricBody(i,e)]:(this.verbose&&console.error("direct access not supported for lyrics url ".concat(t)),[2,this.fetchProxiedLyricBody(t,e)]);case 2:return(s=(o=a.sent())?{text:o,url:t}:null)&&(rY[r]=s),[2,s]}})})},t.prototype.fetchProxiedLyricBody=function(t,e){return rC(this,0,void 0,function(){var r,n,i;return rN(this,function(o){switch(o.label){case 0:return rY[r="".concat(t,"//").concat(e)]?[2,rY[r]]:(this.verbose&&console.log("load lyrics from the external server",t),[4,rH(this.lyricsParserEndpoint+e,function(e){return new Promise(function(r,n){e.Songle.Utils.url2Lyric(t,function(t){return r(t)},function(t){return n(t)})})},this.verbose)]);case 1:return(i=(n=o.sent())?{text:n,url:t}:null)&&(rY[r]=i),[2,i]}})})},t.prototype.parseLyricBody=function(t,e){return rC(this,0,void 0,function(){var r;return rN(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,rH(this.lyricsParserEndpoint+e,function(e){return e.Songle.Utils.parseLyric(t)},this.verbose)];case 1:return r=n.sent(),[3,3];case 2:var i,o,s,a,u;return n.sent(),(s=(i=t.replace(/^\ufeff/,"").replace(/\r/,"").split(/\n/).filter(rq).filter(function(t){return!t.match(/^#/)}).join("\n").replace(/^\s+/,"")).split(/\n/)).forEach(function(t,e){t.match(/^\S+\S+$/m)&&(o=e)}),a=function(t){for(var e,r,n,i,o,s=RegExp("[(]?(.)[)]?","g");null!==(r=s.exec(t));)i=RegExp("^("+(n=r[1])+"[\\s\\S]+?)(?=\\n\\n[^\\u3000|\\s])","m"),null!==(o=t.match(i))&&(e=o[1].replace(RegExp("^"+n,"m"),"").replace(RegExp("^\\n"),"").replace(RegExp("^\\u3000","mg"),""),t=(t=t.replace(i,function(){return e})).replace(RegExp("[\\(]?"+n+"[\\)]?","g"),e).replace(RegExp("^"+n,"m"),""));return t}((void 0!==o&&o<5?s.slice(o+1).join("\n"):i).split(/\n/).filter(rq).join("\n")),u=RegExp("[\\u4E00-\\u9FAF|\\uFF66-\\uFF9D|\\u31F0-\\u31FF]+[\\(]([\\u3041-\\u3096\\u309D-\\u309F]+)[\\)]","g"),r=a.replace(u,function(t,e){return e}).split(/\n/).filter(rz).join("\n").replace(/\n\n+/g,"\n\n").replace(/\n+$/g,"\n"),[3,3];case 3:return[2,r]}})})},t.prototype.clearLyricBodyCache=function(){rY={}},t.prototype.fetchLyricBody=function(t,e){var r,n,i=e.parserPath,o=e.directAccess;return rC(this,0,void 0,function(){var e,s;return rN(this,function(a){switch(a.label){case 0:if(rL(t))return this.verbose&&console.log("load lyrics from the data url",t),[2,{text:rF(t)}];if(this.isUploaderUrl(t))return[2,this.fetchSongleLyricBody(t,i)];if(rP.isPiaproUrl(t))return[2,this.fetchPiaproLyricBody(t,i)];a.label=1;case 1:return a.trys.push([1,5,,6]),e=new URL(t),o||"undefined"!=typeof location&&location.protocol!==e.protocol&&"https:"!==e.protocol?[3,4]:"undefined"!=typeof location&&location.hostname!==e.hostname?[3,2]:(o=!0,[3,4]);case 2:return[4,rI("".concat(this.localLyricsEndpoint,"/cors"),{url:t})];case 3:o=(s=a.sent())&&200===s.status&&(null===(n=null===(r=s.data)||void 0===r?void 0:r.data)||void 0===n?void 0:n.enabled),a.label=4;case 4:return o?(this.verbose&&console.log("load lyrics directly",t),[2,this.fetchCrossOriginLyricBody(t,i)]):[3,6];case 5:return a.sent(),[3,6];case 6:return[2,this.fetchProxiedLyricBody(t,i)]}})})},t.prototype.post=function(t){return rC(this,0,void 0,function(){var e,r;return rN(this,function(n){switch(n.label){case 0:return e=t.forceUpdate?{url:t.lyricsUrl,force_create:"true"}:{url:t.lyricsUrl},[4,rU("".concat(this.lyricsPostEndpoint,"/songs/").concat(t.songId,"/lyrics.json"),e)];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,{success:!0,lyricsId:r.data.id}]:[2,{success:!1,error:"failed to update lyrics url"}]}})})},t.prototype.postPrivate=function(t){return rC(this,0,void 0,function(){var e,r,n,i,o,s,a,u;return rN(this,function(c){switch(c.label){case 0:return[4,rD.getProfile()];case 1:if(e=c.sent(),!rD.isSongleUser(e))throw Error("Songle authentication is required");return r=rD.isSpoofingSongleUser(e)?"?"+Object.keys(i={songleUserId:(n=e.user).songleUserId,songleAccessToken:n.songleAccessToken,songleRefreshToken:n.songleRefreshToken}).map(function(t){return"".concat(t,"=").concat(encodeURIComponent(i[t]))}).join("&"):"",o=t.songId,s=t.lyricsText,(a=new FormData).append("text",s),[4,rU("".concat(rk.textalive.server,"/songle/me/songs/").concat(o,"/lyrics.json").concat(r),a,{withCredentials:!0})];case 2:return(u=c.sent())&&200===u.status&&u.data?[2,{success:!0,lyrics:u.data.data.lyric}]:[2,{success:!1,error:"failed to post lyrics text"}]}})})},t.prototype.update=function(t){var e;return rC(this,0,void 0,function(){var r;return rN(this,function(n){switch(n.label){case 0:return[4,rU("".concat(this.lyricsPostEndpoint,"/songs/").concat(t.songCode,"/lyrics/").concat(t.lyricsId,"/diffs.json"),t.lyricsData?{lyric:JSON.stringify(t.lyricsData)}:{source_diff_id:t.lyricsDiffId})];case 1:return[2,(null===(e=null==(r=n.sent())?void 0:r.data)||void 0===e?void 0:e.lyric_diff)?{success:200===r.status,lyricsId:r.data.lyric_diff.lyric_id,lyricsDiffId:r.data.lyric_diff.id}:{success:200===r.status}]}})})},t}()),r$={},rX={},rZ=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return rk.textalive.server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songleEndpoint",{get:function(){return rk.songle.server},enumerable:!1,configurable:!0}),t.prototype.getSongPathFromUrl=function(t){return rP.getSongPathFromUrl(t)},t.prototype.isUploaderUrl=function(t){return rP.isUploaderUrl(t)},t.prototype.isUploaderPath=function(t){return rP.isUploaderPath(t)},t.prototype.getUploaderGuid=function(t){return rP.getUploaderGuid(t)},t.prototype.getAltSongUrlFromUploaderGuid=function(t){return rP.getAltSongUrlFromUploaderGuid(t)},t.prototype.getSongUrlFromUploaderGuid=function(t){return rP.getSongUrlFromUploaderGuid(t)},t.prototype.getSongUrlFromPath=function(t){return rP.getSongUrlFromPath(t)},t.prototype.isYouTubeUrl=function(t){return rP.isYouTubeUrl(t)},t.prototype.isNicovideoUrl=function(t){return rP.isNicovideoUrl(t)},t.prototype.isVideoSiteUrl=function(t){return rP.isVideoSiteUrl(t)},t.prototype.isPiaproUrl=function(t){return rP.isPiaproUrl(t)},t.prototype.load=function(t){return rC(this,0,void 0,function(){var e,r;return rN(this,function(n){switch(n.label){case 0:return r$[e=t.code||"number"==typeof t.id&&String(t.id)||encodeURIComponent(t.songPath)]?[2,r$[e]]:(r$[e]=this.doLoad(e),[4,r$[e]]);case 1:return r=n.sent(),this.use(r),[2,r]}})})},t.prototype.use=function(t){if(t){var e=String(t.song.id),r=t.song.code,n=this.getSongPathFromUrl(t.song.permalink);r$[e]=r$[r]=r$[n]=Promise.resolve(t)}},t.prototype.clearCache=function(){r$={},rX={}},t.prototype.doLoad=function(t){var e;return rC(this,0,void 0,function(){var r,n,i;return rN(this,function(o){switch(o.label){case 0:return[4,rI("".concat(this.songleEndpoint,"/songs/").concat(t,"?format=json"))];case 1:return(r=o.sent())&&200===r.status?(n=r.data,this.isUploaderUrl(null===(e=null==n?void 0:n.song)||void 0===e?void 0:e.permalink)?[4,this.doLoadPrivateSong(n.song.id)]:[3,3]):[2,null];case 2:if(i=o.sent())return n.status=n.status||{},n.status.owner=!0,[2,rR(rR({},n),{song:i})];n.status=n.status||{},n.status.owner=!1,o.label=3;case 3:return[2,n]}})})},t.prototype.doLoadPrivateSong=function(t){var e,r;return rC(this,0,void 0,function(){var n,i,o,s;return rN(this,function(a){switch(a.label){case 0:return[4,rD.getProfile()];case 1:return n=a.sent(),rD.isSongleUser(n)?(rD.isSpoofingSongleUser(n)&&(i={songleUserId:(o=n.user).songleUserId,songleAccessToken:o.songleAccessToken,songleRefreshToken:o.songleRefreshToken}),[4,rI("".concat(this.endpoint,"/songle/me/songs/").concat(t,".json"),i,{withCredentials:!0})]):[2,null];case 2:return(s=a.sent())&&200===s.status&&(null===(r=null===(e=s.data)||void 0===e?void 0:e.data)||void 0===r?void 0:r.song)?[2,s.data.data.song]:[2,null]}})})},t.prototype.loadInfo=function(t,e){return rC(this,0,void 0,function(){var r;return rN(this,function(n){return rX[r=this.cacheKey(t,e)]||(rX[r]=this.doLoadInfo(t,{min:!0,revisions:null==e?void 0:e.revisions})),[2,rX[r]]})})},t.prototype.loadDetailInfo=function(t,e){return rC(this,0,void 0,function(){var r;return rN(this,function(n){return rX[r=this.cacheKey(t,e)+"/dt"]||(rX[r]=this.doLoadInfo(t,{min:!1,revisions:null==e?void 0:e.revisions})),[2,rX[r]]})})},t.prototype.cacheKey=function(t,e){var r=String(t);return(null==e?void 0:e.revisions)&&("number"==typeof e.revisions.chord&&(r+="/cd"+e.revisions.chord),"number"==typeof e.revisions.beat&&(r+="/bt"+e.revisions.beat),"number"==typeof e.revisions.chorus&&(r+="/cr"+e.revisions.chorus)),r},t.prototype.doLoadInfo=function(t,e){var r=void 0===e?{min:!0}:e,n=r.min,i=r.revisions;return rC(this,0,void 0,function(){var e,r;return rN(this,function(o){switch(o.label){case 0:return e={min:n?1:0},"number"==typeof(null==i?void 0:i.chord)&&(e.chord_revision_id=i.chord),"number"==typeof(null==i?void 0:i.beat)&&(e.beat_revision_id=i.beat),"number"==typeof(null==i?void 0:i.chorus)&&(e.chorus_revision_id=i.chorus),[4,rI("".concat(this.songleEndpoint,"/songs/").concat(t,"/info.json"),e)];case 1:return(r=o.sent())&&200===r.status?[2,r.data]:[2,null]}})})},t.prototype.loadVocalAmplitude=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.songleEndpoint,"/songs/").concat(t,"/vamplitude.json"))];case 1:return(e=r.sent())&&200===e.status&&e.data?[2,e.data]:[2,null]}})})},t.prototype.loadValenceArousal=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.songleEndpoint,"/songs/").concat(t,"/av.json"))];case 1:return(e=r.sent())&&200===e.status&&e.data?[2,e.data]:[2,null]}})})},t.prototype.list=function(t){return void 0===t&&(t={}),rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI(this.endpoint+"/songs",t)];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}})})},t.prototype.listPrivate=function(t){return void 0===t&&(t={}),rC(this,0,void 0,function(){var e,r,n,i;return rN(this,function(o){switch(o.label){case 0:return[4,rD.getProfile()];case 1:return e=o.sent(),rD.isSongleUser(e)?(r={},rD.isSpoofingSongleUser(e)&&(r={songleUserId:(n=e.user).songleUserId,songleAccessToken:n.songleAccessToken,songleRefreshToken:n.songleRefreshToken}),"number"==typeof t.page&&(r.page=t.page),"number"==typeof t.perPage&&(r.per_page=t.perPage),[4,rI("".concat(this.endpoint,"/songle/me/songs.json"),rR(rR({},r),{private:!0}),{withCredentials:!0})]):[2,{data:null,error:"Songle authentication is required"}];case 2:return(i=o.sent())&&200===i.status?[2,i.data]:[2,{data:null,error:"private songs not found"}]}})})},t.prototype.create=function(t){return rC(this,0,void 0,function(){return rN(this,function(e){return[2,this.doCreate(t,!1)]})})},t.prototype.createPrivate=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rD.getProfile()];case 1:return e=r.sent(),rD.isSongleUser(e)?[2,this.doCreate(t,!0)]:[2,{success:!1,song:null,error:"Songle authentication is required"}]}})})},t.prototype.doCreate=function(t,e){var r,n;return rC(this,0,void 0,function(){var i,o,s,a,u;return rN(this,function(c){switch(c.label){case 0:return i=t.url,o=t.name,s=t.artistName,[4,rD.getToken()];case 1:return a=c.sent(),[4,rU(e?this.endpoint+"/etc/songs/private":this.endpoint+"/etc/songs",{url:i,name:o,artist:s},{postToken:a,withCredentials:!0})];case 2:return(u=c.sent())&&200===u.status?e?[2,{success:!0,song:u.data.data.song}]:[2,{success:!0,song:u.data.song}]:[2,{success:!1,error:((null===(r=null==u?void 0:u.data)||void 0===r?void 0:r.data)?u.data.data.message:null===(n=null==u?void 0:u.data)||void 0===n?void 0:n.message)||"failed to register a song"}]}})})},t.prototype.uploadPrivate=function(t){return rC(this,0,void 0,function(){var e,r,n,i,o,s;return rN(this,function(a){switch(a.label){case 0:return[4,rD.getProfile()];case 1:if(e=a.sent(),!rD.isSongleUser(e))throw Error("Songle authentication is required");return r=rD.isSpoofingSongleUser(e)?"?"+Object.keys(i={songleUserId:(n=e.user).songleUserId,songleAccessToken:n.songleAccessToken,songleRefreshToken:n.songleRefreshToken}).map(function(t){return"".concat(t,"=").concat(encodeURIComponent(i[t]))}).join("&"):"",(o=new FormData).append("file",t),[4,rU("".concat(this.endpoint,"/songle/me/uploads.json").concat(r),o,{withCredentials:!0})];case 2:return(s=a.sent())&&200===s.status&&s.data?[2,s.data.data]:[2,null]}})})},t.prototype.search=function(t,e){return void 0===e&&(e=!0),rC(this,0,void 0,function(){var r;return rN(this,function(n){switch(n.label){case 0:return[4,rI("".concat(this.songleEndpoint,"/songs/search.json"),{q:t,lyrics:e?1:0})];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,{success:!0,data:r.data}]:[2,{success:!1}]}})})},t.prototype.copySongMap=function(t){var e;return rC(this,0,void 0,function(){var r,n,i,o;return rN(this,function(s){switch(s.label){case 0:return r=t.sourceId,n=t.destinationId,i=t.types||["beat","chord","chorus","melody"],[4,rU("".concat(this.endpoint,"/songle/me/songs/").concat(n,"/actions/copy_music_map.json"),{source_id:r,types:i},{withCredentials:!0})];case 1:return(o=s.sent())&&(null===(e=o.data)||void 0===e?void 0:e.success)?[2,{success:!0}]:[2,{success:!1,error:null==o?void 0:o.data}]}})})},t.prototype.createStage=function(){var t;return rC(this,0,void 0,function(){var e,r;return rN(this,function(n){switch(n.label){case 0:return[4,rD.getProfile()];case 1:return e=n.sent(),[4,rU("".concat(this.endpoint,"/etc/songs/stage"),null,{postToken:null===(t=null==e?void 0:e.status)||void 0===t?void 0:t.token,withCredentials:!0})];case 2:return[2,(null==(r=n.sent())?void 0:r.data)||null]}})})},t}()),rK=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return"".concat(rk.textalive.server,"/templates/")},enumerable:!1,configurable:!0}),t.prototype.list=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.endpoint),t)];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}})})},t.prototype.load=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.endpoint+t))];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}})})},t.prototype.loadByName=function(t){return rC(this,0,void 0,function(){var e,r,n;return rN(this,function(i){switch(i.label){case 0:return r="latest",t&&(e=t.match(/(.+)@([0-9]+)/))&&(t=e[1],r=e[2]),[4,rI("".concat(this.endpoint+t,"/").concat(r))];case 1:return(n=i.sent())&&200===n.status?[2,n.data]:"latest"!==r?[2,this.loadByName(t)]:[2,null]}})})},t.prototype.loadForVideo=function(t,e){return void 0===e&&(e={script:!0,withoutAuthors:!0}),rC(this,0,void 0,function(){var r;return rN(this,function(n){switch(n.label){case 0:return[4,rI("".concat(this.endpoint,"for/").concat(t),e)];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}})})},t.prototype.create=function(t){return rC(this,0,void 0,function(){var e,r,n;return rN(this,function(i){switch(i.label){case 0:return[4,rD.getToken()];case 1:return e=i.sent(),[4,rU(this.endpoint,t,{postToken:e,withCredentials:!0})];case 2:return(r=i.sent())?200!==r.status||Array.isArray(r.data)||r.data.error?(n=Array.isArray(r.data)?{parseErrors:r.data}:r.data,[2,rR(rR({},n),{success:!1})]):[2,rR(rR({},r.data),{success:!0})]:[2,{success:!1}]}})})},t.prototype.listContributors=function(t,e){return rC(this,0,void 0,function(){var r;return rN(this,function(n){switch(n.label){case 0:return[4,rI("".concat(this.endpoint).concat(t,"/").concat(e,"/contributors"))];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}})})},t}()),rQ=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return"".concat(rk.textalive.server,"/videos/")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendererEndpoint",{get:function(){return"".concat(rk.textalive.server,"/renderer/")},enumerable:!1,configurable:!0}),t.prototype.list=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.endpoint),t)];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}})})},t.prototype.load=function(t){return rC(this,0,void 0,function(){var e,r,n,i;return rN(this,function(o){switch(o.label){case 0:return e={},[4,rD.getProfile()];case 1:return r=o.sent(),rD.isSpoofingSongleUser(r)&&(e={songleUserId:(n=r.user).songleUserId,songleAccessToken:n.songleAccessToken,songleRefreshToken:n.songleRefreshToken}),[4,rI("".concat(this.endpoint+t),e,{withCredentials:!0})];case 2:return(i=o.sent())&&200===i.status?[2,i.data]:[2,null]}})})},t.prototype.create=function(t){return rC(this,0,void 0,function(){var e,r;return rN(this,function(n){switch(n.label){case 0:return[4,rD.getToken()];case 1:return e=n.sent(),[4,rU(this.endpoint,t,{postToken:e,withCredentials:!0})];case 2:return(r=n.sent())?200!==r.status||r.data.error?[2,rR(rR({},r.data),{success:!1})]:[2,rR(rR({},r.data),{success:!0})]:[2,{success:!1}]}})})},t.prototype.delete=function(t){return rC(this,0,void 0,function(){var e,r;return rN(this,function(n){switch(n.label){case 0:return[4,rD.getToken()];case 1:return e=n.sent(),[4,rU("".concat(this.endpoint,"delete"),{id:t},{postToken:e,withCredentials:!0})];case 2:return(r=n.sent())&&200===r.status?[2,{success:!0,video:r.data}]:[2,{success:!1,video:null}]}})})},t.prototype.listContributors=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.endpoint).concat(t,"/contributors"),null,{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}})})},t.prototype.listRenderings=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.rendererEndpoint,"list"),{videoId:t},{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}})})},t.prototype.getRenderingStatus=function(t){return rC(this,0,void 0,function(){var e;return rN(this,function(r){switch(r.label){case 0:return[4,rI("".concat(this.rendererEndpoint,"status"),{id:t},{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}})})},t.prototype.render=function(t,e,r){return rC(this,0,void 0,function(){var n,i;return rN(this,function(o){switch(o.label){case 0:return[4,rD.getToken()];case 1:return n={token:o.sent(),videoId:t,quality:e},r&&(n.authentication=!0),[4,rU("".concat(this.rendererEndpoint,"render"),n,{withCredentials:!0})];case 2:return(i=o.sent())&&200===i.status?[2,i.data]:[2,null]}})})},t.prototype.getDownloadInfo=function(){return rC(this,0,void 0,function(){var t;return rN(this,function(e){switch(e.label){case 0:return t={endpoint:"".concat(this.rendererEndpoint,"download")},[4,rD.getToken()];case 1:return[2,(t.token=e.sent(),t)]}})})},t}()),r0={asset:rj,endpoint:rk,lyrics:rJ,song:rZ,template:rK,text:rM,font:rV,user:rD,video:rQ},r1=function(t,e){return(r1=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function r2(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}r1(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function r3(t,e,r){if(2==arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;var r4=function(){function t(t){this.a=0,this.r=0,this.g=0,this.b=0,this.from(t)}return Object.defineProperty(t.prototype,"value",{get:function(){return this.valueArgb},set:function(t){this.fromNumber(t,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueArgb",{get:function(){return this.valueRgb+0x1000000*(255&this.a)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueRgb",{get:function(){return((255&this.r)<<8|255&this.g)<<8|255&this.b},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hexRgb",{get:function(){return("000000"+(0xffffff&this.value).toString(16)).slice(-6)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hexA",{get:function(){return("00"+(255&this.a).toString(16)).slice(-2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return"#".concat(this.hexRgb)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cssRgb",{get:function(){return"rgb("+this.r+","+this.g+","+this.b+")"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return"".concat(this.rgb).concat(this.hexA)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"argb",{get:function(){return"0x".concat(this.hexA).concat(this.rgb.substring(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cssRgba",{get:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")"},enumerable:!1,configurable:!0}),t.prototype.eq=function(e){return typeof this==typeof e&&e instanceof t&&this.value===e.value},t.prototype.toString=function(t){return void 0===t&&(t=!0),t?this.rgba:this.rgb},t.prototype.from=function(t){if(void 0===t&&(t="#000"),"object"==typeof t){if(!t)return;return"number"==typeof t.value?void(this.value=t.value):"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b?(this.a="number"==typeof t.a?t.a:255,this.r=t.r,this.g=t.g,void(this.b=t.b)):void 0}"string"==typeof t?this.fromString(t):"number"==typeof t&&this.fromNumber(t)},t.prototype.fromString=function(t){if(t){if("#"===t.charAt(0)&&(t=t.substring(1)),4===t.length){var e=t.charAt(0),r=t.charAt(1),n=t.charAt(2),i=t.charAt(3);t="".concat(e).concat(e).concat(r).concat(r).concat(n).concat(n).concat(i).concat(i)}else 3===t.length&&(e=t.charAt(0),r=t.charAt(1),n=t.charAt(2),t="".concat(e).concat(e).concat(r).concat(r).concat(n).concat(n)),6===t.length&&(t="".concat(t,"ff"));var o=parseInt("".concat(t.substring(6)).concat(t.substring(0,6)),16);this.fromNumber(o,!0)}},t.prototype.fromNumber=function(t,e){void 0===e&&(e=!0),isNaN(t)||(this.a=e?t>>>24&255:0,this.r=t>>>16&255,this.g=t>>>8&255,this.b=t>>>0&255)},t}(),r5=function(){function t(t,e,r){void 0===t&&(t="Noto Sans Japanese"),void 0===e&&(e=40),void 0===r&&(r=""),this._family=t,this._size=e,this._style=r}return Object.defineProperty(t.prototype,"family",{get:function(){return this._family},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},enumerable:!1,configurable:!0}),t.prototype.deriveFamily=function(e){return new t(e,this._size,this._style)},t.prototype.deriveStyle=function(e){return new t(this._family,this._size,e)},t.prototype.deriveSize=function(e){return new t(this._family,e,this._style)},t.prototype.clone=function(){return new t(this._family,this._size,this._style)},t.prototype.eq=function(t){return this._family===t._family&&this._size===t._size&&this._style===t._style},t.prototype.toString=function(t){void 0===t&&(t=1);var e,r=function(t){if(!t||t.length<=0)return[];for(var e=[],r="",n=!1,i=!1,o=!1,s=0;s<t.length;s++){var a=t[s];if(i?o?o=!1:"\\"===a?o=!0:a===i&&(i=!1):'"'===a||"'"===a?i=a:","===a&&(n=!0),n){var u=r.trim();""!==u&&e.push(u),r="",n=!1}else r+=a}var c=r.trim();return""!==c&&e.push(c),e}(this._family);return e=r.length<1?"":r.length>1?" "+r.join(", "):(e=r[0]).length>1&&e[0]!==e[e.length-1]||"'"!==e[0]&&'"'!==e[0]?" '".concat(e,"'"):" ".concat(e),this._style+(this._style.length>0?" ":"")+this._size*t+"px"+e},t}(),r6=function(){function t(){}return Object.defineProperty(t.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return"object"==typeof t?this.overlaps(t.startTime,t.endTime):this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?(t-this.startTime)/this.duration:-1},t}(),r8=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._parent=null,e._children=[],e._previous=null,e._next=null,e._runtime=null,e._templates=[],e}return r2(e,t),Object.defineProperty(e.prototype,"video",{get:function(){return this.parent&&this.parent.video},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this._data?this._data.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this._data?this._data.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rendering",{get:function(){return this._runtime?this._runtime.rendering:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return this._runtime?this._runtime.graphics:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"templates",{get:function(){return this._templates.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"templateCount",{get:function(){return this._templates.length},enumerable:!1,configurable:!0}),e.prototype.maximize=function(){var t=!1,e=this.endTime,r=Math.max(null===this._parent?0:this._parent.startTime,null===this._previous?0:this._previous.endTime);r!==this.startTime&&(this.moveWithChildren(r-this.startTime),t=!0);var n=Math.min(null===this._parent?this.video.duration:this._parent.endTime,null===this._next?this.video.duration:this._next.startTime);return n!==this.endTime&&(this._data.endTime=n,t=e!==n),t},e.prototype.moveWithChildren=function(t){var e=[];for(e.push(this);e.length>0;){var r=e.pop();null!=r._children&&r._children.forEach(function(t){return e.push(t)}),r._data.startTime+=t,r._data.endTime+=t}},e.prototype.getTemplate=function(t){return void 0===t&&(t=0),t<0||t>=this._templates.length?null:this._templates[t]},e.prototype.addTemplateAt=function(t,e){this._templates.splice(e,0,t),t.assignedUnit=this},e.prototype.addTemplate=function(t){this._templates.push(t),t.assignedUnit=this},e.prototype.removeTemplates=function(){for(var t=this._templates.slice();this._templates.length>0;)this._templates.pop();return t},e.prototype.removeTemplateAt=function(t){if(t<0||t>=this._templates.length)return null;var e=this._templates.splice(t,1)[0];return e.assignedUnit=null,e},e.prototype.removeTemplate=function(t){for(var e=0;e<this._templates.length;e++){var r=this._templates[e];if(r===t)return this._templates.splice(e,1),t.assignedUnit=null,r}return null},e.prototype.getType=function(){return rv.NONE},e.prototype.toString=function(){return"RenderingUnit"},e}(r6),r7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r2(e,t),Object.defineProperty(e.prototype,"text",{get:function(){var t="";return this.children.forEach(function(e){t+=e.text}),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.children.reduce(function(t,e){return null===t?e.color:void 0===t||t.eq(e.color)?t:void 0},null)},set:function(t){null!==t&&this.children.forEach(function(e){e.color=t})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{set:function(t){null!==t&&this.children.forEach(function(e){e.font=t})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.children.reduce(function(t,e){var r=e.fontFamily;return void 0===t||null!==t&&t!==r?void 0:r},null)},set:function(t){this.children.forEach(function(e){e.fontFamily=t})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.children.reduce(function(t,e){var r=e.fontStyle;return void 0===t||null!==t&&t!==r?void 0:r},null)},set:function(t){this.children.forEach(function(e){e.fontStyle=t})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.children.length<=0?0:this.children.reduce(function(t,e){return t+e.fontSize},0)/this.children.length},set:function(t){this.children.forEach(function(e){e.fontSize=t})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this.children.reduce(function(t,e){return t+e.advance},0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this.children.reduce(function(t,e){return Math.max(t,e.ascent)},0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this.children.reduce(function(t,e){return Math.max(t,e.descent)},0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ascent+this.descent},enumerable:!1,configurable:!0}),e.prototype.expandTime=function(t){var e,r,n,i;return{startTime:(e=this.startTime,"number"==typeof(r=t.startTime)&&!isNaN(r)&&r<e?r:e),endTime:(n=this.endTime,"number"==typeof(i=t.endTime)&&!isNaN(i)&&i>n?i:n)}},e.prototype.toString=function(){return this.text},e}(r8),r9=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r._font=new r5(e&&e.fontFamily,e&&e.fontSize,e&&e.fontStyle),r._color=new r4,r}return r2(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._data&&this._data.char||"?"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this._runtime?this._runtime.advance:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this._runtime?this._runtime.ascent:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this._runtime?this._runtime.descent:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(t){null===t||this.font.eq(t)||(this._font=t.clone(),this._data.fontFamily=t.family,this._data.fontSize=t.size,this._data.fontStyle=t.style,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.font.family},set:function(t){this.font.family!==t&&(this._font=this.font.deriveFamily(t),this._data.fontFamily=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.font.style},set:function(t){this.font.style!==t&&(this._font=this.font.deriveStyle(t),this._data.fontStyle=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.font.size},set:function(t){isNaN(t)||this.font.size===t||(this._font=this.font.deriveSize(t),this._data.fontSize=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){t&&!t.eq(this.color)&&(this._color=t,this._runtime&&this._runtime.onColorUpdate(t))},enumerable:!1,configurable:!0}),e.prototype.getType=function(){return rv.CHAR},e}(r7),nt=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r}return r2(e,t),e.prototype.getType=function(){return rv.GRAPHIC},e.prototype.toString=function(){return"Graphic"},e}(r8),ne=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r}return r2(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._data&&this._data.pos||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawPos",{get:function(){return this._data&&this._data.rawPoS||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:function(){return this._data&&this._data.language||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countDown",{get:function(){return this._data?this._data.countDown:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countUp",{get:function(){return this._data?this._data.countUp:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initialCount",{get:function(){return this._data?this._data.initialCount:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"charCount",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChar",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChar",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!1,configurable:!0}),e.prototype.addChar=function(t){if(t){this._children.length>0&&(t._previous=this.lastChar,this.lastChar._next=t),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,n=e.endTime;this._data.startTime=r,this._data.endTime=n}},e.prototype.findIndex=function(t){return t instanceof r9?this._children.indexOf(t):-1},e.prototype.getType=function(){return rv.WORD},e}(r7),nr=function(t){function e(e,r){var n=t.call(this)||this;return n._video=e,n._data=r,n.createUnits(),n}return r2(e,t),e.prototype.createUnits=function(){var t=this,e=this._data;e&&Array.isArray(e.words)&&e.words.forEach(function(e){if(e){var r=new ne(e);Array.isArray(e.characters)&&e.characters.forEach(function(t){return r.addChar(new r9(t))}),t.addWord(r)}})},Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordCount",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"charCount",{get:function(){return this._children.reduce(function(t,e){return t+e.charCount},0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstWord",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastWord",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChar",{get:function(){var t=this.firstWord;return null===t?null:t.firstChar},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChar",{get:function(){var t=this.lastWord;return null===t?null:t.lastChar},enumerable:!1,configurable:!0}),e.prototype.getWord=function(t){return t<0||t>=this._children.length?null:this._children[t]},e.prototype.getChar=function(t){if(t<0)return null;for(var e=0,r=this.firstWord;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},e.prototype.addWord=function(t){if(t){this._children.length>0&&(t._previous=this.lastWord,t._previous._next=t,t.firstChar._previous=t._previous.lastChar,t._previous.lastChar._next=t.firstChar),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,n=e.endTime;this._data.startTime=r,this._data.endTime=n}},e.prototype.findIndex=function(t){if(t instanceof ne)return this._children.indexOf(t);if(t instanceof r9){for(var e=0,r=!1,n=0,i=this._children;n<i.length;n++){var o=i[n],s=o.findIndex(t);if(!(s<0)){e+=s,r=!0;break}e+=o.charCount}return r?e:-1}return -1},e.prototype.getType=function(){return rv.PHRASE},e}(r7);function nn(t,e,r){if(!t||t.length<=0)return null;var n=rg.sortedIndex(t,e,function(t){return t.endTime});if(n<0)return null;if(r&&"endTime"in r&&"number"==typeof r.endTime){n>=t.length&&(n=t.length-1);var i=r.endTime;return t[n].overlaps(e,i)?t[n]:n<1?null:t[n-1].overlaps(e,i)?t[n-1]:null}return n>=t.length?null:r&&"loose"in r&&r.loose||t[n].contains(e)?t[n]:null}function ni(t,e,r){if(!t||t.length<=0)return{current:null,entered:[],left:[],previous:null,next:null};var n=rg.sortedIndex(t,e,function(t){return t.startTime});n<t.length&&t[n].startTime===e&&n++;var i,o,s,a=n-1<0?-1:t[n-1].startTime<=e&&t[n-1].endTime>e?n-2:n-1,u=rg.sortedIndex(t,r,function(t){return t.endTime});u>=t.length?(i=-1,o=-1,s=t[u-1].endTime>e?t.length:0):(t[u].startTime>r?(i=-1,o=u):u+1>=t.length||t[u+1].startTime>r?(i=t[u].endTime>r&&t[u].startTime<=r?u:-1,o=u+1):(i=u+1,o=u+2),s=t[u].endTime<=r?u+1:u);var c=a>=0?t[a]:null,l=o>=0&&o<t.length?t[o]:null;return{current:i>=0?t[i]:null,entered:t.slice(n,o),left:t.slice(a+1,s),previous:c,next:l}}var no=function(t){function e(e){var r=t.call(this)||this;return r._credits=[],r._phrases=[],r._graphics=[],r.data=e||{},r.createUnits(),r}return r2(e,t),Object.defineProperty(e.prototype,"credits",{get:function(){return this._credits.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"phrases",{get:function(){return this._phrases.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"words",{get:function(){return this._phrases.reduce(function(t,e){return t.splice.apply(t,r3([t.length,0],e._children,!1)),t},[])},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"chars",{get:function(){return this.words.reduce(function(t,e){return t.splice.apply(t,r3([t.length,0],e._children,!1)),t},[])},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return this._graphics.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rendering",{get:function(){return this._runtime.rendering},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.data.duration||0},set:function(t){this.data.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.data.startTime||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.data.endTime||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"creditCount",{get:function(){return this._credits.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"phraseCount",{get:function(){return this._phrases.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"graphicCount",{get:function(){return this._graphics.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordCount",{get:function(){return this._phrases.reduce(function(t,e){return t+e.wordCount},0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"charCount",{get:function(){return this._phrases.reduce(function(t,e){return t+e.charCount},0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstCredit",{get:function(){return this._credits.length<=0?null:this._credits[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastCredit",{get:function(){return this._credits.length<=0?null:this._credits[this._credits.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[this._phrases.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstWord",{get:function(){var t;return(null===(t=this.firstPhrase)||void 0===t?void 0:t.firstWord)||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastWord",{get:function(){var t;return(null===(t=this.lastPhrase)||void 0===t?void 0:t.lastWord)||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChar",{get:function(){var t;return(null===(t=this.firstWord)||void 0===t?void 0:t.firstChar)||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChar",{get:function(){var t;return(null===(t=this.lastWord)||void 0===t?void 0:t.lastChar)||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[this._graphics.length-1]},enumerable:!1,configurable:!0}),e.prototype.createUnits=function(){var t,e,r=this;Array.isArray(this.data.credits)?(this.data.credits.sort(ns),this.data.credits.forEach(function(t){return r.doAddCredit(new nr(r,t),!1)}),this.organizeTimings(null===(t=this.firstCredit)||void 0===t?void 0:t.firstChar)):this.data.credits=[],Array.isArray(this.data.phrases)?(this.data.phrases.sort(ns),this.data.phrases.forEach(function(t){return r.doAddPhrase(new nr(r,t),!1)}),this.organizeTimings(null===(e=this.firstPhrase)||void 0===e?void 0:e.firstChar)):this.data.phrases=[],Array.isArray(this.data.graphics)?(this.data.graphics.sort(ns),this.data.graphics.forEach(function(t){return r.doAddGraphic(new nt(t),!1)})):this.data.graphics=[]},e.prototype.organizeTimings=function(t){for(;t;)t.startTime===t.endTime&&t.maximize(),t=t.next},e.prototype.exportData=function(t){this.updateTemplateData(t);for(var r=e.exportUnitData(this.data.credits,!0),n=r.units,i=r.templateClasses,o=e.exportUnitData(this.data.phrases,!1),s=o.units,a=o.templateClasses,u=e.exportUnitData(this.data.graphics,!0),c=u.units,l=u.templateClasses,p=i.concat(a,l).filter(function(t,e,r){return r.indexOf(t)===e}),h={};p.length>0;){var f=p.shift(),d=t.getByName(f);if(d){h[f]=d.id;for(var y=0,g=t.getRequiredTemplates(d.script);y<g.length;y++){var v=g[y];h[v]||p.push(v)}}else console.log("template class not found",f)}return{credits:n,phrases:s,graphics:c,templateClasses:h}},e.exportUnitData=function(t,r){if(void 0===r&&(r=!1),!t)return{units:[],templateClasses:[]};for(var n=[],i=[],o=0;o<t.length;o++){var s=t[o],a={templates:s.templates?s.templates.map(function(t){var e=t.type;i.push(e);var r={};return Object.keys(t.value).forEach(function(e){var n=t.value[e];r[e]="object"==typeof n?Object.assign({},n):n}),{type:e,value:r}}):[]},u=void 0;if(s.words){var c=e.exportUnitData(s.words);a.words=c.units,u=c.templateClasses}else if(s.characters){var l=e.exportUnitData(s.characters);a.characters=l.units,u=l.templateClasses}else{for(var p=0,h=["fontFamily","fontSize","fontStyle"];p<h.length;p++){var f=h[p];s[f]&&(a[f]=s[f])}u=[]}r&&(a.startTime=s.startTime,a.endTime=s.endTime),n.push(a),i=i.concat(u)}return{units:n,templateClasses:i=i.filter(function(t,e,r){return r.indexOf(t)===e})}},e.prototype.updateTemplateData=function(t){e.updateTemplateDataForUnits(t,this.firstCredit,this.data.credits),e.updateTemplateDataForUnits(t,this.firstPhrase,this.data.phrases),e.updateTemplateDataForUnits(t,this.firstGraphic,this.data.graphics)},e.updateTemplateDataForUnits=function(t,r,n){if(r&&n)for(var i=0;i<n.length;i++){var o=n[i];o.templates=[];for(var s=0;s<r.templateCount;s++){var a=r.getTemplate(s),u=t.exportInstance(a);o.templates.push(u)}o.words?e.updateTemplateDataForUnits(t,r.children[0],o.words):o.characters&&e.updateTemplateDataForUnits(t,r.children[0],o.characters),r=r.next}},e.prototype.addCredit=function(t){this.doAddCredit(t,!0)},e.prototype.doAddCredit=function(t,e){var r=this.addRenderingUnit(this._credits,t);e&&this.data.credits.splice(r,0,t._data),this._runtime&&this._runtime.addCredit(t)},e.prototype.addPhrase=function(t){this.doAddPhrase(t,!0)},e.prototype.doAddPhrase=function(t,e){var r=this.addRenderingUnit(this._phrases,t);e&&this.data.phrases.splice(r,0,t._data),this._runtime&&this._runtime.addPhrase(t)},e.prototype.addGraphic=function(t){this.doAddGraphic(t,!0)},e.prototype.doAddGraphic=function(t,e){if(t){var r=this.addRenderingUnit(this._graphics,t);e&&this.data.graphics.splice(r,0,t._data),this._runtime&&this._runtime.addGraphic(t)}},e.prototype.addRenderingUnit=function(t,e){if(e){var r=rg.sortedIndex(t,e,na),n=r>0?t[r-1]:null,i=r<t.length?t[r]:null;if(t.splice(r,0,e),n&&(e._previous=n,e._previous._next=e),i&&(i._previous=e,e._next=i),e instanceof nr&&e.wordCount>0){for(var o=n;o&&!o.lastWord;)o=o.previous;for(var s=i;s&&!s.firstWord;)s=s.next;if(o&&(e.firstWord._previous=o.lastWord,o.lastWord._next=e.firstWord),s&&(e.lastWord._next=s.firstWord,s.firstWord._previous=e.lastWord),e.charCount>0){for(var a=null==o?void 0:o.lastWord;a&&null===a.lastChar;)a=a.previous;for(var u=null==s?void 0:s.firstWord;u&&null===u.firstChar;)u=u.next;a&&(e.firstChar._previous=a.lastChar,a.lastChar._next=e.firstChar),u&&(e.lastChar._next=u.firstChar,u.firstChar._previous=e.lastChar)}}return this.updateStartAndEndTime(),r}},e.prototype.removeCredit=function(t){var e=this.removeRenderingUnit(this._credits,t);return!(e<0||(this.data.credits.splice(e,1),this._runtime&&this._runtime.removeCredit(t),0))},e.prototype.removeCredits=function(){var t=this;this._runtime&&this._credits.forEach(function(e){return t._runtime.removeCredit(e)}),this._credits=[],this.data.credits.splice(0,this.data.credits.length)},e.prototype.removePhrase=function(t){var e=this.removeRenderingUnit(this._phrases,t);return!(e<0||(this.data.phrases.splice(e,1),this._runtime&&this._runtime.removePhrase(t),0))},e.prototype.removePhrases=function(){var t=this;this._runtime&&this._phrases.forEach(function(e){return t._runtime.removePhrase(e)}),this._phrases=[],this.data.phrases.splice(0,this.data.phrases.length)},e.prototype.removeGraphic=function(t){var e=this.removeRenderingUnit(this._graphics,t);return!(e<0||(this.data.graphics.splice(e,1),this._runtime&&this._runtime.removeGraphic(t),0))},e.prototype.removeGraphics=function(){var t=this;this._runtime&&this._graphics.forEach(function(e){return t._runtime.removeGraphic(e)}),this._graphics=[],this.data.graphics.splice(0,this.data.graphics.length),this.rendering.reset()},e.prototype.removeRenderingUnit=function(t,e){var r=rg.sortedIndex(t,e,na);if(r<0||t[r]!==e)return -1;if(t.splice(r,1),e instanceof nr){if(e.charCount>0){for(var n=e._previous;n&&null===n.lastChar;)n=n.previous;for(var i=e._next;i&&null===i.firstChar;)i=i.next;n&&i?(n.lastChar._next=i.firstChar,i.firstChar._previous=n.lastChar):n?n.lastChar._next=null:i&&(i.firstChar._previous=null)}if(e.wordCount>0){for(n=e._previous;n&&null===n.lastWord;)n=n.previous;for(i=e._next;i&&null===i.firstWord;)i=i.next;n&&i?(n.lastWord._next=i.firstWord,i.firstWord._previous=n.lastWord):n?n.lastWord._next=null:i&&(i.firstWord._previous=null)}}e._previous&&(e._previous._next=e._next),e._next&&(e._next._previous=e._previous),this.updateStartAndEndTime()},e.prototype.updateStartAndEndTime=function(){this.data.endTime=Math.max((null===(e=null===(t=this.lastCredit)||void 0===t?void 0:t.lastChar)||void 0===e?void 0:e.endTime)||0,(null===(r=this.lastChar)||void 0===r?void 0:r.endTime)||0,(null===(n=this.lastGraphic)||void 0===n?void 0:n.endTime)||0);var t,e,r,n,i,o,s,a,u=null===(o=null===(i=this.firstCredit)||void 0===i?void 0:i.firstChar)||void 0===o?void 0:o.startTime,c=null===(s=this.firstChar)||void 0===s?void 0:s.startTime,l=null===(a=this.firstGraphic)||void 0===a?void 0:a.startTime;this.data.startTime=Math.min("number"==typeof u?u:Number.MAX_VALUE,"number"==typeof c?c:Number.MAX_VALUE,"number"==typeof l?l:Number.MAX_VALUE,this.data.endTime)},e.prototype.findIndex=function(t){if(t instanceof nr)return(e=this._phrases.indexOf(t))>=0?e:this._credits.indexOf(t);if(t instanceof ne){for(var e=0,r=!1,n=0,i=this._phrases;n<i.length;n++){if(!((s=(o=i[n]).findIndex(t))<0)){e+=s,r=!0;break}e+=o.wordCount}return r?e:-1}if(t instanceof r9){e=0,r=!1;for(var o,s,a=0,u=this._phrases;a<u.length;a++){if(!((s=(o=u[a]).findIndex(t))<0)){e+=s,r=!0;break}e+=o.charCount}return r?e:-1}return t instanceof nt?this._graphics.indexOf(t):-1},e.prototype.getCredit=function(t){return t<0||t>=this._credits.length?null:this._credits[t]},e.prototype.getPhrase=function(t){return t<0||t>=this._phrases.length?null:this._phrases[t]},e.prototype.getWord=function(t){if(t<0)return null;for(var e=0,r=this.firstPhrase;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},e.prototype.getChar=function(t){if(t<0)return null;for(var e=0,r=this.firstWord;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},e.prototype.getGraphic=function(t){return t<0||t>=this._graphics.length?null:this._graphics[t]},e.prototype.findCredit=function(t,e){return nn(this._credits,t,e)},e.prototype.findCreditChange=function(t,e){return ni(this._credits,t,e)},e.prototype.findPhrase=function(t,e){return nn(this._phrases,t,e)},e.prototype.findPhraseChange=function(t,e){return ni(this._phrases,t,e)},e.prototype.findWord=function(t,e){var r=this.findPhrase(t,e);return r?nn(r._children,t,e):null},e.prototype.findWordChange=function(t,e){return ni(this.words,t,e)},e.prototype.findChar=function(t,e){var r=this.findWord(t,e);return r?nn(r._children,t,e):null},e.prototype.findCharChange=function(t,e){return ni(this.chars,t,e)},e.prototype.findGraphic=function(t,e){return nn(this._graphics,t,e)},e.prototype.findGraphicChange=function(t,e){return ni(this._graphics,t,e)},e}(r6);function ns(t,e){return t.startTime-e.startTime}function na(t){return t.startTime}var nu,nc,nl,np,nh,nf,nd,ny,ng,nv,nm,nb,n_,nw,nE,nP,nO,nS,nT,nx,nA,nR,nC,nN,nk,nI,nj,nU,nL,nF,nB,nD,nM=function(){function t(t,e,r,n,i,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.setValues(t,e,r,n,i,o)}return t.prototype.setValues=function(t,e,r,n,i,o){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=o,this},t.prototype.append=function(t,e,r,n,i,o){var s=this.a,a=this.b,u=this.c,c=this.d;return 1==t&&0==e&&0==r&&1==n||(this.a=s*t+u*e,this.b=a*t+c*e,this.c=s*r+u*n,this.d=a*r+c*n),this.tx=s*i+u*o+this.tx,this.ty=a*i+c*o+this.ty,this},t.prototype.prepend=function(t,e,r,n,i,o){var s=this.a,a=this.c,u=this.tx;return this.a=t*s+r*this.b,this.b=e*s+n*this.b,this.c=t*a+r*this.d,this.d=e*a+n*this.d,this.tx=t*u+r*this.ty+i,this.ty=e*u+n*this.ty+o,this},t.prototype.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.appendTransform=function(e,r,n,i,o,s,a,u,c){var l,p,h;return o%360?(p=Math.cos(l=o*t.DEG_TO_RAD),h=Math.sin(l)):(p=1,h=0),s||a?(s*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.append(Math.cos(a),Math.sin(a),-Math.sin(s),Math.cos(s),e,r),this.append(p*n,h*n,-h*i,p*i,0,0)):this.append(p*n,h*n,-h*i,p*i,e,r),(u||c)&&(this.tx-=u*this.a+c*this.c,this.ty-=u*this.b+c*this.d),this},t.prototype.prependTransform=function(e,r,n,i,o,s,a,u,c){var l,p,h;return o%360?(p=Math.cos(l=o*t.DEG_TO_RAD),h=Math.sin(l)):(p=1,h=0),(u||c)&&(this.tx-=u,this.ty-=c),s||a?(s*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.prepend(p*n,h*n,-h*i,p*i,0,0),this.prepend(Math.cos(a),Math.sin(a),-Math.sin(s),Math.cos(s),e,r)):this.prepend(p*n,h*n,-h*i,p*i,e,r),this},t.prototype.rotate=function(e){var r=Math.cos(e*=t.DEG_TO_RAD),n=Math.sin(e),i=this.a,o=this.b;return this.a=i*r+this.c*n,this.b=o*r+this.d*n,this.c=-i*n+this.c*r,this.d=-o*n+this.d*r,this},t.prototype.skew=function(e,r){return e*=t.DEG_TO_RAD,r*=t.DEG_TO_RAD,this.append(Math.cos(r),Math.sin(r),-Math.sin(e),Math.cos(e),0,0),this},t.prototype.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},t.prototype.translate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,n=this.d,i=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},t.prototype.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d},t.prototype.transformPoint=function(t,e,r){return r.x=t*this.a+e*this.c+this.tx,r.y=t*this.b+e*this.d+this.ty,r},t.prototype.decompose=function(e){void 0===e&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var r=Math.atan2(-this.c,this.d),n=Math.atan2(this.b,this.a);return 1e-5>Math.abs(1-r/n)?(e.rotation=n/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=r/t.DEG_TO_RAD,e.skewY=n/t.DEG_TO_RAD),e},t.prototype.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)},t.prototype.toString=function(){return"[".concat(this.constructor.name," (a=").concat(this.a," b=").concat(this.b," c=").concat(this.c," d=").concat(this.d," tx=").concat(this.tx," ty=").concat(this.ty,")]")},t.DEG_TO_RAD=Math.PI/180,t.identity=new t,t}(),nV=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.setValues(t,e)}return t.prototype.setValues=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"[".concat(this.constructor.name," (x=").concat(this.x," y=").concat(this.y,")]")},t}(),nG=function(){function t(){this.tx=new nM,this.alpha=0,this.composite="",this.visible=!0}return t.prototype.reset=function(){},t}(),nq=function(){function t(){this.rendering=new nG}return t.prototype.addCredit=function(t){this.doAddPhrase(t)},t.prototype.removeCredit=function(t){t._runtime=null},t.prototype.addPhrase=function(t){this.doAddPhrase(t)},t.prototype.removePhrase=function(t){t._runtime=null},t.prototype.doAddPhrase=function(t){t._runtime={graphics:{clear:function(){}},rendering:new nG,update:function(){}};for(var e=t.firstWord;e;){e._runtime={graphics:{clear:function(){}},rendering:new nG,update:function(){}};for(var r=e.firstChar;r&&(r._runtime={graphics:{clear:function(){}},rendering:new nG,update:function(){},advance:0,ascent:0,descent:0,onFontUpdate:function(){},onColorUpdate:function(){}},r!==e.lastChar);)r=r.next;if(e===t.lastWord)break;e=e.next}},t.prototype.addGraphic=function(t){t._runtime={graphics:{clear:function(){}},rendering:new nG,update:function(){}}},t.prototype.removeGraphic=function(t){t._runtime=null},t}(),nz=function(){function t(){this.wrapperTable={}}return t.prototype.isGraphics=function(){return!1},t.prototype.setCanvas=function(){return Promise.resolve()},t.prototype.createRuntime=function(t){var e,r,n;return e=this,r=void 0,n=function(){var e,r,n;return function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(r)throw TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,function(i){for(this.video=t,t._runtime=new nq,e=t.firstCredit;e;)t._runtime.addCredit(e),e=e.next;for(r=t.firstPhrase;r;)t._runtime.addPhrase(r),r=r.next;for(n=t.firstGraphic;n;)t._runtime.addGraphic(n),n=n.next;return[2,t._runtime]})},new(r||(r=Promise))(function(t,i){function o(t){try{a(n.next(t))}catch(t){i(t)}}function s(t){try{a(n.throw(t))}catch(t){i(t)}}function a(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(t){t(n)})).then(o,s)}a((n=n.apply(e,[])).next())})},t.prototype.reset=function(){var t,e;this.resetTextUnitsFrom(this.video.firstCredit),this.resetTextUnitsFrom(null===(t=this.video.firstCredit)||void 0===t?void 0:t.firstWord),this.resetTextUnitsFrom(null===(e=this.video.firstCredit)||void 0===e?void 0:e.firstChar),this.resetTextUnitsFrom(this.video.firstPhrase),this.resetTextUnitsFrom(this.video.firstWord),this.resetTextUnitsFrom(this.video.firstChar),this.video._runtime.rendering.reset()},t.prototype.resetTextUnitsFrom=function(t){for(;t;)t.rendering.reset(),t.graphics.clear(),t=t.next},t.prototype.update=function(){var t,e;this.updateCharsFrom(null===(t=this.video.firstCredit)||void 0===t?void 0:t.firstChar),this.updateCharsFrom(null===(e=this.video.firstPhrase)||void 0===e?void 0:e.firstChar)},t.prototype.updateCharsFrom=function(t){for(;t;)t._runtime.update(),t=t.next},t.prototype.updateStageTx=function(){},t}(),nW=function(t,e){return nE=(nw=String(t)).length,function(t){for(var e in n_=t||{},nY)Object.prototype.hasOwnProperty.call(n_,e)||(n_[e]=nY[e]);nP=n_.sourceFile||null}(e),nk=1,nO=nI=0,nN=!0,i9(),function(t){nj=nU=nO,n_.locations&&(nL=new i6),nF=nD=null,nB=[],ot();var e=t||oh(),r=!0;for(t||(e.body=[]);nR!==n0;){var n=oO();e.body.push(n),r&&oy(n)&&oc(!0),r=!1}return od(e,"Program")}(n_.program)},nY={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null},nH=function(t,e){for(var r=1,n=0;;){i3.lastIndex=n;var i=i3.exec(t);if(!(i&&i.index<e))break;++r,n=i.index+i[0].length}return{line:r,column:e-n}};function nJ(t,e){var r=nH(nw,t),n=SyntaxError(e+=" ("+r.line+":"+r.column+")");throw n.pos=t,n.loc=r,n.raisedAt=nO,n}var n$=[],nX={type:"num"},nZ={type:"regexp"},nK={type:"string"},nQ={type:"name"},n0={type:"eof"},n1={keyword:"break"},n2={keyword:"case",beforeExpr:!0},n3={keyword:"catch"},n4={keyword:"continue"},n5={keyword:"debugger"},n6={keyword:"default"},n8={keyword:"do",isLoop:!0},n7={keyword:"else",beforeExpr:!0},n9={keyword:"finally"},it={keyword:"for",isLoop:!0},ie={keyword:"function"},ir={keyword:"if"},ii={keyword:"return",beforeExpr:!0},io={keyword:"switch"},is={keyword:"throw",beforeExpr:!0},ia={keyword:"try"},iu={keyword:"var"},ic={keyword:"while",isLoop:!0},il={keyword:"with"},ip={keyword:"new",beforeExpr:!0},ih={keyword:"this"},id={keyword:"null",atomValue:null},iy={keyword:"true",atomValue:!0},ig={keyword:"false",atomValue:!1},iv={keyword:"in",binop:7,beforeExpr:!0},im={break:n1,case:n2,catch:n3,continue:n4,debugger:n5,default:n6,do:n8,else:n7,finally:n9,for:it,function:ie,if:ir,return:ii,switch:io,throw:is,try:ia,var:iu,while:ic,with:il,null:id,true:iy,false:ig,new:ip,in:iv,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:ih,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ib={type:"[",beforeExpr:!0},i_={type:"]"},iw={type:"{",beforeExpr:!0},iE={type:"}"},iP={type:"(",beforeExpr:!0},iO={type:")"},iS={type:",",beforeExpr:!0},iT={type:";",beforeExpr:!0},ix={type:":",beforeExpr:!0},iA={type:"."},iR={type:"?",beforeExpr:!0},iC={binop:10,beforeExpr:!0},iN={isAssign:!0,beforeExpr:!0},ik={isAssign:!0,beforeExpr:!0},iI={postfix:!0,prefix:!0,isUpdate:!0},ij={prefix:!0,beforeExpr:!0},iU={binop:1,beforeExpr:!0},iL={binop:2,beforeExpr:!0},iF={binop:3,beforeExpr:!0},iB={binop:4,beforeExpr:!0},iD={binop:5,beforeExpr:!0},iM={binop:6,beforeExpr:!0},iV={binop:7,beforeExpr:!0},iG={binop:8,beforeExpr:!0},iq={binop:9,prefix:!0,beforeExpr:!0},iz={binop:10,beforeExpr:!0};function iW(t){t=t.split(" ");var e="",r=[];t:for(var n=0;n<t.length;++n){for(var i=0;i<r.length;++i)if(r[i][0].length==t[n].length){r[i].push(t[n]);continue t}r.push([t[n]])}function o(t){if(1==t.length)return e+="return str === "+JSON.stringify(t[0])+";";e+="switch(str){";for(var r=0;r<t.length;++r)e+="case "+JSON.stringify(t[r])+":";e+="return true}return false;"}if(r.length>3){for(r.sort(function(t,e){return e.length-t.length}),e+="switch(str.length){",n=0;n<r.length;++n){var s=r[n];e+="case "+s[0].length+":",o(s)}e+="}"}else o(t);return Function("str",e)}var iY,iH=iW("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),iJ=iW("class enum extends super const export import"),i$=iW("implements interface let package private protected public static yield"),iX=iW("eval arguments"),iZ=iW("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),iK=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,iQ="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",i0=RegExp("["+iQ+"]"),i1=RegExp("["+iQ+"------------------------------------------------------------------------------------------------------------------------------------------]"),i2=/[\n\r\u2028\u2029]/,i3=/\r\n|[\n\r\u2028\u2029]/g,i4=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&i0.test(String.fromCharCode(t)))},i5=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&i1.test(String.fromCharCode(t))))};function i6(){this.line=nk,this.column=nO-nI}function i8(t,e){nT=nO,n_.locations&&(nA=new i6),nR=t,i9(),nC=e,nN=t.beforeExpr}function i7(){for(var t=nO,e=n_.onComment&&n_.locations&&new i6,r=nw.charCodeAt(nO+=2);nO<nE&&10!==r&&13!==r&&8232!==r&&8233!==r;)++nO,r=nw.charCodeAt(nO);n_.onComment&&n_.onComment(!1,nw.slice(t+2,nO),t,nO,e,n_.locations&&new i6)}function i9(){for(;nO<nE;){var t,e=nw.charCodeAt(nO);if(32===e)++nO;else if(13===e)++nO,10===(t=nw.charCodeAt(nO))&&++nO,n_.locations&&(++nk,nI=nO);else if(10===e||8232===e||8233===e)++nO,n_.locations&&(++nk,nI=nO);else if(e>8&&e<14)++nO;else if(47===e){if(42===(t=nw.charCodeAt(nO+1)))!function(){var t,e=n_.onComment&&n_.locations&&new i6,r=nO,n=nw.indexOf("*/",nO+=2);if(-1===n&&nJ(nO-2,"Unterminated comment"),nO=n+2,n_.locations)for(i3.lastIndex=r;(t=i3.exec(nw))&&t.index<nO;)++nk,nI=t.index+t[0].length;n_.onComment&&n_.onComment(!0,nw.slice(r+2,n),r,nO,e,n_.locations&&new i6)}();else{if(47!==t)break;i7()}}else if(160===e)++nO;else{if(!(e>=5760&&iK.test(String.fromCharCode(e))))break;++nO}}}function ot(t){if(t?nO=nS+1:nS=nO,n_.locations&&(nx=new i6),t)return or();if(nO>=nE)return i8(n0);var e=nw.charCodeAt(nO);if(i4(e)||92===e)return oa();var r=function(t){switch(t){case 46:return(s=nw.charCodeAt(nO+1))>=48&&s<=57?oi(!0):(++nO,i8(iA));case 40:return++nO,i8(iP);case 41:return++nO,i8(iO);case 59:return++nO,i8(iT);case 44:return++nO,i8(iS);case 91:return++nO,i8(ib);case 93:return++nO,i8(i_);case 123:return++nO,i8(iw);case 125:return++nO,i8(iE);case 58:return++nO,i8(ix);case 63:return++nO,i8(iR);case 48:var e,r,n,i,o,s,a,u=nw.charCodeAt(nO+1);if(120===u||88===u)return nO+=2,null==(a=on(16))&&nJ(nS+2,"Expected hexadecimal number"),i4(nw.charCodeAt(nO))&&nJ(nO,"Identifier directly after number"),i8(nX,a);case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return oi(!1);case 34:case 39:return function(t){nO++;for(var e="";;){nO>=nE&&nJ(nS,"Unterminated string constant");var r=nw.charCodeAt(nO);if(r===t)return++nO,i8(nK,e);if(92===r){r=nw.charCodeAt(++nO);var n=/^[0-7]+/.exec(nw.slice(nO,nO+3));for(n&&(n=n[0]);n&&parseInt(n,8)>255;)n=n.slice(0,-1);if("0"===n&&(n=null),++nO,n)nD&&nJ(nO-2,"Octal literal in strict mode"),e+=String.fromCharCode(parseInt(n,8)),nO+=n.length-1;else switch(r){case 110:e+="\n";break;case 114:e+="\r";break;case 120:e+=String.fromCharCode(oo(2));break;case 117:e+=String.fromCharCode(oo(4));break;case 85:e+=String.fromCharCode(oo(8));break;case 116:e+="	";break;case 98:e+="\b";break;case 118:e+="\v";break;case 102:e+="\f";break;case 48:e+="\0";break;case 13:10===nw.charCodeAt(nO)&&++nO;case 10:n_.locations&&(nI=nO,++nk);break;default:e+=String.fromCharCode(r)}}else 13!==r&&10!==r&&8232!==r&&8233!==r||nJ(nS,"Unterminated string constant"),e+=String.fromCharCode(r),++nO}}(t);case 47:return e=nw.charCodeAt(nO+1),nN?(++nO,or()):61===e?oe(ik,2):oe(iC,1);case 37:case 42:return 61===nw.charCodeAt(nO+1)?oe(ik,2):oe(iz,1);case 124:case 38:return(r=nw.charCodeAt(nO+1))===t?oe(124===t?iU:iL,2):61===r?oe(ik,2):oe(124===t?iF:iD,1);case 94:return 61===nw.charCodeAt(nO+1)?oe(ik,2):oe(iB,1);case 43:case 45:return(n=nw.charCodeAt(nO+1))===t?45==n&&62==nw.charCodeAt(nO+2)&&i2.test(nw.slice(nU,nO))?(nO+=3,i7(),i9(),ot()):oe(iI,2):61===n?oe(ik,2):oe(iq,1);case 60:case 62:return i=nw.charCodeAt(nO+1),o=1,i===t?(o=62===t&&62===nw.charCodeAt(nO+2)?3:2,61===nw.charCodeAt(nO+o)?oe(ik,o+1):oe(iG,o)):33==i&&60==t&&45==nw.charCodeAt(nO+2)&&45==nw.charCodeAt(nO+3)?(nO+=4,i7(),i9(),ot()):(61===i&&(o=61===nw.charCodeAt(nO+2)?3:2),oe(iV,o));case 61:case 33:return 61===nw.charCodeAt(nO+1)?oe(iM,61===nw.charCodeAt(nO+2)?3:2):oe(61===t?iN:ij,1);case 126:return oe(ij,1)}return!1}(e);if(!1===r){var n=String.fromCharCode(e);if("\\"===n||i0.test(n))return oa();nJ(nO,"Unexpected character '"+n+"'")}return r}function oe(t,e){var r=nw.slice(nO,nO+e);nO+=e,i8(t,r)}function or(){for(var t,e,r=nO;;){nO>=nE&&nJ(r,"Unterminated regular expression");var n=nw.charAt(nO);if(i2.test(n)&&nJ(r,"Unterminated regular expression"),t)t=!1;else{if("["===n)e=!0;else if("]"===n&&e)e=!1;else if("/"===n&&!e)break;t="\\"===n}++nO}var i=nw.slice(r,nO);++nO;var o=os();return o&&!/^[gmsiy]*$/.test(o)&&nJ(r,"Invalid regexp flag"),i8(nZ,new RegExp(i,o))}function on(t,e){for(var r=nO,n=0,i=0,o=null==e?1/0:e;i<o;++i){var s,a=nw.charCodeAt(nO);if((s=a>=97?a-97+10:a>=65?a-65+10:a>=48&&a<=57?a-48:1/0)>=t)break;++nO,n=n*t+s}return nO===r||null!=e&&nO-r!==e?null:n}function oi(t){var e=nO,r=!1,n=48===nw.charCodeAt(nO);t||null!==on(10)||nJ(e,"Invalid number"),46===nw.charCodeAt(nO)&&(++nO,on(10),r=!0);var i=nw.charCodeAt(nO);69!==i&&101!==i||(43!==(i=nw.charCodeAt(++nO))&&45!==i||++nO,null===on(10)&&nJ(e,"Invalid number"),r=!0),i4(nw.charCodeAt(nO))&&nJ(nO,"Identifier directly after number");var o,s=nw.slice(e,nO);return r?o=parseFloat(s):n&&1!==s.length?/[89]/.test(s)||nD?nJ(e,"Invalid number"):o=parseInt(s,8):o=parseInt(s,10),i8(nX,o)}function oo(t){var e=on(16,t);return null===e&&nJ(nS,"Bad character escape sequence"),e}function os(){iY=!1;for(var t,e=!0,r=nO;;){var n=nw.charCodeAt(nO);if(i5(n))iY&&(t+=nw.charAt(nO)),++nO;else{if(92!==n)break;iY||(t=nw.slice(r,nO)),iY=!0,117!=nw.charCodeAt(++nO)&&nJ(nO,"Expecting Unicode escape sequence \\uXXXX"),++nO;var i=oo(4),o=String.fromCharCode(i);o||nJ(nO-1,"Invalid Unicode escape"),(e?i4(i):i5(i))||nJ(nO-4,"Invalid Unicode escape"),t+=o}e=!1}return iY?t:nw.slice(r,nO)}function oa(){var t=os(),e=nQ;return iY||(iZ(t)?e=im[t]:(n_.forbidReserved&&(3===n_.ecmaVersion?iH:iJ)(t)||nD&&i$(t))&&nJ(nS,"The keyword '"+t+"' is reserved")),i8(e,t)}function ou(){nj=nS,nU=nT,nL=nA,ot()}function oc(t){if(nD=t,nO=nU,n_.locations)for(;nO<nI;)nI=nw.lastIndexOf("\n",nI-2)+1,--nk;i9(),ot()}function ol(){this.type=null,this.start=nS,this.end=null}function op(){this.start=nx,this.end=null,null!==nP&&(this.source=nP)}function oh(){var t=new ol;return n_.locations&&(t.loc=new op),n_.directSourceFile&&(t.sourceFile=n_.directSourceFile),n_.ranges&&(t.range=[nS,0]),t}function of(t){var e=new ol;return e.start=t.start,n_.locations&&(e.loc=new op,e.loc.start=t.loc.start),n_.ranges&&(e.range=[t.range[0],0]),e}function od(t,e){return t.type=e,t.end=nU,n_.locations&&(t.loc.end=nL),n_.ranges&&(t.range[1]=nU),t}function oy(t){return n_.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function og(t){if(nR===t)return ou(),!0}function ov(){return!n_.strictSemicolons&&(nR===n0||nR===iE||i2.test(nw.slice(nU,nS)))}function om(){og(iT)||ov()||o_()}function ob(t){nR===t?ou():o_()}function o_(){nJ(nS,"Unexpected token")}function ow(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&nJ(t.start,"Assigning to rvalue"),nD&&"Identifier"===t.type&&iX(t.name)&&nJ(t.start,"Assigning to "+t.name+" in strict mode")}var oE={kind:"loop"},oP={kind:"switch"};function oO(){(nR===iC||nR===ik&&"/="==nC)&&ot(!0);var t,e,r=nR,n=oh();switch(r){case n1:case n4:ou();var i=r===n1;og(iT)||ov()?n.label=null:nR!==nQ?o_():(n.label=oB(),om());for(var o=0;o<nB.length;++o){var s=nB[o];if((null==n.label||s.name===n.label.name)&&(null!=s.kind&&(i||"loop"===s.kind)||n.label&&i))break}return o===nB.length&&nJ(n.start,"Unsyntactic "+r.keyword),od(n,i?"BreakStatement":"ContinueStatement");case n5:return ou(),om(),od(n,"DebuggerStatement");case n8:return ou(),nB.push(oE),n.body=oO(),nB.pop(),ob(ic),n.test=oS(),om(),od(n,"DoWhileStatement");case it:if(ou(),nB.push(oE),ob(iP),nR===iT)return ox(n,null);if(nR===iu){var a=oh();return ou(),oR(a,!0),od(a,"VariableDeclaration"),1===a.declarations.length&&og(iv)?oA(n,a):ox(n,a)}return a=oC(!1,!0),og(iv)?(ow(a),oA(n,a)):ox(n,a);case ie:return ou(),oL(n,!0);case ir:return ou(),n.test=oS(),n.consequent=oO(),n.alternate=og(n7)?oO():null,od(n,"IfStatement");case ii:return nF||nJ(nS,"'return' outside of function"),ou(),og(iT)||ov()?n.argument=null:(n.argument=oC(),om()),od(n,"ReturnStatement");case io:for(ou(),n.discriminant=oS(),n.cases=[],ob(iw),nB.push(oP);nR!=iE;)if(nR===n2||nR===n6){var u=nR===n2;t&&od(t,"SwitchCase"),n.cases.push(t=oh()),t.consequent=[],ou(),u?t.test=oC():(e&&nJ(nj,"Multiple default clauses"),e=!0,t.test=null),ob(ix)}else t||o_(),t.consequent.push(oO());return t&&od(t,"SwitchCase"),ou(),nB.pop(),od(n,"SwitchStatement");case is:return ou(),i2.test(nw.slice(nU,nS))&&nJ(nU,"Illegal newline after throw"),n.argument=oC(),om(),od(n,"ThrowStatement");case ia:if(ou(),n.block=oT(),n.handler=null,nR===n3){var c=oh();ou(),ob(iP),c.param=oB(),nD&&iX(c.param.name)&&nJ(c.param.start,"Binding "+c.param.name+" in strict mode"),ob(iO),c.guard=null,c.body=oT(),n.handler=od(c,"CatchClause")}return n.guardedHandlers=n$,n.finalizer=og(n9)?oT():null,n.handler||n.finalizer||nJ(n.start,"Missing catch or finally clause"),od(n,"TryStatement");case iu:return ou(),oR(n),om(),od(n,"VariableDeclaration");case ic:return ou(),n.test=oS(),nB.push(oE),n.body=oO(),nB.pop(),od(n,"WhileStatement");case il:return nD&&nJ(nS,"'with' in strict mode"),ou(),n.object=oS(),n.body=oO(),od(n,"WithStatement");case iw:return oT();case iT:return ou(),od(n,"EmptyStatement");default:var l=nC,p=oC();if(r===nQ&&"Identifier"===p.type&&og(ix)){for(o=0;o<nB.length;++o)nB[o].name===l&&nJ(p.start,"Label '"+l+"' is already declared");var h=nR.isLoop?"loop":nR===io?"switch":null;return nB.push({name:l,kind:h}),n.body=oO(),nB.pop(),n.label=p,od(n,"LabeledStatement")}return n.expression=p,om(),od(n,"ExpressionStatement")}}function oS(){ob(iP);var t=oC();return ob(iO),t}function oT(t){var e,r=oh(),n=!0,i=!1;for(r.body=[],ob(iw);!og(iE);){var o=oO();r.body.push(o),n&&t&&oy(o)&&(e=i,oc(i=!0)),n=!1}return i&&!e&&oc(!1),od(r,"BlockStatement")}function ox(t,e){return t.init=e,ob(iT),t.test=nR===iT?null:oC(),ob(iT),t.update=nR===iO?null:oC(),ob(iO),t.body=oO(),nB.pop(),od(t,"ForStatement")}function oA(t,e){return t.left=e,t.right=oC(),ob(iO),t.body=oO(),nB.pop(),od(t,"ForInStatement")}function oR(t,e){for(t.declarations=[],t.kind="var";;){var r=oh();if(r.id=oB(),nD&&iX(r.id.name)&&nJ(r.id.start,"Binding "+r.id.name+" in strict mode"),r.init=og(iN)?oC(!0,e):null,t.declarations.push(od(r,"VariableDeclarator")),!og(iS))break}return t}function oC(t,e){var r=oN(e);if(!t&&nR===iS){var n=of(r);for(n.expressions=[r];og(iS);)n.expressions.push(oN(e));return od(n,"SequenceExpression")}return r}function oN(t){var e=function(t){var e=function t(e,r,n){var i=nR.binop;if(null!=i&&(!n||nR!==iv)&&i>r){var o=of(e);o.left=e,o.operator=nC;var s=nR;return ou(),o.right=t(ok(),i,n),t(od(o,s===iU||s===iL?"LogicalExpression":"BinaryExpression"),r,n)}return e}(ok(),-1,t);if(og(iR)){var r=of(e);return r.test=e,r.consequent=oC(!0),ob(ix),r.alternate=oC(!0,t),od(r,"ConditionalExpression")}return e}(t);if(nR.isAssign){var r=of(e);return r.operator=nC,r.left=e,ou(),r.right=oN(t),ow(e),od(r,"AssignmentExpression")}return e}function ok(){if(nR.prefix){var t=oh(),e=nR.isUpdate;return t.operator=nC,t.prefix=!0,nN=!0,ou(),t.argument=ok(),e?ow(t.argument):nD&&"delete"===t.operator&&"Identifier"===t.argument.type&&nJ(t.start,"Deleting local variable in strict mode"),od(t,e?"UpdateExpression":"UnaryExpression")}for(var r=oI(oj());nR.postfix&&!ov();)(t=of(r)).operator=nC,t.prefix=!1,t.argument=r,ow(r),ou(),r=od(t,"UpdateExpression");return r}function oI(t,e){var r;return og(iA)?((r=of(t)).object=t,r.property=oB(!0),r.computed=!1,oI(od(r,"MemberExpression"),e)):og(ib)?((r=of(t)).object=t,r.property=oC(),r.computed=!0,ob(i_),oI(od(r,"MemberExpression"),e)):!e&&og(iP)?((r=of(t)).callee=t,r.arguments=oF(iO,!1),oI(od(r,"CallExpression"),e)):t}function oj(){switch(nR){case ih:var t,e=oh();return ou(),od(e,"ThisExpression");case nQ:return oB();case nX:case nK:case nZ:return(e=oh()).value=nC,e.raw=nw.slice(nS,nT),ou(),od(e,"Literal");case id:case iy:case ig:return(e=oh()).value=nR.atomValue,e.raw=nR.keyword,ou(),od(e,"Literal");case iP:var r=nx,n=nS;ou();var i=oC();return i.start=n,i.end=nT,n_.locations&&(i.loc.start=r,i.loc.end=nA),n_.ranges&&(i.range=[n,nT]),ob(iO),i;case ib:return e=oh(),ou(),e.elements=oF(i_,!0,!0),od(e,"ArrayExpression");case iw:return function(){var t=oh(),e=!0,r=!1;for(t.properties=[],ou();!og(iE);){if(e)e=!1;else if(ob(iS),n_.allowTrailingCommas&&og(iE))break;var n,i={key:oU()},o=!1;if(og(ix)?(i.value=oC(!0),n=i.kind="init"):n_.ecmaVersion>=5&&"Identifier"===i.key.type&&("get"===i.key.name||"set"===i.key.name)?(o=r=!0,n=i.kind=i.key.name,i.key=oU(),nR!==iP&&o_(),i.value=oL(oh(),!1)):o_(),"Identifier"===i.key.type&&(nD||r))for(var s=0;s<t.properties.length;++s){var a=t.properties[s];if(a.key.name===i.key.name){var u=n==a.kind||o&&"init"===a.kind||"init"===n&&("get"===a.kind||"set"===a.kind);u&&!nD&&"init"===n&&"init"===a.kind&&(u=!1),u&&nJ(i.key.start,"Redefinition of property")}}t.properties.push(i)}return od(t,"ObjectExpression")}();case ie:return e=oh(),ou(),oL(e,!1);case ip:return t=oh(),ou(),t.callee=oI(oj(),!0),og(iP)?t.arguments=oF(iO,!1):t.arguments=n$,od(t,"NewExpression");default:o_()}}function oU(){return nR===nX||nR===nK?oj():oB(!0)}function oL(t,e){nR===nQ?t.id=oB():e?o_():t.id=null,t.params=[];var r=!0;for(ob(iP);!og(iO);)r?r=!1:ob(iS),t.params.push(oB());var n=nF,i=nB;if(nF=!0,nB=[],t.body=oT(!0),nF=n,nB=i,nD||t.body.body.length&&oy(t.body.body[0]))for(var o=t.id?-1:0;o<t.params.length;++o){var s=o<0?t.id:t.params[o];if((i$(s.name)||iX(s.name))&&nJ(s.start,"Defining '"+s.name+"' in strict mode"),o>=0)for(var a=0;a<o;++a)s.name===t.params[a].name&&nJ(s.start,"Argument name clash in strict mode")}return od(t,e?"FunctionDeclaration":"FunctionExpression")}function oF(t,e,r){for(var n=[],i=!0;!og(t);){if(i)i=!1;else if(ob(iS),e&&n_.allowTrailingCommas&&og(t))break;r&&nR===iS?n.push(null):n.push(oC(!0))}return n}function oB(t){var e=oh();return e.name=nR===nQ?nC:t&&!n_.forbidReserved&&nR.keyword||o_(),nN=!1,ou(),od(e,"Identifier")}var oD=function(){function t(e,r){var n,i="string"==typeof e?nW(e,t.PARSE_OPTIONS):e;this.ast=i,this.initFunc_=r,this.paused_=!1,this.polyfills_=[],this.functionCounter_=0,this.stepFunctions_=Object.create(null);for(var o,s=/^step([A-Z]\w*)$/,a=Object.getOwnPropertyNames(t.prototype),u=0;u<a.length;u++){var c=a[u];"function"==typeof t.prototype[c]&&(o=c.match(s))&&(this.stepFunctions_[o[1]]=t.prototype[c].bind(this))}this.global=this.createScope(this.ast,null),this.ast=nW(this.polyfills_.join("\n"),t.PARSE_OPTIONS),this.polyfills_=void 0,this.stripLocations_(this.ast,void 0,void 0),(n=new oV(this.ast,this.global)).done=!1,this.stateStack=[n],this.run(),this.value=void 0,this.ast=i,(n=new oV(this.ast,this.global)).done=!1,this.stateStack.length=0,this.stateStack[0]=n,this.nodeConstructor=n.node.constructor,this.stateStack=this.stateStack,this.OBJECT=this.OBJECT,this.OBJECT_PROTO=this.OBJECT_PROTO,this.FUNCTION=this.FUNCTION,this.FUNCTION_PROTO=this.FUNCTION_PROTO,this.ARRAY=this.ARRAY,this.ARRAY_PROTO=this.ARRAY_PROTO,this.REGEXP=this.REGEXP,this.REGEXP_PROTO=this.REGEXP_PROTO,this.UNDEFINED=void 0,this.NULL=null,this.NAN=NaN,this.TRUE=!0,this.FALSE=!1,this.STRING_EMPTY="",this.NUMBER_ZERO=0,this.NUMBER_ONE=1}return t.prototype.wrap=function(t){return t},t.prototype.unwrap=function(t,e){return t},t.prototype.appendCode=function(e){var r=this.stateStack[0];if(!r||"Program"!==r.node.type)throw Error("Expecting original AST to start with a Program node.");var n="string"==typeof e?nW(e,t.PARSE_OPTIONS):e;if(!n||"Program"!==n.type)throw Error("Expecting new AST to start with a Program node.");this.populateScope_(n,r.scope);for(var i,o=0;i=n.body[o];o++)r.node.body.push(i);r.done=!1},t.prototype.step=function(){var e=this.stateStack,r=e[e.length-1];if(!r)return!1;var n=r.node,i=n.type;if("Program"===i&&r.done)return!1;if(this.paused_)return!0;try{var o=this.stepFunctions_[i](e,r,n)}catch(e){if(e!==t.STEP_ERROR)throw e}return o&&e.push(o),!!n.end||this.step()},t.prototype.run=function(){for(;!this.paused_&&this.step(););return this.paused_},t.prototype.initGlobalScope=function(e){this.setProperty(e,"NaN",NaN,t.READONLY_DESCRIPTOR),this.setProperty(e,"Infinity",1/0,t.READONLY_DESCRIPTOR),this.setProperty(e,"undefined",void 0,t.READONLY_DESCRIPTOR),this.setProperty(e,"window",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"this",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"self",e),this.OBJECT_PROTO=new oM(null),this.FUNCTION_PROTO=new oM(this.OBJECT_PROTO),this.initFunction(e),this.initObject(e),e.proto=this.OBJECT_PROTO,this.setProperty(e,"constructor",this.OBJECT),this.initArray(e),this.initString(e),this.initBoolean(e),this.initNumber(e),this.initDate(e),this.initRegExp(e),this.initError(e),this.initMath(e),this.initJSON(e);var r=this,n=this.createNativeFunction(function(t){throw EvalError("Can't happen")},!1);n.eval=!0,this.setProperty(e,"eval",n),this.setProperty(e,"parseInt",this.createNativeFunction(parseInt,!1)),this.setProperty(e,"parseFloat",this.createNativeFunction(parseFloat,!1)),this.setProperty(e,"isNaN",this.createNativeFunction(isNaN,!1)),this.setProperty(e,"isFinite",this.createNativeFunction(isFinite,!1));for(var i=[[escape,"escape"],[unescape,"unescape"],[decodeURI,"decodeURI"],[decodeURIComponent,"decodeURIComponent"],[encodeURI,"encodeURI"],[encodeURIComponent,"encodeURIComponent"]],o=0;o<i.length;o++){var s=function(t){return function(e){try{return t(e)}catch(t){r.throwException(r.URI_ERROR,t.message)}}}(i[o][0]);this.setProperty(e,i[o][1],this.createNativeFunction(s,!1),t.NONENUMERABLE_DESCRIPTOR)}this.initFunc_&&this.initFunc_(this,e)},t.prototype.initFunction=function(e){var r,n=this,i=/^[A-Za-z_$][\w$]*$/;(r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.FUNCTION_PROTO);if(arguments.length)var o=String(arguments[arguments.length-1]);else o="";for(var s=[],a=0;a<arguments.length-1;a++){var u=String(arguments[a]);u.match(i)||n.throwException(n.SYNTAX_ERROR,"Invalid function argument: "+u),s.push(u)}s=s.join(", "),r.parentScope=n.global;try{var c=nW("$ = function("+s+") {"+o+"};",t.PARSE_OPTIONS)}catch(t){n.throwException(n.SYNTAX_ERROR,"Invalid code: "+t.message)}return 1!==c.body.length&&n.throwException(n.SYNTAX_ERROR,"Invalid code in function body."),r.node=c.body[0].expression.right,n.setProperty(r,"length",r.node.length,t.READONLY_DESCRIPTOR),r}).id=this.functionCounter_++,this.FUNCTION=this.createObjectProto(this.FUNCTION_PROTO),this.setProperty(e,"Function",this.FUNCTION),this.setProperty(this.FUNCTION,"prototype",this.FUNCTION_PROTO),this.FUNCTION.nativeFunc=r,this.setProperty(this.FUNCTION_PROTO,"constructor",this.FUNCTION,t.NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.nativeFunc=function(){},this.FUNCTION_PROTO.nativeFunc.id=this.functionCounter_++,this.setProperty(this.FUNCTION_PROTO,"length",0,t.READONLY_DESCRIPTOR);var o=function(t){if(!(t&&t.isObject||n.getScope().strict)){if(null==t)t=n.global;else{var e=n.createObjectProto(n.getPrototype(t));e.data=t,t=e}}return t};r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[],null!=e&&(e.isObject?r.arguments_=n.pseudoToNative(e):n.throwException(n.TYPE_ERROR,"CreateListFromArrayLike called on non-object")),r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"apply",r),r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[];for(var i=1;i<arguments.length;i++)r.arguments_.push(arguments[i]);r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"call",r),this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',","{configurable: true, writable: true, value:","function(oThis) {","if (typeof this !== 'function') {","throw TypeError('What is trying to be bound is not callable');","}","var aArgs   = Array.prototype.slice.call(arguments, 1),","fToBind = this,","fNOP    = function() {},","fBound  = function() {","return fToBind.apply(this instanceof fNOP","? this",": oThis,","aArgs.concat(Array.prototype.slice.call(arguments)));","};","if (this.prototype) {","fNOP.prototype = this.prototype;","}","fBound.prototype = new fNOP();","return fBound;","}","});",""),r=function(){return this.toString()},this.setNativeFunctionPrototype(this.FUNCTION,"toString",r),this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return this.valueOf()},this.setNativeFunctionPrototype(this.FUNCTION,"valueOf",r),this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initObject=function(e){var r,n=this;r=function(t){if(null==t)return n.calledWithNew()?this:n.createObjectProto(n.OBJECT_PROTO);if(!t.isObject){var e=n.createObjectProto(n.getPrototype(t));return e.data=t,e}return t},this.OBJECT=this.createNativeFunction(r,!0),this.setProperty(this.OBJECT,"prototype",this.OBJECT_PROTO),this.setProperty(this.OBJECT_PROTO,"constructor",this.OBJECT),this.setProperty(e,"Object",this.OBJECT);var i=function(t){null==t&&n.throwException(n.TYPE_ERROR,"Cannot convert '"+t+"' to object")};r=function(t){i(t);var e=t.isObject?t.properties:t;return n.nativeToPseudo(Object.getOwnPropertyNames(e))},this.setProperty(this.OBJECT,"getOwnPropertyNames",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),t.isObject?n.nativeToPseudo(Object.keys(t.properties)):n.nativeToPseudo(Object.keys(t))},this.setProperty(this.OBJECT,"keys",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return null===t?n.createObjectProto(null):(void 0!==t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object prototype may only be an Object or null"),n.createObjectProto(t))},this.setProperty(this.OBJECT,"create",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var create_ = Object.create;","Object.create = function(proto, props) {","var obj = create_(proto);","props && Object.defineProperties(obj, props);","return obj;","};","})();",""),r=function(t,e,r){return e=String(e),t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.defineProperty called on non-object"),r&&r.isObject||n.throwException(n.TYPE_ERROR,"Property description must be an object"),!t.properties[e]&&t.preventExtensions&&n.throwException(n.TYPE_ERROR,"Can't define property '"+e+"', object is not extensible"),n.setProperty(t,e,ReferenceError,r.properties),t},this.setProperty(this.OBJECT,"defineProperty",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var defineProperty_ = Object.defineProperty;","Object.defineProperty = function(obj, prop, d1) {","var d2 = {};","if ('configurable' in d1) d2.configurable = d1.configurable;","if ('enumerable' in d1) d2.enumerable = d1.enumerable;","if ('writable' in d1) d2.writable = d1.writable;","if ('value' in d1) d2.value = d1.value;","if ('get' in d1) d2.get = d1.get;","if ('set' in d1) d2.set = d1.set;","return defineProperty_(obj, prop, d2);","};","})();","Object.defineProperty(Object, 'defineProperties',","{configurable: true, writable: true, value:","function(obj, props) {","var keys = Object.keys(props);","for (var i = 0; i < keys.length; i++) {","Object.defineProperty(obj, keys[i], props[keys[i]]);","}","return obj;","}","});",""),r=function(t,e){if(t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.getOwnPropertyDescriptor called on non-object"),(e=String(e))in t.properties){var r=Object.getOwnPropertyDescriptor(t.properties,e),i=t.getter[e],o=t.setter[e];(i||o)&&(r.get=i,r.set=o,delete r.value,delete r.writable);var s=n.nativeToPseudo(r);return"value"in r&&n.setProperty(s,"value",r.value),s}},this.setProperty(this.OBJECT,"getOwnPropertyDescriptor",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),n.getPrototype(t)},this.setProperty(this.OBJECT,"getPrototypeOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return!!t&&!t.preventExtensions},this.setProperty(this.OBJECT,"isExtensible",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return t&&t.isObject&&(t.preventExtensions=!0),t},this.setProperty(this.OBJECT,"preventExtensions",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.setNativeFunctionPrototype(this.OBJECT,"toString",oM.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"toLocaleString",oM.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"valueOf",oM.prototype.valueOf),r=function(t){return i(this),this.isObject?String(t) in this.properties:this.hasOwnProperty(t)},this.setNativeFunctionPrototype(this.OBJECT,"hasOwnProperty",r),r=function(t){return i(this),Object.prototype.propertyIsEnumerable.call(this.properties,t)},this.setNativeFunctionPrototype(this.OBJECT,"propertyIsEnumerable",r),r=function(t){for(;;){if(!(t=n.getPrototype(t)))return!1;if(t===this)return!0}},this.setNativeFunctionPrototype(this.OBJECT,"isPrototypeOf",r)},t.prototype.initArray=function(e){var r,n=this;r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.ARRAY_PROTO);var i=arguments[0];if(1==arguments.length&&"number"==typeof i)isNaN(t.legalArrayLength(i))&&n.throwException(n.RANGE_ERROR,"Invalid array length"),r.properties.length=i;else{for(var o=0;o<arguments.length;o++)r.properties[o]=arguments[o];r.properties.length=o}return r},this.ARRAY=this.createNativeFunction(r,!0),this.ARRAY_PROTO=this.ARRAY.properties.prototype,this.setProperty(e,"Array",this.ARRAY),r=function(t){return t&&"Array"===t.class},this.setProperty(this.ARRAY,"isArray",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return Array.prototype.pop.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"pop",r),r=function(t){return Array.prototype.push.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"push",r),r=function(){return Array.prototype.shift.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"shift",r),r=function(t){return Array.prototype.unshift.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"unshift",r),r=function(){return Array.prototype.reverse.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"reverse",r),r=function(t,e){var r=Array.prototype.splice.apply(this.properties,arguments);return n.unwrap&&(r=r.map(n.unwrap)),n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"splice",r),r=function(t,e){var r=Array.prototype.slice.call(this.properties,t,e);return n.unwrap&&(r=r.map(n.unwrap)),n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"slice",r),r=function(t){return Array.prototype.join.call(this.properties,t)},this.setNativeFunctionPrototype(this.ARRAY,"join",r),r=function(t){for(var e=[],r=0,i=n.getProperty(this,"length"),o=0;o<i;o++){if(n.hasProperty(this,o)){var s=n.getProperty(this,o);e[r]=s}r++}for(o=0;o<arguments.length;o++){var a=arguments[o];if(n.isa(a,n.ARRAY))for(var u=n.getProperty(a,"length"),c=0;c<u;c++)n.hasProperty(a,c)&&(e[r]=n.getProperty(a,c)),r++;else e[r]=a}return n.unwrap&&(e=e.map(n.unwrap)),n.nativeToPseudo(e)},this.setNativeFunctionPrototype(this.ARRAY,"concat",r),r=function(t,e){return Array.prototype.indexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"indexOf",r),r=function(t,e){return Array.prototype.lastIndexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"lastIndexOf",r),r=function(){return Array.prototype.sort.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"sort",r),this.polyfills_.push("Object.defineProperty(Array.prototype, 'every',","{configurable: true, writable: true, value:","function(callbackfn, thisArg) {","if (!this || typeof callbackfn !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O && !callbackfn.call(T, O[k], k, O)) return false;","k++;","}","return true;","}","});","Object.defineProperty(Array.prototype, 'filter',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (this === void 0 || this === null || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var res = [];","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t) {","var val = t[i];","if (fun.call(thisArg, val, i, t)) res.push(val);","}","}","return res;","}","});","Object.defineProperty(Array.prototype, 'forEach',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O) callback.call(T, O[k], k, O);","k++;","}","}","});","Object.defineProperty(Array.prototype, 'map',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') new TypeError;","var T, A, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","A = new Array(len);","k = 0;","while (k < len) {","if (k in O) A[k] = callback.call(T, O[k], k, O);","k++;","}","return A;","}","});","Object.defineProperty(Array.prototype, 'reduce',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var t = Object(this), len = t.length >>> 0, k = 0, value;","if (arguments.length === 2) {","value = arguments[1];","} else {","while (k < len && !(k in t)) k++;","if (k >= len) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k++];","}","for (; k < len; k++) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'reduceRight',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (null === this || 'undefined' === typeof this || 'function' !== typeof callback) throw TypeError();","var t = Object(this), len = t.length >>> 0, k = len - 1, value;","if (arguments.length >= 2) {","value = arguments[1];","} else {","while (k >= 0 && !(k in t)) k--;","if (k < 0) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k--];","}","for (; k >= 0; k--) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'some',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (!this || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t && fun.call(thisArg, t[i], i, t)) {","return true;","}","}","return false;","}","});","(function() {","var sort_ = Array.prototype.sort;","Array.prototype.sort = function(opt_comp) {","if (typeof opt_comp !== 'function') {","return sort_.call(this);","}","for (var i = 0; i < this.length; i++) {","var changes = 0;","for (var j = 0; j < this.length - i - 1; j++) {","if (opt_comp(this[j], this[j + 1]) > 0) {","var swap = this[j];","this[j] = this[j + 1];","this[j + 1] = swap;","changes++;","}","}","if (!changes) break;","}","return this;","};","})();","Object.defineProperty(Array.prototype, 'toLocaleString',","{configurable: true, writable: true, value:","function() {","var out = [];","for (var i = 0; i < this.length; i++) {","out[i] = (this[i] === null || this[i] === undefined) ? '' : this[i].toLocaleString();","}","return out.join(',');","}","});","")},t.prototype.initString=function(e){var r,n=this;r=function(t){return t=String(t),n.calledWithNew()?(this.data=t,this):t},this.STRING=this.createNativeFunction(r,!0),this.setProperty(e,"String",this.STRING),this.setProperty(this.STRING,"fromCharCode",this.createNativeFunction(String.fromCharCode,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["trim","toLowerCase","toUpperCase","toLocaleLowerCase","toLocaleUpperCase","charAt","charCodeAt","substring","slice","substr","indexOf","lastIndexOf","concat"],o=0;o<i.length;o++)this.setNativeFunctionPrototype(this.STRING,i[o],String.prototype[i[o]]);r=function(t,e,r){return e=e?n.pseudoToNative(e):void 0,r=r?n.pseudoToNative(r):void 0,String(this).localeCompare(t,e,r)},this.setNativeFunctionPrototype(this.STRING,"localeCompare",r),r=function(t,e){n.isa(t,n.REGEXP)&&(t=t.data);var r=String(this).split(t,e);return n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.STRING,"split",r),r=function(t){t=t?t.data:void 0;var e=String(this).match(t);return e?n.nativeToPseudo(e):null},this.setNativeFunctionPrototype(this.STRING,"match",r),r=function(t){return n.isa(t,n.REGEXP)&&(t=t.data),String(this).search(t)},this.setNativeFunctionPrototype(this.STRING,"search",r),r=function(t,e){return String(this).replace(t.data||t,e)},this.setNativeFunctionPrototype(this.STRING,"replace",r),this.polyfills_.push("(function() {","var replace_ = String.prototype.replace;","String.prototype.replace = function(substr, newSubstr) {","if (typeof newSubstr !== 'function') {","return replace_.call(this, substr, newSubstr);","}","var str = this;","if (substr instanceof RegExp) {","var subs = [];","var m = substr.exec(str);","while (m) {","m.push(m.index, str);","var inject = newSubstr.apply(null, m);","subs.push([m.index, m[0].length, inject]);","m = substr.global ? substr.exec(str) : null;","}","for (var i = subs.length - 1; i >= 0; i--) {","str = str.substring(0, subs[i][0]) + subs[i][2] + str.substring(subs[i][0] + subs[i][1]);","}","} else {","var i = str.indexOf(substr);","if (i !== -1) {","var inject = newSubstr(str.substr(i, substr.length), i, str);","str = str.substring(0, i) + inject + str.substring(i + substr.length);","}","}","return str;","};","})();","")},t.prototype.initBoolean=function(t){var e,r=this;e=function(t){return t=!!t,r.calledWithNew()?(this.data=t,this):t},this.BOOLEAN=this.createNativeFunction(e,!0),this.setProperty(t,"Boolean",this.BOOLEAN)},t.prototype.initNumber=function(e){var r,n=this;r=function(t){return t=Number(t),n.calledWithNew()?(this.data=t,this):t},this.NUMBER=this.createNativeFunction(r,!0),this.setProperty(e,"Number",this.NUMBER);for(var i=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"],o=0;o<i.length;o++)this.setProperty(this.NUMBER,i[o],Number[i[o]],t.READONLY_NONENUMERABLE_DESCRIPTOR);r=function(t){try{return Number(this).toExponential(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toExponential",r),r=function(t){try{return Number(this).toFixed(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toFixed",r),r=function(t){try{return Number(this).toPrecision(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toPrecision",r),r=function(t){try{return Number(this).toString(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toString",r),r=function(t,e){return t=t?n.pseudoToNative(t):void 0,e=e?n.pseudoToNative(e):void 0,Number(this).toLocaleString(t,e)},this.setNativeFunctionPrototype(this.NUMBER,"toLocaleString",r)},t.prototype.initDate=function(e){var r,n=this;r=function(t,e){if(!n.calledWithNew())return Date();var r=[null].concat([].slice.call(arguments));return this.data=new(Function.prototype.bind.apply(Date,r)),this},this.DATE=this.createNativeFunction(r,!0),this.setProperty(e,"Date",this.DATE),this.setProperty(this.DATE,"now",this.createNativeFunction(Date.now,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"parse",this.createNativeFunction(Date.parse,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"UTC",this.createNativeFunction(Date.UTC,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toISOString","toJSON","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"],o=0;o<i.length;o++)r=function(t){return function(e){for(var r=[],i=0;i<arguments.length;i++)r[i]=n.pseudoToNative(arguments[i]);return this.data[t].apply(this.data,r)}}(i[o]),this.setNativeFunctionPrototype(this.DATE,i[o],r)},t.prototype.initRegExp=function(e){var r,n=this;r=function(t,e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.REGEXP_PROTO);return t=t?t.toString():"",e=e?e.toString():"",n.populateRegExp(r,new RegExp(t,e)),r},this.REGEXP=this.createNativeFunction(r,!0),this.REGEXP_PROTO=this.REGEXP.properties.prototype,this.setProperty(e,"RegExp",this.REGEXP),this.setProperty(this.REGEXP.properties.prototype,"global",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"ignoreCase",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"multiline",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"source","(?:)",t.READONLY_NONENUMERABLE_DESCRIPTOR),r=function(t){return this.data.test(t)},this.setNativeFunctionPrototype(this.REGEXP,"test",r),r=function(t){t=t.toString(),this.data.lastIndex=Number(n.getProperty(this,"lastIndex"));var e=this.data.exec(t);if(n.setProperty(this,"lastIndex",this.data.lastIndex),e){for(var r=n.createObjectProto(n.ARRAY_PROTO),i=0;i<e.length;i++)n.setProperty(r,i,e[i]);return n.setProperty(r,"index",e.index),n.setProperty(r,"input",e.input),r}return null},this.setNativeFunctionPrototype(this.REGEXP,"exec",r)},t.prototype.initError=function(e){var r=this;this.ERROR=this.createNativeFunction(function(e){if(r.calledWithNew())var n=this;else n=r.createObject(r.ERROR);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n},!0),this.setProperty(e,"Error",this.ERROR),this.setProperty(this.ERROR.properties.prototype,"message","",t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"name","Error",t.NONENUMERABLE_DESCRIPTOR);var n=function(n){var i=r.createNativeFunction(function(e){if(r.calledWithNew())var n=this;else n=r.createObject(i);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n},!0);return r.setProperty(i,"prototype",r.createObject(r.ERROR)),r.setProperty(i.properties.prototype,"name",n,t.NONENUMERABLE_DESCRIPTOR),r.setProperty(e,n,i),i};this.EVAL_ERROR=n("EvalError"),this.RANGE_ERROR=n("RangeError"),this.REFERENCE_ERROR=n("ReferenceError"),this.SYNTAX_ERROR=n("SyntaxError"),this.TYPE_ERROR=n("TypeError"),this.URI_ERROR=n("URIError")},t.prototype.initMath=function(e){var r=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(e,"Math",r);for(var n=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],i=0;i<n.length;i++)this.setProperty(r,n[i],Math[n[i]],t.READONLY_NONENUMERABLE_DESCRIPTOR);var o=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(i=0;i<o.length;i++)this.setProperty(r,o[i],this.createNativeFunction(Math[o[i]],!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initJSON=function(t){var e=this,r=e.createObjectProto(this.OBJECT_PROTO);this.setProperty(t,"JSON",r);var n=function(t){try{var r=JSON.parse(t.toString())}catch(t){e.throwException(e.SYNTAX_ERROR,t.message)}return e.nativeToPseudo(r)};this.setProperty(r,"parse",this.createNativeFunction(n,!1)),n=function(t){var r=e.pseudoToNative(t);try{var n=JSON.stringify(r)}catch(t){e.throwException(e.TYPE_ERROR,t.message)}return n},this.setProperty(r,"stringify",this.createNativeFunction(n,!1))},t.prototype.isa=function(t,e){if(null==t||!e)return!1;var r=e.properties.prototype;if(t===r)return!0;for(var n=this.getPrototype(t);n;){if(n===r)return!0;n=n.proto}return!1},t.legalArrayLength=function(t){var e=t>>>0;return e===Number(t)?e:NaN},t.legalArrayIndex=function(t){var e=t>>>0;return String(e)===String(t)&&0xffffffff!==e?e:NaN},t.prototype.createObject=function(t){return this.createObjectProto(t&&t.properties.prototype)},t.prototype.createObjectProto=function(t){var e=new oM(t);return this.isa(e,this.FUNCTION)&&(this.setProperty(e,"prototype",this.createObjectProto(this.OBJECT_PROTO||null)),e.class="Function"),this.isa(e,this.ARRAY)&&(this.setProperty(e,"length",0,{configurable:!1,enumerable:!1,writable:!0}),e.class="Array"),this.isa(e,this.ERROR)&&(e.class="Error"),e},t.prototype.populateRegExp=function(e,r){e.data=r,this.setProperty(e,"lastIndex",r.lastIndex,t.NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"source",r.source,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"global",r.global,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"ignoreCase",r.ignoreCase,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"multiline",r.multiline,t.READONLY_NONENUMERABLE_DESCRIPTOR)},t.prototype.createFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.parentScope=r,n.node=e,this.setProperty(n,"length",n.node.params.length,t.READONLY_DESCRIPTOR),n},t.prototype.createNativeFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.nativeFunc=e,e.id=this.functionCounter_++,this.setProperty(n,"length",e.length,t.READONLY_DESCRIPTOR),r?this.setProperty(n.properties.prototype,"constructor",n,t.NONENUMERABLE_DESCRIPTOR):!1===r&&(n.illegalConstructor=!0,this.setProperty(n,"prototype",void 0)),n},t.prototype.createAsyncFunction=function(e){var r=this.createObjectProto(this.FUNCTION_PROTO);return r.asyncFunc=e,e.id=this.functionCounter_++,this.setProperty(r,"length",e.length,t.READONLY_DESCRIPTOR),r},t.prototype.nativeToPseudo=function(t){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(t instanceof RegExp){var e,r=this.createObjectProto(this.REGEXP_PROTO);return this.populateRegExp(r,t),r}if(t instanceof Function){var n=this;return this.createNativeFunction(function(){return n.nativeToPseudo(t.apply(n,Array.prototype.slice.call(arguments).map(function(t){return n.pseudoToNative(t)})))},void 0)}if(Array.isArray(t)){e=this.createObjectProto(this.ARRAY_PROTO);for(var i=0;i<t.length;i++)i in t&&this.setProperty(e,i,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]))}else for(var o in e=this.createObjectProto(this.OBJECT_PROTO),t)this.setProperty(e,o,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]));return e},t.prototype.pseudoToNative=function(t,e){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(this.isa(t,this.REGEXP))return t.data;var r,n=e||{pseudo:[],native:[]};if(-1!==(o=n.pseudo.indexOf(t)))return n.native[o];if(n.pseudo.push(t),this.isa(t,this.ARRAY)){r=[],n.native.push(r);for(var i=this.getProperty(t,"length"),o=0;o<i;o++)this.hasProperty(t,o)&&(r[o]=this.unwrap?this.unwrap(this.getProperty(t,o),n):this.pseudoToNative(this.getProperty(t,o),n))}else{if(t._native)return t._native;r={},n.native.push(r);var s=void 0;for(var a in t.properties)s=t.properties[a],r[a]=this.unwrap?this.unwrap(s,n):this.pseudoToNative(s,n)}return n.pseudo.pop(),n.native.pop(),r},t.prototype.getPrototype=function(t){switch(typeof t){case"number":return this.NUMBER.properties.prototype;case"boolean":return this.BOOLEAN.properties.prototype;case"string":return this.STRING.properties.prototype}return t?t.proto:null},t.prototype.getProperty=function(e,r){if(r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot read property '"+r+"' of "+e),"length"===r){if(this.isa(e,this.STRING))return String(e).length}else if(64>r.charCodeAt(0)&&this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return String(e)[n]}do{var i=e;if(i.properties&&r in i.properties){var o=i.getter[r];return o?(o.isGetter=!0,o):i.properties[r]}if(void 0!==i._native&&"_"!==r.charAt(0)&&"function"!=typeof i._native[r])return this.wrap?this.wrap(i._native[r]):i._native[r]}while(e=this.getPrototype(e))},t.prototype.hasProperty=function(e,r){if(!e.isObject)throw TypeError("Primitive data type has no properties");if("length"===(r=String(r))&&this.isa(e,this.STRING))return!0;if(this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return!0}do{var i=e;if(i.properties&&r in i.properties)return!0;if(void 0!==i._native&&"_"!=r.charAt(0)){var o=typeof i._native[r];return"function"!==o&&("undefined"!==o||oG(i._native.constructor,r))}}while(e=this.getPrototype(e))return!1},t.prototype.setProperty=function(e,r,n,i){r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of "+e),i&&("get"in i||"set"in i)&&("value"in i||"writable"in i)&&this.throwException(this.TYPE_ERROR,"Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");var o=!this.stateStack||this.getScope().strict;if(e.isObject){if(this.isa(e,this.STRING)){var s=t.legalArrayIndex(r);if("length"===r||!isNaN(s)&&s<String(e).length)return void(o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of String '"+e.data+"'"))}if("Array"===e.class){var a=e.properties.length,u=void 0;if("length"===r){if(isNaN(n=t.legalArrayLength(n))&&this.throwException(this.RANGE_ERROR,"Invalid array length"),n<a)for(u in e.properties)!isNaN(u=t.legalArrayIndex(u))&&n<=u&&delete e.properties[u]}else isNaN(u=t.legalArrayIndex(r))||(e.properties.length=Math.max(a,u+1))}if(!e.preventExtensions||r in e.properties){if(i){"get"in i&&(i.get?e.getter[r]=i.get:delete e.getter[r]),"set"in i&&(i.set?e.setter[r]=i.set:delete e.setter[r]);var c={};"configurable"in i&&(c.configurable=i.configurable),"enumerable"in i&&(c.enumerable=i.enumerable),"writable"in i&&(c.writable=i.writable,delete e.getter[r],delete e.setter[r]),"value"in i?(c.value=i.value,delete e.getter[r],delete e.setter[r]):n!==ReferenceError&&(c.value=n,delete e.getter[r],delete e.setter[r]);try{Object.defineProperty(e.properties,r,c)}catch(t){this.throwException(this.TYPE_ERROR,"Cannot redefine property: "+r)}}else{if(n===ReferenceError)throw ReferenceError("Value not specified.");if(void 0!==e._native&&"_"!=r.charAt(0)){var l=typeof e._native[r];if("function"!==l&&("undefined"!==l||oG(e._native.constructor,r))){var p=this.unwrap?this.unwrap(n):n;return void(e._native[r]=p)}}for(var h=e;!(r in h.properties);)if(!(h=this.getPrototype(h))){h=e;break}if(h.setter&&h.setter[r])return h.setter[r];if(h.getter&&h.getter[r])o&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of object '"+e+"' which only has a getter");else try{e.properties[r]=n}catch(t){o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of object '"+e+"'")}}}else o&&this.throwException(this.TYPE_ERROR,"Can't add property '"+r+"', object is not extensible")}else o&&this.throwException(this.TYPE_ERROR,"Can't create property '"+r+"' on '"+e+"'")},t.prototype.setNativeFunctionPrototype=function(e,r,n){this.setProperty(e.properties.prototype,r,this.createNativeFunction(n,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.getScope=function(){var t=this.stateStack[this.stateStack.length-1].scope;if(!t)throw Error("No scope found.");return t},t.prototype.createScope=function(t,e){var r=this.createObjectProto(null);if(r.parentScope=e,e||this.initGlobalScope(r),this.populateScope_(t,r),r.strict=!1,e&&e.strict)r.strict=!0;else{var n=t.body&&t.body[0];n&&n.expression&&"Literal"===n.expression.type&&"use strict"===n.expression.value&&(r.strict=!0)}return r},t.prototype.createSpecialScope=function(t,e){if(!t)throw Error("parentScope required");var r=e||this.createObjectProto(null);return r.parentScope=t,r.strict=t.strict,r},t.prototype.getValueFromScope=function(t){for(var e=this.getScope();e&&e!==this.global;){if(t in e.properties)return e.properties[t];e=e.parentScope}if(e===this.global&&this.hasProperty(e,t))return this.getProperty(e,t);var r=this.stateStack[this.stateStack.length-1].node;"UnaryExpression"===r.type&&"typeof"===r.operator||this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.setValueToScope=function(t,e){for(var r=this.getScope(),n=r.strict;r&&r!==this.global;){if(t in r.properties)return void(r.properties[t]=e);r=r.parentScope}if(r===this.global&&(!n||this.hasProperty(r,t)))return this.setProperty(r,t,e);this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.populateScope_=function(e,r){if("VariableDeclaration"===e.type)for(var n=0;n<e.declarations.length;n++)this.setProperty(r,e.declarations[n].id.name,void 0,t.VARIABLE_DESCRIPTOR);else{if("FunctionDeclaration"===e.type)return void this.setProperty(r,e.id.name,this.createFunction(e,r),t.VARIABLE_DESCRIPTOR);if("FunctionExpression"===e.type||"ExpressionStatement"===e.type)return}var i=e.constructor;for(var o in e){var s=e[o];if(s&&"object"==typeof s){if(Array.isArray(s))for(n=0;n<s.length;n++)s[n]&&s[n].constructor===i&&this.populateScope_(s[n],r);else s.constructor===i&&this.populateScope_(s,r)}}},t.prototype.stripLocations_=function(t,e,r){for(var n in e?t.start=e:delete t.start,r?t.end=r:delete t.end,t)if(t.hasOwnProperty(n)){var i=t[n];i&&"object"==typeof i&&this.stripLocations_(i,e,r)}},t.prototype.calledWithNew=function(){return this.stateStack[this.stateStack.length-1].isConstructor},t.prototype.getValue=function(e){return e[0]===t.SCOPE_REFERENCE?this.getValueFromScope(e[1]):this.getProperty(e[0],e[1])},t.prototype.setValue=function(e,r){return e[0]===t.SCOPE_REFERENCE?this.setValueToScope(e[1],r):this.setProperty(e[0],e[1],r)},t.prototype.throwException=function(e,r){if(void 0===r)var n=e;else n=this.createObject(e),this.setProperty(n,"message",r,t.NONENUMERABLE_DESCRIPTOR);throw this.executeException(n),t.STEP_ERROR},t.prototype.executeException=function(t){var e,r=this.stateStack.slice();do{this.stateStack.pop();var n=this.stateStack[this.stateStack.length-1];if("TryStatement"===n.node.type)return void(n.throwValue=t)}while(n&&"Program"!==n.node.type)if(this.isa(t,this.ERROR)){var i={EvalError:EvalError,RangeError:RangeError,ReferenceError:ReferenceError,SyntaxError:SyntaxError,TypeError:TypeError,URIError:URIError},o=this.getProperty(t,"name").toString(),s=this.getProperty(t,"message").valueOf();e=(i[o]||Error)(s)}else e=t.toString();throw this.stateStack=r,e},t.prototype.createGetter_=function(t,e){var r=Array.isArray(e)?e[0]:e,n=new this.nodeConstructor;n.type="CallExpression";var i=new oV(n,this.stateStack[this.stateStack.length-1].scope);return i.doneCallee_=!0,i.funcThis_=r,i.func_=t,i.doneArgs_=!0,i.arguments_=[],i},t.prototype.createSetter_=function(t,e,r){var n=Array.isArray(e)?e[0]:this.global,i=new this.nodeConstructor;i.type="CallExpression";var o=new oV(i,this.stateStack[this.stateStack.length-1].scope);return o.doneCallee_=!0,o.funcThis_=n,o.func_=t,o.doneArgs_=!0,o.arguments_=[r],o},t.prototype.stepArrayExpression=function(t,e,r){var n=r.elements,i=e.n_||0;for(e.array_?(this.setProperty(e.array_,i,e.value),i++):(e.array_=this.createObjectProto(this.ARRAY_PROTO),e.array_.properties.length=n.length);i<n.length;){if(n[i])return e.n_=i,new oV(n[i],e.scope);i++}t.pop(),t[t.length-1].value=e.array_},t.prototype.stepAssignmentExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new oV(r.left,e.scope);return n.components=!0,n}if(!e.doneRight_){if(e.leftReference_||(e.leftReference_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_&&"="!==r.operator){var i=this.getValue(e.leftReference_);if(e.leftValue_=i,i&&"object"==typeof i&&i.isGetter)return i.isGetter=!1,e.doneGetter_=!0,this.createGetter_(i,e.leftReference_)}return e.doneRight_=!0,new oV(r.right,e.scope)}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);var o=e.leftValue_,s=e.value;switch(r.operator){case"=":o=s;break;case"+=":o+=s;break;case"-=":o-=s;break;case"*=":o*=s;break;case"/=":o/=s;break;case"%=":o%=s;break;case"<<=":o<<=s;break;case">>=":o>>=s;break;case">>>=":o>>>=s;break;case"&=":o&=s;break;case"^=":o^=s;break;case"|=":o|=s;break;default:throw SyntaxError("Unknown assignment expression: "+r.operator)}var a=this.setValue(e.leftReference_,o);if(a)return e.doneSetter_=o,this.createSetter_(a,e.leftReference_,o);t.pop(),t[t.length-1].value=o},t.prototype.stepBinaryExpression=function(t,e,r){if(!e.doneLeft_)return e.doneLeft_=!0,new oV(r.left,e.scope);if(!e.doneRight_)return e.doneRight_=!0,e.leftValue_=e.value,new oV(r.right,e.scope);t.pop();var n,i=e.leftValue_,o=e.value;switch(r.operator){case"==":n=i==o;break;case"!=":n=i!=o;break;case"===":n=i===o;break;case"!==":n=i!==o;break;case">":n=i>o;break;case">=":n=i>=o;break;case"<":n=i<o;break;case"<=":n=i<=o;break;case"+":n=i+o;break;case"-":n=i-o;break;case"*":n=i*o;break;case"/":n=i/o;break;case"%":n=i%o;break;case"&":n=i&o;break;case"|":n=i|o;break;case"^":n=i^o;break;case"<<":n=i<<o;break;case">>":n=i>>o;break;case">>>":n=i>>>o;break;case"in":o&&o.isObject||this.throwException(this.TYPE_ERROR,"'in' expects an object, not '"+o+"'"),n=this.hasProperty(o,i);break;case"instanceof":this.isa(o,this.FUNCTION)||this.throwException(this.TYPE_ERROR,"Right-hand side of instanceof is not an object"),n=!!i.isObject&&this.isa(i,o);break;default:throw SyntaxError("Unknown binary operator: "+r.operator)}t[t.length-1].value=n},t.prototype.stepBlockStatement=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new oV(i,e.scope);t.pop()},t.prototype.stepBreakStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name);e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(n){if(e.labels&&-1!==e.labels.indexOf(n))return}else if(e.isLoop||e.isSwitch)return;e=t.pop()}throw SyntaxError("Illegal break statement")},t.prototype.stepCallExpression=function(e,r,n){if(!r.doneCallee_){r.doneCallee_=1;var i=new oV(n.callee,r.scope);return i.components=!0,i}if(1===r.doneCallee_){r.doneCallee_=2;var o=r.value;if(Array.isArray(o)){if(r.func_=this.getValue(o),o[0]!==t.SCOPE_REFERENCE&&(r.funcThis_=o[0]),(o=r.func_)&&"object"==typeof o&&o.isGetter)return o.isGetter=!1,r.doneCallee_=1,this.createGetter_(o,r.value)}else r.func_=o;r.arguments_=[],r.n_=0}if(o=r.func_,!r.doneArgs_){if(0!==r.n_&&r.arguments_.push(r.value),n.arguments[r.n_])return new oV(n.arguments[r.n_++],r.scope);"NewExpression"===n.type?(o.illegalConstructor&&this.throwException(this.TYPE_ERROR,o+" is not a constructor"),r.funcThis_=this.createObject(o),r.isConstructor=!0):void 0===r.funcThis_&&(r.funcThis_=r.scope.strict?void 0:this.global),r.doneArgs_=!0}if(r.doneExec_)e.pop(),r.isConstructor&&"object"!=typeof r.value?e[e.length-1].value=r.funcThis_:e[e.length-1].value=r.value;else{r.doneExec_=!0,o&&o.isObject||(console.log("non-function called",o,r),this.throwException(this.TYPE_ERROR,o+" is not a function"));var s=o.node;if(s){for(var a=this.createScope(s.body,o.parentScope),u=0;u<s.params.length;u++){var c=s.params[u].name,l=r.arguments_.length>u?r.arguments_[u]:void 0;this.setProperty(a,c,l)}var p=this.createObjectProto(this.ARRAY_PROTO);for(u=0;u<r.arguments_.length;u++)this.setProperty(p,u,r.arguments_[u]);this.setProperty(a,"arguments",p);var h=s.id&&s.id.name;return h&&this.setProperty(a,h,o),this.setProperty(a,"this",r.funcThis_,t.READONLY_DESCRIPTOR),r.value=void 0,new oV(s.body,a)}if(o.eval){var f=r.arguments_[0];if("string"==typeof f){try{var d=nW(f.toString(),t.PARSE_OPTIONS)}catch(t){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+t.message)}var y=new this.nodeConstructor;return y.type="EvalProgram_",y.body=d.body,this.stripLocations_(y,n.start,n.end),(a=r.scope).strict?a=this.createScope(d,a):this.populateScope_(d,a),this.value=void 0,new oV(y,a)}r.value=f}else if(o.nativeFunc)void 0!==r.funcThis_&&void 0!==r.funcThis_._native?r.value=o.nativeFunc.call(r.funcThis_,r.arguments_):r.value=o.nativeFunc.apply(r.funcThis_,r.arguments_);else{if(o.asyncFunc){var g=this,v=r.arguments_.concat(function(t){r.value=t,g.paused_=!1});return this.paused_=!0,void o.asyncFunc.apply(r.funcThis_,v)}this.throwException(this.TYPE_ERROR,o.class+" is not a function")}}},t.prototype.stepCatchClause=function(t,e,r){if(!e.done_){e.done_=!0;var n=this.createSpecialScope(e.scope);return this.setProperty(n,r.param.name,e.throwValue),new oV(r.body,n)}t.pop()},t.prototype.stepConditionalExpression=function(t,e,r){var n=e.mode_||0;if(0===n)return e.mode_=1,new oV(r.test,e.scope);if(1===n){e.mode_=2;var i=!!e.value;if(i&&r.consequent)return new oV(r.consequent,e.scope);if(!i&&r.alternate)return new oV(r.alternate,e.scope);this.value=void 0}t.pop(),"ConditionalExpression"===r.type&&(t[t.length-1].value=e.value)},t.prototype.stepContinueStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name),e=t[t.length-1];e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(e.isLoop&&(!n||e.labels&&-1!==e.labels.indexOf(n)))return;t.pop(),e=t[t.length-1]}throw SyntaxError("Illegal continue statement")},t.prototype.stepDebuggerStatement=function(t,e,r){t.pop()},t.prototype.stepDoWhileStatement=function(t,e,r){if("DoWhileStatement"===r.type&&void 0===e.test_&&(e.value=!0,e.test_=!0),!e.test_)return e.test_=!0,new oV(r.test,e.scope);if(e.value){if(r.body)return e.test_=!1,e.isLoop=!0,new oV(r.body,e.scope)}else t.pop()},t.prototype.stepEmptyStatement=function(t,e,r){t.pop()},t.prototype.stepEvalProgram_=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new oV(i,e.scope);t.pop(),t[t.length-1].value=this.value},t.prototype.stepExpressionStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new oV(r.expression,e.scope);t.pop(),this.value=e.value},t.prototype.stepForInStatement=function(e,r,n){if(!r.doneInit_&&(r.doneInit_=!0,n.left.declarations&&n.left.declarations[0].init))return r.scope.strict&&this.throwException(this.SYNTAX_ERROR,"for-in loop variable declaration may not have an initializer."),new oV(n.left,r.scope);if(!r.doneObject_)return r.doneObject_=!0,r.variable_||(r.variable_=r.value),new oV(n.right,r.scope);if(r.isLoop||(r.isLoop=!0,r.object_=r.value,r.visited_=Object.create(null)),void 0===r.name_){do{if(r.object_&&r.object_.isObject){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_.properties));do var i=r.props_.shift();while(i&&(r.visited_[i]||!Object.prototype.hasOwnProperty.call(r.object_.properties,i)))if(i&&(r.visited_[i]=!0,Object.prototype.propertyIsEnumerable.call(r.object_.properties,i))){r.name_=i;break}}else if(null!==r.object_){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_));do i=r.props_.shift();while(i&&r.visited_[i])if(i){r.visited_[i]=!0,r.name_=i;break}}r.object_=this.getPrototype(r.object_),r.props_=null}while(null!==r.object_)if(null===r.object_)return void e.pop()}if(!r.doneVariable_){r.doneVariable_=!0;var o=n.left;if("VariableDeclaration"!==o.type){r.variable_=null;var s=new oV(o,r.scope);return s.components=!0,s}r.variable_=[t.SCOPE_REFERENCE,o.declarations[0].id.name]}if(r.variable_||(r.variable_=r.value),!r.doneSetter_){r.doneSetter_=!0;var a=r.name_,u=this.setValue(r.variable_,a);if(u)return this.createSetter_(u,r.variable_,a)}return r.name_=void 0,r.doneVariable_=!1,r.doneSetter_=!1,n.body?new oV(n.body,r.scope):void 0},t.prototype.stepForStatement=function(t,e,r){var n=e.mode_||0;if(0===n){if(e.mode_=1,r.init)return new oV(r.init,e.scope)}else if(1===n){if(e.mode_=2,r.test)return new oV(r.test,e.scope)}else if(2===n){if(e.mode_=3,!r.test||e.value)return e.isLoop=!0,new oV(r.body,e.scope);t.pop()}else if(3===n&&(e.mode_=1,r.update))return new oV(r.update,e.scope)},t.prototype.stepFunctionDeclaration=function(t,e,r){t.pop()},t.prototype.stepFunctionExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.createFunction(r,e.scope)},t.prototype.stepIdentifier=function(e,r,n){if(e.pop(),r.components)e[e.length-1].value=[t.SCOPE_REFERENCE,n.name];else{var i=this.getValueFromScope(n.name);if(i&&"object"==typeof i&&i.isGetter){i.isGetter=!1;for(var o=r.scope;!this.hasProperty(o,n.name);)o=o.parentScope;return this.createGetter_(i,this.global)}e[e.length-1].value=i}},t.prototype.stepIfStatement=function(t,e,r){return this.stepConditionalExpression(t,e,r)},t.prototype.stepLabeledStatement=function(t,e,r){t.pop();var n=e.labels||[];n.push(r.label.name);var i=new oV(r.body,e.scope);return i.labels=n,i},t.prototype.stepLiteral=function(t,e,r){t.pop();var n=r.value;if(n instanceof RegExp){var i=this.createObjectProto(this.REGEXP_PROTO);this.populateRegExp(i,n),n=i}t[t.length-1].value=n},t.prototype.stepLogicalExpression=function(t,e,r){if("&&"!==r.operator&&"||"!==r.operator)throw SyntaxError("Unknown logical operator: "+r.operator);if(!e.doneLeft_)return e.doneLeft_=!0,new oV(r.left,e.scope);if(e.doneRight_)t.pop(),t[t.length-1].value=e.value;else{if(!("&&"===r.operator&&!e.value||"||"===r.operator&&e.value))return e.doneRight_=!0,new oV(r.right,e.scope);t.pop(),t[t.length-1].value=e.value}},t.prototype.stepMemberExpression=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new oV(r.object,e.scope);if(r.computed){if(!e.doneProperty_)return e.object_=e.value,e.doneProperty_=!0,new oV(r.property,e.scope);n=e.value}else e.object_=e.value,n=r.property.name;if(t.pop(),e.components)t[t.length-1].value=[e.object_,n];else{var n,i=this.getProperty(e.object_,n);if(i&&"object"==typeof i&&i.isGetter)return i.isGetter=!1,this.createGetter_(i,e.object_);t[t.length-1].value=i}},t.prototype.stepNewExpression=function(t,e,r){return this.stepCallExpression(t,e,r)},t.prototype.stepObjectExpression=function(t,e,r){var n=e.n_||0,i=r.properties[n];if(e.object_){var o=i.key;if("Identifier"===o.type)var s=o.name;else{if("Literal"!==o.type)throw SyntaxError("Unknown object structure: "+o.type);s=o.value}e.properties_[s]||(e.properties_[s]={}),e.properties_[s][i.kind]=e.value,e.n_=++n,i=r.properties[n]}else e.object_=this.createObjectProto(this.OBJECT_PROTO),e.properties_=Object.create(null);if(i)return new oV(i.value,e.scope);for(var a in e.properties_){var u=e.properties_[a];if("get"in u||"set"in u){var c={configurable:!0,enumerable:!0,get:u.get,set:u.set};this.setProperty(e.object_,a,null,c)}else this.setProperty(e.object_,a,u.init)}t.pop(),t[t.length-1].value=e.object_},t.prototype.stepProgram=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.done=!1,e.n_=n+1,new oV(i,e.scope);e.done=!0},t.prototype.stepReturnStatement=function(t,e,r){if(r.argument&&!e.done_)return e.done_=!0,new oV(r.argument,e.scope);var n=e.value,i=t.length-1;for(e=t[i];"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if("TryStatement"!==e.node.type&&t.splice(i,1),--i<0)throw SyntaxError("Illegal return statement");e=t[i]}e.value=n},t.prototype.stepSequenceExpression=function(t,e,r){var n=e.n_||0,i=r.expressions[n];if(i)return e.n_=n+1,new oV(i,e.scope);t.pop(),t[t.length-1].value=e.value},t.prototype.stepSwitchStatement=function(t,e,r){if(!e.test_)return e.test_=1,new oV(r.discriminant,e.scope);for(1===e.test_&&(e.test_=2,e.switchValue_=e.value);;){var n=e.index_||0,i=r.cases[n];if(e.matched_||!i||i.test){if(i||e.matched_||!e.defaultCase_){if(!i)return void t.pop();if(!e.matched_&&!e.tested_&&i.test)return e.tested_=!0,new oV(i.test,e.scope);if(e.matched_||e.value===e.switchValue_){e.matched_=!0;var o=e.n_||0;if(i.consequent[o])return e.isSwitch=!0,e.n_=o+1,new oV(i.consequent[o],e.scope)}e.tested_=!1,e.n_=0,e.index_=n+1}else e.matched_=!0,e.index_=e.defaultCase_}else e.defaultCase_=n,e.index_=n+1}},t.prototype.stepThisExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.getValueFromScope("this")},t.prototype.stepThrowStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new oV(r.argument,e.scope);this.throwException(e.value)},t.prototype.stepTryStatement=function(t,e,r){if(!e.doneBlock_)return e.doneBlock_=!0,new oV(r.block,e.scope);if(e.throwValue&&!e.doneHandler_&&r.handler){e.doneHandler_=!0;var n=new oV(r.handler,e.scope);return n.throwValue=e.throwValue,e.throwValue=null,n}if(!e.doneFinalizer_&&r.finalizer)return e.doneFinalizer_=!0,new oV(r.finalizer,e.scope);e.throwValue?this.executeException(e.throwValue):t.pop()},t.prototype.stepUnaryExpression=function(e,r,n){if(!r.done_){r.done_=!0;var i=new oV(n.argument,r.scope);return i.components="delete"===n.operator,i}e.pop();var o=r.value;if("-"===n.operator)o=-o;else if("+"===n.operator)o=+o;else if("!"===n.operator)o=!o;else if("~"===n.operator)o=~o;else if("delete"===n.operator){var s=!0;if(Array.isArray(o)){var a=o[0];a===t.SCOPE_REFERENCE&&(a=r.scope);var u=String(o[1]);try{delete a.properties[u]}catch(t){r.scope.strict?this.throwException(this.TYPE_ERROR,"Cannot delete property '"+u+"' of '"+a+"'"):s=!1}}o=s}else if("typeof"===n.operator)o=o&&"Function"===o.class?"function":typeof o;else{if("void"!==n.operator)throw SyntaxError("Unknown unary operator: "+n.operator);o=void 0}e[e.length-1].value=o},t.prototype.stepUpdateExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n,i=new oV(r.argument,e.scope);return i.components=!0,i}if(e.leftSide_||(e.leftSide_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_){var o=this.getValue(e.leftSide_);if(e.leftValue_=o,o&&"object"==typeof o&&o.isGetter){o.isGetter=!1,e.doneGetter_=!0;var s=o;return this.createGetter_(s,e.leftSide_)}}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);if(o=Number(e.leftValue_),"++"===r.operator)n=o+1;else{if("--"!==r.operator)throw SyntaxError("Unknown update expression: "+r.operator);n=o-1}var a=r.prefix?n:o,u=this.setValue(e.leftSide_,n);if(u)return e.doneSetter_=a,this.createSetter_(u,e.leftSide_,n);t.pop(),t[t.length-1].value=a},t.prototype.stepVariableDeclaration=function(t,e,r){var n=r.declarations,i=e.n_||0,o=n[i];for(e.init_&&o&&(this.setValueToScope(o.id.name,e.value),e.init_=!1,o=n[++i]);o;){if(o.init)return e.n_=i,e.init_=!0,new oV(o.init,e.scope);o=n[++i]}t.pop()},t.prototype.stepWithStatement=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new oV(r.object,e.scope);if(!e.doneBody_){e.doneBody_=!0;var n=this.createSpecialScope(e.scope,e.value);return new oV(r.body,n)}t.pop()},t.prototype.stepWhileStatement=function(t,e,r){return this.stepDoWhileStatement(t,e,r)},t.PARSE_OPTIONS={ecmaVersion:5},t.READONLY_DESCRIPTOR={configurable:!0,enumerable:!0,writable:!1},t.NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!0},t.READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!1},t.VARIABLE_DESCRIPTOR={configurable:!1,enumerable:!0,writable:!0},t.STEP_ERROR={},t.SCOPE_REFERENCE={},t.toStringCycles_=[],t}(),oM=function(){function t(t){this.proto=null,this.isObject=!0,this.class="Object",this.data=null,this._native=void 0,this.getter=Object.create(null),this.setter=Object.create(null),this.properties=Object.create(null),this.proto=t}return t.prototype.toString=function(){if("Array"===this.class){(n=oD.toStringCycles_).push(this);try{for(var t=[],e=0;e<this.properties.length;e++){var r=this.properties[e];t[e]=r&&r.isObject&&-1!==n.indexOf(r)?"...":r}}finally{n.pop()}return t.join(",")}if("Error"===this.class){if(-1!==(n=oD.toStringCycles_).indexOf(this))return"[object Error]";var n,i,o=void 0,s=this;do if("name"in s.properties){i=s.properties.name;break}while(s=s.proto)s=this;do if("message"in s.properties){o=s.properties.message;break}while(s=s.proto)n.push(this);try{i=i&&i.toString(),o=o&&o.toString()}finally{n.pop()}return o?i+": "+o:String(i)}return null!==this.data?String(this.data):"[object "+this.class+"]"},t.prototype.valueOf=function(){return void 0===this.data||null===this.data||this.data instanceof RegExp?this:this.data instanceof Date?this.data.valueOf():this.data},t}(),oV=function(t,e){this.node=t,this.scope=e},oG=function(t,e){for(var r=t;r&&r.prototype;){if(Object.getOwnPropertyNames(r.prototype).indexOf(e)>=0)return!0;r=Object.getPrototypeOf(r)}return!1};function oq(t,e){var r={},n=nW(t,{locations:!0,onComment:function(t,e,n,i,o,s){r[s.line]=e}});if("Program"!==n.type||1!==n.body.length||"FunctionDeclaration"!==n.body[0].type)throw Error("JavaScript program should only have one function definition");var i=n.body[0].body.body,o=[],s=[];return i.forEach(function(t){if("ExpressionStatement"===t.type){var n=t.expression;if("AssignmentExpression"===n.type&&"="===n.operator&&"MemberExpression"===n.left.type&&"ThisExpression"===n.left.object.type&&"Identifier"===n.left.property.type){for(var i=[],a=n.loc.start.line-1;a>=0&&void 0!==r[a];a--)i.push(r[a]);if(!(i.length<=0)){var u=n.left.property.name;if(!(Array.isArray(e)&&e.indexOf(u)>=0)&&"FunctionExpression"!==n.right.type){var c=function(t,e,r){var n={name:t,title:{},className:null,proposed:!1,initialValue:null};if(e.forEach(function(t){var e=t.indexOf("@ui ");if(e>=0)n.description=t.substring(e+4).trim();else{var r=t.indexOf("@title ");if(r>=0){var i=t.substring(r+7).trim();0===i.indexOf("@ja ")?n.title.ja=i.substring(4).trim():n.title.default=i}else if(t.indexOf("@proposed")>=0)n.proposed=!0;else{var o=t.indexOf("@comment ");if(o>=0){var s=t.substring(o+9).trim();return n.comment||(n.comment={}),void(0===s.indexOf("@ja ")?n.comment.ja=s.substring(4).trim():n.comment.default=s)}}}}),!n.description&&!n.comment)return null;if(n.proposed||n.comment)return n;var i=n.description.indexOf("("),o=n.description.indexOf(")",i);if(!(i<0||o<0)){n.className=n.description.substr(0,i);try{var s=new oD("[".concat(n.description.substr(i+1,o-i-1),"]")),a=Date.now();for(s.unwrap=null,s.wrap=null;s.step()&&!(Date.now()-a>100););n.params=s.pseudoToNative(s.value)}catch(t){}return n.params||(n.params=[]),n}}(u,i);s.push(n),c&&o.push(c)}}}}}),{widgets:o,fields:s,ast:n}}function oz(t,e){if(void 0===e&&(e=-1),!t)return{dependencyAtCursor:null,dependencies:[]};for(var r=[],n=null,i=("string"==typeof t?nW(t,oD.PARSE_OPTIONS):t).body[0].body.body.slice(0);i.length>0;){var o=i.shift();if(null!=o){if("CallExpression"!==o.type)o.expression&&i.push(o.expression),o.object&&i.push(o.object),o.property&&i.push(o.property),o.name&&"string"!=typeof name&&i.push(o.name),o.left&&i.push(o.left),o.right&&i.push(o.right),o.id&&i.push(o.id),o.init&&i.push(o.init),o.callee&&i.push(o.callee),o.body&&Array.isArray(o.body)&&i.push.apply(i,o.body),o.declarations&&Array.isArray(o.declarations)&&i.push.apply(i,o.declarations),o.arguments&&Array.isArray(o.arguments)&&i.push.apply(i,o.arguments),o.params&&Array.isArray(o.params)&&i.push.apply(i,o.params);else if(o.callee.name&&"require"===o.callee.name){var s=o.arguments;if(s&&Array.isArray(s)&&1===s.length){var a=s[0];if("Literal"===a.type){var u=a.value;r.push(u),o.start&&o.end&&o.start<=e&&o.end>=e&&(n=u)}}}}}return{dependencyAtCursor:n,dependencies:r}}oD.Object=oM,oD.State=oV;var oW=function(){return(oW=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function oY(t,e,r){for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}function oH(t){return"boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t}"function"==typeof SuppressedError&&SuppressedError;var oJ={type:"ExpressionStatement",start:null,end:null,expression:{type:"CallExpression",start:null,end:null,expression:null,arguments:null},arguments:null},o$=function(){function t(t,e,r){void 0===r&&(r=null),this.wrapperTable=t,this.ignoredPropNames=e,this.wrapMethodParameter=r,this.verbose=!1,this.initialize()}return t.prototype.initialize=function(){var t=this,e=new oD("",function(e,r){t.globalScope=r});this.interpreter=e,this.interpreter.wrap=function(e){return t.wrap(e)},this.interpreter.unwrap=function(e,r){return t.unwrap(e,r)},this.wrappers={},Object.keys(this.wrapperTable).forEach(function(e){return t.wrapClass(t.wrapperTable[e],e)})},t.prototype.createGlobalFunction=function(t,e){var r,n=this,i=e.func,o=e.raw,s=e.isConstructor,a=e.async,u=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=i(o?t:t.map(function(e,r){return r<t.length-1||!a?n.unwrap(e):e}));return o?r:n.wrap(r)};r=a?this.interpreter.createAsyncFunction(u):this.interpreter.createNativeFunction(u,s),this.interpreter.setProperty(this.globalScope,t,r)},t.prototype.createFunction=function(t,e){return void 0===e&&(e=!1),this.interpreter.createNativeFunction(t,e)},t.prototype.setProperty=function(t,e,r){this.interpreter.setProperty(t,e,this.wrap(r))},t.prototype.setRawProperty=function(t,e,r){this.interpreter.setProperty(t,e,r)},t.prototype.getProperty=function(t,e){return this.unwrap(this.interpreter.getProperty(t,e))},t.prototype.getRawProperty=function(t,e){return this.interpreter.getProperty(t,e)},t.prototype.prepareRun=function(t){e="string"==typeof t?nW(t,oD.PARSE_OPTIONS):t;var e,r=this.interpreter.createScope(e,this.globalScope);return this.interpreter.stateStack=[{node:e,scope:r,done:!1}],r},t.prototype.newStatementFor=function(t){return nW("new "+t+"();",oD.PARSE_OPTIONS)},t.prototype.prepareNewInstance=function(t,e){var r=this.interpreter.createScope(nW("",oD.PARSE_OPTIONS),e);return this.interpreter.stateStack=[{node:t,scope:r,thisExpression:r}],r},t.prototype.exec=function(t,e,r,n){var i=this,o=this.interpreter;oJ.expression.arguments=[];var s=[];return r.forEach(function(t){oJ.expression.arguments.push(null),s.push(i.wrap(t))}),o.stateStack=[{node:{type:"Program",body:[oJ]},scope:this.globalScope,done:!0,n_:1},{node:oJ,scope:this.globalScope,done_:!0},{node:oJ.expression,doneCallee_:2,doneArgs_:!0,arguments_:s,funcThis_:t,func_:o.getProperty(t,e),scope:t,n_:s.length,value:[t,e]}],this.run(700,"call a method ("+t.className+"."+e+(n||"")+")")},t.prototype.run=function(t,e){var r=this.interpreter,n=Date.now(),i=!1;try{for(;r.step();)if(Date.now()-n>t){i=!0;break}}catch(t){throw this.verbose&&console.log(r.stateStack),"string"==typeof t&&(t=Error(t)),r.stateStack.length>0&&(t.node=r.stateStack[r.stateStack.length-1].node),t}if(i){var o=Error("timeout: spent too long time (> "+t+"ms) to "+e);throw r.stateStack.length>0&&(o.node=r.stateStack[0].node),o}return this.interpreter.value},t.prototype.cleanupProperties=function(t){if(!t)return null;for(var e in this.ignoredPropNames.forEach(function(e){void 0!==t.properties[e]&&delete t.properties[e]}),t.properties)this.cleanupProperty(t.properties[e])||delete t.properties[e];return t.properties},t.prototype.cleanupProperty=function(t){if(oH(t)||t._native)return!0;var e=this.globalScope.properties;if(t.parent===e.Array){for(var r=t.length,n=0;n<t.length;n++)this.cleanupProperty(t.properties[n])||(delete t.properties[n],r--);return t.length=r,r>0}if(t.parent===e.Object){var i=!0;for(var o in t.properties)this.cleanupProperty(t.properties[o])?i=!1:delete t.properties[o];return!i}return!1},t.prototype.restoreProperties=function(t,e){e&&(t.properties=oW(oW({},t.properties),e))},t.prototype.wrap=function(t){if("object"==typeof t&&null!==t&&void 0!==t.constructor&&"string"==typeof t.constructor.className){var e=t.constructor.className,r=this.wrappers[e];if(void 0===r)return;var n=this.interpreter.createObject(r);return n._native=t,n}return this.verbose&&(oH(t)||Array.isArray(t)||console.log("wrap complex obj:",String(t))),this.interpreter.nativeToPseudo(t)},t.prototype.unwrap=function(t,e){return"object"==typeof t&&null!==t&&t._native?t._native:this.interpreter.pseudoToNative(t,e)},t.prototype.wrapClass=function(t,e){this.verbose&&console.log("--- wrapping "+e+" ---"),t.className=e;var r=this,n=this.interpreter.createNativeFunction(function(e){var i,o;if(i=r.interpreter.calledWithNew()?this:r.interpreter.createObjectProto(n.properties.prototype),void 0!==e){if(Array.isArray(e))for(var s=0;s<e.length;s++)o[s]=r.unwrap(e[s]);else o=r.unwrap(e)}if(t){var a=Object.create(t.prototype),u=t.apply(a,[null].concat(o).splice(1));i._native=null!==u&&"object"==typeof u?u:a}return i});return this.interpreter.setProperty(this.globalScope,e,n),this.wrapStaticMembers(n,t),this.wrapInstanceMembers(n,t),this.wrappers[e]=n,n},t.prototype.wrapStaticMembers=function(t,e){var r=this,n=function(n){if(i.interpreter.setProperty(t,n,ReferenceError,{get:function(){return r.wrap(e[n])},set:function(t){return e[n]=r.unwrap(t)}}),i.verbose){var o=void 0;try{o=typeof e[n]}catch(t){o="not accessible"}console.log("static "+n+" ("+o+")")}},i=this;for(var o in e)n(o)},t.prototype.wrapInstanceMembers=function(t,e){for(var r,n=new e,i=0,o=oY(oY([],Object.keys(n)),function(t){for(var e=t,r=[];e&&e.prototype;)r=oY(oY([],r),Object.getOwnPropertyNames(e.prototype)),e=Object.getPrototypeOf(e);return r}(e)).filter(function(t,e,r){return r.indexOf(t)===e});i<o.length;i++){var s=o[i];if("constructor"!==s&&!this.interpreter.hasProperty(t,s)&&!this.interpreter.hasProperty(t.properties.prototype,s)&&"_"!==s.charAt(0)){if(this.verbose){var a=void 0;try{a=typeof n[s]}catch(t){a="not accessible"}r=s+" ("+a+")"}try{if("function"==typeof n[s]){var u=function(e,r){return function(n){var i;return r.wrap((i=this._native)[e].apply(i,n.map(function(e){var n=r.unwrap(e);return r.wrapMethodParameter?r.wrapMethodParameter(t,n):n})))}}(s,this);this.interpreter.setProperty(t.properties.prototype,s,this.interpreter.createNativeFunction(u)),this.verbose&&(r+=" native method")}}catch(t){}this.verbose&&console.log(r)}}},t}();function oX(t){var e=parseFloat(t);return isNaN(e)?0:e}function oZ(t){var e;if("undefined"==typeof window||!(null===(e=null==window?void 0:window.location)||void 0===e?void 0:e.search))return null;for(var r=0,n=window.location.search.substring(1).split("&");r<n.length;r++){var i=n[r].split("=");if(decodeURIComponent(i[0])===t)return decodeURIComponent(i[1])}return null}var oK=function(t,e){return(oK=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function oQ(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}oK(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var o0=function(){return(o0=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function o1(t,e,r,n){return new(r||(r=Promise))(function(e,i){function o(t){try{a(n.next(t))}catch(t){i(t)}}function s(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?e(t.value):((n=t.value)instanceof r?n:new r(function(t){t(n)})).then(o,s)}a((n=n.apply(t,[])).next())})}function o2(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(r)throw TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function o3(t,e,r){if(2==arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;var o4,o5,o6=[0,0,0,0],o8=function(){function t(){this._position=0,this._wait=50,this.update=this.update.bind(this)}return Object.defineProperty(t.prototype,"wait",{get:function(){return this._wait},set:function(t){this._wait=t,this._isPlaying&&this.start()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.isPlaying?Math.min(this.basePosition.position+(Date.now()-this.basePosition.time),this.player.video.duration):this._position},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){var e=t.player,r=t.updater,n=t.emitter;return o1(this,0,void 0,function(){return o2(this,function(t){return this.player=e,this.updateMediaPosition=r,this.emitter=n,[2]})})},t.prototype.play=function(){this.start(),this.emitter.onPlay()},t.prototype.stop=function(){this.clearInterval(),this._isPlaying=!1,this.seek(0),this.pause(),this.emitter.onStop()},t.prototype.pause=function(){this.clearInterval(),this._isPlaying=!1,this.emitter.onPause()},t.prototype.seek=function(t){var e=this;this._position=t,this.updateMediaPosition(t).then(function(){e.emitter.onSeek(t),e.emitter.onSeekComplete(t)}),this.isPlaying&&this.start()},t.prototype.dispose=function(){this.clearInterval()},t.prototype.clearInterval=function(){window.clearInterval(this.intervalId)},t.prototype.start=function(){this.clearInterval(),this._isPlaying=!0,this.basePosition={time:Date.now(),position:this._position},this.intervalId=window.setInterval(this.update,this.wait)},t.prototype.update=function(){this.player.video||this.stop();var t=this.basePosition.position+(Date.now()-this.basePosition.time);this._position=Math.min(t,this.player.video.duration),this.updateMediaPosition(this.position),this._position>=this.player.video.duration&&this.stop()},t}(),o7=function(){function t(t){void 0===t&&(t={}),this.options=t,this.wait=50,this.volumeListener={onVolumeUpdate:this.onVolumeUpdate.bind(this)},this.resetProps()}return Object.defineProperty(t.prototype,"songlePlayer",{get:function(){return this._songlePlayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this._songlePlayer&&this._songlePlayer.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"withSync",{get:function(){var t,e;return!(!(null===(t=this.options)||void 0===t?void 0:t.accessToken)&&!(null===(e=this.options)||void 0===e?void 0:e.secretToken))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){if(!this._songlePlayer)return 0;if(this.lastPosition>0&&this.lastTime>0)return Date.now()+this.lastPosition-this.lastTime;var t,e=this._songlePlayer.positionTime;if("songle-api-html-media-element-media"===(null===(t=this._songlePlayer.media)||void 0===t?void 0:t.dispatcherName)){var r=this.lastTime,n=this.lastPosition,i=void 0;if(r>0){var o=Date.now()-r;i=Math.max(0,this.wait-o)}else i=this.wait;0===n&&e>=500?e=0:0===r&&e-n>=800&&(e=n+i)}return e},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){var e,r,n,i,o=t.player,s=t.updater,a=t.emitter,u=t.altSourceUrl;return o1(this,0,void 0,function(){var t,c,l;return o2(this,function(p){switch(p.label){case 0:return this.player&&this.player.removeListener(this.volumeListener),this.player=o,this.player.addListener(this.volumeListener),this.updateMediaPosition=s,this.emitter=a,this._songlePlayer?[3,2]:[4,this.initializeSonglePlayer()];case 1:p.sent(),p.label=2;case 2:return t=this.options.headless,c=u||this.options.altSourceUrls&&(null===(e=this.player.data.song)||void 0===e?void 0:e.permalink)&&this.options.altSourceUrls[null===(r=this.player.data.song)||void 0===r?void 0:r.permalink]||(null===(n=this.player.data.song)||void 0===n?void 0:n.permalink)||void 0,rP.isUploaderUrl(c)&&(c=rP.getAltSongUrlFromUploaderGuid(rP.getUploaderGuid(rP.getSongPathFromUrl(c)))),(l=(null===(i=this.player.data.song)||void 0===i?void 0:i.permalink)||c)===c&&(c=void 0),[4,this._songlePlayer.useMedia(l,{headless:t,altSourceUrl:c})];case 3:return p.sent(),this.ignoreSonglePlayerEvents=!0,this._songlePlayer.volume=0*(1-this.player.volume/100)+100*this.player.volume/100,this._songlePlayer.play(),this._songlePlayer.stop(),this.ignoreSonglePlayerEvents=!1,this.resetProps(),[2]}})})},t.prototype.resetProps=function(){this.lastPosition=0,this.lastTime=0,this.elapsedTimes=[]},t.prototype.initializeSonglePlayer=function(){var t;return o1(this,0,void 0,function(){var e,r,n,i,o,s,u,c=this;return o2(this,function(l){switch(l.label){case 0:return r=(e=this.options).accessToken,n=e.secretToken,(o=this.options.songle)?[3,2]:[4,function(){return o1(this,0,void 0,function(){return o2(this,function(t){return o5&&o5.Player?[2,o5]:"undefined"==typeof window?[2,a("bCzyS")]:window.Songle&&window.Songle.Player?[2,window.Songle]:(o4||(o4=new Promise(function(t){var e=!1;window.onSongleAPIReady=function(r){e=!0,t(o5=r)},setTimeout(function(){if(!e){var t=[];document.querySelectorAll("script").forEach(function(e){var r=e.getAttribute("src");r&&r.indexOf("songle.jp/v2/api.js")>=0&&t.push(e)}),t.forEach(function(t){return t.parentElement.removeChild(t)});var r=document.createElement("script");r.src="https://api.songle.jp/v2/api.js",document.head.appendChild(r)}},1e3)})),[2,o4])})})}()];case 1:o=l.sent(),l.label=2;case 2:return(i=o).System&&(i.System.showLicense=!1),s=null===(t=this.options)||void 0===t?void 0:t.autoUseMedia,this._songlePlayer=this.withSync?new i.SyncPlayer({mediaElement:this.player.mediaSourceElement,accessToken:r,secretToken:n,autoUseMedia:s}):new i.Player({mediaElement:this.player.mediaSourceElement}),u=!1,this._songlePlayer.on("play",function(){c.ignoreSonglePlayerEvents||(u=!1,c.handler||(c.startPolling(),c.emitter.onPlay()))}),this._songlePlayer.on("pause",function(){return o1(c,0,void 0,function(){return o2(this,function(t){switch(t.label){case 0:return this.ignoreSonglePlayerEvents?[2]:(u=!1,this.stopPolling(),this.emitter.onPause(),this.stopping?(this.stopping=!1,[4,this.updateMediaPosition(0)]):[3,2]);case 1:t.sent(),this.resetProps(),this.emitter.onStop(),t.label=2;case 2:return[2]}})})}),this._songlePlayer.on("finish",function(){return o1(c,0,void 0,function(){return o2(this,function(t){switch(t.label){case 0:return u=!1,this.handler?(this.stopPolling(),[4,this.updateMediaPosition(0)]):[3,2];case 1:t.sent(),this.emitter.onStop(),t.label=2;case 2:return[2]}})})}),this._songlePlayer.on("seek",function(t){var e=t.data;return o1(c,0,void 0,function(){return o2(this,function(t){switch(t.label){case 0:return this._songlePlayer.isPlaying?[3,2]:(u=!1,[4,this.updateMediaPosition(e.positionTime)]);case 1:return t.sent(),this.emitter.onSeekComplete(e.positionTime),[3,4];case 2:return u=!0,[4,this.updateMediaPosition(this._songlePlayer.positionTime)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}),this._songlePlayer.on("mediaSeek",function(){u&&(c.emitter.onSeekComplete(c.position),u=!1)}),this.withSync&&(this._songlePlayer.on("mediaPlay",function(){c.handler||(c.startPolling(),c.emitter.onPlay())}),this._songlePlayer.on("mediaFinish",function(){c.handler&&(c.stopPolling(),c.emitter.onStop())})),[2]}})})},t.prototype.play=function(){if(this._songlePlayer)return this._songlePlayer.play();this.emitter.onPlay()},t.prototype.stop=function(){if(this._songlePlayer)return this.stopping=this._songlePlayer.isPlaying,this._songlePlayer.stop();this.emitter.onStop()},t.prototype.pause=function(){if(this._songlePlayer)return this.stopping=!1,this._songlePlayer.pause();this.emitter.onPause()},t.prototype.seek=function(t){var e=this;this._songlePlayer?(this._songlePlayer.seekTo(t),this.emitter.onSeek(t)):this.updateMediaPosition(t).then(function(){e.emitter.onSeek(t)})},t.prototype.startPolling=function(){var t,e=this;if(this.lastTime>0){var r=Date.now()-this.lastTime;t=Math.max(0,this.wait-r)}else t=this.wait;this.handler=setTimeout(function(){return o1(e,0,void 0,function(){var e,r,n,i,o,s,a,u;return o2(this,function(c){switch(c.label){case 0:return this._songlePlayer?(r=(e=this).lastTime,n=e.lastPosition,i=this._songlePlayer.positionTime,o=!1,"songle-api-html-media-element-media"===(null===(u=this._songlePlayer.media)||void 0===u?void 0:u.dispatcherName)&&(0===n&&i>=500?(i=0,o=!0):0===r&&i-n>=800&&(i=n+t,o=!0)),s=r>0?Date.now()-r:t,this.updateElapsedTimes(s),a=n>0?n+s:i,(a=Math.abs(i-a)>2*this.wait?i:a<=i?.5*(a+i):Math.max(n,i))<this.lastPosition&&(this.lastPosition-a>5*this.wait||(a=this.lastPosition)),o||(this.lastTime=Date.now()),this.lastPosition=a,[4,this.updateMediaPosition(a)]):[2];case 1:return c.sent(),this.handler&&this.startPolling(),[2]}})})},t)},t.prototype.updateElapsedTimes=function(t){if(this.elapsedTimes.unshift(t),this.elapsedTimes=this.elapsedTimes.slice(0,10),this.elapsedTimes.length>=10){var e=this.elapsedTimes.reduce(function(t,e){return t+e})/10;e>5*this.wait&&(this.player.stageScale=Math.max(.25,.9*this.player.stageScale),this.elapsedTimes=[]),e<1.2*this.wait&&this.player.stageScale<1&&(this.player.stageScale=Math.min(1,this.player.stageScale/.9),this.elapsedTimes=[])}},t.prototype.stopPolling=function(){var t;if(this.handler){if(clearTimeout(this.handler),this._songlePlayer){if("songle-api-html-media-element-media"===(null===(t=this._songlePlayer.media)||void 0===t?void 0:t.dispatcherName)){var e=this.lastTime,r=this.lastPosition,n=Date.now()-e;this.lastPosition=r+n}else this.lastPosition=this._songlePlayer.positionTime}this.lastTime=0}this.handler=null},t.prototype.dispose=function(){if(this.player&&this.player.removeListener(this.volumeListener),this._songlePlayer){try{this._songlePlayer.stop()}catch(t){}this._songlePlayer=null}},t.prototype.onVolumeUpdate=function(t){this._songlePlayer&&(this._songlePlayer.volume=t)},t}(),o9=function(){function t(t){this.listeners=[],this.throttleInterval=t&&t.throttleInterval?Number(t.throttleInterval):100}return t.prototype.onVideoLoad=function(t,e){this.listeners.forEach(function(r){return r.onVideoLoad&&r.onVideoLoad(t,e)})},t.prototype.onSongLoad=function(t,e){this.listeners.forEach(function(r){return r.onSongLoad&&r.onSongLoad(t,e)})},t.prototype.onSongMapLoad=function(t,e){this.listeners.forEach(function(r){return r.onSongMapLoad&&r.onSongMapLoad(t,e)})},t.prototype.onSongInfoLoad=function(t,e){var r=!1;this.listeners.forEach(function(n){n.onSongInfoLoad&&(n.onSongInfoLoad(t,e),r=!0)}),r&&console.warn('[TextAlive API] "onSongInfoLoad" event is deprecated; use "onSongMapLoad" event instead')},t.prototype.onVocalAmplitudeLoad=function(t,e){this.listeners.forEach(function(r){return r.onVocalAmplitudeLoad&&r.onVocalAmplitudeLoad(t,e)})},t.prototype.onValenceArousalLoad=function(t,e){this.listeners.forEach(function(r){return r.onValenceArousalLoad&&r.onValenceArousalLoad(t,e)})},t.prototype.onLyricsLoad=function(t,e){this.listeners.forEach(function(r){return r.onLyricsLoad&&r.onLyricsLoad(t,e)})},t.prototype.onTextLoad=function(t,e){this.listeners.forEach(function(r){return r.onTextLoad&&r.onTextLoad(t,e)})},t.prototype.onAppLoad=function(t){this.listeners.forEach(function(e){return e.onAppLoad&&e.onAppLoad(t)})},t.prototype.onAppReady=function(t){this.listeners.forEach(function(e){return e.onAppReady&&e.onAppReady(t)})},t.prototype.onAppParameterUpdate=function(t,e){this.listeners.forEach(function(r){return r.onAppParameterUpdate&&r.onAppParameterUpdate(t,e)})},t.prototype.onAppMediaChange=function(t,e){this.listeners.forEach(function(r){return r.onAppMediaChange&&r.onAppMediaChange(t,e)})},t.prototype.onTemplateUpdate=function(t){this.listeners.forEach(function(e){return e.onTemplateUpdate&&e.onTemplateUpdate(t)})},t.prototype.onTemplateCommit=function(t){this.listeners.forEach(function(e){return e.onTemplateCommit&&e.onTemplateCommit(t)})},t.prototype.onTemplatesLoad=function(t,e){this.listeners.forEach(function(r){return r.onTemplatesLoad&&r.onTemplatesLoad(t,e)})},t.prototype.onFontsLoad=function(t,e){this.listeners.forEach(function(r){return r.onFontsLoad&&r.onFontsLoad(t,e)})},t.prototype.onVideoReady=function(t){this.listeners.forEach(function(e){return e.onVideoReady&&e.onVideoReady(t)})},t.prototype.onTimerReady=function(t){this.listeners.forEach(function(e){return e.onTimerReady&&e.onTimerReady(t)})},t.prototype.onStageElementSet=function(t){this.listeners.forEach(function(e){return e.onStageElementSet&&e.onStageElementSet(t)})},t.prototype.onMediaElementSet=function(t){this.listeners.forEach(function(e){return e.onMediaElementSet&&e.onMediaElementSet(t)})},t.prototype.onTimeUpdate=function(t){var e=this;this.listeners.forEach(function(e){return e.onTimeUpdate&&e.onTimeUpdate(t)}),this.position=t,this.throttledTimeUpdate||(this.throttledTimeUpdate=new Promise(function(t,r){setTimeout(function(){e.onThrottledTimeUpdate(e.position),e.throttledTimeUpdate=null,t()},e.throttleInterval)}))},t.prototype.onThrottledTimeUpdate=function(t){this.listeners.forEach(function(e){return e.onThrottledTimeUpdate&&e.onThrottledTimeUpdate(t)})},t.prototype.onBackgroundGraphicsUpdate=function(t){this.listeners.forEach(function(e){return e.onBackgroundGraphicsUpdate&&e.onBackgroundGraphicsUpdate(t)})},t.prototype.onMediaSeek=function(t){this.listeners.forEach(function(e){return e.onMediaSeek&&e.onMediaSeek(t)})},t.prototype.onVideoSeekStart=function(){this.listeners.forEach(function(t){return t.onVideoSeekStart&&t.onVideoSeekStart()})},t.prototype.onVideoSeekEnd=function(){this.listeners.forEach(function(t){return t.onVideoSeekEnd&&t.onVideoSeekEnd()})},t.prototype.onVideoSeek=function(t){this.listeners.forEach(function(e){return e.onVideoSeek&&e.onVideoSeek(t)})},t.prototype.onPlay=function(){this.listeners.forEach(function(t){return t.onPlay&&t.onPlay()})},t.prototype.onPause=function(){this.listeners.forEach(function(t){return t.onPause&&t.onPause()})},t.prototype.onSeek=function(t){this.listeners.forEach(function(e){return e.onSeek&&e.onSeek(t)})},t.prototype.onSeekComplete=function(t){this.listeners.forEach(function(e){return e.onSeekComplete&&e.onSeekComplete(t)})},t.prototype.onStop=function(){this.listeners.forEach(function(t){return t.onStop&&t.onStop()})},t.prototype.onDispose=function(){this.listeners.forEach(function(t){return t.onDispose&&t.onDispose()})},t.prototype.onResize=function(t){this.listeners.forEach(function(e){return e.onResize&&e.onResize(t)})},t.prototype.onVolumeUpdate=function(t){this.listeners.forEach(function(e){return e.onVolumeUpdate&&e.onVolumeUpdate(t)})},t.prototype.addListener=function(t){!t||this.listeners.indexOf(t)>=0||this.listeners.push(t)},t.prototype.removeListener=function(t){var e=!1;return this.listeners=this.listeners.filter(function(r){var n=r===t;return e=e||n,!n}),e},t}(),st=function(){function t(t,e,r){var n=this;this.player=t,this.manager=e,this.emitter=r,this._defaultBackgroundCss=null,this._background=null,t.addListener({onStageElementSet:function(t){return n.doUpdateBackground(n.background)}})}return Object.defineProperty(t.prototype,"background",{get:function(){return this._background},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultBackgroundCss",{get:function(){return this._defaultBackgroundCss?this._defaultBackgroundCss:""},set:function(t){this._defaultBackgroundCss=t,this.updateBackground(this._background)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return null!==this._background},enumerable:!1,configurable:!0}),t.prototype.settingBackground=function(t){return o1(this,0,void 0,function(){return o2(this,function(e){switch(e.label){case 0:return[4,this.doSetBackground(t)];case 1:return[2,e.sent()&&this.doUpdateBackground(t)]}})})},t.prototype.setBackground=function(t){return o1(this,0,void 0,function(){var e;return o2(this,function(r){switch(r.label){case 0:return[4,this.doSetBackground(t)];case 1:return[2,(e=r.sent())&&this.updateBackground(e)]}})})},t.prototype.doSetBackground=function(t){return o1(this,0,void 0,function(){var e,r,n;return o2(this,function(i){switch(i.label){case 0:return e=t&&t.originalUrl?t.originalUrl:"",this.manager.isBackgroundColorAsset(t)?[2,{css:e,originalUrl:e}]:this.manager.isBackgroundPiaproImageAsset(t)?[4,this.manager.read(e)]:[3,2];case 1:return(r=i.sent())&&r.url&&this.manager.checkBackgroundImageLicense(r.license)?(r.originalUrl=e,t&&(r.x=t.x,r.y=t.y),[2,r]):[2,{css:"",originalUrl:e,x:t?t.x:void 0,y:t?t.y:void 0,license:r?r.license:void 0}];case 2:return this.manager.isBackgroundSpecialImageAsset(t)?[2,{css:'url("https://api.textalive.jp/images/backgrounds/snowmiku2016/'+(n=/^snowmiku2016-([0-9]{2})$/.exec(e))[1]+'.jpg")',contentUrl:"https://api.textalive.jp/images/backgrounds/snowmiku2016/"+n[1]+".jpg",url:"https://snowmiku.com/2016/info_chara.html",name:"SNOW MIKU 2016",authorName:"",originalUrl:e,x:t?t.x:void 0,y:t?t.y:void 0,defaultY:0}]:[2,{originalUrl:null,css:"",x:t?t.x:void 0,y:t?t.y:void 0}]}})})},t.prototype.updateBackground=function(t){return!!this.doUpdateBackground(t)&&(this.emitter&&this.emitter.onBackgroundGraphicsUpdate&&this.emitter.onBackgroundGraphicsUpdate(t),!0)},t.prototype.doUpdateBackground=function(t){if(!t)return!1;if(!this.player.stageElement)return this._background=t,!0;var e=this.player.stageElement.style;return t.css.length<=0?e.background=this.defaultBackgroundCss:e.background=t.css,"number"==typeof t.x||this._background&&"number"==typeof this._background.x?("number"!=typeof t.x&&(t.x=this._background.x),e.backgroundPositionX=e.backgroundPositionX+"%"):e.backgroundPositionX="number"==typeof t.defaultX?t.defaultX+"%":"center","number"==typeof t.y||this._background&&"number"==typeof this._background.y?("number"!=typeof t.y&&(t.y=this._background.y),e.backgroundPositionY=e.backgroundPositionY+"%"):e.backgroundPositionY="number"==typeof t.defaultY?t.defaultY+"%":"center",e.backgroundSize="cover",this._background=t,!0},t.prototype.export=function(){if(!this.background||!this.background.originalUrl)return null;var t={originalUrl:this.background.originalUrl};return void 0!==this.background.x&&(t.x=this.background.x),void 0!==this.background.y&&(t.y=this.background.y),t},t.prototype.exportPartialVideoEntry=function(t){return{background:this.export()}},t}(),se=function(t){function e(e,r){var n=this.constructor,i=t.call(this,e)||this;return i.fonts=r,Object.setPrototypeOf(i,n.prototype),i}return oQ(e,t),e}(Error),sr=function(){function t(t,e,r){this.fontInfoManager=t,this.textFetcher=e,this.listener=r,this._failed=[],this._loaded=[]}return Object.defineProperty(t.prototype,"failed",{get:function(){return this._failed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),t.prototype.loadAll=function(){return o1(this,0,void 0,function(){var t;return o2(this,function(e){switch(e.label){case 0:return[4,this.listAvailableFonts()];case 1:return t=e.sent(),[2,this.loadFonts(t)]}})})},t.prototype.loadForVideo=function(t){return o1(this,0,void 0,function(){var e,r;return o2(this,function(n){switch(n.label){case 0:return(e=this.listFontFamiliesInVideo(t))?[4,this.listAvailableFonts()]:(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(this.loaded),[2,Promise.resolve(this.loaded)]);case 1:return r=n.sent(),[2,this.loadFonts(r.filter(function(t){return e.indexOf(t.en)>=0}))]}})})},t.prototype.listFontFamiliesInVideo=function(t){if(!t||!t.phrases)return null;var e=[];return t.phrases.forEach(function(t){return t.words.forEach(function(t){return t.characters.forEach(function(t){return e.push(t.fontFamily)})})}),e.filter(function(t,e,r){return r.indexOf(t)===e})},t.prototype.listAvailableFonts=function(){return o1(this,0,void 0,function(){return o2(this,function(t){return[2,this.fontInfoManager.listAvailableFonts()]})})},t.prototype.isLoading=function(){return!!this.queue},t.prototype.load=function(t){return o1(this,0,void 0,function(){var e,r;return o2(this,function(n){switch(n.label){case 0:return e=[],r=[],t.forEach(function(t){"string"==typeof t?e.push(t):r.push(t)}),[4,this.fontInfoManager.listAvailableFonts()];case 1:return n.sent().forEach(function(t){e.indexOf(t.key)>=0&&r.push(t)}),[2,this.loadFonts(r)]}})})},t.prototype.loadFonts=function(t){return o1(this,0,void 0,function(){var e=this;return o2(this,function(r){return this.queue?(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(null,new se("Failed to load some fonts because there is an ongoing font loding process",this.failed.slice())),[2,this.loaded]):(this.queue=this.doLoad(t).then(function(t){return e.queue=null,t}),[2,this.queue])})})},t.prototype.doLoad=function(t){return o1(this,0,void 0,function(){var e,r,n,i,o=this;return o2(this,function(s){switch(s.label){case 0:return e=[],r=[],[4,this.fontInfoManager.getFrequentChars()];case 1:return n=s.sent(),t.forEach(function(t){t.typesquare||t.typekit||e.push(t),t.typesquare&&r.push(t)}),i=(this.textFetcher&&this.textFetcher()||"").split("").filter(function(t,e,r){return r.indexOf(t)===e}).sort().join(""),[2,Promise.all([function(t,e,r){return o1(this,0,void 0,function(){var n,i,o,s,u,c,l,p,h,f,d,y,g,v;return o2(this,function(m){switch(m.label){case 0:if(n={loaded:[],failed:[]},"undefined"==typeof window||!window.document||!window.document.head)return n.failed=t.slice(),[2,n];for(i=r.split("").filter(function(t,e,r){return r.indexOf(t)===e}).sort(),o=!0,s=0,i.forEach(function(t){var r=e.indexOf(t,s);o=o&&r>=0,s=r}),u=window.document.head,c=[],l=0;l<u.children.length;l++)"link"===(p=u.children.item(l)).tagName.toLowerCase()&&"stylesheet"===p.getAttribute("rel")&&c.push(p.getAttribute("href"));if(h=[],f=[],d=[],t.forEach(function(t){if(t.google)d.push(t.key);else{var e=o&&t.compactUrl||t.url;c.includes(e)?n.loaded.push(t):(f.push(t.en),h.push(e))}}),y={classes:!1,active:null,inactive:null,fontactive:function(e){n.loaded.push(t.find(function(t){return t.en===e})),n.failed=n.failed.filter(function(t){return t.en!==e})},fontinactive:function(e){n.failed.push(t.find(function(t){return t.en===e}))},timeout:5e3},d.length>0&&(y.google={families:d}),f.length>0&&(y.custom={families:f,urls:h}),!y.google&&!y.custom)return[3,6];m.label=1;case 1:return m.trys.push([1,5,,6]),(v="undefined"!=typeof window&&(null==window?void 0:window.WebFont))?[3,3]:[4,a("1MZgh")];case 2:v=m.sent(),m.label=3;case 3:return g=v,[4,new Promise(function(t){y.active=y.inactive=t,g.load(y)})];case 4:case 5:return m.sent(),[3,6];case 6:return[2,n]}})})}(e,n,i),function(t,e){return o1(this,0,void 0,function(){var r,n,i,o,s,a,u;return o2(this,function(c){switch(c.label){case 0:if(r={loaded:[],failed:[]},!("undefined"!=typeof window&&window.document&&window.document.head&&window.Ts&&window.Ts.loadFontAsync))return r.failed=t.slice(),[2,r];for(n=window.document.head,i={},o=function(t){var e=n.children.item(t);if("style"!==e.tagName.toLowerCase()||"text/css"!==e.getAttribute("type")||"stylesheet"!==e.getAttribute("rel")||!e.hasAttribute("data-cssName"))return"continue";var r=e.getAttribute("data-cssName");if(void 0===i[r])return i[r]=new Set(e.getAttribute("data-text")),"continue";e.getAttribute("data-text").split("").forEach(function(t){return i[r].add(t)})},s=0;s<n.children.length;s++)o(s);return a=window.Ts,u=[],t.forEach(function(t){var n=new Set(e+t.en+t.ja);if(i[t.en]&&i[t.en].forEach(function(t){return n.delete(t)}),n.size<=0)return r.loaded.push(t),r;u.push(new Promise(function(e){return function(t,e,r,n,i){var o=e.en;t.loadFontAsync({cssName:o,text:n,outputType:"json",callback:function(t){try{var s,a,u,c;s=t.data,a=JSON.parse(s),u=JSON.parse(a.res),(c=document.createElement("style")).setAttribute("data-cssName",o),c.setAttribute("data-text",n),c.setAttribute("type","text/css"),c.setAttribute("rel","stylesheet"),c.innerHTML="@font-face {font-family: '"+u.fontFamily+"';font-weight: "+u["font-weight"]+";src: url(data:font/woff;base64,"+u.src+");}",document.head.appendChild(c),r.loaded.push(e)}catch(t){r.failed.push(e)}i()}})}(a,t,r,Array.from(n.values()).join(""),e)}))}),[4,Promise.all(u)];case 1:return c.sent(),[2,r]}})})}(r,i)]).then(function(t){var e=t[0],r=t[1],n=e.loaded.concat(r.loaded);if(o.addLoadedFonts(n),e.failed.length>0||r.failed.length>0){var i=e.failed.concat(r.failed);o.addFailedFonts(i),o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,new se("Failed to load some fonts",o.failed.slice()))}else o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(n);return o.loaded}).catch(function(t){return o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,new se(t,o.failed.slice())),o.loaded})]}})})},t.prototype.addLoadedFonts=function(t){var e=this;this._loaded=this.loaded.concat(t.filter(function(t){return 0>e.failed.findIndex(function(e){return e.key===t.key})}))},t.prototype.addFailedFonts=function(t){var e=this;this._failed=this.failed.concat(t.filter(function(t){return 0>e.failed.findIndex(function(e){return e.key===t.key})}))},t}(),sn=function(){function t(){}return Object.defineProperty(t.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return"object"==typeof t?this.overlaps(t.startTime,t.endTime):this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?this.startTime===this.endTime?0:(t-this.startTime)/(this.endTime-this.startTime):-1},t}(),si=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return oQ(e,t),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.next?this.next.startTime:this.startTime},enumerable:!1,configurable:!0}),e}(sn),so=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return oQ(e,t),e}(sn),ss=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return oQ(e,t),e}(sn),sa=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return oQ(e,t),e}(sn),su=function(){function t(t){var e=t.analysis,r=t.info;this.beats=[],this.chords=[],this.segments=[],this.voice=[],this._revisions={beatId:(null==r?void 0:r.beatRevisionId)||-1,chordId:(null==r?void 0:r.chordRevisionId)||-1,repetitiveSegmentId:(null==r?void 0:r.chorusRevisionId)||-1},this.parseBeats(null==e?void 0:e.beats),this.parseSegments(null==e?void 0:e.repetitive_segment),this.parseChords(null==e?void 0:e.chords),this.parseVoice(e.voice)}return Object.defineProperty(t.prototype,"revisions",{get:function(){return this._revisions},enumerable:!1,configurable:!0}),t.prototype.parseBeats=function(t){var e=this;if(this.beats.splice(0,this.beats.length),Array.isArray(t)&&Array.isArray(t[0])){var r=null,n=0;t[0].forEach(function(t){var i=new si;i.startTime=1e3*t[0],i.length=t[2],i.position=t[3],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.beats.push(i),r=i}),null!==r&&(r.next=null)}},t.prototype.parseChords=function(t){var e=this;if(this.chords.splice(0,this.chords.length),Array.isArray(t)){var r=null,n=0;t.forEach(function(t){var i=new so;i.startTime=1e3*t[0],i.endTime=1e3*t[1],i.name=t[2],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.chords.push(i),r=i}),null!==r&&(r.next=null)}},t.prototype.parseSegments=function(t){var e=this;this.segments.splice(0,this.segments.length),Array.isArray(t)&&t.forEach(function(t){var r={chorus:!!t.chorus,duration:10*t.segment_length,segments:null},n=null,i=0;r.segments=t.start_frames.map(function(t){var e=new ss;return e.startTime=10*t,e.endTime=e.startTime+r.duration,e.previous=n,null!==n&&(n.next=e),e.index=i++,n=e,e}),null!==n&&(n.next=null),e.segments.push(r)})},t.prototype.parseVoice=function(t){var e=this;this.voice.splice(0,this.voice.length),Array.isArray(t)&&t.forEach(function(t){var r=[],n=null,i=0,o=0;t.forEach(function(t){var e=new sa;e.startTime=o,e.endTime=e.startTime+10*t[1],e.f0=t[0][0],e.initialF0=t[0][1],e.previous=n,null!==n&&(n.next=e),e.index=i++,r.push(e),n=e,o=e.endTime}),null!==n&&(n.next=null),e.voice.push(r)})},t}(),sc=function(){function t(t){var e=t.song,r=t.analysis,n=t.vocalAmplitude,i=t.maxVocalAmplitude,o=t.valenceArousal;this._song=e,this._analysis=r,this._vocalAmplitude=n,this._maxVocalAmplitude=i,this._valenceArousal=o}return Object.defineProperty(t.prototype,"song",{get:function(){return this._song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analysis",{get:function(){return this._analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vocalAmplitude",{get:function(){return this._vocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxVocalAmplitude",{get:function(){return this._maxVocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valenceArousal",{get:function(){return this._valenceArousal},enumerable:!1,configurable:!0}),t.prototype.getChoruses=function(){if(!this._analysis)return[];var t,e=this._analysis.segments.filter(function(t){return t.chorus});return e.length<=0?[]:(null===(t=e[0].segments)||void 0===t?void 0:t.slice())||[]},t.prototype.findChorus=function(t,e){return nn(this.getChoruses(),t,e)},t.prototype.findChorusBetween=function(t,e){return this.findChorus(t,{endTime:e})},t.prototype.findChorusChange=function(t,e){return ni(this.getChoruses(),t,e)},t.prototype.getBeats=function(){var t,e;return(null===(e=null===(t=this._analysis)||void 0===t?void 0:t.beats)||void 0===e?void 0:e.slice())||[]},t.prototype.findBeat=function(t,e){return nn(this.getBeats(),t,e)},t.prototype.findBeatChange=function(t,e){return ni(this.getBeats(),t,e)},t.prototype.getChords=function(){var t,e;return(null===(e=null===(t=this._analysis)||void 0===t?void 0:t.chords)||void 0===e?void 0:e.slice())||[]},t.prototype.findChord=function(t,e){return nn(this.getChords(),t,e)},t.prototype.findChordChange=function(t,e){return ni(this.getChords(),t,e)},t.prototype.getVocalFrequency=function(t){if(!Array.isArray(null===(e=this._analysis)||void 0===e?void 0:e.voice))return -1;var e,r=this._analysis.voice[0];if(r.length<=0)return -1;var n=rg.sortedIndex(r,t,function(t){return t.endTime});return r[n].contains(t)?r[n].f0:-1},t.prototype.getVocalAmplitude=function(t){var e=this._vocalAmplitude,r=Math.round(t/10);return!Array.isArray(this._vocalAmplitude)||r<0||r>=e.length?-1:this._vocalAmplitude[r]},t.prototype.getMaxVocalAmplitude=function(){return"number"==typeof this._maxVocalAmplitude?this._maxVocalAmplitude:-1},t.prototype.getValenceArousal=function(t){var e=this._valenceArousal;if(!e)return null;var r=rg.sortedIndex(e.seq,t,function(t){return 1e3*t.t[1]});if(r<0)return{a:e.seq[0].a,v:e.seq[0].v};if(r+1>=e.seq.length||t<1e3*e.seq[r+1].t[0])return{a:e.seq[Math.min(r,e.seq.length-1)].a,v:e.seq[Math.min(r,e.seq.length-1)].v};var n=e.seq[r],i=e.seq[r+1],o=t/1e3,s=i.t[0],a=n.t[1],u=a-s;return{a:(n.a*(a-o)+i.a*(o-s))/u,v:(n.v*(a-o)+i.v*(o-s))/u}},t.prototype.getMedianValenceArousal=function(){var t=this._valenceArousal;return t?t.stats.median:null},t}(),sl=function(){function t(t,e,r){this.songManager=t,this.options=r,this.listener=e}return Object.defineProperty(t.prototype,"song",{get:function(){return this._song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analysis",{get:function(){return this._analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vocalAmplitude",{get:function(){return this._vocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxVocalAmplitude",{get:function(){return this._maxVocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valenceArousal",{get:function(){return this._valenceArousal},enumerable:!1,configurable:!0}),t.prototype.loadSong=function(t,e){var r,n,i;return o1(this,0,void 0,function(){var o,s;return o2(this,function(a){switch(a.label){case 0:return"number"==typeof t&&t<0||!t?(this.onSongLoad(null,Error("Neither Songle ID or code provided")),[2,null]):[4,this.songManager.load("number"==typeof t?{id:t}:{code:t})];case 1:return o=a.sent(),this.onSongLoad(o,o?void 0:Error("Song data not found")),o?(s={chord:null==e?void 0:e.chordId,beat:null==e?void 0:e.beatId,chorus:null==e?void 0:e.repetitiveSegmentId},[4,Promise.all([(null===(r=this.options)||void 0===r?void 0:r.vocalFrequencyEnabled)?this.loadSongDetailInfo(o.song.code,{revisions:s}):this.loadSongInfo(o.song.code,{revisions:s}),(null===(n=this.options)||void 0===n?void 0:n.vocalAmplitudeEnabled)?this.loadVocalAmplitude(o.song.code):Promise.resolve(null),(null===(i=this.options)||void 0===i?void 0:i.valenceArousalEnabled)?this.loadValenceArousal(o.song.code):Promise.resolve(null)])]):[2,null];case 2:return a.sent(),[2,new sc(this)]}})})},t.prototype.onSongLoad=function(t,e){this._song=t,this.listener&&this.listener.onSongLoad&&this.listener.onSongLoad(t,e)},t.prototype.loadSongInfo=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,this.songManager.loadInfo(String(t),e)];case 1:return r=n.sent(),this.onSongMapLoad(r,r?void 0:Error("Song analysis data not found")),[2,r]}})})},t.prototype.loadSongDetailInfo=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,this.songManager.loadDetailInfo(String(t),e)];case 1:return r=n.sent(),this.onSongMapLoad(r,r?void 0:Error("Song analysis data not found")),[2,r]}})})},t.prototype.mockSongInfo=function(t){var e=function(t){for(var e=t.beat,r=t.chorusSegment,n=t.duration,i=[],o=0;60*o/e.bpm<n/1e3;)i.push([60*o/e.bpm,1,e.length,o%e.length+1,1]),o++;return{beats:[i],chords:null,repetitive_segment:[{chorus:!0,index:0,segment_length:r.duration/10,start_frames:r.startTimes.map(function(t){return t/10})}],voice:null}}(t);return this._song=null,this.onSongMapLoad({analysis:e,info:null}),new sc(this)},t.prototype.onSongMapLoad=function(t,e){var r,n;this._analysis=new su(t),(null===(r=this.listener)||void 0===r?void 0:r.onSongMapLoad)&&this.listener.onSongMapLoad(this._analysis,e),(null===(n=this.listener)||void 0===n?void 0:n.onSongInfoLoad)&&this.listener.onSongInfoLoad(t,e)},t.prototype.loadVocalAmplitude=function(t){var e;return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return r=this,[4,this.songManager.loadVocalAmplitude(String(t))];case 1:return r._vocalAmplitude=n.sent(),this._maxVocalAmplitude=Math.max.apply(Math,this._vocalAmplitude),(null===(e=this.listener)||void 0===e?void 0:e.onVocalAmplitudeLoad)&&this.listener.onVocalAmplitudeLoad(this._vocalAmplitude,this._vocalAmplitude?void 0:Error("Vocal amplitude data not found")),[2,this._vocalAmplitude]}})})},t.prototype.loadValenceArousal=function(t){var e;return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return r=this,[4,this.songManager.loadValenceArousal(String(t))];case 1:return r._valenceArousal=n.sent(),(null===(e=this.listener)||void 0===e?void 0:e.onValenceArousalLoad)&&this.listener.onValenceArousalLoad(this._valenceArousal,this._valenceArousal?void 0:Error("Valence arousal data not found")),[2,this._valenceArousal]}})})},t}(),sp=function(){function t(t,e,r){this.managers=t,this.listener=e,this.options=r}return t.prototype.loadRawText=function(t){var e;return e=!t.phrases||t.phrases.length<0?"":t.phrases.map(function(t){return t.words.map(function(t){return t.characters.map(function(t){return t.char}).join("")}).join("")}).join(""),this.onTextLoad({text:e}),{lyricsId:-1,lyrics:null,lyricsBody:{text:e,artist:null,name:null,url:null}}},t.prototype.loadLyrics=function(t){var e=t.songCode,r=t.lyricId,n=void 0===r?-1:r,i=t.lyricDiffId,o=void 0===i?-1:i,s=t.altLyricsUrl,a=t.directAccess;return o1(this,0,void 0,function(){var t,r,i,u;return o2(this,function(c){switch(c.label){case 0:return n<=0?(0===n?this.onLyricsLoad(null,Error("Lyrics not loaded")):this.onLyricsLoad(null,Error("Lyrics not found")),[2,null]):[4,this.managers.lyrics.loadDiff(e,n,o)];case 1:return(null==(t=c.sent())?void 0:t.data)?(r=o0(o0({},t),{processing:!1,failed:!1,id:n,diff:{id:o}}),this.onLyricsLoad(r),s||a?[3,3]:[4,this.managers.lyrics.fetchLocalLyricBody(n)]):(this.onLyricsLoad(null,Error("Lyrics timing information not found")),[2,null]);case 2:i=c.sent(),c.label=3;case 3:if(null==i?void 0:i.text)return[3,7];c.label=4;case 4:return c.trys.push([4,6,,7]),[4,this.loadLyricsText(t,{altLyricsUrl:s,directAccess:a})];case 5:return i=c.sent(),[3,7];case 6:return u=c.sent(),this.onTextLoad(null,u),[3,7];case 7:return i&&this.onTextLoad(i),[2,{lyricsId:r.id,lyrics:r,lyricsBody:i}]}})})},t.prototype.loadLyricsText=function(t,e){var r=void 0===e?{}:e,n=r.altLyricsUrl,i=r.directAccess;return o1(this,0,void 0,function(){var e,r,o=this;return o2(this,function(s){switch(s.label){case 0:return e=this.options&&"number"==typeof this.options.lyricsFetchTimeout&&this.options.lyricsFetchTimeout>=0,r=this.managers.lyrics.fetchLyricBody(n||t.url,{parserPath:t.parser_path,directAccess:i}),[4,e?Promise.race([r,new Promise(function(t,e){return setTimeout(function(){return e(Error("Fetching lyrics text timeout"))},o.options.lyricsFetchTimeout)})]):r];case 1:return[2,s.sent()]}})})},t.prototype.onLyricsLoad=function(t,e){this.listener&&this.listener.onLyricsLoad&&this.listener.onLyricsLoad(t,e)},t.prototype.onTextLoad=function(t,e){this.listener&&this.listener.onTextLoad&&this.listener.onTextLoad(t,e)},t}(),sh=function(){function t(t){var e=t.video;this._video=e}return Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._video.json},enumerable:!1,configurable:!0}),t}(),sf=function(){function t(t,e){this.managers=t,this.listener=e,this.listener=e}return Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),t.prototype.onVideoLoad=function(t,e){var r=t?Object.assign(t,e):null;return r&&("string"==typeof r.json?r.json=JSON.parse(r.json):"object"==typeof r.json&&null!==r.json||(r.json={}),"string"==typeof r.config?r.config=JSON.parse(r.config):"object"==typeof r.config&&null!==r.config||(r.config={})),this._video=r,this.listener&&this.listener.onVideoLoad&&this.listener.onVideoLoad(r),new sh({video:r})},t.prototype.createFromVideoId=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,this.managers.video.load(t)];case 1:return r=n.sent(),[2,this.onVideoLoad(r,e)]}})})},t.prototype.createFromVideo=function(t,e){return this.onVideoLoad(t,e)},t.prototype.createFromSongUrl=function(t,e){return o1(this,0,void 0,function(){return o2(this,function(r){return[2,this.createFromSongPath(this.managers.song.getSongPathFromUrl(t),e)]})})},t.prototype.createFromSongPath=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,this.managers.song.load({songPath:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}})})},t.prototype.createFromSongId=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,this.managers.song.load({id:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}})})},t.prototype.createFromSongCode=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,this.managers.song.load({code:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}})})},t.prototype.createFromSong=function(t,e){var r;return o1(this,0,void 0,function(){var n,i,o,s,a,u;return o2(this,function(c){switch(c.label){case 0:return n=null==e?void 0:e.lyricId,i=null==e?void 0:e.lyricDiffId,"number"!=typeof n||n<0?[4,this.managers.lyrics.load(t.code)]:[3,4];case 1:return(a=(o=c.sent())&&!o.status.failed&&!o.status.processing&&Array.isArray(o.lyrics)&&o.lyrics.length>0)?[4,this.managers.lyrics.loadDetail(t.code,o.lyrics[0].id)]:[3,3];case 2:a=c.sent(),c.label=3;case 3:(s=a)&&(n=s.id,i=null===(r=s.diff)||void 0===r?void 0:r.id),c.label=4;case 4:return"number"!=typeof n&&(n=-1),"number"!=typeof i&&(i=-1),u={id:-1,sourceId:-1,sourceOriginId:-1,songleId:t.id,songleCode:t.code,lyricId:n,lyricDiffId:i,title:null,log:null,background:null,config:null,json:null,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null},[2,this.onVideoLoad(u,e)]}})})},t.prototype.createFromText=function(t,e){return o1(this,0,void 0,function(){var r,n,i,o,s,a;return o2(this,function(u){switch(u.label){case 0:return[4,this.managers.text.parse(t)];case 1:return a=(s=(o=(i=(n=(r=u.sent())&&"success"===r.status?this.createVideoDataFromParsedText(r,t):this.createVideoDataFromText(t))[n.length-1])&&i.words[i.words.length-1])&&o.characters[o.characters.length-1])?s.endTime:0,[2,this.createFromJSON({phrases:n,startTime:0,endTime:a,duration:a},e)]}})})},t.prototype.createFromJSON=function(t,e){return this.onVideoLoad({id:-1,sourceId:-1,sourceOriginId:-1,songleId:-1,lyricId:-1,lyricDiffId:-1,title:null,log:null,background:null,config:null,json:t,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null},e)},t.prototype.createVideoDataFromParsedText=function(t,e){var r=0,n=e.split(/\r\n|[\n\v\f\r\x85\u2028\u2029]/);return t.result.map(function(t,e){return{words:t.map(function(t){return{characters:n[e].substr(t.startPosition,t.wordLength).split("").map(function(t){return{char:t,startTime:300*r,endTime:300*++r}}),pos:t.PoS,rawPoS:t.rawPoS,language:t.language}}),templates:[{type:"DefaultAlignment"}]}})},t.prototype.createVideoDataFromText=function(t){for(var e,r={characters:[]},n={words:[r],templates:[{type:"DefaultAlignment"}]},i=0,o=[n],s=0;s<t.length;s++){var a=t.charAt(s);"\n"!==a?" "!==a?(e={char:a,startTime:300*i,endTime:300*++i},r.characters.push(e)):(r={characters:[]},n.words.push(r)):(n={words:[r={characters:[]}],templates:[{type:"DefaultAlignment"}]},o.push(n))}return r.characters.length<=0&&n.words.pop(),n.words.length<=0&&o.pop(),o},t}(),sd=function(){function t(t,e,r){void 0===e&&(e=null);var n=this;this.managers=t,this.listener=e,this.options=r,this.fontLoader=new sr(t.font,function(){return n.text},e)}return Object.defineProperty(t.prototype,"permalink",{get:function(){var t;return"https://textalive.jp".concat((null===(t=this.song)||void 0===t?void 0:t.permalink)?"/songs/".concat(encodeURIComponent(rP.getSongPathFromUrl(this.song.permalink))):"")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){var t;return null===(t=this.videoProvider)||void 0===t?void 0:t.video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"song",{get:function(){var t,e;return null===(e=null===(t=this.songProvider)||void 0===t?void 0:t.song)||void 0===e?void 0:e.song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songStatus",{get:function(){var t,e;return null===(e=null===(t=this.songProvider)||void 0===t?void 0:t.song)||void 0===e?void 0:e.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songMap",{get:function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsId",{get:function(){var t,e;return null===(e=null===(t=this.textProvider)||void 0===t?void 0:t.lyrics)||void 0===e?void 0:e.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyrics",{get:function(){var t;return null===(t=this.textProvider)||void 0===t?void 0:t.lyrics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsBody",{get:function(){var t;return null===(t=this.textProvider)||void 0===t?void 0:t.lyricsBody},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){var t,e;return null===(e=null===(t=this.textProvider)||void 0===t?void 0:t.lyricsBody)||void 0===e?void 0:e.text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fonts",{get:function(){return this.fontLoader},enumerable:!1,configurable:!0}),t.prototype.createFromVideoId=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return r=this,[4,new sf(this.managers,this.listener).createFromVideoId(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}})})},t.prototype.createFromVideo=function(t,e){return this.videoProvider=new sf(this.managers,this.listener).createFromVideo(t,e),this.videoProvider},t.prototype.createFromSongUrl=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return r=this,[4,new sf(this.managers,this.listener).createFromSongUrl(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}})})},t.prototype.createFromSongPath=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return r=this,[4,new sf(this.managers,this.listener).createFromSongPath(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}})})},t.prototype.createFromSongId=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return r=this,[4,new sf(this.managers,this.listener).createFromSongId(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}})})},t.prototype.createFromSongCode=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return r=this,[4,new sf(this.managers,this.listener).createFromSongCode(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}})})},t.prototype.createFromText=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return r=this,[4,new sf(this.managers,this.listener).createFromText(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}})})},t.prototype.createFromJSON=function(t,e){return this.videoProvider=new sf(this.managers,this.listener).createFromJSON(t,e),this.videoProvider},t.prototype.finalize=function(t){return o1(this,0,void 0,function(){return o2(this,function(e){switch(e.label){case 0:return this.video?[4,this.loadSong()]:[2,null];case 1:return e.sent(),[4,this.loadText(t)];case 2:return e.sent(),[4,this.loadFonts()];case 3:return e.sent(),[2]}})})},t.prototype.mockSongInfo=function(t){this.songProvider=new sl(this.managers.song,this.listener,this.options).mockSongInfo(t)},t.prototype.loadSong=function(){return o1(this,0,void 0,function(){var t;return o2(this,function(e){switch(e.label){case 0:return t=this,[4,new sl(this.managers.song,this.listener,this.options).loadSong(this.video.songleCode||this.video.songleId,this.video)];case 1:return t.songProvider=e.sent(),[2]}})})},t.prototype.loadText=function(t){var e,r;return o1(this,0,void 0,function(){var n,i,o,s,a,u,c,l;return o2(this,function(p){switch(p.label){case 0:return i=(n=this.video).lyricId,o=n.lyricDiffId,s=this.song?this.song.code:null,a=new sp(this.managers,this.listener,this.options),!s&&i<0?(u=a.loadRawText(null===(e=this.videoProvider)||void 0===e?void 0:e.data),[3,3]):[3,1];case 1:return c=(null==t?void 0:t.altLyricsUrl)||void 0,l=(null==t?void 0:t.lyricsDirectAccess)||void 0,[4,a.loadLyrics({songCode:s,lyricId:i,lyricDiffId:o,altLyricsUrl:c,directAccess:l})];case 2:u=p.sent(),p.label=3;case 3:return this.textProvider=u,(null==u?void 0:u.lyrics)&&(null===(r=null==u?void 0:u.lyricsBody)||void 0===r?void 0:r.text)&&this.importLyrics(),[2]}})})},t.prototype.loadFonts=function(){var t,e,r;return o1(this,0,void 0,function(){return o2(this,function(n){switch(n.label){case 0:return"number"==typeof this.video.id&&this.video.id>=0?[4,this.fontLoader.loadForVideo(null===(t=this.videoProvider)||void 0===t?void 0:t.data)]:[3,2];case 1:case 3:case 5:return n.sent(),[2];case 2:return Array.isArray(null===(e=this.options)||void 0===e?void 0:e.fontFamilies)?[4,this.fontLoader.load(this.options.fontFamilies)]:[3,4];case 4:return null!==(null===(r=this.options)||void 0===r?void 0:r.fontFamilies)?[3,6]:[4,this.fontLoader.loadAll()];case 6:return[2]}})})},t.prototype.importLyrics=function(){var t=this.text.replace(/[\s\r\n]/g,""),e=0,r={phrases:this.lyrics.data.map(function(r){return{words:r.map(function(r){return{characters:r.map(function(r){return{char:t.charAt(e++),startTime:1e3*r.start_time,endTime:1e3*r.end_time}})}})}})};this.video.json&&Array.isArray(this.video.json.phrases)?this.video.json.phrases.forEach(function(t,e){t.words.forEach(function(t,n){t.characters.forEach(function(t,i){var o=r.phrases[e].words[n].characters[i];t.char=o.char,t.startTime=o.startTime,t.endTime=o.endTime})})}):this.video.json=r},t.prototype.getChoruses=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getChoruses()},t.prototype.findChorus=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChorus(t,e)},t.prototype.findChorusBetween=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChorusBetween(t,e)},t.prototype.findChorusChange=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChorusChange(t,e)},t.prototype.getBeats=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getBeats()},t.prototype.findBeat=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findBeat(t,e)},t.prototype.findBeatChange=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findBeatChange(t,e)},t.prototype.getChords=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getChords()},t.prototype.findChord=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChord(t,e)},t.prototype.findChordChange=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChordChange(t,e)},t.prototype.getVocalFrequency=function(t){var e;return null===(e=this.songProvider)||void 0===e?void 0:e.getVocalFrequency(t)},t.prototype.getVocalAmplitude=function(t){var e;return null===(e=this.songProvider)||void 0===e?void 0:e.getVocalAmplitude(t)},t.prototype.getMaxVocalAmplitude=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getMaxVocalAmplitude()},t.prototype.getValenceArousal=function(t){var e;return null===(e=this.songProvider)||void 0===e?void 0:e.getValenceArousal(t)},t.prototype.getMedianValenceArousal=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getMedianValenceArousal()},t}(),sy=function(){function t(t,e){this.player=t,this.listener=e,this.initialize()}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options?o0({},this._options):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"author",{get:function(){return this._author},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"server",{get:function(){return this._server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"managed",{get:function(){return!!this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songUrl",{get:function(){return this._songUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songOptions",{get:function(){return this._songOptions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parameters",{get:function(){return this._parameters},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConnecting",{get:function(){return!!this.connecting},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var t,e,r,n;return o1(this,0,void 0,function(){return o2(this,function(i){switch(i.label){case 0:return this._options=null===(e=null===(t=this.player)||void 0===t?void 0:t.options)||void 0===e?void 0:e.app,this._options&&(this._options=o0({},this._options),this._name=null===(r=this._options)||void 0===r?void 0:r.appName,this._author=null===(n=this._options)||void 0===n?void 0:n.appAuthor,this._options.token&&(rk.textalive.appToken=this._options.token)),this._parameters={},this.parseQueryString(),this.initializeServerConnection(),"undefined"!=typeof window&&this._options?[4,this.connect()]:[3,2];case 1:i.sent(),this.initializePlayerListener(),this.initializeMessageListener(),i.label=2;case 2:return this._songUrl&&this.createFromSongUrl(),[2]}})})},t.prototype.initializeServerConnection=function(){var t,e,r,n,i,o;return o1(this,0,void 0,function(){var s,a,u,c,l;return o2(this,function(p){switch(p.label){case 0:return[4,rD.getServerStatus()];case 1:return a="ja"===(null==(s=p.sent())?void 0:s.lang),rk.textalive.appToken&&(null==s?void 0:s.app)&&(s.app.data&&(this._name=null===(t=s.app.data)||void 0===t?void 0:t.name,this._author=null===(r=null===(e=s.app)||void 0===e?void 0:e.data)||void 0===r?void 0:r.author,u=null===(i=null===(n=s.app)||void 0===n?void 0:n.data)||void 0===i?void 0:i.status,this._status="number"==typeof u?u:-1),this._server={version:s.version,message:s.app.message,error:s.app.error},!this._server.error)?(c=this._server.message?"\n".concat(this._server.message):"",a?console.info("[TextAlive API]  v".concat(rk.client.version,"  v").concat(this._server.version||"0.0.0"," ").concat(c)):console.info("[TextAlive API] App API client v".concat(rk.client.version," connected to server v").concat(this._server.version||"0.0.0").concat(c)),this.listener.onAppLoad(this)):(l=(null===(o=this._server)||void 0===o?void 0:o.error)?"\n".concat(this._server.error):"",a?console.warn("[TextAlive API]  https://developer.textalive.jp ".concat(l)):console.warn("[TextAlive API] This app requires a valid app token to run properly. You could get a token from https://developer.textalive.jp. ".concat(l)),this.listener.onAppLoad(null,l)),[2]}})})},t.prototype.initializePlayerListener=function(){var t=this;this.playerListener={onVideoReady:function(e){t._host&&window.parent.postMessage({kind:"ta_video",options:{lyrics:!!t.player.data.lyrics,duration:t.player.video.duration}},"*")},onThrottledTimeUpdate:function(e){t._host&&window.parent.postMessage({kind:"ta_position",options:{position:e}},"*")},onPlay:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"play"}},"*")},onPause:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"pause"}},"*")},onStop:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"stop"}},"*")},onVolumeUpdate:function(e){t._host&&window.parent.postMessage({kind:"ta_volume",options:{volume:e}},"*")},onDispose:function(){t.dispose()}},this.player.addListener(this.playerListener)},t.prototype.initializeMessageListener=function(){var t=this;this.messageListener=function(e){if(e.data.kind&&/^ta_/.test(e.data.kind)){var r=t.player;switch(e.data.kind.substring(3)){case"status":switch(e.data.options.status){case"play":r.requestPlay();break;case"pause":r.requestPause();break;case"stop":r.requestStop()}break;case"seek":r.requestMediaSeek(e.data.options.position);break;case"volume":r.volume=e.data.options.volume;break;case"parameter":var n=e.data.options,i=n.name,o=n.value;t.parameters[i]=o,t.listener.onAppParameterUpdate(i,o);break;case"media":t._songUrl=e.data.options.url,t._songOptions=e.data.options.options||{},r.requestStop();var s=t.createFromSongUrl();t.listener.onAppMediaChange(t._songUrl,s)}}},window.addEventListener("message",this.messageListener)},t.prototype.createFromSongUrl=function(){var t,e=this._songOptions;return e&&(t={video:{}},e.altLyricsUrl&&(t.altLyricsUrl=e.altLyricsUrl),e.lyricsDirectAccess&&(t.lyricsDirectAccess=e.lyricsDirectAccess),e.lyricId&&(t.video.lyricId=e.lyricId),e.lyricDiffId&&(t.video.lyricDiffId=e.lyricDiffId),e.chordId&&(t.video.chordId=e.chordId),e.beatId&&(t.video.beatId=e.beatId),e.repetitiveSegmentId&&(t.video.repetitiveSegmentId=e.repetitiveSegmentId)),this.player.createFromSongUrl(this._songUrl,t)},t.prototype.parseQueryString=function(){var t=oZ("ta_app_token");t&&(rk.textalive.appToken=t),this._songUrl=oZ("ta_song_url"),this._songOptions={};var e=oZ("ta_lyric_id");e&&(this._songOptions.lyricId=parseInt(e),isNaN(this._songOptions.lyricId)&&delete this._songOptions.lyricId);var r=oZ("ta_lyric_diff_id");r&&(this._songOptions.lyricDiffId=parseInt(r),isNaN(this._songOptions.lyricDiffId)&&delete this._songOptions.lyricDiffId);var n=oZ("ta_alt_lyrics_url");n&&(this._songOptions.altLyricsUrl=n);var i=oZ("ta_lyrics_direct_access");i&&(this._songOptions.lyricsDirectAccess="true"===i,this._songOptions.lyricsDirectAccess||delete this._songOptions.lyricsDirectAccess);var o=oZ("ta_chord_id");o&&(this._songOptions.chordId=parseInt(o),isNaN(this._songOptions.chordId)&&delete this._songOptions.chordId);var s=oZ("ta_beat_id");s&&(this._songOptions.beatId=parseInt(s),isNaN(this._songOptions.beatId)&&delete this._songOptions.beatId);var a=oZ("ta_repetitive_segment_id");a&&(this._songOptions.repetitiveSegmentId=parseInt(a),isNaN(this._songOptions.repetitiveSegmentId)&&delete this._songOptions.repetitiveSegmentId)},t.prototype.connect=function(){return o1(this,0,void 0,function(){var t,e=this;return o2(this,function(r){switch(r.label){case 0:return this.connecting?[2,this.connecting]:"undefined"!=typeof window&&this.options&&window.parent&&window!==window.parent?[3,2]:[4,new Promise(function(t){return setTimeout(t,1)})];case 1:return r.sent(),this.listener.onAppReady(this),[2,!1];case 2:return this.connecting=Promise.race([new Promise(function(r){t=function(n){n.data.kind&&/^ta_/.test(n.data.kind)&&"ack"===n.data.kind.substring(3)&&(window.removeEventListener("message",t),e._host=n.data.options,r(!0))},window.addEventListener("message",t)}),o1(e,0,void 0,function(){var e;return o2(this,function(r){switch(r.label){case 0:e=0,r.label=1;case 1:return e<5?(window.parent.postMessage({kind:"ta_connect",options:this.options},"*"),[4,new Promise(function(t){return setTimeout(t,200)})]):[3,4];case 2:if(r.sent(),this._host)return[3,4];r.label=3;case 3:return e++,[3,1];case 4:return!this._host&&t&&window.removeEventListener("message",t),[2,!!this._host]}})})]),this.connecting.finally(function(){e.connecting=null,e.listener.onAppReady(e)}),[2,this.connecting]}})})},t.prototype.dispose=function(){"undefined"!=typeof window&&this.options&&(this.player.removeListener(this.playerListener),window.removeEventListener("message",this.messageListener)),this._host=null,this.player=null},t}();function sg(t){return t}function sv(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0==t?e:t<0?e*(-(e*t)+1+t):e*((2-e)*t+(1-t))}}function sm(t){return function(e){return Math.pow(e,t)}}function sb(t){return function(e){return 1-Math.pow(1-e,t)}}function s_(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}var sw=sm(2),sE=sb(2),sP=s_(2),sO=sm(3),sS=sb(3),sT=s_(3),sx=sm(4),sA=sb(4),sR=s_(4),sC=sm(5),sN=sb(5),sk=s_(5);function sI(t){return 1-Math.cos(t*Math.PI/2)}function sj(t){return Math.sin(t*Math.PI/2)}function sU(t){return -.5*(Math.cos(Math.PI*t)-1)}function sL(t){return function(e){return e*e*((t+1)*e-t)}}var sF=sL(1.7);function sB(t){return function(e){return--e*e*((t+1)*e+t)+1}}var sD=sB(1.7);function sM(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}var sV=sM(1.7);function sG(t){return-(Math.sqrt(1-t*t)-1)}function sq(t){return Math.sqrt(1- --t*t)}function sz(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function sW(t){return 1-sY(1-t)}function sY(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function sH(t){return t<.5?.5*sW(2*t):.5*sY(2*t-1)+.5}function sJ(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return-t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)}}var s$=sJ(1,.3);function sX(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return t*Math.pow(2,-10*n)*Math.sin((n-i)*r/e)+1}}var sZ=sX(1,.3);function sK(t,e){var r=2*Math.PI;return function(n){var i=e/r*Math.asin(1/t);return(n*=2)<1?-(t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)*.5):t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*r/e)*.5+1}}var sQ=sK(1,.3*1.5),s0=Object.freeze({__proto__:null,backIn:sF,backInOut:sV,backOut:sD,bounceIn:sW,bounceInOut:sH,bounceOut:sY,circIn:sG,circInOut:sz,circOut:sq,cubicIn:sO,cubicInOut:sT,cubicOut:sS,elasticIn:s$,elasticInOut:sQ,elasticOut:sZ,get:sv,getBackIn:sL,getBackInOut:sM,getBackOut:sB,getElasticIn:sJ,getElasticInOut:sK,getElasticOut:sX,getPowIn:sm,getPowInOut:s_,getPowOut:sb,linear:sg,quadIn:sw,quadInOut:sP,quadOut:sE,quartIn:sx,quartInOut:sR,quartOut:sA,quintIn:sC,quintInOut:sk,quintOut:sN,sineIn:sI,sineInOut:sU,sineOut:sj}),s1=(function(){function t(){}t.linear=sg,t.get=sv,t.getPowIn=sm,t.getPowOut=sb,t.getPowInOut=s_,t.quadIn=sw,t.quadOut=sE,t.quadInOut=sP,t.cubicIn=sO,t.cubicOut=sS,t.cubicInOut=sT,t.quartIn=sx,t.quartOut=sA,t.quartInOut=sR,t.quintIn=sC,t.quintOut=sN,t.quintInOut=sk,t.sineIn=sI,t.sineOut=sj,t.sineInOut=sU,t.getBackIn=sL,t.backIn=sF,t.getBackOut=sB,t.backOut=sD,t.getBackInOut=sM,t.backInOut=sV,t.circIn=sG,t.circOut=sq,t.circInOut=sz,t.bounceIn=sW,t.bounceOut=sY,t.bounceInOut=sH,t.getElasticIn=sJ,t.elasticIn=s$,t.getElasticOut=sX,t.elasticOut=sZ,t.getElasticInOut=sK,t.elasticInOut=sQ}(),function(){function t(){this.cursor=-1,this.widgets=[],this.instances=[],this.model={id:-1,type:rv.NONE,sourceId:-1,author:null,originalAuthor:null,className:null,createdDate:null}}return Object.defineProperty(t.prototype,"id",{get:function(){return this.model?this.model.id:-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"script",{get:function(){return this.model?this.model.script:null},enumerable:!1,configurable:!0}),t}()),s2=function(){},s3=function(){function t(t,e){this.onTemplateLoad=e,this._emitter=null,this._loaded=null,this._loading=null,this.verbose=!1,this._emitter=t,this.clear()}return Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loading",{get:function(){return this._loading},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this._loaded={},this._loading={}},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),o1(this,0,void 0,function(){var e;return o2(this,function(r){switch(r.label){case 0:return[4,rK.list({maxResults:t,withoutAuthors:!0,withoutOriginalAuthors:!0,script:!0})];case 1:return(e=r.sent())&&e.list?(this.verbose&&console.log("--- loading template classes ---"),[2,this.registerMany(e.list)]):[2]}})})},t.prototype.loadForVideo=function(t){return o1(this,0,void 0,function(){var e,r=this;return o2(this,function(n){switch(n.label){case 0:return[4,rK.loadForVideo(t)];case 1:return(e=n.sent())&&e.list?(this.verbose&&console.log("--- loading template classes for vid:".concat(t," ---")),[4,this.registerMany(e.list)]):[2,null];case 2:return[2,n.sent().map(function(t){return t?r.getByName(t):null})]}})})},t.prototype.loadByNames=function(t){return o1(this,0,void 0,function(){var e,r=this;return o2(this,function(n){switch(n.label){case 0:return!Array.isArray(t)||t.length<=0?[2,[]]:(this.verbose&&console.log("--- loading template classes ---"),[4,Promise.all(t.map(function(t){return r.doLoadByName(t)}))]);case 1:return(e=n.sent())&&this._emitter.onTemplatesLoad(e.filter(function(t){return!!t}).map(function(t){return t.className})),[2,e]}})})},t.prototype.loadByName=function(t){return o1(this,0,void 0,function(){var e,r;return o2(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.doLoadByName(t)];case 1:return e=n.sent(),this._emitter.onTemplatesLoad([e.className]),[2,e];case 2:return r=n.sent(),this._emitter.onTemplatesLoad(null,r),[2,null];case 3:return[2]}})})},t.prototype.doLoadByName=function(t){return o1(this,0,void 0,function(){var e,r,n=this;return o2(this,function(i){return null!==(e=this.getByName(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(r=new Promise(function(e){return rK.loadByName(t).then(function(t){return n.onTemplateLoad(t)}).then(e)}),this._loading[t]=r,r.finally(function(){return delete n._loading[t]}),[2,r])})})},t.prototype.loadById=function(t){return o1(this,0,void 0,function(){var e,r;return o2(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.doLoadById(t)];case 1:return e=n.sent(),r=null,[3,3];case 2:return r=n.sent(),[3,3];case 3:return this._emitter.onTemplatesLoad(e?[e.className]:null,r),[2,e]}})})},t.prototype.doLoadById=function(t){return o1(this,0,void 0,function(){var e,r,n=this;return o2(this,function(i){return(e=this.getById(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(r=new Promise(function(e){return rK.load(t).then(function(t){return n.onTemplateLoad(t)}).then(e)}),this._loading[t]=r,r.finally(function(){return delete n._loading[t]}),[2,r])})})},t.prototype.registerMany=function(t){return o1(this,0,void 0,function(){var e,r=this;return o2(this,function(n){switch(n.label){case 0:return[4,Promise.all(t.map(function(t){var e=r.onTemplateLoad(t);return r._loading[t.className]=e,r._loading["".concat(t.className,"@").concat(t.id)]=e,e}).map(function(t){return t.then(function(t){return t.className}).catch(function(t){return null})}))];case 1:return e=n.sent().filter(function(t){return!!t}),this._emitter.onTemplatesLoad(e),[2,e]}})})},t.prototype.commit=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,rK.create({sourceId:t.model.sourceId,script:t.model.script,log:e})];case 1:return(r=n.sent()).success&&(t.model.id=r.id,this._emitter.onTemplateCommit(t.className)),[2,r]}})})},t.prototype.getByName=function(t,e){var r;if(void 0===e&&(e=!1),t&&(r=t.match(/(.+)@([0-9]+)/))){t=r[1];var n=parseInt(r[2]);if(!this._loaded[t])return null;var i=this._loaded[t].model;if(i.id!==n){if(!e)return null;this.verbose&&console.log("[warning] template ".concat(t," version ").concat(n," is requested but ").concat(i.id," is used"))}}return this._loaded[t]?this._loaded[t]:null},t.prototype.getById=function(t){var e=null;for(var r in this._loaded)if(this._loaded[r].model.id===t){e=this._loaded[r];break}return e},t}(),s4={Matrix2D:nM,Point:nV,Color:r4,Font:r5,RenderingUnit:r8,TextUnit:r7,Graphic:nt,Phrase:nr,Word:ne,Char:r9,Beat:si,RepetitiveSegment:ss},s5=["headTime","tailTime","insomnia"],s6=["animate","getAssignedUnit","name","type"],s8=function(){function t(t,e,r){this._emitter=null,this._player=null,this.interpreter=null,this.unsafeAcceleration=!1,this._verbose=!1,this.ignoreVersion=!1,this.rawConsole=!1,this._player=t,this._emitter=e,this.unsafeAcceleration=r,this.loader=new s3(e,this.register.bind(this)),t.addListener({onVideoReady:this.onVideoReady.bind(this)})}return Object.defineProperty(t.prototype,"verbose",{get:function(){return this._verbose},set:function(t){this._verbose=this.loader.verbose=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return!!this.interpreter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this.loader.loaded},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var t=this;if(!this.ready){var e,r,n,i,o,s,a,u,c,l=(r=(e={player:this._player,ignoredPropNames:s6,rawConsole:this.rawConsole,templateGetter:function(e){return t.getByName(e,!0)}}).player,n=e.ignoredPropNames,i=e.rawConsole,o=e.templateGetter,s=r.graphics.wrapperTable,a=new o$(o0(o0({},s4),s),n,function(t,e){return r.graphics.isGraphics(t)&&e instanceof r4?e.toString():e}),u={require:{func:function(t){if(!(t.length<1||"string"!=typeof t[0])){var e=o(t[0]);return null===e?void 0:e.functionDefinition}},raw:!0,isConstructor:!0},print:{func:function(t){r.isEditing&&console.log.apply(console,t)},raw:i},findChorus:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:r.findChorus(t[0])}},findBeat:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:r.findBeat(t[0])}},getVocalFrequency:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:r.getVocalFrequency(t[0])}},getVocalAmplitude:{func:function(t){return t.length<1||"number"!=typeof t[0]?-1:r.getVocalAmplitude(t[0])}},getMaxVocalAmplitude:{func:function(t){return r.getMaxVocalAmplitude()}},getValenceArousal:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:r.getValenceArousal(t[0])}},getMedianValenceArousal:{func:function(t){return r.getMedianValenceArousal()}}},Object.keys(rv).forEach(function(t){a.setProperty(a.globalScope,t,rv[t]),u[t]={value:rv[t]}}),Object.keys(s0).forEach(function(t){var e=s0[t];0!==t.indexOf("get")&&(u[t]={func:e})}),(c=Object.keys(a.wrapperTable))&&c.forEach(function(t){return u[t]={cls:a.wrapperTable[t]}}),Object.keys(u).forEach(function(t){var e=u[t];e.func?a.createGlobalFunction(t,e):e.value&&a.setProperty(a.globalScope,t,e.value)}),{interpreter:a,unsafeGlobalScope:u}),p=l.interpreter,h=l.unsafeGlobalScope;this.unsafeGlobalScope=h,this.interpreter=p,this.onVideoReady(this._player.video)}},t.prototype.getByName=function(t,e){return void 0===e&&(e=!1),this.loader.getByName(t,e)},t.prototype.getById=function(t){return this.loader.getById(t)},t.prototype.clear=function(){this.loader.clear()},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),o1(this,0,void 0,function(){return o2(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadLatest(t)]})})},t.prototype.loadForVideo=function(t){return o1(this,0,void 0,function(){return o2(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadForVideo(t)]})})},t.prototype.loadByNames=function(t){return o1(this,0,void 0,function(){return o2(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadByNames(t)]})})},t.prototype.loadByName=function(t){return o1(this,0,void 0,function(){return o2(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadByName(t)]})})},t.prototype.loadById=function(t){return o1(this,0,void 0,function(){return o2(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadById(t)]})})},t.prototype.commit=function(t,e){return o1(this,0,void 0,function(){return o2(this,function(r){return[2,this.loader.commit(t,e)]})})},t.prototype.register=function(t){return o1(this,0,void 0,function(){var e,r,n,i,o,s,a=this;return o2(this,function(u){switch(u.label){case 0:if(!t)return[2,null];if("number"==typeof t.sourceId){if(e=t,!(r=this.createClass(t.script)))return[2,null]}else r=t;n=oz(r.ast).dependencies,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,Promise.all(n.map(function(t){var e=a.getByName(t,a.ignoreVersion);return e?Promise.resolve(e):a.loadByName(t)}))];case 2:return u.sent(),this.verbose&&console.log("load dependencies for",r.className,n),[3,4];case 3:return i=u.sent(),this.verbose&&console.error("failed loading dependencies for",r.className,i),[3,4];case 4:try{if(!(e?this.loadModel(r,e):this.createModel(r)))throw Error("failed to create a template instance");return[2,this.registerClass(r)]}catch(t){throw o=void 0,e&&(delete(s=o0({},e)).script,o=s),{error:t.message,stack:t.stack,cause:o}}return[2]}})})},t.prototype.updateClassScript=function(t,e){var r=this.createClass(e);return this.updateClass(t,r)},t.prototype.registerClass=function(t){if(!t)return null;if(this.loader.loaded[t.className]){this.verbose&&console.log("updating",t.className,t.model.id);var e=this.updateClass(this.loader.loaded[t.className],t);return this.verbose&&console.log("updated",e.className,e.id),e}return this.loader.loaded[t.className]=t,this.verbose&&console.log("loaded",t.className,t.model.id),t},t.prototype.updateClass=function(t,e){var r=t,n=e;if(!n)return null;if(r.model.script===n.model.script)return this.verbose&&console.log("no diff for",r.className),r;if(!this.createModel(n))return null;if(r.className!==n.className){var i=this.getByName(n.className);if(!i)return n.cursor=r.cursor,this.loader.loaded[n.className]=n,this.verbose&&console.log("create",n.className),n;r=i}return r.newStatement=n.newStatement,r.widgets=n.widgets,r.scope=n.scope,r.functionDefinition=n.functionDefinition,r.newStatement=n.newStatement,r.unsafeConstructorGenerator=n.unsafeConstructorGenerator,r.ast=n.ast,r.cursor<0&&(r.cursor=n.cursor),n.id>=0?(this.verbose&&console.log("replace",n.className,r.id,n.id),r.model=n.model):(this.verbose&&console.log("update",n.className,r.id,n.id),r.model.type=n.model.type,r.model.className=n.model.className,r.model.prettyName=n.model.prettyName,r.model.script=n.model.script,r.model.createdDate=null,r.id>=0&&(r.model.sourceId=r.model.id,r.model.id=-1)),n=r,this.updateInstances(r.instances.slice(),n),this._emitter.onTemplateUpdate(n.className),n},t.prototype.loadModel=function(t,e){var r=this.newRawInstance(t);return t.model=e,this.updateWidgetInitialValues(t,r),r},t.prototype.createModel=function(t){var e=this.newRawInstance(t);if(null===e)return!1;if(t.id>=0)return!0;var r=e.templateInstance,n=t.model.script;return t.model={id:-1,sourceId:-1,className:t.className,prettyName:r?this.interpreter.getProperty(r,"name"):e.unsafeTemplateInstance.name,type:r?this.interpreter.getProperty(r,"type"):e.unsafeTemplateInstance.type,script:n,author:null,originalAuthor:null,createdDate:null},this.updateWidgetInitialValues(t,e),e},t.prototype.updateWidgetInitialValues=function(t,e){var r=this;t.widgets.forEach(function(t){t.initialValue=r.getProperty(e,t.name)})},t.prototype.updateInstances=function(t,e){var r=this;t.forEach(function(t){try{r.updateInstance(t,e)}catch(r){console.log("failed updating template for",t.assignedUnit,":",e)}}),this._player.isPlaying||this._player.requestStageUpdate()},t.prototype.createClass=function(t){var e=this;this.ready||this.initialize();var r=new s1;r.model={id:-1,sourceId:-1,className:null,prettyName:null,type:0,script:t,author:null,originalAuthor:null,createdDate:null};var n=oq(t,s6),i=n.ast,o=n.widgets;if(r.ast=i,r.widgets=o,r.className=r.ast.body[0].id.name,r.scope=this.interpreter.prepareRun(r.ast),this.interpreter.run(1e3,"to define "+r.className),r.functionDefinition=this.interpreter.getRawProperty(r.scope,r.className),r.newStatement=this.interpreter.newStatementFor(r.className),this.unsafeAcceleration){var s=Object.keys(this.unsafeGlobalScope),a=Object.keys(this.getGlobalProperties()).map(function(t){return"".concat(t,"=props.").concat(t)}).join(","),u="return function(props){var ".concat(a,";").concat(t,"return ").concat(r.className,";}"),c=new(Function.bind.apply(Function,o3(o3([void 0],s,!1),[u],!1))),l=function(t){var r=e.getByName(t);return r?r.unsafeConstructorGenerator(e.getGlobalProperties()):null},p=s.map(function(t){if("require"===t)return l;var r=e.unsafeGlobalScope[t];return r.func?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.func(t)}:r.cls||r.value});r.unsafeConstructorGenerator=c.apply({},p)}return r},t.prototype.getGlobalProperties=function(){var t;return{width:this._player.videoWidth,height:this._player.videoHeight,margin:this._player.margin,duration:(null===(t=this._player.video)||void 0===t?void 0:t.duration)||0}},t.prototype.newRawInstance=function(t){var e=new s2;if(this.unsafeAcceleration){var r=new(t.unsafeConstructorGenerator(this.getGlobalProperties()));e.unsafeTemplateInstance=r}else{this.interpreter.prepareNewInstance(t.newStatement,t.scope);var n=this.interpreter.run(700,"to instantiate "+t.className);e.templateInstance=n,e.templateInstance._nativeInstance=e}return e.templateClass=t,e.ignore=!1,e},t.prototype.setProperty=function(t,e,r){this.unsafeAcceleration?t.unsafeTemplateInstance[e]=r:this.interpreter.setProperty(t.templateInstance,e,r)},t.prototype.getProperty=function(t,e){return this.unsafeAcceleration?t.unsafeTemplateInstance[e]:this.interpreter.getProperty(t.templateInstance,e)},t.prototype.exportInstance=function(t){for(var e={},r=0,n=t.templateClass.widgets.map(function(t){return t.name}).concat(s5);r<n.length;r++){var i=n[r],o=this.getProperty(t,i);try{var s=function(t){if(void 0!==t&&"function"!=typeof t){if("object"!=typeof t)return t;if(null===t)return null;if(t instanceof r4)return{type:"Color",value:{r:t.r,g:t.g,b:t.b,a:t.a}};throw Error()}}(o);void 0!==s&&(e[i]=s)}catch(e){console.error("cannot export ".concat(t.templateClass.className,".").concat(i),o,"assigned to",t.assignedUnit)}}return{type:t.templateClass.className,value:e}},t.prototype.importInstances=function(t,e){try{this.importPhraseTemplates(t.firstCredit,e.credits),this.importPhraseTemplates(t.firstPhrase,e.phrases);for(var r=e.graphics,n=t.firstGraphic,i=0;null!==n;){var o=r[i++];this.importTemplates(n,o.templates),n=n.next}}catch(t){return console.error("restoring templates failed",t),!1}return!0},t.prototype.importPhraseTemplates=function(t,e){if(Array.isArray(e))for(var r=0;t;){var n=e[r++];this.importTemplates(t,n.templates);for(var i=t.firstWord,o=0;o<t.wordCount;o++){var s=n.words[o];this.importTemplates(i,s.templates);for(var a=i.firstChar,u=0;u<i.charCount;u++){var c=s.characters[u];this.importTemplates(a,c.templates),a=a.next}i=i.next}if(e.length<r+1)break;t=t.next}},t.prototype.importTemplates=function(t,e){if(Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r],i=this.importInstance(n);i&&t.addTemplate(i)}},t.prototype.importInstance=function(t){var e=this.getByName(t.type),r=this.newInstance(e);if(!r||!t.value)return null;for(var n=0,i=Object.keys(t.value);n<i.length;n++){var o=i[n],s=function(t,e){if("object"!=typeof t||null===t)return t;if(t.type&&(e[t.type]||"Color"===t.type)){var r;if("Color"===t.type){var n=new r4;n.r=Number(t.value.r),n.g=Number(t.value.g),n.b=Number(t.value.b),n.a=Number(t.value.a),r=n}else{for(var i=new e[t.type],o=0,s=Object.keys(t.value);o<s.length;o++){var a=s[o];i[a]=t.value[a]}r=i}return r}}(t.value[o],this.interpreter.wrapperTable);void 0!==s&&this.setProperty(r,o,s)}return r},t.prototype.updateInstance=function(t,e){var r=this.newRawInstance(e),n=t.templateInstance,i=this.interpreter.cleanupProperties(n);t.templateClass!==e&&(this.disposeInstance(t),e.instances.push(t)),t.templateClass=e,t.scope=r.scope,t.templateInstance=r.templateInstance,t.ignore=r.ignore,this.interpreter.restoreProperties(t.templateInstance,i),this.attachGetAssignedUnitMethod(t)},t.prototype.newInstance=function(t){var e;try{if(null===(e=this.newRawInstance(t)))return null}catch(t){return null}return this.attachGetAssignedUnitMethod(e),t.instances.push(e),e},t.prototype.attachGetAssignedUnitMethod=function(t){var e=this;if(this.unsafeAcceleration)t.unsafeTemplateInstance.getAssignedUnit=function(){return t.assignedUnit};else{var r=this.interpreter.createFunction(function(){return e.interpreter.wrap(t.assignedUnit)});this.interpreter.setRawProperty(t.templateInstance,"getAssignedUnit",r)}},t.prototype.disposeInstance=function(t){var e=t.templateClass;e.instances=e.instances.filter(function(e){return e!==t})},t.prototype.disposeInstances=function(t){var e=this;Array.isArray(t)?t.forEach(function(t){return e.disposeInstance(t)}):[t.firstCredit,t.firstPhrase,t.firstWord,t.firstChar,t.firstGraphic].forEach(function(t){for(;t;)e.disposeInstances(t.removeTemplates()),t=t.next})},t.prototype.setTemplate=function(t,e){this.removeTemplates(t),t.addTemplate(e)},t.prototype.clearTemplate=function(t){this.removeTemplates(t)},t.prototype.removeTemplateAt=function(t,e){var r=t.removeTemplateAt(e);r&&this.disposeInstance(r)},t.prototype.removeTemplates=function(t){var e=t.removeTemplates();this.disposeInstances(e)},t.prototype.getRequiredTemplates=function(t){return oz(t).dependencies},t.prototype.getRequiredTemplateAt=function(t,e){return oz(t,e).dependencyAtCursor},t.prototype.exec=function(t,e,r){if(t.unsafeTemplateInstance){var n=t.unsafeTemplateInstance;return n[e].apply(n,r)}var i=this.interpreter.exec(t.templateInstance,e,r,t.assignedUnit?" assigned to "+t.assignedUnit.toString():"");return this.interpreter.unwrap(i)},t.prototype.declareVariable=function(t,e,r,n){return this.updateClassScript(t,function(t,e,r,n){try{var i=oq(t),o=i.ast,s=i.fields,a=s[s.length-1],u=t.match(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/),c=u?u.pop():"\n",l=t.split(c),p=a?Array(a.loc.start.column+1).join(" "):"  ",h=a?a.loc.end.line:0;if(h<=0){var f=o.body[0].body,d=l[f.loc.start.line-1],y=d.substring(0,f.loc.start.column+1),g=d.substring(f.loc.start.column+1);l[f.loc.start.line-1]=y,l.splice(f.loc.start.line,0,g),h=f.loc.start.line}for(var v=void 0;(v="var"+Math.random().toString().substring(2)).length>8&&(v=v.substring(0,8)),!(0>t.indexOf(v)););l.length>h&&l[h].length>0&&l.splice(h,0,""),l.splice(h,0,"",p+"// @proposed",p+"// @title "+e,p+"// "+function(t,e){if("Slider"===t)return"@ui Slider("+e.min+", "+e.max+")";if("Check"===t)return"@ui Check()";if("Color"===t)return"@ui Color()";var r=e.etc;return"@comment "+(r=r.replace(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/g,"")).replace(/\/[*/]/g,"")}(r,n),p+"this."+v+" = "+("Slider"===r?((n.min+n.max)/2).toString():"Check"===r?"false":"Color"===r?'new Color("#000000")':"null")+";"),t=l.join(c)}catch(t){}return t}(t.model.script,e,r,n))},t.prototype.onVideoReady=function(t){this.ready&&(this.interpreter.setRawProperty(this.interpreter.globalScope,"width",this._player.resolutionWidth),this.interpreter.setRawProperty(this.interpreter.globalScope,"height",this._player.resolutionHeight),this.interpreter.setRawProperty(this.interpreter.globalScope,"margin",this.interpreter.wrap(this._player.margin)),this.interpreter.setRawProperty(this.interpreter.globalScope,"duration",(null==t?void 0:t.duration)||0))},t}(),s7="https://textalive.jp",s9=function(){function t(t){var e,r=this;if(this.player=t,this._position="embed",this._rounded=!1,this._bordered=!1,this._shadowed=!1,this._background="#fff",this._color="#1f4391",void 0!==(null===(e=t.options)||void 0===e?void 0:e.mediaBannerPosition)&&(this._position=t.options.mediaBannerPosition),this.domEnabled){this.logoAnchor=document.createElement("a"),this.logoAnchor.className="textalive-logo",this.logoAnchor.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><style>.bg{fill:#1f4391;}.fg{fill:#fff;}</style></defs><g class="logo-sq"><rect class="bg" x="-20" y="-20" width="240" height="240"/><g class="textalive-logo-art"><path class="fg" d="M97.33,130.81V142a3,3,0,0,0,4.78,2.41l56.81-42.09a3,3,0,0,0,0-4.81l-8.33-6.14Z"/><path class="fg" d="M137.14,81.43l-35-25.84A3,3,0,0,0,97.33,58v52.92Z"/><path class="fg" d="M51,55H80.33a2,2,0,0,1,2,2V71.67a0,0,0,0,1,0,0H51a2,2,0,0,1-2-2V57A2,2,0,0,1,51,55Z"/><path class="fg" d="M44.83,107.5h56.33a2,2,0,0,1,2,2v12.67a2,2,0,0,1-2,2H44.83a0,0,0,0,1,0,0V107.5A0,0,0,0,1,44.83,107.5Z" transform="translate(189.83 41.84) rotate(90)"/></g></g></svg>',this.logoAnchor.style.padding=this.bordered?"1px 2px":"1px 3px",this.logoAnchor.href=s7,this.logoAnchor.target="_blank",this.logoAnchor.title="Powered by TextAlive App API",this.logoSvg=this.logoAnchor.querySelector("svg"),this.logoSvg.style.width="24px",this.songNameDiv=document.createElement("div"),this.songNameDiv.className="name",this.songNameDiv.style.fontWeight="bold",this.songNameDiv.style.overflow="hidden",this.songNameDiv.style.textOverflow="ellipsis",this.songNameDiv.style.marginBottom="2px",this.songNameDiv.textContent="-",this.songArtistDiv=document.createElement("div"),this.songArtistDiv.className="artist",this.songArtistDiv.textContent="-",this.songArtistDiv.style.overflow="hidden",this.songArtistDiv.style.textOverflow="ellipsis";var n=document.createElement("span");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="song"><path d="M120.95,45.77l-59.12,13a2.57,2.57,0,0,0-2,2.51v47.8c0,13.61-12.4,23.74-24.2,23.74-8.92,0-14.82-4.23-14.82-13,0-13,12.86-21.93,23.9-21.93a16.33,16.33,0,0,1,10,3V35a2.57,2.57,0,0,1,2-2.51l69.41-15.29a2.57,2.57,0,0,1,3.13,2.51V92.84c0,13.61-12.1,23.9-24.2,23.9-8.92,0-14.82-4.24-14.82-13,0-13.16,12.86-21.93,23.9-21.93a16.31,16.31,0,0,1,10,2.87V48.29A2.57,2.57,0,0,0,120.95,45.77Z"/><path d="M35.61,134.36c-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43a18.4,18.4,0,0,1,8.48,1.88V35a4,4,0,0,1,3.2-4l69.41-15.29a4.07,4.07,0,0,1,5,4V92.83c0,15-13.54,25.4-25.7,25.4-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43A19,19,0,0,1,122.57,82V48.29a1.07,1.07,0,0,0-1.3-1h0l-59.12,13a1.08,1.08,0,0,0-.84,1v47.8C61.3,124,47.76,134.36,35.61,134.36Zm9.07-34.94c-10.57,0-22.4,8.74-22.4,20.43,0,10,8.35,11.51,13.32,11.51,13.38,0,22.7-11.72,22.7-22.24V61.31a4.1,4.1,0,0,1,3.2-4l59.12-13h0a4.07,4.07,0,0,1,5,4V87.56l-2.37-1.67a14.88,14.88,0,0,0-9.12-2.6c-10.59,0-22.4,8.39-22.4,20.43,0,10,8.35,11.51,13.32,11.51,10.74,0,22.7-9.2,22.7-22.4V19.72a1.07,1.07,0,0,0-1.3-1L57,34a1.07,1.07,0,0,0-.84,1v68.83l-2.37-1.67A14.87,14.87,0,0,0,44.68,99.42Z"/></g></svg>',n.style.padding="0 3px 0 0",this.songSvg=n.querySelector("svg"),this.songSvg.style.width="14px",this.songWrapper=document.createElement("div"),this.songWrapper.style.width="203px",this.songWrapper.style.maxWidth="203px",this.songWrapper.appendChild(this.songNameDiv),this.songWrapper.appendChild(this.songArtistDiv),this.songAnchor=document.createElement("a"),this.songAnchor.className="song",this.songAnchor.target="_blank",this.songAnchor.style.display="flex",this.songAnchor.style.lineHeight="1.2em",this.songAnchor.style.padding="4px 3px 3px 3px",this.songAnchor.style.textDecoration="none",this.songAnchor.appendChild(n),this.songAnchor.appendChild(this.songWrapper),this.lyricsNameDiv=document.createElement("div"),this.lyricsNameDiv.className="name",this.lyricsNameDiv.style.fontWeight="bold",this.lyricsNameDiv.textContent="-",this.lyricsNameDiv.style.overflow="hidden",this.lyricsNameDiv.style.textOverflow="ellipsis",this.lyricsNameDiv.style.marginBottom="2px",this.lyricsArtistDiv=document.createElement("div"),this.lyricsArtistDiv.className="artist",this.lyricsArtistDiv.textContent="-",this.lyricsArtistDiv.style.overflow="hidden",this.lyricsArtistDiv.style.textOverflow="ellipsis";var i=document.createElement("span");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="lyrics"><path d="M78,126.3H67.52l-6.26-23.82H24.4L18.14,126.3H7.7L35.7,22H50ZM27,92.39H58.65l-15.82-61Z"/><path d="M78,128.3H67.52a2,2,0,0,1-1.93-1.49l-5.87-22.33H25.94l-5.87,22.33a2,2,0,0,1-1.93,1.49H7.7a2,2,0,0,1-1.93-2.52l28-104.34A2,2,0,0,1,35.7,20H50a2,2,0,0,1,1.93,1.48l28,104.34A2,2,0,0,1,78,128.3Zm-8.89-4h6.29L48.43,24H37.23L10.31,124.3h6.28L22.46,102a2,2,0,0,1,1.93-1.49H61.26A2,2,0,0,1,63.2,102ZM58.65,94.39H27a2,2,0,0,1-1.94-2.5l15.82-61a2,2,0,0,1,3.87,0l15.82,61a2,2,0,0,1-1.94,2.5Zm-29.06-4H56.07L42.83,39.32Z"/><path d="M106.82,128c-17.74,0-26.43-13-26.43-36.52S89.09,55,106.82,55a21.78,21.78,0,0,1,15.83,6.43L134,56.22V112c0,5.22,1.56,8,4.7,8a7.31,7.31,0,0,0,3.65-1v6.61A17.77,17.77,0,0,1,133.6,128a9.61,9.61,0,0,1-9.74-7.65A22.4,22.4,0,0,1,106.82,128Zm0-10.09a18.15,18.15,0,0,0,16.69-10.61V75.7a18.15,18.15,0,0,0-16.69-10.61c-11.3,0-16,9.56-16,26.43S95.52,118,106.82,118Z"/><path d="M133.6,130A11.61,11.61,0,0,1,123.08,124,24.48,24.48,0,0,1,106.82,130c-13,0-28.43-6.68-28.43-38.52S93.85,53,106.82,53A23.88,23.88,0,0,1,123,59.05l10.08-4.65A2,2,0,0,1,136,56.22V112c0,4,.91,6,2.7,6a5.3,5.3,0,0,0,2.66-.78,2,2,0,0,1,3,1.74v6.61a2,2,0,0,1-1,1.74A19.64,19.64,0,0,1,133.6,130Zm-9.74-11.65a2,2,0,0,1,1.95,1.55,7.63,7.63,0,0,0,7.79,6.1,15.19,15.19,0,0,0,6.69-1.64v-2.52a8.51,8.51,0,0,1-1.65.16c-2.5,0-6.7-1.3-6.7-10V59.34l-8.46,3.91a2,2,0,0,1-2.25-.4A19.67,19.67,0,0,0,106.82,57C90.61,57,82.39,68.62,82.39,91.52S90.61,126,106.82,126a20.33,20.33,0,0,0,15.55-7A2,2,0,0,1,123.86,118.39Zm-17,1.57c-11.94,0-18-9.57-18-28.43s6.06-28.43,18-28.43a20.07,20.07,0,0,1,18.5,11.75,2,2,0,0,1,.19.86v31.65a2,2,0,0,1-.19.86A20.06,20.06,0,0,1,106.82,120Zm0-52.86c-12.55,0-14,13.94-14,24.43,0,21.9,8,24.43,14,24.43a16.13,16.13,0,0,0,14.69-9.07V76.16A16.13,16.13,0,0,0,106.82,67.09Z"/></g></svg>',i.style.padding="0 3px 0 0",this.lyricsSvg=i.querySelector("svg"),this.lyricsSvg.style.width="14px",this.lyricsWrapper=document.createElement("div"),this.lyricsWrapper.style.width="90px",this.lyricsWrapper.style.maxWidth="90px",this.lyricsWrapper.appendChild(this.lyricsNameDiv),this.lyricsWrapper.appendChild(this.lyricsArtistDiv),this.lyricsAnchor=document.createElement("a"),this.lyricsAnchor.className="lyrics",this.lyricsAnchor.target="_blank",this.lyricsAnchor.style.display="flex",this.lyricsAnchor.style.lineHeight="1.2em",this.lyricsAnchor.style.padding="4px 3px 3px 3px",this.lyricsAnchor.style.textDecoration="none",this.lyricsAnchor.appendChild(i),this.lyricsAnchor.appendChild(this.lyricsWrapper),this.bannerDiv=document.createElement("div"),this.bannerDiv.className="textalive-banner",this.bannerDiv.style.cursor="pointer",this.bannerDiv.style.zIndex="10000",this.bannerDiv.style.background="#1f4391",this.bannerDiv.style.lineHeight="0",this.bannerDiv.style.display="flex",this.bannerDiv.style.maxWidth="256px",this.bannerDiv.style.fontFamily="'Hiragino Kaku Gothic Pro','','Yu Gothic',YuGothic,Meiryo,HelveticaNeue,'Helvetica Neue',Helvetica,Arial,sans-serif",this.bannerDiv.style.fontSize="9px",this.bannerDiv.style.alignItems="center",this.bannerDiv.style.whiteSpace="nowrap",this.bannerDiv.appendChild(this.logoAnchor),this.bannerDiv.appendChild(this.songAnchor),this.bannerDiv.appendChild(this.lyricsAnchor),this.songAnchor.style.display="none",this.lyricsAnchor.style.display="none",this.updatePosition(),this.updateRounded(),this.updateBordered(),this.updateShadowed(),this.updateBackground(),this.updateColor()}this.listener={onAppReady:function(){r.updatePosition()},onMediaElementSet:function(t){r.domEnabled&&(r.bannerDiv&&r.bannerDiv.parentElement&&r.bannerDiv.parentElement.removeChild(r.bannerDiv),r.player.mediaBannerElement&&r.player.mediaBannerElement.appendChild(r.bannerDiv))},onVideoLoad:function(){r.domEnabled&&(r.logoAnchor.href=s7,r.songAnchor.style.display="none",r.lyricsAnchor.style.display="none",r.songAnchor.style.borderRadius="0")},onSongLoad:function(t){return o1(r,0,void 0,function(){var e,r,n,i,o,s,a,u,c;return o2(this,function(l){switch(l.label){case 0:return t?(e=null===(a=null===(s=null==t?void 0:t.song)||void 0===s?void 0:s.artist)||void 0===a?void 0:a.name,r=null===(u=null==t?void 0:t.song)||void 0===u?void 0:u.name,n=null===(c=null==t?void 0:t.song)||void 0===c?void 0:c.permalink,i="".concat(s7).concat(n?"/songs/".concat(encodeURIComponent(rP.getSongPathFromUrl(n))):""),this.domEnabled&&(this.logoAnchor.href=i,this.songArtistDiv.textContent=at(e),this.songNameDiv.textContent=at(r),this.songAnchor.title="".concat(at(r)," by ").concat(at(e)),this.songAnchor.href=n,this.songAnchor.style.display="flex",this.songAnchor.style.borderRadius=this.rounded?"0 4px 4px 0":"0",this.songWrapper.style.width="auto"),[4,rD.getServerStatus()]):[2];case 1:return"ja"===(null==(o=l.sent())?void 0:o.lang)?console.warn("[TextAlive API]  :",at(e),"/ :",at(r),"/ :",at(n)):console.warn("[TextAlive API] Song artist:",at(e),"/ song name:",at(r),"/ distributed at:",at(n)),[2]}})})},onLyricsLoad:function(t){t&&r.domEnabled&&(r.songWrapper.style.maxWidth="90px",r.lyricsAnchor.style.display="flex",r.songAnchor.style.borderRadius="0")},onTextLoad:function(t){return o1(r,0,void 0,function(){var e,r,n,i,o;return o2(this,function(s){switch(s.label){case 0:return t?(e=null===(o=null==t?void 0:t.artist)||void 0===o?void 0:o.name,r=null==t?void 0:t.name,n=null==t?void 0:t.url,this.domEnabled&&(this.lyricsArtistDiv.textContent=at(e),this.lyricsNameDiv.textContent=at(r),this.lyricsAnchor.title="".concat(at(r)," by ").concat(at(e)),this.lyricsAnchor.href=n,this.lyricsWrapper.style.width="auto"),[4,rD.getServerStatus()]):[2];case 1:return"ja"===(null==(i=s.sent())?void 0:i.lang)?console.warn("[TextAlive API]  :",at(e),"/ :",at(r),"/ :",at(n)):console.warn("[TextAlive API] Song lyrics artist:",at(e),"/ lyrics name:",at(r),"/ distributed at:",at(n)),[2]}})})},onDispose:function(){r.dispose()}},t.addListener(this.listener),t.mediaBannerElement&&this.player.mediaBannerElement.appendChild(this.bannerDiv)}return Object.defineProperty(t.prototype,"domEnabled",{get:function(){return"undefined"!=typeof window&&"undefined"!=typeof document&&"function"==typeof document.createElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.updatePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rounded",{get:function(){return this._rounded},set:function(t){this._rounded=t,this.updateRounded()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bordered",{get:function(){return this._bordered},set:function(t){this._bordered=t,this.updateBordered()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowed",{get:function(){return this._shadowed},set:function(t){this._shadowed=t,this.updateShadowed()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(t){this._background=t,this.updateBackground()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this.updateColor()},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.player.removeListener(this.listener)},t.prototype.updatePosition=function(){var t,e;if(this.domEnabled){var r=this.position,n=this.player;if(null===r||!(null===(t=n.options)||void 0===t?void 0:t.app)||(null===(e=n.app)||void 0===e?void 0:e.managed))this.bannerDiv.style.display="none";else if(this.bannerDiv.style.display="flex","embed"===r)this.bannerDiv.style.position="initial",this.bannerDiv.style.marginTop="4px",this.songAnchor.style.flexGrow="1",this.lyricsAnchor.style.flexGrow="1";else{this.bannerDiv.style.position="fixed",this.bannerDiv.style.marginTop="0";var i=r.indexOf("top")>=0,o=r.indexOf("right")>=0,s=r.indexOf("bottom")>=0,a=r.indexOf("left")>=0;this.bannerDiv.style.top=i?"4px":"initial",this.bannerDiv.style.right=o?"4px":"initial",this.bannerDiv.style.bottom=s?"4px":"initial",this.bannerDiv.style.left=a?"4px":"initial",this.songAnchor.style.flexGrow="0",this.lyricsAnchor.style.flexGrow="0"}}},t.prototype.updateRounded=function(){if(this.domEnabled){var t=this.rounded;this.logoSvg.style.borderRadius=t?"4px 0 0 4px":"0",this.lyricsAnchor.style.borderRadius=t?"0 4px 4px 0":"0",this.bannerDiv.style.borderRadius=t?"4px":"0"}},t.prototype.updateBordered=function(){if(this.domEnabled){var t=this.bordered;this.logoAnchor.style.padding=t?"1px 2px":"1px 3px",this.bannerDiv.style.border=t?"1px solid rgba(31, 67, 145, 0.3)":"none"}},t.prototype.updateShadowed=function(){if(this.domEnabled){var t=this.shadowed;this.bannerDiv.style.boxShadow=t?"1px 1px 3px 0 rgba(9, 19, 42, 0.9)":"none"}},t.prototype.updateBackground=function(){this.domEnabled&&(this.songAnchor.style.background=this.background,this.lyricsAnchor.style.background=this.background)},t.prototype.updateColor=function(){this.domEnabled&&(this.songSvg.style.fill=this.color,this.songAnchor.style.color=this.color,this.lyricsSvg.style.fill=this.color,this.lyricsAnchor.style.color=this.color)},t}();function at(t){return t&&""!==t?t:"-"}var ae=function(){this.halted=[],this.errors=[]},ar=function(){function t(t,e){var r=this;this.listener=e,this.player=null,this._scale=1,this.playerListener={onResize:function(t){r.elementWidth=Math.floor(t.width),r.updateSize()},onVideoReady:function(){r.elementWidth=r.calcWidth(),r.updateSize()},onStageElementSet:function(t){r.elementWidth=r.calcWidth(),r.updateSize(),r.player.graphics.setCanvas(t)},onDispose:function(){r.dispose()}},this.requestedTime=0,this.request=null,this.player=t,t.addListener(this.playerListener)}return Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.updateSize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.player.graphics.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.player.graphics.height},enumerable:!1,configurable:!0}),t.prototype.requestUpdate=function(t){return o1(this,0,void 0,function(){var e=this;return o2(this,function(r){return this.requestedTime=void 0===t?this.player.videoPosition:t,this.request||(this.request=new Promise(function(t){setTimeout(function(){try{e.update(e.requestedTime)}catch(t){}e.request=null,t(e.requestedTime)},0)})),[2,this.request]})})},t.prototype.update=function(t){t||(t=this.player.mediaPosition),"number"==typeof t&&(this.player.graphics.reset(),this.animate(t),this.player.graphics.update(),this.listener.onStageUpdate(t))},t.prototype.animate=function(t){for(var e=new ae,r=e.errors,n=e.halted,i=0,o=[this.player.video.firstCredit,this.player.video.firstPhrase,this.player.video.firstWord,this.player.video.firstChar,this.player.video.firstGraphic];i<o.length;i++)for(var s=o[i];s;)this.animateRenderingUnit(t,s,e),s=s.next;if(n.length>0){console.error("---");for(var a=0;a<n.length;a++)console.error("halted",n[a],r[a])}},t.prototype.animateRenderingUnit=function(t,e,r){if(e.animate)e.animate(t,e);else if(e.templateCount<=0)an(e)&&e.getType()===rv.CHAR&&(e.rendering.visible=!1);else for(var n=0;n<e.templateCount;n++)this.animateTemplate(t,e,e.getTemplate(n),r)},t.prototype.animateTemplate=function(t,e,r,n){var i=this;if(r.ignore)e.rendering.visible=!1;else{if(e.getType()!==rv.GRAPHIC)for(var o,s,a,u=e.parent;u;){if(u.templateCount>0&&(!u.rendering.visible||0===u.rendering.alpha))return void(e.rendering.visible=!1);u=u.parent}var c=this.player.templates.getProperty(r,"insomnia"),l=an(e);if(!c&&l&&(o=function(t,e){return i.player.templates.getProperty(t,e)},s=r&&o(r,"headTime")||500,a=r&&o(r,"tailTime")||500,!(e.startTime-s<=t&&e.endTime+a>=t)&&(e.getType()!==rv.GRAPHIC&&(e.rendering.visible=!1),1)))return;this.doAnimateTemplate(t,r,n)}},t.prototype.doAnimateTemplate=function(t,e,r){var n=r.errors,i=r.halted;try{this.player.templates.exec(e,"animate",[t])}catch(t){n.push(t),i.push(e)}},t.prototype.calcWidth=function(){var t=this.player.stageElement;if(!t)return 0;var e=window.getComputedStyle(t);return t.offsetWidth-oX(e.borderLeftWidth)-oX(e.borderRightWidth)-oX(e.paddingLeft)-oX(e.paddingRight)},t.prototype.updateSize=function(){var t=this.player.stageElement;if(t){var e=this.elementWidth*this.player.videoProportion;if(t.style.height="".concat(e,"px"),t.width=this.elementWidth*this._scale,t.height=e*this._scale,this.player.video){var r=t.width/this.player.videoWidth;this.player.graphics.updateStageTx(r,this.player.margin),this.player.isPlaying||this.requestUpdate()}}},t.prototype.dispose=function(){this.player.removeListener(this.playerListener),this.player=null},t}();function an(t){if(t.getType()===rv.GRAPHIC)return!0;for(var e=!0,r=t.parent;r;){if(r.templateCount>0){e=!1;break}r=r.parent}return e}var ai=function(t){function e(e,r){var n=this.constructor,i=t.call(this,e)||this;return i.video=r,Object.setPrototypeOf(i,n.prototype),i}return oQ(e,t),e}(Error);function ao(t){for(;t.firstElementChild;)t.removeChild(t.firstElementChild)}function as(t){return"string"!=typeof t?t:"undefined"==typeof window?null:document.querySelector(t)}var aa=function(){function t(t){this._mediaPosition=0,this._videoPosition=0,this.isEditing=!1,this._isVideoSeeking=!1,this._volume=100,this._options=t,this.emitter=new o9(t),this._templates=new s8(this,this.emitter,t&&t.unsafeAcceleration);var e=Object.assign({},r0);t&&t.managers&&(e=Object.assign(e,t.managers)),this.managers=e,this._timer=t&&t.timer||this.createDefaultTimer(),this._data=new sd(e,this.emitter,t),this._backgroundGraphics=new st(this,e.asset,this.emitter),this._graphics=t&&t.graphics||this.createDefaultGraphicsDriver(),this.stage=new ar(this,{onStageUpdate:this.onStageUpdate.bind(this)}),this._banner=new s9(this),this.stageElement=as(null==t?void 0:t.stageElement)||null,this.mediaElement=as(null==t?void 0:t.mediaElement)||null,this._app=new sy(this,this.emitter)}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options?o0({},this._options):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"app",{get:function(){return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundGraphics",{get:function(){return this._backgroundGraphics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templates",{get:function(){return this._templates},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._graphics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageElement",{get:function(){return this._stageElement},set:function(t){this._stageElement=t,this.emitter.onStageElementSet(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageScale",{get:function(){return this.stage.scale},set:function(t){this.stage.scale=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaElement",{get:function(){return this._mediaElement},set:function(t){this.updateMediaElement(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaSourceElement",{get:function(){return this._mediaSourceElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaBannerElement",{get:function(){return this._mediaBannerElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaPosition",{get:function(){return this._mediaPosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoPosition",{get:function(){return this._videoPosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wait",{get:function(){return this._timer?this._timer.wait:0},set:function(t){this._timer&&(this._timer.wait=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fps",{get:function(){return 1e3/this.wait},set:function(t){this.wait=1e3/t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionWidth",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&"number"==typeof this._data.video.config.width?this._data.video.config.width:"number"==typeof(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.width)?this._options.defaultVideoSize.width:1280},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionHeight",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&"number"==typeof this._data.video.config.height?this._data.video.config.height:"number"==typeof(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.height)?this._options.defaultVideoSize.height:720},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionProportion",{get:function(){return this.resolutionHeight/this.resolutionWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"margin",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&this._data.video.config.margin?this._data.video.config.margin:(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.margin)||o6},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoWidth",{get:function(){var t=this.resolutionWidth,e=this.margin;return t+e[1]+e[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoHeight",{get:function(){var t=this.resolutionHeight,e=this.margin;return t+e[0]+e[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoProportion",{get:function(){return this.videoHeight/this.videoWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageWidth",{get:function(){return this.stage.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageHeight",{get:function(){return this.stage.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return!!this._videoPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this._timer&&this._timer.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVideoSeeking",{get:function(){return this._isVideoSeeking},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"banner",{get:function(){return this._banner},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timer",{get:function(){return this._timer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){isNaN(t)||(this._volume=Math.min(100,Math.max(0,t)),this.emitter.onVolumeUpdate(this._volume))},enumerable:!1,configurable:!0}),t.prototype.createDefaultTimer=function(){try{if("undefined"!=typeof window&&"basic"!==oZ("ta_timer"))return new o7}catch(t){}return new o8},t.prototype.createDefaultGraphicsDriver=function(){return new nz},t.prototype.addListener=function(t){return this.emitter.addListener(t)},t.prototype.removeListener=function(t){return this.emitter.removeListener(t)},t.prototype.createFromVideoId=function(t,e){return o1(this,0,void 0,function(){var r=this;return o2(this,function(n){return[2,this.create(function(){return r.doCreateFromVideoId(t,e)},null==e?void 0:e.dryRun)]})})},t.prototype.doCreateFromVideoId=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,(r=new sd(this.managers,this.emitter,this._options)).createFromVideoId(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}})})},t.prototype.createFromVideo=function(t,e){return o1(this,0,void 0,function(){var r=this;return o2(this,function(n){return[2,this.create(function(){return r.doCreateFromVideo(t,e)},null==e?void 0:e.dryRun)]})})},t.prototype.doCreateFromVideo=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){return(r=new sd(this.managers,this.emitter,this._options)).createFromVideo(t,null==e?void 0:e.video),[2,this.finalize(r,e)]})})},t.prototype.createFromSongUrl=function(t,e){return o1(this,0,void 0,function(){var r=this;return o2(this,function(n){return[2,this.create(function(){return r.doCreateFromSongUrl(t,e)},null==e?void 0:e.dryRun)]})})},t.prototype.doCreateFromSongUrl=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,(r=new sd(this.managers,this.emitter,this._options)).createFromSongUrl(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}})})},t.prototype.createFromSongPath=function(t,e){return o1(this,0,void 0,function(){var r=this;return o2(this,function(n){return[2,this.create(function(){return r.doCreateFromSongPath(t,e)},null==e?void 0:e.dryRun)]})})},t.prototype.doCreateFromSongPath=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,(r=new sd(this.managers,this.emitter,this._options)).createFromSongPath(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}})})},t.prototype.createFromSongId=function(t,e){return o1(this,0,void 0,function(){var r=this;return o2(this,function(n){return[2,this.create(function(){return r.doCreateFromSongId(t,e)},null==e?void 0:e.dryRun)]})})},t.prototype.doCreateFromSongId=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,(r=new sd(this.managers,this.emitter,this._options)).createFromSongId(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}})})},t.prototype.createFromSongCode=function(t,e){return o1(this,0,void 0,function(){var r=this;return o2(this,function(n){return[2,this.create(function(){return r.doCreateFromSongCode(t,e)},null==e?void 0:e.dryRun)]})})},t.prototype.doCreateFromSongCode=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,(r=new sd(this.managers,this.emitter,this._options)).createFromSongCode(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}})})},t.prototype.createFromText=function(t,e){return o1(this,0,void 0,function(){var r=this;return o2(this,function(n){return[2,this.create(function(){return r.doCreateFromText(t,e)},null==e?void 0:e.dryRun)]})})},t.prototype.doCreateFromText=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){switch(n.label){case 0:return[4,(r=new sd(this.managers,this.emitter,this._options)).createFromText(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}})})},t.prototype.createFromJSON=function(t,e){return o1(this,0,void 0,function(){var r=this;return o2(this,function(n){return[2,this.create(function(){return r.doCreateFromJSON(t,e)},null==e?void 0:e.dryRun)]})})},t.prototype.doCreateFromJSON=function(t,e){return o1(this,0,void 0,function(){var r;return o2(this,function(n){return(r=new sd(this.managers,this.emitter,this._options)).createFromJSON(t,null==e?void 0:e.video),[2,this.finalize(r,e)]})})},t.prototype.create=function(t,e){return o1(this,0,void 0,function(){var r,n=this;return o2(this,function(i){if(this._videoPromise&&!e)throw new ai("Player.createFrom* method calls cannot run in parallel",this._videoPromise);return r=t(),e||(this._videoPromise=r,r.finally(function(){return n._videoPromise=null})),[2,r]})})},t.prototype.finalize=function(t,e){return o1(this,0,void 0,function(){var r,n,i,o=this;return o2(this,function(s){switch(s.label){case 0:return t.video?[4,Promise.all([t.finalize(e),this.backgroundGraphics.setBackground(t.video.background)])]:[2,null];case 1:var a,u,c,l;return s.sent(),(null==e?void 0:e.dryRun)?[2,null]:(a=n=new no(r=t.video.json),c=(u={config:t.video.config,song:t.song}).config,l=u.song,c&&"object"==typeof c&&"number"==typeof c.duration?a.duration=c.duration:l?a.duration=1e3*l.length:a.duration||(a.duration=a.endTime),[4,Promise.all([this.graphics.createRuntime(n),function(t,e){var r=e.id,n=e.data,i=e.loader,o=e.deserializer;return o1(this,0,void 0,function(){return o2(this,function(e){switch(e.label){case 0:return r&&r>=0?[4,i(r)]:[3,2];case 1:e.sent(),e.label=2;case 2:return o(t,n),[2]}})})}(n,{id:t.video.id,data:r,loader:function(t){return o1(o,0,void 0,function(){return o2(this,function(e){switch(e.label){case 0:return[4,this.templates.loadForVideo(t)];case 1:return e.sent(),[2]}})})},deserializer:function(t,e){return o.templates.importInstances(t,e)}}),function(t,e){var r=e.parser;return o1(this,0,void 0,function(){var e,n;return o2(this,function(i){switch(i.label){case 0:return t&&t.length>0&&t[0].words&&t[0].words.length>0&&t[0].words[0]&&!t[0].words[0].pos?[4,r((e=t.map(function(t){return t.words.map(function(t){return t.characters.map(function(t){return t.char}).join("")}).join(" ")})).join("\n"))]:[2];case 1:return(n=i.sent())&&"success"===n.status&&t.forEach(function(t,r){var i=n.result[r],o=0;t.words.forEach(function(t){var n=t.characters.map(function(t){return t.char}).join(""),s=e[r].indexOf(n,o);if(!(s<0)){o=s;var a=i.find(function(t){return t.startPosition<=s&&t.endPosition>=s});a&&(t.pos=a.PoS,t.rawPoS=a.rawPoS,t.language=a.language)}})}),[2]}})})}(null==r?void 0:r.phrases,{parser:rM.parse.bind(rM)})])]);case 2:return s.sent(),this._data,this._video&&this.templates.disposeInstances(this._video),this._data=t,this._video=n,this.emitter.onVideoReady(n),i=(null==e?void 0:e.altSourceUrl)||void 0,[4,this._timer.initialize({player:this,updater:this.updateMediaPosition.bind(this),emitter:this.emitter,altSourceUrl:i})];case 3:return s.sent(),this.emitter.onTimerReady(this._timer),[2,n]}})})},t.prototype.updateMediaPosition=function(t){return o1(this,0,void 0,function(){var e=this;return o2(this,function(r){return this._isVideoSeeking?(this._mediaPosition=t,this.emitter.onMediaSeek(t),[2,t]):[2,this.stage.requestUpdate(t).then(function(t){return e._mediaPosition=t,e._videoPosition=t,e.emitter.onMediaSeek(t),t})]})})},t.prototype.exportVideo=function(t){var e,r,n,i,o,s,a;return void 0===t&&(t={legacyStringMode:!0}),o1(this,0,void 0,function(){var u,c,l,p;return o2(this,function(h){return u={sourceId:(null===(e=this._data.video)||void 0===e?void 0:e.id)||-1,sourceOriginId:(null===(r=this._data.video)||void 0===r?void 0:r.sourceOriginId)||-1,songleId:(null===(n=this._data.song)||void 0===n?void 0:n.id)||-1,lyricId:this._data.lyricsId||-1,lyricDiffId:(null===(i=this._data.lyrics)||void 0===i?void 0:i.id)||-1,config:((null==t?void 0:t.legacyStringMode)?(null===(o=this._data.video)||void 0===o?void 0:o.config)&&JSON.stringify(this._data.video.config):null===(s=this._data.video)||void 0===s?void 0:s.config)||null},c=this.backgroundGraphics.exportPartialVideoEntry(t),l=(null===(a=this._video)||void 0===a?void 0:a.exportData(this._templates))||null,p=(null==t?void 0:t.legacyStringMode)?JSON.stringify(l):l,[2,o0(o0(o0({},u),c),{json:p})]})})},t.prototype.getChoruses=function(){return this._data.getChoruses()},t.prototype.findChorus=function(t,e){return this._data.findChorus(t,e)},t.prototype.findChorusBetween=function(t,e){return this._data.findChorusBetween(t,e)},t.prototype.findChorusChange=function(t,e){return this._data.findChorusChange(t,e)},t.prototype.getBeats=function(){return this._data.getBeats()},t.prototype.findBeat=function(t,e){return this._data.findBeat(t,e)},t.prototype.findBeatChange=function(t,e){return this._data.findBeatChange(t,e)},t.prototype.getChords=function(){return this._data.getChords()},t.prototype.findChord=function(t,e){return this._data.findChord(t,e)},t.prototype.findChordChange=function(t,e){return this._data.findChordChange(t,e)},t.prototype.getVocalFrequency=function(t){return this._data.getVocalFrequency(t)},t.prototype.getVocalAmplitude=function(t){return this._data.getVocalAmplitude(t)},t.prototype.getMaxVocalAmplitude=function(){return this._data.getMaxVocalAmplitude()},t.prototype.getValenceArousal=function(t){return this._data.getValenceArousal(t)},t.prototype.getMedianValenceArousal=function(){return this._data.getMedianValenceArousal()},t.prototype.resize=function(t){return this.emitter.onResize(t)},t.prototype.onResize=function(t){return this.resize(t)},t.prototype.setStageElement=function(t){return this._stageElement=t,this.emitter.onStageElementSet(t)},t.prototype.setMediaElement=function(t){this.mediaElement=t},t.prototype.updateMediaElement=function(t){"undefined"!=typeof document&&(this._mediaElement&&ao(this._mediaElement),t?(ao(t),this._mediaSourceElement||(this._mediaSourceElement=document.createElement("div"),this._mediaSourceElement.classList.add("textalive-media-wrapper")),t.appendChild(this._mediaSourceElement),this._mediaBannerElement||(this._mediaBannerElement=document.createElement("div"),this._mediaSourceElement.classList.add("textalive-banner-wrapper")),t.appendChild(this._mediaBannerElement)):(this._mediaSourceElement=null,this._mediaBannerElement=null)),this._mediaElement=t,this.emitter.onMediaElementSet(t)},t.prototype.setVideoPosition=function(t){return o1(this,0,void 0,function(){var e=this;return o2(this,function(r){return[2,this.stage.requestUpdate(t).then(function(t){return e._videoPosition=t,e.emitter.onVideoSeek(t),t})]})})},t.prototype.setMediaPosition=function(t){return o1(this,0,void 0,function(){return o2(this,function(e){return this.requestMediaSeek(t),[2]})})},t.prototype.requestPlay=function(){return this._timer.play(),!0},t.prototype.requestStop=function(){return this._timer.stop(),!0},t.prototype.requestPause=function(){return this._timer.pause(),!0},t.prototype.requestMediaSeek=function(t){return this._timer.seek(t),!0},t.prototype.startVideoSeek=function(){return this._isVideoSeeking=!0,this.emitter.onVideoSeekStart()},t.prototype.endVideoSeek=function(){return this._isVideoSeeking=!1,this.emitter.onVideoSeekEnd()},t.prototype.requestSettingBackground=function(t){return o1(this,0,void 0,function(){return o2(this,function(e){return[2,this.backgroundGraphics.settingBackground(t)]})})},t.prototype.requestSetBackground=function(t){return o1(this,0,void 0,function(){return o2(this,function(e){return[2,this.backgroundGraphics.setBackground(t)]})})},t.prototype.requestStageUpdate=function(){return o1(this,0,void 0,function(){return o2(this,function(t){return[2,this.stage.requestUpdate()]})})},t.prototype.onStageUpdate=function(t){this._isVideoSeeking||this.emitter.onTimeUpdate(t)},t.prototype.dispose=function(){this._timer&&(this._timer.dispose(),this._timer=null),this.mediaElement&&(ao(this._mediaElement),this._mediaElement=null),this.stageElement&&(this._stageElement=null),this.emitter.onDispose()},t}();console.log("# \n\n\n\n\n\nTextAlive App API\nTextAlive App API TextAlive https://textalive.jp/  https://developer.textalive.jp/ \n\n# \n\ntextalive-ml@aist.go.jp"),rg.sortedIndex;class au{constructor(t){this.text=t.text,this.startTime=t.startTime,this.endTime=t.endTime,this.duration=t.duration,this.x=0,this.y=0,this.isDraw=!1}}class ac{constructor(){this._px=0,this._py=0,this._rx=0,this._ry=0,this._space=160,this._speed=1500,this._position=0,this._isOver=!1,this._can=document.createElement("canvas"),this._ctx=this._can.getContext("2d"),document.getElementById("view").append(this._can),document.addEventListener("mousemove",t=>this._move(t)),document.addEventListener("mouseleave",t=>this._leave(t)),"ontouchstart"in window&&(this._space*=.5,this._speed*=.5,document.addEventListener("touchmove",t=>this._move(t)),document.addEventListener("touchend",t=>this._leave(t))),this.resize()}setLyrics(t){this._lyrics=t}update(t){this._isOver||(this._rx=.3*Math.sin(t/1234+.123)+.2,this._ry=.5*Math.cos(t/1011+.111),this._mouseX=this._stw*(this._rx+1)/2,this._mouseY=this._sth*(this._ry+1)/2);var e=(t-this._position)/1e3;this._px+=-this._rx*e*this._speed,this._py+=-this._ry*e*this._speed,this._drawBg(),this._drawLyrics(),this._position=t}resize(){this._can.width=this._stw=document.documentElement.clientWidth,this._can.height=this._sth=document.documentElement.clientHeight}_move(t){var e=0,r=0;t.touches?(e=t.touches[0].clientX,r=t.touches[0].clientY):(e=t.clientX,r=t.clientY),this._mouseX=e,this._mouseY=r,this._rx=e/this._stw*2-1,this._ry=r/this._sth*2-1,this._isOver=!0}_leave(t){this._isOver=!1}_drawBg(){var t=this._space,e=this._px%t,r=this._py%t,n=this._stw/t+1,i=this._sth/t+1,o=this._ctx;o.clearRect(0,0,this._stw,this._sth),o.strokeStyle="#000",o.lineWidth=1,o.beginPath();for(var s=0;s<=i;s++)for(var a=0;a<=n;a++){var u=a*t+e,c=s*t+r;o.moveTo(u-8,c),o.lineTo(u+8,c),o.moveTo(u,c-8),o.lineTo(u,c+8)}o.stroke()}_drawLyrics(){if(this._lyrics){var t=this._position,e=this._space,r=.5*e,n=this._ctx;n.textAlign="center",n.fillStyle="#000";for(var i=0,o=this._lyrics.length;i<o;i++){var s=this._lyrics[i];if(s.startTime<t){if(t<s.endTime&&!isNaN(this._mouseX)&&!s.isDraw){var a=Math.floor((-this._px+this._mouseX)/e),u=Math.floor((-this._py+this._mouseY)/e),c=0,l=0,p=!0;e:for(var h=0;h<=100;h++){c=h,l=0;for(var f=-1,d=1,y=0==h?1:4*h,g=0;g<y;g++){p=!0;for(var v=0;v<i;v++){var m=this._lyrics[v];if(m.isDraw&&m.x==a+c&&m.y==u+l){p=!1;break}}if(p)break e;((c+=f)==h||c==-h)&&(f=-f),((l+=d)==h||l==-h)&&(d=-d)}}s.x=a+c,s.y=u+l,s.isDraw=!0}if(s.isDraw){var b=s.x*e,_=s.y*e;if(b+e<-this._px||-this._px+this._stw<b||_+e<-this._py||-this._py+this._sth<_)continue;b=this._px+b+e/2,_=this._py+_+e/2,r=.5*e*this._easeOutBack(Math.min((t-s.startTime)/200,1)),n.font="bold "+r+"px sans-serif",n.fillText(s.text,b,_+.37*r)}}else s.isDraw=!1}}}_easeOutBack(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)}}new class{constructor(){var t=new ac;this._canMng=t,this._initPlayer(),window.addEventListener("resize",()=>this._resize()),this._update()}_initPlayer(){var t=new aa({app:{token:"eaFarhRWbobOZTyd"},mediaElement:document.querySelector("#media")});t.addListener({onAppReady:t=>this._onAppReady(t),onVideoReady:t=>this._onVideoReady(t),onTimeUpdate:t=>this._onTimeUpdate(t)}),this._player=t}_onAppReady(t){t.songUrl||this._player.createFromSongUrl("http://www.youtube.com/watch?v=bMtYf3R0zhY",{video:{beatId:3953902,repetitiveSegmentId:2099660,lyricId:52093,lyricDiffId:5177}}),document.getElementById("view").addEventListener("click",()=>{var t;(t=this._player).isPlaying?t.requestPause():t.requestPlay()})}_onVideoReady(t){var e=[];if(t.firstChar)for(var r=t.firstChar;r;)e.push(new au(r)),r=r.next;this._canMng.setLyrics(e)}_onTimeUpdate(t){this._position=t,this._updateTime=Date.now(),this._canMng.update(t)}_update(){if(this._player.isPlaying&&0<=this._updateTime&&0<=this._position){var t=Date.now()-this._updateTime+this._position;this._canMng.update(t)}window.requestAnimationFrame(()=>this._update())}_resize(){this._canMng.resize()}};