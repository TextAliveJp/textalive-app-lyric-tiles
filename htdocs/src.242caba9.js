parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"Z8sE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.expandEndTime=n,exports.expandStartTime=i,exports.sortedIndex=e,exports.defaultFontStyle=exports.defaultFontSize=exports.defaultFontFamily=exports.defaultColor=exports.Word=exports.Video=exports.UnitTypes=exports.TextUnit=exports.RenderingUnit=exports.Point=exports.Phrase=exports.NullRenderingParameter=exports.NullGraphicsDriver=exports.Matrix2D=exports.Graphic=exports.Font=exports.Color=exports.Char=void 0;var t={NONE:0,PHRASE:1,WORD:2,CHAR:4,GRAPHIC:8,ALL:63,PUBLIC:64};function e(t,e,r){r||(r=function(t){return t});for(var i="number"==typeof e?e:r(e),n=0,o=t.length;n<o;){var s=Math.floor((n+o)/2);r(t[s])<i?n=s+1:o=s}return n}exports.UnitTypes=t;var r=function(){function e(){this._parent=null,this._children=[],this._previous=null,this._next=null,this._runtime=null,this._templates=[]}return Object.defineProperty(e.prototype,"video",{get:function(){return this.parent&&this.parent.video},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this._data?this._data.startTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this._data?this._data.endTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rendering",{get:function(){return this._runtime?this._runtime.rendering:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return this._runtime?this._runtime.graphics:null},enumerable:!0,configurable:!0}),e.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},e.prototype.progress=function(t){return this.contains(t)?(t-this.startTime)/this.duration:-1},e.prototype.moveStartTime=function(t){t=Math.min(Math.max(t,0),this._data.endTime),null!=this._parent&&(t=Math.max(t,this._parent.startTime)),null!=this._previous&&(t=Math.max(t,this._previous.endTime)),this._children.length>0&&(t=Math.min(t,this._children[0].startTime));var e=this.startTime!==t;return this._data.startTime=t,e},e.prototype.moveStartTimeAndShrink=function(t){var e=this.endTime;if(this._children.length>0)this._children.forEach(function(t){e-=t.duration});else if(t+30>e)return!1;t=Math.min(Math.max(t,0),e),null!=this._parent&&(t=Math.max(t,this._parent.startTime)),null!=this._previous&&(t=Math.max(t,this._previous.endTime));var r=this.startTime!==t;if(this._data.startTime=t,r&&this._children.length>0)for(var i=0,n=this._children;i<n.length;i++){var o=n[i];if(o.startTime>=t)break;o.moveWithChildren(t-o.startTime),t=o.endTime}return r},e.prototype.moveEndTime=function(t){var e=this.video.duration;t=Math.max(Math.min(t,e),this.startTime),null!=this._parent&&(t=Math.min(t,this._parent.endTime)),null!=this._next&&(t=Math.min(t,this._next.startTime)),this._children.length>0&&(t=Math.max(t,this._children[this._children.length-1].endTime));var r=this.endTime!==t;return this._data.endTime=t,r},e.prototype.moveEndTimeAndShrink=function(t){var e=this.startTime;if(this._children.length>0)this._children.forEach(function(t){e+=t.duration});else if(t-30<e)return!1;var r=this.video.duration;t=Math.max(Math.min(t,r),e),null!=this._parent&&(t=Math.min(t,this._parent.endTime)),null!=this._next&&(t=Math.min(t,this._next.startTime));var i=this.endTime!==t;if(this._data.endTime=t,i&&this._children.length>0)for(var n=this._children.length-1;n>=0;n--){var o=this._children[n];if(o.endTime<=t)break;o.moveWithChildren(t-o.endTime),t=o.startTime}return i},e.prototype.move=function(t){var e=0,r=this.video.duration;null!=this._parent&&(e=Math.max(e,this._parent.startTime),r=Math.min(r,this._parent.endTime)),null!=this._previous&&(e=Math.max(e,this._previous.endTime)),null!=this._next&&(r=Math.min(r,this._next.startTime)),this.startTime+t<e&&(t=e-this.startTime),this.endTime+t>r&&(t=r-this.endTime),this.moveWithChildren(t)},e.prototype.maximize=function(){var t=!1,e=this.endTime,r=Math.max(null===this._parent?0:this._parent.startTime,null===this._previous?0:this._previous.endTime);r!==this.startTime&&(this.moveWithChildren(r-this.startTime),t=!0);var i=Math.min(null===this._parent?this.video.duration:this._parent.endTime,null===this._next?this.video.duration:this._next.startTime);return i!==this.endTime&&(this._data.endTime=i,t=e!==i),t},e.prototype.moveStartTimeAndExtend=function(t){return this.moveAndExtend(t,1)},e.prototype.moveEndTimeAndExtend=function(t){return this.moveAndExtend(t,2)},e.prototype.moveAndExtend=function(t,e){if(void 0===e&&(e=0),0===t)return!1;var r,i,n=this._parent?this._parent.startTime:this._previous?this._previous.endTime:0,o=this._parent?this._parent.endTime:this._next?this._next.startTime:this.video.duration;if(this._parent){if(null!==this._next)for(r=this._next;null===r._parent&&null!==r._next||r._parent===this._parent;)o-=r.duration,r=r._next;if(null!==this._previous)for(r=this._previous;null===r._parent&&null!==r._previous||r._parent===this._parent;)n+=r.duration,r=r._previous}if(0===e){if(this.startTime+t<n&&(t=n-this.startTime),this.endTime+t>o&&(t=o-this.endTime),0===t)return!1;this.moveWithChildren(t)}else if(1===e){if(this.startTime+t<n&&(t=n-this.startTime),0===t)return!1;this._data.startTime+=t}else{if(this.endTime+t>o&&(t=o-this.endTime),0===t)return!1;this._data.endTime+=t}for(i=this;null!==i;){var s=i.moveBackward(),a=i.moveForward();if(null===i._parent)break;var h=i._parent;s<h.startTime&&(h._data.startTime=s,h.moveBackward()),a>h.endTime&&(h._data.endTime=a,h.moveForward()),i=h}return!0},e.prototype.moveBackward=function(){for(var t=this,e=this.startTime;null!==t._previous&&t._parent===t._previous._parent&&t._previous.endTime>t.startTime;){var r=t.startTime-t._previous.endTime;t._previous.moveWithChildren(r),e=(t=t._previous).startTime}return e},e.prototype.moveForward=function(){for(var t=this,e=this.endTime;null!==t._next&&t._parent===t._next._parent&&t._next.startTime<t.endTime;){var r=t.endTime-t._next.startTime;t._next.moveWithChildren(r),e=(t=t._next).endTime}return e},e.prototype.moveWithChildren=function(t){var e=[];for(e.push(this);e.length>0;){var r=e.pop();null!=r._children&&r._children.forEach(function(t){return e.push(t)}),r._data.startTime+=t,r._data.endTime+=t}},e.prototype.getNumTemplates=function(){return this._templates.length},e.prototype.getTemplate=function(t){return void 0===t&&(t=0),t<0||t>=this._templates.length?null:this._templates[t]},e.prototype.addTemplateAt=function(t,e){this._templates.splice(e,0,t),t.assignedUnit=this},e.prototype.addTemplate=function(t){this._templates.push(t),t.assignedUnit=this},e.prototype.clearTemplates=function(){for(var t=[];this._templates.length>0;){var e=this.removeTemplateAt(0);e&&t.push(e)}return t},e.prototype.removeTemplateAt=function(t){if(t<0||t>=this._templates.length)return null;var e=this._templates.splice(t,1)[0];return e.assignedUnit=null,e},e.prototype.removeTemplate=function(t){for(var e=0;e<this._templates.length;e++){var r=this._templates[e];if(r===t)return this._templates.splice(e,1),t.assignedUnit=null,r}return null},e.prototype.getType=function(){return t.NONE},e.prototype.toString=function(){return"RenderingUnit"},e}();function i(t,e){return void 0!==e&&e<t?e:t}function n(t,e){return void 0!==e&&e>t?e:t}exports.RenderingUnit=r;var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function s(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function a(t,e,r,i){return new(r||(r=Promise))(function(n,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}h((i=i.apply(t,e||[])).next())})}function h(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var u=function(e){function r(t){var r=e.call(this)||this;return r._data=t,r}return s(r,e),r.prototype.getType=function(){return t.GRAPHIC},r.prototype.toString=function(){return"Graphic"},r}(r),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),Object.defineProperty(e.prototype,"text",{get:function(){var t="";return this.children.forEach(function(e){t+=e.text}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.children.reduce(function(t,e){return null===t?e.color:void 0===t||t.eq(e.color)?t:void 0},null)},set:function(t){null!==t&&this.children.forEach(function(e){e.color=t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"font",{set:function(t){null!==t&&this.children.forEach(function(e){e.font=t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.children.reduce(function(t,e){var r=e.fontFamily;return void 0===t||null!==t&&t!==r?void 0:r},null)},set:function(t){this.children.forEach(function(e){e.fontFamily=t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.children.reduce(function(t,e){var r=e.fontStyle;return void 0===t||null!==t&&t!==r?void 0:r},null)},set:function(t){this.children.forEach(function(e){e.fontStyle=t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.children.length<=0?0:this.children.reduce(function(t,e){return t+e.fontSize},0)/this.children.length},set:function(t){this.children.forEach(function(e){e.fontSize=t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this.children.reduce(function(t,e){return t+e.advance},0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this.children.reduce(function(t,e){return Math.max(t,e.ascent)},0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this.children.reduce(function(t,e){return Math.max(t,e.descent)},0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ascent+this.descent},enumerable:!0,configurable:!0}),e.prototype.expandTime=function(t){return{startTime:i(this.startTime,t.startTime),endTime:n(this.endTime,t.endTime)}},e.prototype.toString=function(){return this.text},e}(r),c="#000",l=function(){function t(t){this.a=0,this.r=0,this.g=0,this.b=0,this.from(t)}return Object.defineProperty(t.prototype,"value",{get:function(){return(((this.a<<8)+this.r<<8)+this.g<<8)+this.b},set:function(t){this.fromNumber(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return"rgb("+this.r+","+this.g+","+this.b+")"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")"},enumerable:!0,configurable:!0}),t.prototype.eq=function(e){return typeof this==typeof e&&e instanceof t&&this.value===e.value},t.prototype.toString=function(t){return void 0===t&&(t=!0),t?this.rgba:this.rgb},t.prototype.from=function(t){if("object"==typeof t||void 0===t){if(!t)return;return"number"==typeof t.value?void(this.value=t.value):"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b?(this.a="number"==typeof t.a?t.a:255,this.r=t.r,this.g=t.g,void(this.b=t.b)):void 0}"string"==typeof t?this.fromString(t):"number"==typeof t&&this.fromNumber(t)},t.prototype.fromString=function(t){if(t){if("#"===t.charAt(0)&&(t=t.substr(1)),4===t.length){var e=t.charAt(0),r=t.charAt(1),i=t.charAt(2),n=t.charAt(3);t=""+e+e+r+r+i+i+n+n}3===t.length&&(r=t.charAt(0),i=t.charAt(1),n=t.charAt(2),t=""+r+r+i+i+n+n);var o=parseInt(t,16);this.fromNumber(o,8===t.length)}},t.prototype.fromNumber=function(t,e){void 0===e&&(e=!0),isNaN(t)||(this.a=e?t>>24&255:255,this.r=t>>16&255,this.g=t>>8&255,this.b=255&t)},t}(),f="Noto Sans Japanese",d=40,m="",y=function(){function t(t,e,r){void 0===t&&(t="Noto Sans Japanese"),void 0===e&&(e=40),void 0===r&&(r=""),this._family=t,this._size=e,this._style=r}return Object.defineProperty(t.prototype,"family",{get:function(){return this._family},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},enumerable:!0,configurable:!0}),t.prototype.deriveFamily=function(e){return new t(e,this._size,this._style)},t.prototype.deriveStyle=function(e){return new t(this._family,this._size,e)},t.prototype.deriveSize=function(e){return new t(this._family,e,this._style)},t.prototype.clone=function(){return new t(this._family,this._size,this._style)},t.prototype.eq=function(t){return this._family===t._family&&this._size===t._size&&this._style===t._style},t.prototype.toString=function(t){return void 0===t&&(t=1),this._style+(this._style.length>0?" ":"")+this._size*t+"px '"+this._family+"'"},t}(),_=function(e){function r(t){var r=e.call(this)||this;return r._data=t,r._font=new y(t&&t.fontFamily,t&&t.fontSize,t&&t.fontStyle),r._color=new l,r}return s(r,e),Object.defineProperty(r.prototype,"text",{get:function(){return this._data&&this._data.char||"?"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"advance",{get:function(){return this._runtime?this._runtime.advance:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"ascent",{get:function(){return this._runtime?this._runtime.ascent:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descent",{get:function(){return this._runtime?this._runtime.descent:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"font",{get:function(){return this._font},set:function(t){null===t||this.font.eq(t)||(this._font=t.clone(),this._data.fontFamily=t.family,this._data.fontSize=t.size,this._data.fontStyle=t.style,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fontFamily",{get:function(){return this.font.family},set:function(t){this.font.family!==t&&(this._font=this.font.deriveFamily(t),this._data.fontFamily=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fontStyle",{get:function(){return this.font.style},set:function(t){this.font.style!==t&&(this._font=this.font.deriveStyle(t),this._data.fontStyle=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fontSize",{get:function(){return this.font.size},set:function(t){isNaN(t)||this.font.size===t||(this._font=this.font.deriveSize(t),this._data.fontSize=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"color",{get:function(){return this._color},set:function(t){t&&!t.eq(this.color)&&(this._color=t,this._runtime&&this._runtime.onColorUpdate(t))},enumerable:!0,configurable:!0}),r.prototype.getType=function(){return t.CHAR},r}(p),g=function(e){function r(t){var r=e.call(this)||this;return r._data=t,r}return s(r,e),Object.defineProperty(r.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pos",{get:function(){return this._data&&this._data.pos||""},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rawPos",{get:function(){return this._data&&this._data.rawPoS||""},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"language",{get:function(){return this._data&&this._data.language||""},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"charCount",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"firstChar",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lastChar",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!0,configurable:!0}),r.prototype.addChar=function(t){if(null!==t){this._children.length>0&&(t._previous=this.lastChar,this.lastChar._next=t),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,i=e.endTime;this._data.startTime=r,this._data.endTime=i}},r.prototype.findIndex=function(t){return t instanceof _?this._children.indexOf(t):-1},r.prototype.getType=function(){return t.WORD},r}(p),b=function(e){function r(t,r){var i=e.call(this)||this;return i._video=t,i._data=r,i}return s(r,e),Object.defineProperty(r.prototype,"video",{get:function(){return this._video},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wordCount",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"charCount",{get:function(){return this._children.reduce(function(t,e){return t+e.charCount},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"firstWord",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lastWord",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"firstChar",{get:function(){var t=this.firstWord;return null===t?null:t.firstChar},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lastChar",{get:function(){var t=this.lastWord;return null===t?null:t.lastChar},enumerable:!0,configurable:!0}),r.prototype.addWord=function(t){if(null!==t){this._children.length>0&&(t._previous=this.lastWord,t._previous._next=t,t.firstChar._previous=t._previous.lastChar,t._previous.lastChar._next=t.firstChar),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,i=e.endTime;this._data.startTime=r,this._data.endTime=i}},r.prototype.findIndex=function(t){if(t instanceof g)return this._children.indexOf(t);if(t instanceof _){for(var e=0,r=!1,i=0,n=this._children;i<n.length;i++){var o=n[i],s=o.findIndex(t);if(!(s<0)){e+=s,r=!0;break}e+=o.charCount}return r?e:-1}return-1},r.prototype.getType=function(){return t.PHRASE},r}(p),v=function(){function t(t){this._phrases=[],this._graphics=[],this.data=t,this.createUnits()}return Object.defineProperty(t.prototype,"rendering",{get:function(){return this._runtime.rendering},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.data.duration},set:function(t){this.data.duration=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this.data.startTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this.data.endTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"phraseCount",{get:function(){return this._phrases.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphicCount",{get:function(){return this._graphics.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wordCount",{get:function(){return this._phrases.reduce(function(t,e){return t+e.wordCount},0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"charCount",{get:function(){return this._phrases.reduce(function(t,e){return t+e.charCount},0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[this._phrases.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstWord",{get:function(){var t=this.firstPhrase;return null===t?null:t.firstWord},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastWord",{get:function(){var t=this.lastPhrase;return null===t?null:t.lastWord},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChar",{get:function(){var t=this.firstWord;return null===t?null:t.firstChar},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastChar",{get:function(){var t=this.lastWord;return null===t?null:t.lastChar},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[this._graphics.length-1]},enumerable:!0,configurable:!0}),t.prototype.createUnits=function(){var t=this;Array.isArray(this.data.phrases)&&(this.data.phrases.forEach(function(e){var r=new b(t,e);e.words.forEach(function(t){var e=new g(t);t.characters.forEach(function(t){return e.addChar(new _(t))}),r.addWord(e)}),t.addPhrase(r)}),this.organizeTimings()),Array.isArray(this.data.graphics)&&this.data.graphics.forEach(function(e){var r=new u(e);t.addGraphic(r)})},t.prototype.organizeTimings=function(){for(var t=this.firstChar;null!==t;)t.startTime===t.endTime&&t.maximize(),t=t.next},t.prototype.exportData=function(e){this.updateTemplateData(e);for(var r=t.exportUnitData(this.data.phrases,!1),i=r.units,n=r.templateClasses,o=t.exportUnitData(this.data.graphics,!0),s=o.units,a=o.templateClasses,h=n.concat(a).filter(function(t,e,r){return r.indexOf(t)===e}),u={};h.length>0;){var p=h.shift(),c=e.getByName(p);if(c){u[p]=c.id;for(var l=0,f=e.getRequiredTemplates(c.script);l<f.length;l++){var d=f[l];u[d]||h.push(d)}}else console.log("template class not found",p)}return{phrases:i,graphics:s,templateClasses:u}},t.exportUnitData=function(e,r){if(void 0===r&&(r=!1),!e)return{units:[],templateClasses:[]};for(var i=[],n=[],o=0,s=e;o<s.length;o++){var a=s[o],h={templates:a.templates?a.templates.map(function(t){var e=t.type;n.push(e);var r={};return Object.keys(t.value).forEach(function(e){var i=t.value[e];r[e]="object"==typeof i?Object.assign({},i):i}),{type:e,value:r}}):[]},u=void 0;if(a.words){var p=a,c=t.exportUnitData(p.words);h.words=c.units,u=c.templateClasses}else if(a.characters){var l=a,f=t.exportUnitData(l.characters);h.characters=f.units,u=f.templateClasses}else{for(var d=0,m=["fontFamily","fontSize","fontStyle"];d<m.length;d++){var y=m[d];a[y]&&(h[y]=a[y])}u=[]}r&&(h.startTime=a.startTime,h.endTime=a.endTime),i.push(h),n=n.concat(u)}return{units:i,templateClasses:n=n.filter(function(t,e,r){return r.indexOf(t)===e})}},t.prototype.updateTemplateData=function(e){t.updateTemplateDataForUnits(e,this.firstPhrase,this.data.phrases),t.updateTemplateDataForUnits(e,this.firstGraphic,this.data.graphics)},t.updateTemplateDataForUnits=function(e,r,i){if(r&&i)for(var n=0,o=i;n<o.length;n++){var s=o[n];s.templates=[];for(var a=0;a<r.getNumTemplates();a++){var h=r.getTemplate(a),u=e.exportInstance(h);s.templates.push(u)}if(s.words){var p=s;t.updateTemplateDataForUnits(e,r.children[0],p.words)}else if(s.characters){var c=s;t.updateTemplateDataForUnits(e,r.children[0],c.characters)}r=r.next}},t.prototype.addPhrase=function(t){if(t){if(this._phrases.length>0&&(t._previous=this.lastPhrase,t._previous._next=t,t.wordCount>0)){for(var e=this.lastPhrase;e&&null===e.lastWord;)e=e.previous;if(e&&(t.firstWord._previous=e.lastWord,e.lastWord._next=t.firstWord),t.charCount>0){for(var r=e.lastWord;r&&null===r.lastChar;)r=r.previous;t.firstChar._previous=r.lastChar,r.lastChar._next=t.firstChar}}this._phrases.push(t);var i=this.expandTime(t),n=i.startTime,o=i.endTime;this.data.startTime=n,this.data.endTime=o}},t.prototype.addGraphic=function(t){if(t){if(this._graphics.length<=0)this._graphics.push(t),this.data.graphics=[t._data];else{var r=e(this._graphics,t,function(t){return t.startTime}),i=r>0?this._graphics[r-1]:null,n=r<this._graphics.length?this._graphics[r]:null;this._graphics.splice(r,0,t),this.data.graphics.splice(r,0,t._data),null!==i&&(i._next=t,t._previous=i),null!==n&&(n._previous=t,t._next=n)}this._runtime&&this._runtime.addGraphic(t)}},t.prototype.removeGraphic=function(t){for(var e=0;e<this._graphics.length;e++){var r=this._graphics[e];if(r===t)return r._previous&&(r._previous._next=r._next),r._next&&(r._next._previous=r._previous),this._graphics.splice(e,1),this.data.graphics.splice(e,1),this._runtime&&this._runtime.removeGraphic(r),!0}return!1},t.prototype.removeGraphics=function(){var t=this;this._runtime&&this._graphics.forEach(function(e){return t._runtime.removeGraphic(e)}),this._graphics=[],this.rendering.reset()},t.prototype.expandTime=function(t){return{startTime:i(this.data.startTime,t.startTime),endTime:n(this.data.endTime,t.endTime)}},t.prototype.findIndex=function(t){if(t instanceof b)return this._phrases.indexOf(t);if(t instanceof g){for(var e=0,r=!1,i=0,n=this._phrases;i<n.length;i++){if(!((h=(a=n[i]).findIndex(t))<0)){e+=h,r=!0;break}e+=a.wordCount}return r?e:-1}if(t instanceof _){e=0,r=!1;for(var o=0,s=this._phrases;o<s.length;o++){var a,h;if(!((h=(a=s[o]).findIndex(t))<0)){e+=h,r=!0;break}e+=a.charCount}return r?e:-1}return t instanceof u?this._graphics.indexOf(t):-1},t.prototype.getPhrase=function(t){return t<0||t>=this._phrases.length?null:this._phrases[t]},t.prototype.getGraphic=function(t){return t<0||t>=this._graphics.length?null:this._graphics[t]},t.prototype.getWord=function(t){for(var e=0,r=this.firstPhrase;!(e+r.children.length>t);)e+=r.children.length,r=r.next;return r.children[t-e]},t.prototype.getChar=function(t){for(var e=0,r=this.firstWord;!(e+r.children.length>t);)e+=r.children.length,r=r.next;return r.children[t-e]},t}(),T=function(){function t(t,e,r,i,n,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===o&&(o=0),this.setValues(t,e,r,i,n,o)}return t.prototype.setValues=function(t,e,r,i,n,o){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===o&&(o=0),this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=o,this},t.prototype.append=function(t,e,r,i,n,o){var s=this.a,a=this.b,h=this.c,u=this.d;return 1==t&&0==e&&0==r&&1==i||(this.a=s*t+h*e,this.b=a*t+u*e,this.c=s*r+h*i,this.d=a*r+u*i),this.tx=s*n+h*o+this.tx,this.ty=a*n+u*o+this.ty,this},t.prototype.prepend=function(t,e,r,i,n,o){var s=this.a,a=this.c,h=this.tx;return this.a=t*s+r*this.b,this.b=e*s+i*this.b,this.c=t*a+r*this.d,this.d=e*a+i*this.d,this.tx=t*h+r*this.ty+n,this.ty=e*h+i*this.ty+o,this},t.prototype.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.appendTransform=function(e,r,i,n,o,s,a,h,u){var p,c,l;return o%360?(p=o*t.DEG_TO_RAD,c=Math.cos(p),l=Math.sin(p)):(c=1,l=0),s||a?(s*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.append(Math.cos(a),Math.sin(a),-Math.sin(s),Math.cos(s),e,r),this.append(c*i,l*i,-l*n,c*n,0,0)):this.append(c*i,l*i,-l*n,c*n,e,r),(h||u)&&(this.tx-=h*this.a+u*this.c,this.ty-=h*this.b+u*this.d),this},t.prototype.prependTransform=function(e,r,i,n,o,s,a,h,u){var p,c,l;return o%360?(p=o*t.DEG_TO_RAD,c=Math.cos(p),l=Math.sin(p)):(c=1,l=0),(h||u)&&(this.tx-=h,this.ty-=u),s||a?(s*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.prepend(c*i,l*i,-l*n,c*n,0,0),this.prepend(Math.cos(a),Math.sin(a),-Math.sin(s),Math.cos(s),e,r)):this.prepend(c*i,l*i,-l*n,c*n,e,r),this},t.prototype.rotate=function(e){e*=t.DEG_TO_RAD;var r=Math.cos(e),i=Math.sin(e),n=this.a,o=this.b;return this.a=n*r+this.c*i,this.b=o*r+this.d*i,this.c=-n*i+this.c*r,this.d=-o*i+this.d*r,this},t.prototype.skew=function(e,r){return e*=t.DEG_TO_RAD,r*=t.DEG_TO_RAD,this.append(Math.cos(r),Math.sin(r),-Math.sin(e),Math.cos(e),0,0),this},t.prototype.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},t.prototype.translate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,i=this.d,n=this.tx,o=t*i-e*r;return this.a=i/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-i*n)/o,this.ty=-(t*this.ty-e*n)/o,this},t.prototype.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},t.prototype.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d},t.prototype.transformPoint=function(t,e,r){return r.x=t*this.a+e*this.c+this.tx,r.y=t*this.b+e*this.d+this.ty,r},t.prototype.decompose=function(e){void 0===e&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var r=Math.atan2(-this.c,this.d),i=Math.atan2(this.b,this.a);return Math.abs(1-r/i)<1e-5?(e.rotation=i/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=r/t.DEG_TO_RAD,e.skewY=i/t.DEG_TO_RAD),e},t.prototype.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)},t.prototype.toString=function(){return"["+this.constructor.name+" (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t.DEG_TO_RAD=Math.PI/180,t.identity=new t,t}(),x=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.setValues(t,e)}return t.prototype.setValues=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"["+this.constructor.name+" (x="+this.x+" y="+this.y+")]"},t}(),P=function(){function t(){this.tx=new T,this.alpha=0,this.composite="",this.visible=!0}return t.prototype.reset=function(){},t}(),O=function(){function t(){this.wrapperTable={}}return t.prototype.isGraphics=function(t){return!1},t.prototype.setCanvas=function(){return Promise.resolve()},t.prototype.createRuntime=function(t){return a(this,void 0,void 0,function(){var e,r,i;return h(this,function(n){for(e=t.firstPhrase;e;){for(e._runtime={graphics:{},rendering:new P,update:function(){}},r=e.firstWord;r;){for(r._runtime={graphics:{},rendering:new P,update:function(){}},i=r.firstChar;i&&(i._runtime={graphics:{},rendering:new P,update:function(){},advance:0,ascent:0,descent:0,onFontUpdate:function(t){},onColorUpdate:function(t){}},i!==r.lastChar);)i=i.next;if(r===e.lastWord)break;r=r.next}e=e.next}return t._runtime={rendering:new P,addGraphic:function(t){},removeGraphic:function(t){}},[2,t._runtime]})})},t.prototype.reset=function(){},t.prototype.update=function(){},t.prototype.updateStageTx=function(t,e){},t}();exports.NullGraphicsDriver=O,exports.NullRenderingParameter=P,exports.Point=x,exports.Matrix2D=T,exports.Video=v,exports.Phrase=b,exports.Word=g,exports.Char=_,exports.Font=y,exports.defaultFontStyle=m,exports.defaultFontSize=d,exports.defaultFontFamily=f,exports.Color=l,exports.defaultColor=c,exports.TextUnit=p,exports.Graphic=u;
},{}],"EDTP":[function(require,module,exports) {
"use strict";module.exports=function(r,n){return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];return r.apply(n,t)}};
},{}],"qZlO":[function(require,module,exports) {
module.exports=function(o){return null!=o&&null!=o.constructor&&"function"==typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)};
},{}],"S1cf":[function(require,module,exports) {
"use strict";var e=require("./helpers/bind"),r=require("is-buffer"),n=Object.prototype.toString;function t(e){return"[object Array]"===n.call(e)}function i(e){return"[object ArrayBuffer]"===n.call(e)}function o(e){return"undefined"!=typeof FormData&&e instanceof FormData}function f(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function u(e){return"string"==typeof e}function c(e){return"number"==typeof e}function a(e){return void 0===e}function l(e){return null!==e&&"object"==typeof e}function s(e){return"[object Date]"===n.call(e)}function p(e){return"[object File]"===n.call(e)}function y(e){return"[object Blob]"===n.call(e)}function d(e){return"[object Function]"===n.call(e)}function b(e){return l(e)&&d(e.pipe)}function j(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function m(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function B(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function v(e,r){if(null!=e)if("object"!=typeof e&&(e=[e]),t(e))for(var n=0,i=e.length;n<i;n++)r.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&r.call(null,e[o],o,e)}function A(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=A(e[n],r):e[n]=r}for(var n=0,t=arguments.length;n<t;n++)v(arguments[n],r);return e}function g(r,n,t){return v(n,function(n,i){r[i]=t&&"function"==typeof n?e(n,t):n}),r}module.exports={isArray:t,isArrayBuffer:i,isBuffer:r,isFormData:o,isArrayBufferView:f,isString:u,isNumber:c,isObject:l,isUndefined:a,isDate:s,isFile:p,isBlob:y,isFunction:d,isStream:b,isURLSearchParams:j,isStandardBrowserEnv:B,forEach:v,merge:A,extend:g,trim:m};
},{"./helpers/bind":"EDTP","is-buffer":"qZlO"}],"M8l6":[function(require,module,exports) {
"use strict";var e=require("../utils");module.exports=function(t,r){e.forEach(t,function(e,o){o!==r&&o.toUpperCase()===r.toUpperCase()&&(t[r]=e,delete t[o])})};
},{"../utils":"S1cf"}],"YdsM":[function(require,module,exports) {
"use strict";module.exports=function(e,o,r,s,t){return e.config=o,r&&(e.code=r),e.request=s,e.response=t,e};
},{}],"bIiH":[function(require,module,exports) {
"use strict";var r=require("./enhanceError");module.exports=function(e,n,o,t,u){var a=new Error(e);return r(a,n,o,t,u)};
},{"./enhanceError":"YdsM"}],"aS8y":[function(require,module,exports) {
"use strict";var t=require("./createError");module.exports=function(e,s,u){var a=u.config.validateStatus;u.status&&a&&!a(u.status)?s(t("Request failed with status code "+u.status,u.config,null,u.request,u)):e(u)};
},{"./createError":"bIiH"}],"H6Qo":[function(require,module,exports) {
"use strict";var e=require("./../utils");function r(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}module.exports=function(i,n,t){if(!n)return i;var a;if(t)a=t(n);else if(e.isURLSearchParams(n))a=n.toString();else{var c=[];e.forEach(n,function(i,n){null!=i&&(e.isArray(i)?n+="[]":i=[i],e.forEach(i,function(i){e.isDate(i)?i=i.toISOString():e.isObject(i)&&(i=JSON.stringify(i)),c.push(r(n)+"="+r(i))}))}),a=c.join("&")}return a&&(i+=(-1===i.indexOf("?")?"?":"&")+a),i};
},{"./../utils":"S1cf"}],"ZeD7":[function(require,module,exports) {
"use strict";var e=require("./../utils"),t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];module.exports=function(r){var i,o,n,s={};return r?(e.forEach(r.split("\n"),function(r){if(n=r.indexOf(":"),i=e.trim(r.substr(0,n)).toLowerCase(),o=e.trim(r.substr(n+1)),i){if(s[i]&&t.indexOf(i)>=0)return;s[i]="set-cookie"===i?(s[i]?s[i]:[]).concat([o]):s[i]?s[i]+", "+o:o}}),s):s};
},{"./../utils":"S1cf"}],"w7LF":[function(require,module,exports) {
"use strict";var t=require("./../utils");module.exports=t.isStandardBrowserEnv()?function(){var r,e=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a");function a(t){var r=t;return e&&(o.setAttribute("href",r),r=o.href),o.setAttribute("href",r),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:"/"===o.pathname.charAt(0)?o.pathname:"/"+o.pathname}}return r=a(window.location.href),function(e){var o=t.isString(e)?a(e):e;return o.protocol===r.protocol&&o.host===r.host}}():function(){return!0};
},{"./../utils":"S1cf"}],"dn2M":[function(require,module,exports) {
"use strict";var e=require("./../utils");module.exports=e.isStandardBrowserEnv()?{write:function(n,t,o,r,i,u){var s=[];s.push(n+"="+encodeURIComponent(t)),e.isNumber(o)&&s.push("expires="+new Date(o).toGMTString()),e.isString(r)&&s.push("path="+r),e.isString(i)&&s.push("domain="+i),!0===u&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};
},{"./../utils":"S1cf"}],"KRuG":[function(require,module,exports) {
"use strict";var e=require("./../utils"),r=require("./../core/settle"),s=require("./../helpers/buildURL"),t=require("./../helpers/parseHeaders"),o=require("./../helpers/isURLSameOrigin"),n=require("../core/createError");module.exports=function(a){return new Promise(function(i,u){var l=a.data,p=a.headers;e.isFormData(l)&&delete p["Content-Type"];var d=new XMLHttpRequest;if(a.auth){var c=a.auth.username||"",f=a.auth.password||"";p.Authorization="Basic "+btoa(c+":"+f)}if(d.open(a.method.toUpperCase(),s(a.url,a.params,a.paramsSerializer),!0),d.timeout=a.timeout,d.onreadystatechange=function(){if(d&&4===d.readyState&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))){var e="getAllResponseHeaders"in d?t(d.getAllResponseHeaders()):null,s={data:a.responseType&&"text"!==a.responseType?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:e,config:a,request:d};r(i,u,s),d=null}},d.onerror=function(){u(n("Network Error",a,null,d)),d=null},d.ontimeout=function(){u(n("timeout of "+a.timeout+"ms exceeded",a,"ECONNABORTED",d)),d=null},e.isStandardBrowserEnv()){var h=require("./../helpers/cookies"),m=(a.withCredentials||o(a.url))&&a.xsrfCookieName?h.read(a.xsrfCookieName):void 0;m&&(p[a.xsrfHeaderName]=m)}if("setRequestHeader"in d&&e.forEach(p,function(e,r){void 0===l&&"content-type"===r.toLowerCase()?delete p[r]:d.setRequestHeader(r,e)}),a.withCredentials&&(d.withCredentials=!0),a.responseType)try{d.responseType=a.responseType}catch(y){if("json"!==a.responseType)throw y}"function"==typeof a.onDownloadProgress&&d.addEventListener("progress",a.onDownloadProgress),"function"==typeof a.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",a.onUploadProgress),a.cancelToken&&a.cancelToken.promise.then(function(e){d&&(d.abort(),u(e),d=null)}),void 0===l&&(l=null),d.send(l)})};
},{"./../utils":"S1cf","./../core/settle":"aS8y","./../helpers/buildURL":"H6Qo","./../helpers/parseHeaders":"ZeD7","./../helpers/isURLSameOrigin":"w7LF","../core/createError":"bIiH","./../helpers/cookies":"dn2M"}],"pBGv":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"BXyq":[function(require,module,exports) {
var process = require("process");
var e=require("process"),t=require("./utils"),r=require("./helpers/normalizeHeaderName"),n={"Content-Type":"application/x-www-form-urlencoded"};function a(e,r){!t.isUndefined(e)&&t.isUndefined(e["Content-Type"])&&(e["Content-Type"]=r)}function i(){var t;return"undefined"!=typeof XMLHttpRequest?t=require("./adapters/xhr"):void 0!==e&&(t=require("./adapters/http")),t}var o={adapter:i(),transformRequest:[function(e,n){return r(n,"Content-Type"),t.isFormData(e)||t.isArrayBuffer(e)||t.isBuffer(e)||t.isStream(e)||t.isFile(e)||t.isBlob(e)?e:t.isArrayBufferView(e)?e.buffer:t.isURLSearchParams(e)?(a(n,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):t.isObject(e)?(a(n,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};t.forEach(["delete","get","head"],function(e){o.headers[e]={}}),t.forEach(["post","put","patch"],function(e){o.headers[e]=t.merge(n)}),module.exports=o;
},{"./utils":"S1cf","./helpers/normalizeHeaderName":"M8l6","./adapters/xhr":"KRuG","./adapters/http":"KRuG","process":"pBGv"}],"rj2i":[function(require,module,exports) {
"use strict";var t=require("./../utils");function e(){this.handlers=[]}e.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},e.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},e.prototype.forEach=function(e){t.forEach(this.handlers,function(t){null!==t&&e(t)})},module.exports=e;
},{"./../utils":"S1cf"}],"woEt":[function(require,module,exports) {
"use strict";var r=require("./../utils");module.exports=function(t,u,e){return r.forEach(e,function(r){t=r(t,u)}),t};
},{"./../utils":"S1cf"}],"V30M":[function(require,module,exports) {
"use strict";module.exports=function(t){return!(!t||!t.__CANCEL__)};
},{}],"YZjV":[function(require,module,exports) {
"use strict";module.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)};
},{}],"a2Uu":[function(require,module,exports) {
"use strict";module.exports=function(e,r){return r?e.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):e};
},{}],"uz6X":[function(require,module,exports) {
"use strict";var e=require("./../utils"),r=require("./transformData"),a=require("../cancel/isCancel"),s=require("../defaults"),t=require("./../helpers/isAbsoluteURL"),n=require("./../helpers/combineURLs");function o(e){e.cancelToken&&e.cancelToken.throwIfRequested()}module.exports=function(d){return o(d),d.baseURL&&!t(d.url)&&(d.url=n(d.baseURL,d.url)),d.headers=d.headers||{},d.data=r(d.data,d.headers,d.transformRequest),d.headers=e.merge(d.headers.common||{},d.headers[d.method]||{},d.headers||{}),e.forEach(["delete","get","head","post","put","patch","common"],function(e){delete d.headers[e]}),(d.adapter||s.adapter)(d).then(function(e){return o(d),e.data=r(e.data,e.headers,d.transformResponse),e},function(e){return a(e)||(o(d),e&&e.response&&(e.response.data=r(e.response.data,e.response.headers,d.transformResponse))),Promise.reject(e)})};
},{"./../utils":"S1cf","./transformData":"woEt","../cancel/isCancel":"V30M","../defaults":"BXyq","./../helpers/isAbsoluteURL":"YZjV","./../helpers/combineURLs":"a2Uu"}],"OvAf":[function(require,module,exports) {
"use strict";var e=require("./../defaults"),t=require("./../utils"),r=require("./InterceptorManager"),o=require("./dispatchRequest");function s(e){this.defaults=e,this.interceptors={request:new r,response:new r}}s.prototype.request=function(r){"string"==typeof r&&(r=t.merge({url:arguments[0]},arguments[1])),(r=t.merge(e,{method:"get"},this.defaults,r)).method=r.method.toLowerCase();var s=[o,void 0],u=Promise.resolve(r);for(this.interceptors.request.forEach(function(e){s.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){s.push(e.fulfilled,e.rejected)});s.length;)u=u.then(s.shift(),s.shift());return u},t.forEach(["delete","get","head","options"],function(e){s.prototype[e]=function(r,o){return this.request(t.merge(o||{},{method:e,url:r}))}}),t.forEach(["post","put","patch"],function(e){s.prototype[e]=function(r,o,s){return this.request(t.merge(s||{},{method:e,url:r,data:o}))}}),module.exports=s;
},{"./../defaults":"BXyq","./../utils":"S1cf","./InterceptorManager":"rj2i","./dispatchRequest":"uz6X"}],"mIKj":[function(require,module,exports) {
"use strict";function t(t){this.message=t}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,module.exports=t;
},{}],"tsWd":[function(require,module,exports) {
"use strict";var e=require("./Cancel");function n(n){if("function"!=typeof n)throw new TypeError("executor must be a function.");var o;this.promise=new Promise(function(e){o=e});var r=this;n(function(n){r.reason||(r.reason=new e(n),o(r.reason))})}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var e;return{token:new n(function(n){e=n}),cancel:e}},module.exports=n;
},{"./Cancel":"mIKj"}],"X8jb":[function(require,module,exports) {
"use strict";module.exports=function(n){return function(t){return n.apply(null,t)}};
},{}],"nUiQ":[function(require,module,exports) {
"use strict";var e=require("./utils"),r=require("./helpers/bind"),n=require("./core/Axios"),t=require("./defaults");function u(t){var u=new n(t),l=r(n.prototype.request,u);return e.extend(l,n.prototype,u),e.extend(l,u),l}var l=u(t);l.Axios=n,l.create=function(r){return u(e.merge(t,r))},l.Cancel=require("./cancel/Cancel"),l.CancelToken=require("./cancel/CancelToken"),l.isCancel=require("./cancel/isCancel"),l.all=function(e){return Promise.all(e)},l.spread=require("./helpers/spread"),module.exports=l,module.exports.default=l;
},{"./utils":"S1cf","./helpers/bind":"EDTP","./core/Axios":"OvAf","./defaults":"BXyq","./cancel/Cancel":"mIKj","./cancel/CancelToken":"tsWd","./cancel/isCancel":"V30M","./helpers/spread":"X8jb"}],"dZBD":[function(require,module,exports) {
module.exports=require("./lib/axios");
},{"./lib/axios":"nUiQ"}],"Lo92":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UnitTypes=exports.TEXT=exports.SongURLManager=exports.MUSIC=exports.LyricsURLManager=exports.BACKGROUND_IMAGE=exports.AssetManager=void 0;var e=0,n=1,t=2,o={NONE:0,PHRASE:1,WORD:2,CHAR:4,GRAPHIC:8,ALL:63,PUBLIC:64},r=/^https?:\/\/uploader\.ongaaccel\.jp\/files\?guid=([a-zA-Z0-9]+)/i,i=/^https?:\/\/songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,s=/^uploaded:([a-zA-Z0-9]+)$/i,c=/^songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,u={getSongPathFromUrl:function(e){if(u.isUploaderUrl(e)){var n=i.exec(e);if(n)return"songle.jp/uploads/"+n[1]+".mp3";var t=r.exec(e);if(t)return"songle.jp/uploads/"+t[1]+".mp3"}return/https?:\/\/(.+)/.exec(e)[1]},isUploaderUrl:function(e){return i.test(e)||r.test(e)},isUploaderPath:function(e){return c.test(e)||s.test(e)},getUploaderGuid:function(e){var n=c.exec(e);if(n)return n[1];var t=s.exec(e);return t?t[1]:null},getSongUrlFromUploaderGuid:function(e){return e?"https://songle.jp/uploads/"+e+".mp3":null},getSongUrlFromPath:function(e){var n=u.getUploaderGuid(e);return n?u.getSongUrlFromUploaderGuid(n):"https://"+e},isYouTubeUrl:function(e){return/^https?:\/\/((www|m)\.)?youtube\.com/i.test(e)},isNicovideoUrl:function(e){return/^https?:\/\/(www\.)?nicovideo.jp/i.test(e)},isVideoSiteUrl:function(e){return u.isYouTubeUrl(e)||u.isNicovideoUrl(e)}},p=/^https:\/\/songle\.jp\/api\/v[0-9]+\/users\/(.+)\/uploads\/(.+)$/,l={isUploaderUrl:function(e){return p.test(e)},parseUploaderUrl:function(e){var n=p.exec(e);return n?{user:n[1],identifier:n[2]}:{user:null,identifier:null}}},a=function(){function e(){}return e.prototype.isLicenseLoading=function(e){return!e||!e.song||void 0===e.lyrics||void 0===e.backgroundImage},e.prototype.checkLicenses=function(e){return!this.isLicenseLoading(e)&&this.checkLicense(e.song)&&this.checkLicense(e.lyrics)&&this.checkLicense(e.backgroundImage)},e.prototype.checkLicense=function(e){return null===e||(1===e.contentType?this.checkMusicLicense(e.license):2===e.contentType?this.checkTextLicense(e.license):0===e.contentType&&(!!this.isBackgroundColorAsset(e)||this.checkBackgroundImageLicense(e.license)))},e.prototype.checkMusicLicense=function(e){return e.condition&&e.condition.uploader||!(!e.condition||e.condition.ns||e.condition.nc||e.condition.org||e.condition.clb)},e.prototype.checkTextLicense=function(e){return e.condition&&e.condition.uploader||!(!e.condition||e.condition.ns||e.condition.org||e.condition.clb)},e.prototype.checkBackgroundImageLicense=function(e){return!(!e.condition||e.condition.ns||e.condition.nc||e.condition.org||e.condition.clb)},e.prototype.isUploaderAsset=function(e){return e&&e.url&&(u.isUploaderUrl(e.url)||l.isUploaderUrl(e.url))},e.prototype.isBlankBackgroundAsset=function(e){return!e||!e.originalUrl},e.prototype.isBackgroundColorAsset=function(e){var n=e&&e.originalUrl?e.originalUrl:"";return/^#[0-9a-fA-F]{3,6}$/.test(n)},e.prototype.isBackgroundPiaproImageAsset=function(e){var n=e&&e.originalUrl?e.originalUrl:"";return/^(http|https):\/\/(www\.)?piapro\.jp\/.+$/.test(n)},e.prototype.isBackgroundSpecialImageAsset=function(e){var n=e&&e.originalUrl?e.originalUrl:"";return/^snowmiku2016-([0-9]{2})$/.test(n)},e.prototype.getQueryParameter=function(e){return!e||e.license&&!this.checkBackgroundImageLicense(e.license)?null:e.originalUrl},e}();exports.AssetManager=a,exports.LyricsURLManager=l,exports.SongURLManager=u,exports.UnitTypes=o,exports.TEXT=t,exports.MUSIC=n,exports.BACKGROUND_IMAGE=e;
},{}],"SXFP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.openWindow=l,exports.VideoManager=exports.UserManager=exports.TextManager=exports.TemplateManager=exports.SongManager=exports.Managers=exports.LyricsManager=exports.FontInfoManager=exports.EndpointManager=exports.AssetManager=void 0;var e=n(require("axios")),t=require("textalive-data");function n(e){return e&&e.__esModule?e:{default:e}}var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))(function(s,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}u((r=r.apply(e,t||[])).next())})}function i(e,t){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var a={fallback:{protocol:"https"},songle:{domain:"songle.jp"},textalive:{domain:"api.textalive.jp"}};function u(e){var t,n,r=0;if(0===e.length)return r;for(t=0,n=e.length;t<n;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r}exports.EndpointManager=a,a.songle.protocol=a.songle.protocol||a.fallback.protocol,a.songle.server=a.songle.protocol+"://"+a.songle.domain,a.textalive.protocol=a.textalive.protocol||a.fallback.protocol,a.textalive.server=a.textalive.protocol+"://"+a.textalive.domain;var c=new(function(n){function s(){return null!==n&&n.apply(this,arguments)||this}return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(s,n),Object.defineProperty(s.prototype,"endpoint",{get:function(){return a.textalive.server+"/etc/license"},enumerable:!0,configurable:!0}),s.prototype.read=function(n,r){return void 0===r&&(r=!0),o(this,void 0,void 0,function(){var s,o;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e.default.get(this.endpoint,{params:{url:n,token:u("ta"+n),skipOptoutCheck:!!r||void 0}})];case 1:return s=i.sent(),[3,3];case 2:return i.sent(),[3,3];case 3:return!s||200!==s.status||s.data&&s.data.error?[2,{originalUrl:null,license:{code:s?s.status:404}}]:((o=s.data).license.code=s.status,o.contentType===t.BACKGROUND_IMAGE&&(o.css='url("'+o.contentUrl+'")'),[2,o])}})})},s}(t.AssetManager));function l(e,t,n,r,s){var o=void 0===window.screenLeft?screen.left:window.screenLeft,i=void 0===window.screenTop?screen.top:window.screenTop,a=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-n/2+o,u=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-r/2+i,c=window.open(e,t,"width="+n+",height="+r+",top="+u+",left="+a+(s?","+s:""));return window.focus&&c.focus(),c}exports.AssetManager=c;var d=new(function(){function t(){this.listeners=[],this.pollingTimeout=null}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return a.textalive.server+"/"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"songleEndpoint",{get:function(){return a.songle.server+"/"},enumerable:!0,configurable:!0}),t.prototype.isLoading=function(){return!!this.userProfile},t.prototype.spoof=function(e){this.userProfile=e},t.prototype.getProfile=function(){return o(this,void 0,void 0,function(){return i(this,function(e){return this.userProfile?[2,this.userProfile]:[2,this.doGetProfile()]})})},t.prototype.doGetProfile=function(){return o(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:this.request||(this.request=e.default.get(this.endpoint+"profile",{withCredentials:!0})),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.request];case 2:return t=n.sent(),this.request=null,t&&200===t.status?(this.emitUserProfile(t.data),[2,this.userProfile]):[2,null];case 3:return n.sent(),[2,null];case 4:return[2]}})})},t.prototype.getMergingUsers=function(){return o(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.default.get(this.endpoint+"profile/merge",{withCredentials:!0})];case 1:return(t=n.sent())&&200===t.status&&t.data?[2,[t.data.user,t.data.mergeWith]]:[2,[null,null]];case 2:return n.sent(),[2,[null,null]];case 3:return[2]}})})},t.prototype.mergeUsers=function(){return o(this,void 0,void 0,function(){var t,n,r,s,o,a;return i(this,function(i){switch(i.label){case 0:return[4,this.getToken()];case 1:t=i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,e.default.post(this.endpoint+"profile/merge",{token:t},{withCredentials:!0})];case 3:if(!(n=i.sent())||200!==n.status||!n.data||!n.data.success)return[2,null];for(r=n.data.user,s=0,o=this.listeners;s<o.length;s++)(a=o[s]).onUserMerged&&a.onUserMerged(r);return[2,r];case 4:return i.sent(),[2,null];case 5:return[2]}})})},t.prototype.isYouTubeUser=function(e){return e&&e.user&&"string"==typeof e.user.youtubeIdString},t.prototype.isPiaproUser=function(e){return e&&e.user&&"string"==typeof e.user.piaproIdString},t.prototype.isSongleUser=function(e){return e&&e.user&&("number"==typeof e.user.songleUserId&&e.user.songleUserId>=0||"string"==typeof e.user.songleAccessToken)},t.prototype.isSpoofingSongleUser=function(e){return this.isSongleUser(e)&&("number"!=typeof e.user.id||e.user.id<0)},t.prototype.addListener=function(e){e&&this.listeners.push(e)},t.prototype.removeListener=function(e){this.listeners=this.listeners.filter(function(t){return t!==e})},t.prototype.emitUserProfile=function(e){this.userProfile=e;for(var t=0,n=this.listeners;t<n.length;t++){var r=n[t];r.onUserProfileUpdated&&r.onUserProfileUpdated(e),this.userProfile.user?r.onUserLoggedIn&&r.onUserLoggedIn(e.user):r.onUserLoggedOut&&r.onUserLoggedOut()}},t.prototype.authenticate=function(t,n){return o(this,void 0,void 0,function(){var r;return i(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,e.default.get(this.endpoint+"profile/logins/basic",{auth:{username:String(t),password:n},withCredentials:!0})];case 1:return(r=s.sent())&&200===r.status&&r.data?[2,r.data]:[2,null];case 2:return s.sent(),[2,null];case 3:return[2]}})})},t.prototype.loginTwitter=function(e){return this.login(e,"twitter")},t.prototype.loginGitHub=function(e){return this.login(e,"github")},t.prototype.loginYouTube=function(e){return this.login(e,"youtube")},t.prototype.loginPiapro=function(e){return this.login(e,"piapro")},t.prototype.loginSongle=function(e){return this.login(e,"songle")},t.prototype.login=function(e,t){return e&&e.preventDefault(),!!t&&(l(this.endpoint+"profile/logins/"+t,"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1)},t.prototype.logoutTwitter=function(e){return this.logout(e,"twitter")},t.prototype.logoutGitHub=function(e){return this.logout(e,"github")},t.prototype.logoutYouTube=function(e){return this.logout(e,"youtube")},t.prototype.logoutPiapro=function(e){return this.logout(e,"piapro")},t.prototype.logoutSongle=function(e){return this.logout(e,"songle")},t.prototype.logout=function(e,t){return void 0===t&&(t=null),e&&e.preventDefault(),l(this.endpoint+"profile/logouts/"+(t||"all"),"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1},t.prototype.startMonitoringAuthState=function(){var e=this;this.pollingTimeout&&(clearTimeout(this.pollingTimeout),this.pollingTimeout=null);var t=function(n){if(n.data&&n.data.textalive){if(n.source.postMessage("close",n.origin),n.data.merge)return e.getMergingUsers().then(function(t){for(var n=t[0],r=t[1],s=0,o=e.listeners;s<o.length;s++){var i=o[s];i.onUserMergeRequired&&i.onUserMergeRequired(n,r)}}).catch(function(e){}),void window.removeEventListener("message",t);e.doGetProfile(),window.removeEventListener("message",t)}};window.addEventListener("message",t)},t.prototype.getToken=function(){return o(this,void 0,void 0,function(){return i(this,function(e){return this.userProfile?[2,this.userProfile.status.token]:this.token?[2,this.token]:[2,this.doGetToken()]})})},t.prototype.doGetToken=function(){var t;return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(this.endpoint+"profile/token",{withCredentials:!0})];case 1:return n=r.sent(),(null===(t=null==n?void 0:n.data)||void 0===t?void 0:t.token)&&(this.token=n.data.token),[2,this.token];case 2:return r.sent(),[2,""];case 3:return[2]}})})},t}()),p=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return a.textalive.server+"/text-parser/"},enumerable:!0,configurable:!0}),t.prototype.parse=function(t){return o(this,void 0,void 0,function(){var n,r;return i(this,function(s){switch(s.label){case 0:return[4,d.getToken()];case 1:n=s.sent(),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.default.post(this.endpoint,{text:t,token:n},{withCredentials:!0,responseType:"json"})];case 3:return(r=s.sent())&&200===r.status?[2,r.data]:[2,null];case 4:return s.sent(),[2,null];case 5:return[2]}})})},t}()),f=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return a.textalive.server+"/fonts"},enumerable:!0,configurable:!0}),t.prototype.listAvailableFonts=function(){return o(this,void 0,void 0,function(){var e=this;return i(this,function(t){switch(t.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:t.sent(),t.label=2;case 2:return this.data&&this.data.fontFamilies?[2,Object.keys(this.data.fontFamilies).map(function(t){return s({key:t},e.data.fontFamilies[t])})]:[2,[]]}})})},t.prototype.getFrequentChars=function(){return o(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:e.sent(),e.label=2;case 2:return[2,this.data&&this.data.frequentChars||""]}})})},t.prototype.fetchInfo=function(){return o(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.default.get(this.endpoint+"/index.json")];case 1:return(t=n.sent())&&200===t.status?(this.data=t.data,[3,3]):[2,null];case 2:return n.sent(),this.data=null,[3,3];case 3:return[2]}})})},t}());function h(e){return function(e){var t=new RegExp("[\\u4E00-\\u9FAF|\\uFF66-\\uFF9D|\\u31F0-\\u31FF]+[\\(]([\\u3041-\\u3096\\u309D-\\u309F]+)[\\)]","g");return e.replace(t,function(e,t){return t})}(function(e){for(var t,n,r,s,o,i=new RegExp("[(]?(.)[)]?","g");null!==(n=i.exec(e));)r=n[1],s=new RegExp("^("+r+"[\\s\\S]+?)(?=\\n\\n[^\\u3000|\\s])","m"),null!==(o=e.match(s))&&(t=o[1].replace(new RegExp("^"+r,"m"),"").replace(new RegExp("^\\n"),"").replace(new RegExp("^\\u3000","mg"),""),e=(e=e.replace(s,function(e,n){return t})).replace(new RegExp("[\\(]?"+r+"[\\)]?","g"),t).replace(new RegExp("^"+r,"m"),""));return e}(function(e){var t,n=e.split(/\n/);return n.forEach(function(e,n){e.match(/^\S+\S+$/m)&&(t=n)}),void 0!==t&&t<5?n.slice(t+1).join("\n"):e}(e.replace(/^\ufeff/,"").replace(/\r/,"").split(/\n/).filter(y).filter(function(e){return!e.match(/^#/)}).join("\n").replace(/^\s+/,"")).split(/\n/).filter(y).join("\n"))).split(/\n/).filter(v).join("\n").replace(/\n\n+/g,"\n\n").replace(/\n+$/g,"\n")}exports.FontInfoManager=f,exports.TextManager=p,exports.UserManager=d;var g=new RegExp("\\b([CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*(?:[CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*)*\\-){2}");function y(e,t,n){return!g.test(e)&&!e.match(/[\(].+(?:|).*[\)]/)&&(!e.match(/(|).+(|)/)||0!==t&&t!==n.length-2)}function v(e,t,n){return!e.match(new RegExp("[(]?"))}var b={},w={};function m(e,t,n){var r=this;return n&&console.log("parse lyrics: loading",e),new Promise(function(s,a){try{var u=document.createElement("script"),c=null;window.module&&(c=window.module,delete window.module),u.src=e,u.onload=function(){return o(r,void 0,void 0,function(){var r,o;return i(this,function(i){switch(i.label){case 0:document.body.removeChild(u),n&&console.log("parse lyrics: load",e),window.Songle&&window.Songle.Utils&&window.Songle.Utils.url2Lyric||(c&&(window.module=c),a("url2Lyric not found")),i.label=1;case 1:return i.trys.push([1,3,4,5]),r=s,[4,t()];case 2:return r.apply(void 0,[i.sent()]),[3,5];case 3:return o=i.sent(),a(o),[3,5];case 4:return c&&(window.module=c),[7];case 5:return[2]}})})},u.onerror=function(e){return a(e.message)},document.body.appendChild(u)}catch(t){console.error("failed to call lyrics parser",e,t)}})}var U=new(function(){function n(){}return Object.defineProperty(n.prototype,"endpoint",{get:function(){return a.songle.server+"/lyrics/"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localLyricsEndpoint",{get:function(){return a.textalive.server+"/etc/lyrics"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"timingEndpoint",{get:function(){return a.songle.server+"/songs/"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lyricsParserEndpoint",{get:function(){return a.songle.server},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lyricsPostEndpoint",{get:function(){return a.songle.server},enumerable:!0,configurable:!0}),n.prototype.isUploaderUrl=function(e){return t.LyricsURLManager.isUploaderUrl(e)},n.prototype.parseUploaderUrl=function(e){return t.LyricsURLManager.parseUploaderUrl(e)},n.prototype.getRecentlySynchronizedCount=function(){return o(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.default.get(this.endpoint+"recently_synchronized_count.json")];case 1:return(t=n.sent())&&200===t.status?[2,t.data?t.data.count:-1]:[2,-1];case 2:return n.sent(),[2,-1];case 3:return[2]}})})},n.prototype.getRecentlySynchronizedList=function(t,n){return void 0===t&&(t=1),o(this,void 0,void 0,function(){var r;return i(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e.default.get(this.endpoint+"recently_synchronized.json",{params:s({page:t},n)})];case 1:return(r=o.sent())&&200===r.status?[2,r.data]:[2,null];case 2:return o.sent(),[2,null];case 3:return[2]}})})},n.prototype.load=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(this.timingEndpoint+t+"/lyrics.json")];case 1:return(n=r.sent())&&200===n.status?[2,n.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}})})},n.prototype.loadDetail=function(t,n){return o(this,void 0,void 0,function(){var r,s;return i(this,function(o){switch(o.label){case 0:if(b[t]&&b[t][n])return[2,b[t][n]];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e.default.get(this.timingEndpoint+t+"/lyrics/"+(n<0?"latest":n)+".json")];case 2:return(s=o.sent())&&200===s.status?(r=s.data,[3,4]):[2,null];case 3:return o.sent(),[2,null];case 4:return b[t]||(b[t]={}),b[t][r.id]=r,n<0&&(b[t][-1]=r),[2,r]}})})},n.prototype.loadDiffs=function(t,n){return o(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(this.timingEndpoint+t+"/lyrics/"+n+"/diffs.json")];case 1:return[2,r.sent().data];case 2:return r.sent(),[2,null];case 3:return[2]}})})},n.prototype.loadDiff=function(t,n,r){return o(this,void 0,void 0,function(){return i(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,e.default.get(this.timingEndpoint+t+"/lyrics/"+n+(r<0?"":0===r?"/original":"/diffs/"+r+"/lyrics")+".json")];case 1:return[2,s.sent().data];case 2:return s.sent(),[2,null];case 3:return[2]}})})},n.prototype.loadAllRevisionsForSong=function(e){return o(this,void 0,void 0,function(){var t,n,r,s,o,a,u,c,l,d;return i(this,function(i){switch(i.label){case 0:return[4,this.load(e)];case 1:t=i.sent(),n=[],r=0,s=t.lyrics,i.label=2;case 2:return r<s.length?(o=s[r],[4,this.loadDetail(e,o.id)]):[3,6];case 3:return a=i.sent(),[4,this.loadDiffs(e,a.id)];case 4:if(u=i.sent(),n.push({lyrics:a,updated_at:new Date(a.created_at)}),Array.isArray(u))for(c=0,l=u;c<l.length;c++)d=l[c],n.push({diff_id:d.id,source_id:d.source_id,lyrics:a,updated_at:new Date(d.updated_at)});i.label=5;case 5:return r++,[3,2];case 6:return[2,n.sort(function(e,t){var n=t.updated_at.getTime()-e.updated_at.getTime();return 0===n?t.diff_id-e.diff_id:n})]}})})},n.prototype.getLatestRevision=function(e){return e.filter(function(e){return!(e.lyrics.processing||e.lyrics.failed)})[0]},n.prototype.fetchLocalLyricBody=function(t){return o(this,void 0,void 0,function(){var n,r,s;return i(this,function(o){switch(o.label){case 0:return this.verbose&&console.log("load locally-stored lyrics for song code",t),[4,e.default.get(this.localLyricsEndpoint+"/token",{params:{code:t}})];case 1:if(!(n=o.sent())||200!==n.status||n.data.error)return[2,null];o.label=2;case 2:return o.trys.push([2,4,,5]),r=n.data.token,[4,e.default.get(this.localLyricsEndpoint,{params:{code:t,token:r}})];case 3:return!(s=o.sent())||200!==s.status||s.data.error?[2,null]:(this.verbose&&console.log("loaded locally-stored lyrics",this.localLyricsEndpoint+"?code="+t+"&token="+r),[2,s.data.text]);case 4:return o.sent(),[2,null];case 5:return[2]}})})},n.prototype.fetchSongleLyricBody=function(t,n){return o(this,void 0,void 0,function(){var r,s,o,u,c,l,p,f,h,g,y;return i(this,function(i){switch(i.label){case 0:if(!(r=this.parseUploaderUrl(t)).identifier)throw new Error("unsupported lyrics url "+t);return[4,d.getProfile()];case 1:if(s=i.sent(),!d.isSongleUser(s))throw new Error("Songle authentication is required");return w[o=t+"//"+n]?[2,w[o]]:(d.isSpoofingSongleUser(s)&&(c=s.user,l=c.songleUserId,p=c.songleAccessToken,f=c.songleRefreshToken,u={songleUserId:l,songleAccessToken:p,songleRefreshToken:f}),h=a.textalive.server+"/songle/users/"+r.user+"/uploads/"+r.identifier,[4,e.default.get(h,{withCredentials:!0,params:u})]);case 2:return g=i.sent(),(y=g.data)&&(w[o]=y),[2,y]}})})},n.prototype.fetchInternalLyricBody=function(t,n){return o(this,void 0,void 0,function(){var r,s,o,a,u;return i(this,function(i){switch(i.label){case 0:if(r=new URL(t),"undefined"==typeof location||location.protocol!==r.protocol||location.hostname!==r.hostname)throw new Error("direct access not supported for lyrics url "+t);return w[s=t+"//"+n]?[2,w[s]]:[4,e.default.get(t,{responseType:"text"})];case 1:return o=i.sent(),a=o.data,[4,this.parseLyricBody(a,n)];case 2:return(u=i.sent())&&(w[s]=u),[2,u]}})})},n.prototype.parseLyricBody=function(e,t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,m(this.lyricsParserEndpoint+t,function(){return window.Songle.Utils.parseLyric(e)},this.verbose)];case 1:return n=r.sent(),[3,3];case 2:return r.sent(),n=h(e),[3,3];case 3:return[2,n]}})})},n.prototype.fetchLyricBody=function(e,t){return o(this,void 0,void 0,function(){var n,r,s;return i(this,function(o){switch(o.label){case 0:if(this.isUploaderUrl(e))return[2,this.fetchSongleLyricBody(e,t)];try{if(n=new URL(e),"undefined"!=typeof location&&location.protocol===n.protocol&&location.hostname===n.hostname)return this.verbose&&console.log("load lyrics from the same server",e),[2,this.fetchInternalLyricBody(e,t)]}catch(e){}return w[r=e+"//"+t]?[2,w[r]]:(this.verbose&&console.log("load lyrics from the external server",e),[4,m(this.lyricsParserEndpoint+t,function(){return new Promise(function(t,n){window.Songle.Utils.url2Lyric(e,function(e){return t(e)},function(e){return n(e)})})},this.verbose)]);case 1:return s=o.sent(),w[r]=s,[2,s]}})})},n.prototype.post=function(t){return o(this,void 0,void 0,function(){var n,r;return i(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),n=t.forceUpdate?{url:t.lyricsUrl,force_create:"true"}:{url:t.lyricsUrl},[4,e.default.post(this.lyricsPostEndpoint+"/songs/"+t.songId+"/lyrics.json",n,{responseType:"json"})];case 1:return[2,{success:200===(r=s.sent()).status,lyricsId:r.data.id}];case 2:return[2,{success:!1,error:s.sent().message}];case 3:return[2]}})})},n.prototype.postPrivate=function(t){return o(this,void 0,void 0,function(){var n,r,s,o,u,c,l,p,f,h,g,y;return i(this,function(i){switch(i.label){case 0:return[4,d.getProfile()];case 1:if(n=i.sent(),!d.isSongleUser(n))throw new Error("Songle authentication is required");d.isSpoofingSongleUser(n)?(s=n.user,o=s.songleUserId,u=s.songleAccessToken,c=s.songleRefreshToken,l={songleUserId:o,songleAccessToken:u,songleRefreshToken:c},r="?"+Object.keys(l).map(function(e){return e+"="+encodeURIComponent(l[e])}).join("&")):r="",p=t.songId,f=t.lyricsText,(h=new FormData).append("text",f),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,e.default.post(a.textalive.server+"/songle/me/songs/"+p+"/lyrics.json"+r,h,{withCredentials:!0})];case 3:return g=i.sent(),y=g.data.data.lyric,[2,{success:200===g.status,error:null,lyrics:y}];case 4:return[2,{success:!1,error:i.sent().message}];case 5:return[2]}})})},n.prototype.update=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.post(this.lyricsPostEndpoint+"/songs/"+t.songCode+"/lyrics/"+t.lyricsId+"/diffs.json",t.lyricsData?{lyric:JSON.stringify(t.lyricsData)}:{source_diff_id:t.lyricsDiffId},{responseType:"json"})];case 1:return[2,(n=r.sent()).data&&n.data.lyric_diff?{success:200===n.status,lyricsId:n.data.lyric_diff.lyric_id,lyricsDiffId:n.data.lyric_diff.id}:{success:200===n.status}];case 2:return[2,{success:!1,error:r.sent().message}];case 3:return[2]}})})},n}()),S={},k={},x=new(function(){function n(){}return Object.defineProperty(n.prototype,"endpoint",{get:function(){return a.textalive.server},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"songleEndpoint",{get:function(){return a.songle.server},enumerable:!0,configurable:!0}),n.prototype.getSongPathFromUrl=function(e){return t.SongURLManager.getSongPathFromUrl(e)},n.prototype.isUploaderUrl=function(e){return t.SongURLManager.isUploaderUrl(e)},n.prototype.isUploaderPath=function(e){return t.SongURLManager.isUploaderPath(e)},n.prototype.getUploaderGuid=function(e){return t.SongURLManager.getUploaderGuid(e)},n.prototype.getSongUrlFromUploaderGuid=function(e){return t.SongURLManager.getSongUrlFromUploaderGuid(e)},n.prototype.getSongUrlFromPath=function(e){return t.SongURLManager.getSongUrlFromPath(e)},n.prototype.isYouTubeUrl=function(e){return t.SongURLManager.isYouTubeUrl(e)},n.prototype.isNicovideoUrl=function(e){return t.SongURLManager.isNicovideoUrl(e)},n.prototype.isVideoSiteUrl=function(e){return t.SongURLManager.isVideoSiteUrl(e)},n.prototype.load=function(e){return o(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:return t=e.code||"number"==typeof e.id&&String(e.id)||encodeURIComponent(e.songPath),S[t]?[2,S[t]]:(S[t]=this.doLoad(t),[4,S[t]]);case 1:return n=r.sent(),this.use(n),[2,n]}})})},n.prototype.use=function(e){if(e){var t=String(e.song.id),n=e.song.code,r=this.getSongPathFromUrl(e.song.permalink);S[t]=S[n]=S[r]=Promise.resolve(e)}},n.prototype.doLoad=function(t){return o(this,void 0,void 0,function(){var n,r,o;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),[4,e.default.get(this.songleEndpoint+"/songs/"+t+"?format=json")];case 1:if(!(n=i.sent())||200!==n.status)return[2,null];if(r=n.data,!this.isUploaderUrl(r.song.permalink))return[3,5];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.doLoadPrivateSong(r.song.id)];case 3:return(o=i.sent())?[2,s(s({},r),{song:o})]:[3,5];case 4:return i.sent(),[3,5];case 5:return[2,r];case 6:return i.sent(),[2,null];case 7:return[2]}})})},n.prototype.doLoadPrivateSong=function(t){return o(this,void 0,void 0,function(){var n,r,s,o,a,u,c;return i(this,function(i){switch(i.label){case 0:return[4,d.getProfile()];case 1:if(n=i.sent(),!d.isSongleUser(n))return[2,null];d.isSpoofingSongleUser(n)&&(s=n.user,o=s.songleUserId,a=s.songleAccessToken,u=s.songleRefreshToken,r={songleUserId:o,songleAccessToken:a,songleRefreshToken:u}),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,e.default.get(this.endpoint+"/songle/me/songs/"+t+".json",{withCredentials:!0,params:r})];case 3:return(c=i.sent())&&200===c.status&&c.data&&c.data.data&&c.data.data.song?[2,c.data.data.song]:[2,null];case 4:return i.sent(),[2,null];case 5:return[2]}})})},n.prototype.loadInfo=function(e){return o(this,void 0,void 0,function(){return i(this,function(t){return k[e]||(k[e]=this.doLoadInfo(e)),[2,k[e]]})})},n.prototype.doLoadInfo=function(t){return o(this,void 0,void 0,function(){var n,r;return i(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),n={min:1},[4,e.default.get(this.songleEndpoint+"/songs/"+t+"/info.json",{params:n})];case 1:return(r=s.sent())&&200===r.status?[2,r.data]:[2,null];case 2:return s.sent(),[2,null];case 3:return[2]}})})},n.prototype.loadVocalAmplitude=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(this.songleEndpoint+"/songs/"+t+"/vamplitude.json")];case 1:return(n=r.sent())&&200===n.status&&n.data?[2,n.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}})})},n.prototype.loadValenceArousal=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(this.songleEndpoint+"/songs/"+t+"/av.json")];case 1:return(n=r.sent())&&200===n.status&&n.data?[2,n.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}})})},n.prototype.list=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:void 0===t&&(t={}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.default.get(this.endpoint+"/songs",{params:t})];case 2:return(n=r.sent())&&200===n.status?[2,n.data]:[2,null];case 3:return r.sent(),[2,null];case 4:return[2]}})})},n.prototype.listPrivate=function(){return o(this,void 0,void 0,function(){var t,n,r,o,a,u,c,l;return i(this,function(i){switch(i.label){case 0:return[4,d.getProfile()];case 1:if(t=i.sent(),!d.isSongleUser(t))return[2,{data:null,error:{code:401,message:"Songle authentication is required"}}];d.isSpoofingSongleUser(t)&&(r=t.user,o=r.songleUserId,a=r.songleAccessToken,u=r.songleRefreshToken,n={songleUserId:o,songleAccessToken:a,songleRefreshToken:u}),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,e.default.get(this.endpoint+"/songle/me/songs.json",{withCredentials:!0,params:s(s({},n),{private:!0})})];case 3:return(c=i.sent())&&200===c.status?[2,c.data]:[2,{data:null,error:{code:c.status,message:c.data.message}}];case 4:return[2,{data:null,error:{code:(l=i.sent()).response&&l.response.status?l.response.status:-1,message:l.response&&l.response.data?l.response.data.message:l.message}}];case 5:return[2]}})})},n.prototype.create=function(e){return o(this,void 0,void 0,function(){return i(this,function(t){return[2,this.doCreate(e,!1)]})})},n.prototype.createPrivate=function(e){return o(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return[4,d.getProfile()];case 1:return t=n.sent(),d.isSongleUser(t)?[2,this.doCreate(e,!0)]:[2,{success:!1,song:null,error:"Songle authentication is required"}]}})})},n.prototype.doCreate=function(t,n){return o(this,void 0,void 0,function(){var r,s,o,a,u,c;return i(this,function(i){switch(i.label){case 0:return r=t.url,s=t.name,o=t.artistName,[4,d.getToken()];case 1:a=i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,e.default.post(n?this.endpoint+"/etc/songs/private":this.endpoint+"/etc/songs",{token:a,url:r,name:s,artist:o},{withCredentials:!0})];case 3:return(u=i.sent())&&200===u.status?n?[2,{success:!0,song:u.data.data.song}]:[2,{success:!0,song:u.data.song}]:[2,{success:!1,error:(u.data.data?u.data.data:u.data).message}];case 4:return c=i.sent(),console.error(c),[2,{success:!1,error:c.response&&c.response.data?c.response.data.message:c.message}];case 5:return[2]}})})},n.prototype.uploadPrivate=function(t){return o(this,void 0,void 0,function(){var n,r,s,o,a,u,c,l,p;return i(this,function(i){switch(i.label){case 0:return[4,d.getProfile()];case 1:if(n=i.sent(),!d.isSongleUser(n))throw new Error("Songle authentication is required");d.isSpoofingSongleUser(n)?(s=n.user,o=s.songleUserId,a=s.songleAccessToken,u=s.songleRefreshToken,c={songleUserId:o,songleAccessToken:a,songleRefreshToken:u},r="?"+Object.keys(c).map(function(e){return e+"="+encodeURIComponent(c[e])}).join("&")):r="",i.label=2;case 2:return i.trys.push([2,4,,5]),(l=new FormData).append("file",t),[4,e.default.post(this.endpoint+"/songle/me/uploads.json"+r,l,{withCredentials:!0})];case 3:return(p=i.sent())&&200===p.status&&p.data?[2,p.data.data]:[3,5];case 4:return i.sent(),[3,5];case 5:return[2,null]}})})},n.prototype.search=function(t,n){return void 0===n&&(n=!0),o(this,void 0,void 0,function(){var r;return i(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,e.default.get(this.songleEndpoint+"/songs/search.json",{params:{q:t,lyrics:n?1:0}})];case 1:return(r=s.sent())&&200===r.status?[3,3]:[2,{success:!1}];case 2:return s.sent(),[3,3];case 3:return r&&r.data&&r.data?[2,{success:!0,data:r.data}]:r?[2,{success:!1,error:r.data}]:[2,{success:!1}]}})})},n.prototype.copySongMap=function(t){return o(this,void 0,void 0,function(){var n,r,s,o;return i(this,function(i){switch(i.label){case 0:n=t.sourceId,r=t.destinationId,s=t.types||["beat","chord","chorus","melody"],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.default.post(this.endpoint+"/songle/me/songs/"+r+"/actions/copy_music_map.json",{source_id:n,types:s},{withCredentials:!0,responseType:"json"})];case 2:return o=i.sent(),[3,4];case 3:return i.sent(),[3,4];case 4:return o&&o.data&&o.data.success?[2,{success:!0}]:o?[2,{success:!1,error:o.data}]:[2,{success:!1}]}})})},n.prototype.createStage=function(){return o(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:return[4,d.getProfile()];case 1:t=r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.default.post(this.endpoint+"/etc/songs/stage",{token:t.status.token},{withCredentials:!0})];case 3:return[2,(n=r.sent())?n.data:null];case 4:return r.sent(),[2,null];case 5:return[2]}})})},n}()),P=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return a.textalive.server+"/templates/"},enumerable:!0,configurable:!0}),t.prototype.list=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(""+this.endpoint,{params:t})];case 1:return(n=r.sent())&&200===n.status?[2,n.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}})})},t.prototype.load=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(""+(this.endpoint+t),{params:{format:"json"}})];case 1:return(n=r.sent())&&200===n.status?[2,n.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}})})},t.prototype.loadByName=function(t){return o(this,void 0,void 0,function(){var n,r,s;return i(this,function(o){switch(o.label){case 0:r="latest",t&&(n=t.match(/(.+)@([0-9]+)/))&&(t=n[1],r=n[2]),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e.default.get(this.endpoint+t+"/"+r,{params:{format:"json"}})];case 2:return(s=o.sent())&&200===s.status?[2,s.data]:"latest"!==r?[2,this.loadByName(t)]:[2,null];case 3:return o.sent(),[2,null];case 4:return[2]}})})},t.prototype.loadForVideo=function(t,n){return void 0===n&&(n={withoutAuthors:!0,withScript:!0}),o(this,void 0,void 0,function(){var r;return i(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,e.default.get(this.endpoint+"for/"+t,{params:n})];case 1:return(r=s.sent())&&200===r.status?[2,r.data]:[2,null];case 2:return s.sent(),[2,null];case 3:return[2]}})})},t.prototype.create=function(t){return o(this,void 0,void 0,function(){var n,r,o;return i(this,function(i){switch(i.label){case 0:return[4,d.getToken()];case 1:n=i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,e.default.post(this.endpoint,s(s({},t),{token:n}),{withCredentials:!0})];case 3:return(r=i.sent())?200!==r.status||Array.isArray(r.data)||r.data.error?(o=Array.isArray(r.data)?{parseErrors:r.data}:r.data,[2,s(s({},o),{success:!1})]):[2,s(s({},r.data),{success:!0})]:[2,{success:!1}];case 4:return[2,{error:i.sent().message,success:!1}];case 5:return[2]}})})},t.prototype.listContributors=function(t,n){return o(this,void 0,void 0,function(){var r;return i(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,e.default.get(""+this.endpoint+t+"/"+n+"/contributors",{withCredentials:!0})];case 1:return(r=s.sent())&&200===r.status?[2,r.data]:[2,null];case 2:return s.sent(),[2,null];case 3:return[2]}})})},t}()),T=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return a.textalive.server+"/videos/"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rendererEndpoint",{get:function(){return a.textalive.server+"/renderer/"},enumerable:!0,configurable:!0}),t.prototype.load=function(t){return o(this,void 0,void 0,function(){var n,r,o,a,u,c,l;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),n={format:"json"},[4,d.getProfile()];case 1:return r=i.sent(),d.isSpoofingSongleUser(r)&&(o=r.user,a=o.songleUserId,u=o.songleAccessToken,c=o.songleRefreshToken,n=s(s({},n),{songleUserId:a,songleAccessToken:u,songleRefreshToken:c})),[4,e.default.get(""+(this.endpoint+t),{params:n,withCredentials:!0})];case 2:return(l=i.sent())&&200===l.status?[2,l.data]:[2,null];case 3:return i.sent(),[2,null];case 4:return[2]}})})},t.prototype.create=function(t){return o(this,void 0,void 0,function(){var n,r;return i(this,function(o){switch(o.label){case 0:return[4,d.getToken()];case 1:n=o.sent(),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e.default.post(this.endpoint,s(s({},t),{token:n}),{withCredentials:!0})];case 3:return(r=o.sent())?200!==r.status||r.data.error?[2,s(s({},r.data),{success:!1})]:[2,s(s({},r.data),{success:!0})]:[2,{success:!1}];case 4:return[2,{error:o.sent().message,success:!1}];case 5:return[2]}})})},t.prototype.delete=function(t){return o(this,void 0,void 0,function(){var n,r;return i(this,function(s){switch(s.label){case 0:return[4,d.getToken()];case 1:n=s.sent(),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.default.post(this.endpoint+"delete",{token:n,id:t},{withCredentials:!0})];case 3:return(r=s.sent())&&200===r.status?[2,{success:!0,video:r.data}]:[2,{success:!1,video:null}];case 4:return[2,{success:!0,error:s.sent(),video:null}];case 5:return[2]}})})},t.prototype.listContributors=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(""+this.endpoint+t+"/contributors",{withCredentials:!0})];case 1:return(n=r.sent())&&200===n.status?[2,n.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}})})},t.prototype.listRenderings=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(this.rendererEndpoint+"list",{params:{videoId:t},withCredentials:!0})];case 1:return(n=r.sent())&&200===n.status?[2,n.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}})})},t.prototype.getRenderingStatus=function(t){return o(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.default.get(this.rendererEndpoint+"status",{params:{id:t},withCredentials:!0})];case 1:return(n=r.sent())&&200===n.status?[2,n.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}})})},t.prototype.render=function(t,n,r){return o(this,void 0,void 0,function(){var s,o,a;return i(this,function(i){switch(i.label){case 0:return[4,d.getToken()];case 1:s=i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),o={token:s,videoId:t,quality:n},r&&(o.authentication=!0),[4,e.default.post(this.rendererEndpoint+"render",o,{withCredentials:!0})];case 3:return(a=i.sent())&&200===a.status?[2,a.data]:[2,null];case 4:return i.sent(),[2,null];case 5:return[2]}})})},t.prototype.getDownloadInfo=function(){return o(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return e={endpoint:this.rendererEndpoint+"download"},[4,d.getToken()];case 1:return[2,(e.token=t.sent(),e)]}})})},t}()),j={asset:c,endpoint:a,lyrics:U,song:x,template:P,text:p,font:f,user:d,video:T};exports.Managers=j,exports.VideoManager=T,exports.TemplateManager=P,exports.SongManager=x,exports.LyricsManager=U;
},{"axios":"dZBD","textalive-data":"Lo92"}],"lAPL":[function(require,module,exports) {
var define;
var e;!function(r,t){"object"==typeof exports&&"object"==typeof module?t(exports):"function"==typeof e&&e.amd?e(["exports"],t):t(r.acorn||(r.acorn={}))}(this,function(e){"use strict";var r,t,n,a;e.version="0.4.1",e.parse=function(e,a){return t=String(e),n=t.length,i(a),He(),function(e){v=y=s,r.locations&&(g=new Pe);x=w=null,k=[],Ye();var t=e||lr(),n=!0;e||(t.body=[]);for(;d!==F;){var a=wr();t.body.push(a),n&&pr(a)&&sr(!0),n=!1}return dr(t,"Program")}(r.program)};var o=e.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function i(e){for(var t in r=e||{},o)Object.prototype.hasOwnProperty.call(r,t)||(r[t]=o[t]);a=r.sourceFile||null}var s,c,u,l,f,d,p,m,h,b,v,y,g,x,k,w,C=e.getLineInfo=function(e,r){for(var t=1,n=0;;){Ne.lastIndex=n;var a=Ne.exec(e);if(!(a&&a.index<r))break;++t,n=a.index+a[0].length}return{line:t,column:r-n}};function E(e,r){var n=C(t,e);r+=" ("+n.line+":"+n.column+")";var a=new SyntaxError(r);throw a.pos=e,a.loc=n,a.raisedAt=s,a}e.tokenize=function(e,a){t=String(e),n=t.length,i(a),He();var o={};function v(e){return Ye(e),o.start=c,o.end=u,o.startLoc=l,o.endLoc=f,o.type=d,o.value=p,o}return v.jumpTo=function(e,n){var a;if(s=e,r.locations)for(h=1,b=Ne.lastIndex=0;(a=Ne.exec(t))&&a.index<e;)++h,b=a.index+a[0].length;m=n,Ke()},v};var A=[],S={type:"num"},I={type:"regexp"},L={type:"string"},U={type:"name"},F={type:"eof"},R={keyword:"break"},V={keyword:"case",beforeExpr:!0},T={keyword:"catch"},q={keyword:"continue"},O={keyword:"debugger"},j={keyword:"default"},D={keyword:"do",isLoop:!0},B={keyword:"else",beforeExpr:!0},M={keyword:"finally"},z={keyword:"for",isLoop:!0},X={keyword:"function"},N={keyword:"if"},W={keyword:"return",beforeExpr:!0},J={keyword:"switch"},P={keyword:"throw",beforeExpr:!0},H={keyword:"try"},$={keyword:"var"},_={keyword:"while",isLoop:!0},G={keyword:"with"},K={keyword:"new",beforeExpr:!0},Q={keyword:"this"},Y={keyword:"null",atomValue:null},Z={keyword:"true",atomValue:!0},ee={keyword:"false",atomValue:!1},re={keyword:"in",binop:7,beforeExpr:!0},te={break:R,case:V,catch:T,continue:q,debugger:O,default:j,do:D,else:B,finally:M,for:z,function:X,if:N,return:W,switch:J,throw:P,try:H,var:$,while:_,with:G,null:Y,true:Z,false:ee,new:K,in:re,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:Q,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ne={type:"[",beforeExpr:!0},ae={type:"]"},oe={type:"{",beforeExpr:!0},ie={type:"}"},se={type:"(",beforeExpr:!0},ce={type:")"},ue={type:",",beforeExpr:!0},le={type:";",beforeExpr:!0},fe={type:":",beforeExpr:!0},de={type:"."},pe={type:"?",beforeExpr:!0},me={binop:10,beforeExpr:!0},he={isAssign:!0,beforeExpr:!0},be={isAssign:!0,beforeExpr:!0},ve={postfix:!0,prefix:!0,isUpdate:!0},ye={prefix:!0,beforeExpr:!0},ge={binop:1,beforeExpr:!0},xe={binop:2,beforeExpr:!0},ke={binop:3,beforeExpr:!0},we={binop:4,beforeExpr:!0},Ce={binop:5,beforeExpr:!0},Ee={binop:6,beforeExpr:!0},Ae={binop:7,beforeExpr:!0},Se={binop:8,beforeExpr:!0},Ie={binop:9,prefix:!0,beforeExpr:!0},Le={binop:10,beforeExpr:!0};for(var Ue in e.tokTypes={bracketL:ne,bracketR:ae,braceL:oe,braceR:ie,parenL:se,parenR:ce,comma:ue,semi:le,colon:fe,dot:de,question:pe,slash:me,eq:he,name:U,eof:F,num:S,regexp:I,string:L},te)e.tokTypes["_"+Ue]=te[Ue];function Fe(e){e=e.split(" ");var r="",t=[];e:for(var n=0;n<e.length;++n){for(var a=0;a<t.length;++a)if(t[a][0].length==e[n].length){t[a].push(e[n]);continue e}t.push([e[n]])}function o(e){if(1==e.length)return r+="return str === "+JSON.stringify(e[0])+";";r+="switch(str){";for(var t=0;t<e.length;++t)r+="case "+JSON.stringify(e[t])+":";r+="return true}return false;"}if(t.length>3){t.sort(function(e,r){return r.length-e.length}),r+="switch(str.length){";for(n=0;n<t.length;++n){var i=t[n];r+="case "+i[0].length+":",o(i)}r+="}"}else o(e);return new Function("str",r)}var Re,Ve=Fe("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Te=Fe("class enum extends super const export import"),qe=Fe("implements interface let package private protected public static yield"),Oe=Fe("eval arguments"),je=Fe("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),De=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Be="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Me=new RegExp("["+Be+"]"),ze=new RegExp("["+Be+"------------------------------------------------------------------------------------------------------------------------------------------]"),Xe=/[\n\r\u2028\u2029]/,Ne=/\r\n|[\n\r\u2028\u2029]/g,We=e.isIdentifierStart=function(e){return e<65?36===e:e<91||(e<97?95===e:e<123||e>=170&&Me.test(String.fromCharCode(e)))},Je=e.isIdentifierChar=function(e){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||e>=170&&ze.test(String.fromCharCode(e))))};function Pe(){this.line=h,this.column=s-b}function He(){h=1,s=b=0,m=!0,Ke()}function $e(e,t){u=s,r.locations&&(f=new Pe),d=e,Ke(),p=t,m=e.beforeExpr}function _e(){var e,n=r.onComment&&r.locations&&new Pe,a=s,o=t.indexOf("*/",s+=2);if(-1===o&&E(s-2,"Unterminated comment"),s=o+2,r.locations)for(Ne.lastIndex=a;(e=Ne.exec(t))&&e.index<s;)++h,b=e.index+e[0].length;r.onComment&&r.onComment(!0,t.slice(a+2,o),a,s,n,r.locations&&new Pe)}function Ge(){for(var e=s,a=r.onComment&&r.locations&&new Pe,o=t.charCodeAt(s+=2);s<n&&10!==o&&13!==o&&8232!==o&&8233!==o;)++s,o=t.charCodeAt(s);r.onComment&&r.onComment(!1,t.slice(e+2,s),e,s,a,r.locations&&new Pe)}function Ke(){for(;s<n;){var e=t.charCodeAt(s);if(32===e)++s;else if(13===e){++s,10===(a=t.charCodeAt(s))&&++s,r.locations&&(++h,b=s)}else if(10===e||8232===e||8233===e)++s,r.locations&&(++h,b=s);else if(e>8&&e<14)++s;else if(47===e){var a;if(42===(a=t.charCodeAt(s+1)))_e();else{if(47!==a)break;Ge()}}else if(160===e)++s;else{if(!(e>=5760&&De.test(String.fromCharCode(e))))break;++s}}}function Qe(e){switch(e){case 46:return function(){var e=t.charCodeAt(s+1);return e>=48&&e<=57?tr(!0):(++s,$e(de))}();case 40:return++s,$e(se);case 41:return++s,$e(ce);case 59:return++s,$e(le);case 44:return++s,$e(ue);case 91:return++s,$e(ne);case 93:return++s,$e(ae);case 123:return++s,$e(oe);case 125:return++s,$e(ie);case 58:return++s,$e(fe);case 63:return++s,$e(pe);case 48:var a=t.charCodeAt(s+1);if(120===a||88===a)return function(){s+=2;var e=rr(16);null==e&&E(c+2,"Expected hexadecimal number");We(t.charCodeAt(s))&&E(s,"Identifier directly after number");return $e(S,e)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return tr(!1);case 34:case 39:return function(e){s++;for(var a="";;){s>=n&&E(c,"Unterminated string constant");var o=t.charCodeAt(s);if(o===e)return++s,$e(L,a);if(92===o){o=t.charCodeAt(++s);var i=/^[0-7]+/.exec(t.slice(s,s+3));for(i&&(i=i[0]);i&&parseInt(i,8)>255;)i=i.slice(0,-1);if("0"===i&&(i=null),++s,i)w&&E(s-2,"Octal literal in strict mode"),a+=String.fromCharCode(parseInt(i,8)),s+=i.length-1;else switch(o){case 110:a+="\n";break;case 114:a+="\r";break;case 120:a+=String.fromCharCode(nr(2));break;case 117:a+=String.fromCharCode(nr(4));break;case 85:a+=String.fromCharCode(nr(8));break;case 116:a+="\t";break;case 98:a+="\b";break;case 118:a+="\v";break;case 102:a+="\f";break;case 48:a+="\0";break;case 13:10===t.charCodeAt(s)&&++s;case 10:r.locations&&(b=s,++h);break;default:a+=String.fromCharCode(o)}}else 13!==o&&10!==o&&8232!==o&&8233!==o||E(c,"Unterminated string constant"),a+=String.fromCharCode(o),++s}}(e);case 47:return function(){var e=t.charCodeAt(s+1);return m?(++s,er()):61===e?Ze(be,2):Ze(me,1)}();case 37:case 42:return 61===t.charCodeAt(s+1)?Ze(be,2):Ze(Le,1);case 124:case 38:return function(e){var r=t.charCodeAt(s+1);return r===e?Ze(124===e?ge:xe,2):61===r?Ze(be,2):Ze(124===e?ke:Ce,1)}(e);case 94:return 61===t.charCodeAt(s+1)?Ze(be,2):Ze(we,1);case 43:case 45:return function(e){var r=t.charCodeAt(s+1);return r===e?45==r&&62==t.charCodeAt(s+2)&&Xe.test(t.slice(y,s))?(s+=3,Ge(),Ke(),Ye()):Ze(ve,2):61===r?Ze(be,2):Ze(Ie,1)}(e);case 60:case 62:return function(e){var r=t.charCodeAt(s+1),n=1;return r===e?(n=62===e&&62===t.charCodeAt(s+2)?3:2,61===t.charCodeAt(s+n)?Ze(be,n+1):Ze(Se,n)):33==r&&60==e&&45==t.charCodeAt(s+2)&&45==t.charCodeAt(s+3)?(s+=4,Ge(),Ke(),Ye()):(61===r&&(n=61===t.charCodeAt(s+2)?3:2),Ze(Ae,n))}(e);case 61:case 33:return function(e){return 61===t.charCodeAt(s+1)?Ze(Ee,61===t.charCodeAt(s+2)?3:2):Ze(61===e?he:ye,1)}(e);case 126:return Ze(ye,1)}return!1}function Ye(e){if(e?s=c+1:c=s,r.locations&&(l=new Pe),e)return er();if(s>=n)return $e(F);var a=t.charCodeAt(s);if(We(a)||92===a)return or();var o=Qe(a);if(!1===o){var i=String.fromCharCode(a);if("\\"===i||Me.test(i))return or();E(s,"Unexpected character '"+i+"'")}return o}function Ze(e,r){var n=t.slice(s,s+r);s+=r,$e(e,n)}function er(){for(var e,r,a=s;;){s>=n&&E(a,"Unterminated regular expression");var o=t.charAt(s);if(Xe.test(o)&&E(a,"Unterminated regular expression"),e)e=!1;else{if("["===o)r=!0;else if("]"===o&&r)r=!1;else if("/"===o&&!r)break;e="\\"===o}++s}var i=t.slice(a,s);++s;var c=ar();return c&&!/^[gmsiy]*$/.test(c)&&E(a,"Invalid regexp flag"),$e(I,new RegExp(i,c))}function rr(e,r){for(var n=s,a=0,o=0,i=null==r?1/0:r;o<i;++o){var c,u=t.charCodeAt(s);if((c=u>=97?u-97+10:u>=65?u-65+10:u>=48&&u<=57?u-48:1/0)>=e)break;++s,a=a*e+c}return s===n||null!=r&&s-n!==r?null:a}function tr(e){var r=s,n=!1,a=48===t.charCodeAt(s);e||null!==rr(10)||E(r,"Invalid number"),46===t.charCodeAt(s)&&(++s,rr(10),n=!0);var o=t.charCodeAt(s);69!==o&&101!==o||(43!==(o=t.charCodeAt(++s))&&45!==o||++s,null===rr(10)&&E(r,"Invalid number"),n=!0),We(t.charCodeAt(s))&&E(s,"Identifier directly after number");var i,c=t.slice(r,s);return n?i=parseFloat(c):a&&1!==c.length?/[89]/.test(c)||w?E(r,"Invalid number"):i=parseInt(c,8):i=parseInt(c,10),$e(S,i)}function nr(e){var r=rr(16,e);return null===r&&E(c,"Bad character escape sequence"),r}function ar(){Re=!1;for(var e,r=!0,n=s;;){var a=t.charCodeAt(s);if(Je(a))Re&&(e+=t.charAt(s)),++s;else{if(92!==a)break;Re||(e=t.slice(n,s)),Re=!0,117!=t.charCodeAt(++s)&&E(s,"Expecting Unicode escape sequence \\uXXXX"),++s;var o=nr(4),i=String.fromCharCode(o);i||E(s-1,"Invalid Unicode escape"),(r?We(o):Je(o))||E(s-4,"Invalid Unicode escape"),e+=i}r=!1}return Re?e:t.slice(n,s)}function or(){var e=ar(),t=U;return Re||(je(e)?t=te[e]:(r.forbidReserved&&(3===r.ecmaVersion?Ve:Te)(e)||w&&qe(e))&&E(c,"The keyword '"+e+"' is reserved")),$e(t,e)}function ir(){v=c,y=u,g=f,Ye()}function sr(e){if(w=e,s=y,r.locations)for(;s<b;)b=t.lastIndexOf("\n",b-2)+1,--h;Ke(),Ye()}function cr(){this.type=null,this.start=c,this.end=null}function ur(){this.start=l,this.end=null,null!==a&&(this.source=a)}function lr(){var e=new cr;return r.locations&&(e.loc=new ur),r.directSourceFile&&(e.sourceFile=r.directSourceFile),r.ranges&&(e.range=[c,0]),e}function fr(e){var t=new cr;return t.start=e.start,r.locations&&(t.loc=new ur,t.loc.start=e.loc.start),r.ranges&&(t.range=[e.range[0],0]),t}function dr(e,t){return e.type=t,e.end=y,r.locations&&(e.loc.end=g),r.ranges&&(e.range[1]=y),e}function pr(e){return r.ecmaVersion>=5&&"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"use strict"===e.expression.value}function mr(e){if(d===e)return ir(),!0}function hr(){return!r.strictSemicolons&&(d===F||d===ie||Xe.test(t.slice(y,c)))}function br(){mr(le)||hr()||yr()}function vr(e){d===e?ir():yr()}function yr(){E(c,"Unexpected token")}function gr(e){"Identifier"!==e.type&&"MemberExpression"!==e.type&&E(e.start,"Assigning to rvalue"),w&&"Identifier"===e.type&&Oe(e.name)&&E(e.start,"Assigning to "+e.name+" in strict mode")}var xr={kind:"loop"},kr={kind:"switch"};function wr(){(d===me||d===be&&"/="==p)&&Ye(!0);var e=d,r=lr();switch(e){case R:case q:ir();var n=e===R;mr(le)||hr()?r.label=null:d!==U?yr():(r.label=jr(),br());for(var a=0;a<k.length;++a){var o=k[a];if(null==r.label||o.name===r.label.name){if(null!=o.kind&&(n||"loop"===o.kind))break;if(r.label&&n)break}}return a===k.length&&E(r.start,"Unsyntactic "+e.keyword),dr(r,n?"BreakStatement":"ContinueStatement");case O:return ir(),br(),dr(r,"DebuggerStatement");case D:return ir(),k.push(xr),r.body=wr(),k.pop(),vr(_),r.test=Cr(),br(),dr(r,"DoWhileStatement");case z:if(ir(),k.push(xr),vr(se),d===le)return Ar(r,null);if(d===$){var i=lr();return ir(),Ir(i,!0),dr(i,"VariableDeclaration"),1===i.declarations.length&&mr(re)?Sr(r,i):Ar(r,i)}i=Lr(!1,!0);return mr(re)?(gr(i),Sr(r,i)):Ar(r,i);case X:return ir(),qr(r,!0);case N:return ir(),r.test=Cr(),r.consequent=wr(),r.alternate=mr(B)?wr():null,dr(r,"IfStatement");case W:return x||E(c,"'return' outside of function"),ir(),mr(le)||hr()?r.argument=null:(r.argument=Lr(),br()),dr(r,"ReturnStatement");case J:ir(),r.discriminant=Cr(),r.cases=[],vr(oe),k.push(kr);for(var s,u;d!=ie;)if(d===V||d===j){var l=d===V;s&&dr(s,"SwitchCase"),r.cases.push(s=lr()),s.consequent=[],ir(),l?s.test=Lr():(u&&E(v,"Multiple default clauses"),u=!0,s.test=null),vr(fe)}else s||yr(),s.consequent.push(wr());return s&&dr(s,"SwitchCase"),ir(),k.pop(),dr(r,"SwitchStatement");case P:return ir(),Xe.test(t.slice(y,c))&&E(y,"Illegal newline after throw"),r.argument=Lr(),br(),dr(r,"ThrowStatement");case H:if(ir(),r.block=Er(),r.handler=null,d===T){var f=lr();ir(),vr(se),f.param=jr(),w&&Oe(f.param.name)&&E(f.param.start,"Binding "+f.param.name+" in strict mode"),vr(ce),f.guard=null,f.body=Er(),r.handler=dr(f,"CatchClause")}return r.guardedHandlers=A,r.finalizer=mr(M)?Er():null,r.handler||r.finalizer||E(r.start,"Missing catch or finally clause"),dr(r,"TryStatement");case $:return ir(),Ir(r),br(),dr(r,"VariableDeclaration");case _:return ir(),r.test=Cr(),k.push(xr),r.body=wr(),k.pop(),dr(r,"WhileStatement");case G:return w&&E(c,"'with' in strict mode"),ir(),r.object=Cr(),r.body=wr(),dr(r,"WithStatement");case oe:return Er();case le:return ir(),dr(r,"EmptyStatement");default:var m=p,h=Lr();if(e===U&&"Identifier"===h.type&&mr(fe)){for(a=0;a<k.length;++a)k[a].name===m&&E(h.start,"Label '"+m+"' is already declared");var b=d.isLoop?"loop":d===J?"switch":null;return k.push({name:m,kind:b}),r.body=wr(),k.pop(),r.label=h,dr(r,"LabeledStatement")}return r.expression=h,br(),dr(r,"ExpressionStatement")}}function Cr(){vr(se);var e=Lr();return vr(ce),e}function Er(e){var r,t=lr(),n=!0,a=!1;for(t.body=[],vr(oe);!mr(ie);){var o=wr();t.body.push(o),n&&e&&pr(o)&&(r=a,sr(a=!0)),n=!1}return a&&!r&&sr(!1),dr(t,"BlockStatement")}function Ar(e,r){return e.init=r,vr(le),e.test=d===le?null:Lr(),vr(le),e.update=d===ce?null:Lr(),vr(ce),e.body=wr(),k.pop(),dr(e,"ForStatement")}function Sr(e,r){return e.left=r,e.right=Lr(),vr(ce),e.body=wr(),k.pop(),dr(e,"ForInStatement")}function Ir(e,r){for(e.declarations=[],e.kind="var";;){var t=lr();if(t.id=jr(),w&&Oe(t.id.name)&&E(t.id.start,"Binding "+t.id.name+" in strict mode"),t.init=mr(he)?Lr(!0,r):null,e.declarations.push(dr(t,"VariableDeclarator")),!mr(ue))break}return e}function Lr(e,r){var t=Ur(r);if(!e&&d===ue){var n=fr(t);for(n.expressions=[t];mr(ue);)n.expressions.push(Ur(r));return dr(n,"SequenceExpression")}return t}function Ur(e){var r=function(e){var r=function(e){return function e(r,t,n){var a=d.binop;if(null!=a&&(!n||d!==re)&&a>t){var o=fr(r);o.left=r,o.operator=p;var i=d;ir(),o.right=e(Fr(),a,n);var s=dr(o,i===ge||i===xe?"LogicalExpression":"BinaryExpression");return e(s,t,n)}return r}(Fr(),-1,e)}(e);if(mr(pe)){var t=fr(r);return t.test=r,t.consequent=Lr(!0),vr(fe),t.alternate=Lr(!0,e),dr(t,"ConditionalExpression")}return r}(e);if(d.isAssign){var t=fr(r);return t.operator=p,t.left=r,ir(),t.right=Ur(e),gr(r),dr(t,"AssignmentExpression")}return r}function Fr(){if(d.prefix){var e=lr(),r=d.isUpdate;return e.operator=p,e.prefix=!0,m=!0,ir(),e.argument=Fr(),r?gr(e.argument):w&&"delete"===e.operator&&"Identifier"===e.argument.type&&E(e.start,"Deleting local variable in strict mode"),dr(e,r?"UpdateExpression":"UnaryExpression")}for(var t=Rr(Vr());d.postfix&&!hr();){(e=fr(t)).operator=p,e.prefix=!1,e.argument=t,gr(t),ir(),t=dr(e,"UpdateExpression")}return t}function Rr(e,r){var t;return mr(de)?((t=fr(e)).object=e,t.property=jr(!0),t.computed=!1,Rr(dr(t,"MemberExpression"),r)):mr(ne)?((t=fr(e)).object=e,t.property=Lr(),t.computed=!0,vr(ae),Rr(dr(t,"MemberExpression"),r)):!r&&mr(se)?((t=fr(e)).callee=e,t.arguments=Or(ce,!1),Rr(dr(t,"CallExpression"),r)):e}function Vr(){switch(d){case Q:var e=lr();return ir(),dr(e,"ThisExpression");case U:return jr();case S:case L:case I:return(e=lr()).value=p,e.raw=t.slice(c,u),ir(),dr(e,"Literal");case Y:case Z:case ee:return(e=lr()).value=d.atomValue,e.raw=d.keyword,ir(),dr(e,"Literal");case se:var n=l,a=c;ir();var o=Lr();return o.start=a,o.end=u,r.locations&&(o.loc.start=n,o.loc.end=f),r.ranges&&(o.range=[a,u]),vr(ce),o;case ne:e=lr();return ir(),e.elements=Or(ae,!0,!0),dr(e,"ArrayExpression");case oe:return function(){var e=lr(),t=!0,n=!1;e.properties=[],ir();for(;!mr(ie);){if(t)t=!1;else if(vr(ue),r.allowTrailingCommas&&mr(ie))break;var a,o={key:Tr()},i=!1;if(mr(fe)?(o.value=Lr(!0),a=o.kind="init"):r.ecmaVersion>=5&&"Identifier"===o.key.type&&("get"===o.key.name||"set"===o.key.name)?(i=n=!0,a=o.kind=o.key.name,o.key=Tr(),d!==se&&yr(),o.value=qr(lr(),!1)):yr(),"Identifier"===o.key.type&&(w||n))for(var s=0;s<e.properties.length;++s){var c=e.properties[s];if(c.key.name===o.key.name){var u=a==c.kind||i&&"init"===c.kind||"init"===a&&("get"===c.kind||"set"===c.kind);u&&!w&&"init"===a&&"init"===c.kind&&(u=!1),u&&E(o.key.start,"Redefinition of property")}}e.properties.push(o)}return dr(e,"ObjectExpression")}();case X:e=lr();return ir(),qr(e,!1);case K:return function(){var e=lr();ir(),e.callee=Rr(Vr(),!0),mr(se)?e.arguments=Or(ce,!1):e.arguments=A;return dr(e,"NewExpression")}();default:yr()}}function Tr(){return d===S||d===L?Vr():jr(!0)}function qr(e,r){d===U?e.id=jr():r?yr():e.id=null,e.params=[];var t=!0;for(vr(se);!mr(ce);)t?t=!1:vr(ue),e.params.push(jr());var n=x,a=k;if(x=!0,k=[],e.body=Er(!0),x=n,k=a,w||e.body.body.length&&pr(e.body.body[0]))for(var o=e.id?-1:0;o<e.params.length;++o){var i=o<0?e.id:e.params[o];if((qe(i.name)||Oe(i.name))&&E(i.start,"Defining '"+i.name+"' in strict mode"),o>=0)for(var s=0;s<o;++s)i.name===e.params[s].name&&E(i.start,"Argument name clash in strict mode")}return dr(e,r?"FunctionDeclaration":"FunctionExpression")}function Or(e,t,n){for(var a=[],o=!0;!mr(e);){if(o)o=!1;else if(vr(ue),t&&r.allowTrailingCommas&&mr(e))break;n&&d===ue?a.push(null):a.push(Lr(!0))}return a}function jr(e){var t=lr();return t.name=d===U?p:e&&!r.forbidReserved&&d.keyword||yr(),m=!1,ir(),dr(t,"Identifier")}});
},{}],"FheM":[function(require,module,exports) {
var t=null;function e(){return t||(t=n()),t}function n(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return r(t[0])}return"/"}function r(t){return(""+t).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)\/[^\/]+$/,"$1")+"/"}exports.getBundleURL=e,exports.getBaseURL=r;
},{}],"TUK3":[function(require,module,exports) {
var r=require("./bundle-url").getBundleURL;function e(r){Array.isArray(r)||(r=[r]);var e=r[r.length-1];try{return Promise.resolve(require(e))}catch(n){if("MODULE_NOT_FOUND"===n.code)return new s(function(n,i){t(r.slice(0,-1)).then(function(){return require(e)}).then(n,i)});throw n}}function t(r){return Promise.all(r.map(u))}var n={};function i(r,e){n[r]=e}module.exports=exports=e,exports.load=t,exports.register=i;var o={};function u(e){var t;if(Array.isArray(e)&&(t=e[1],e=e[0]),o[e])return o[e];var i=(e.substring(e.lastIndexOf(".")+1,e.length)||e).toLowerCase(),u=n[i];return u?o[e]=u(r()+e).then(function(r){return r&&module.bundle.register(t,r),r}).catch(function(r){throw delete o[e],r}):void 0}function s(r){this.executor=r,this.promise=null}s.prototype.then=function(r,e){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.then(r,e)},s.prototype.catch=function(r){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.catch(r)};
},{"./bundle-url":"FheM"}],"LU4Z":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.utils=exports.timers=exports.parser=exports.loaders=exports.defaultWait=exports.defaultThrottleInterval=exports.defaultResolutionWidth=exports.defaultResolutionHeight=exports.defaultMargin=exports.VideoBuilder=exports.TemplateClass=exports.SongleSyncStageStateStopped=exports.SongleSyncStageStatePlaying=exports.SongleSyncStageStatePaused=exports.Player=void 0;var e=require("textalive-graphics"),r=require("textalive-data-web"),n=i(require("acorn"));function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e,r){r||(r=function(t){return t});for(var n="number"==typeof e?e:r(e),i=0,o=t.length;i<o;){var s=Math.floor((i+o)/2);r(t[s])<n?i=s+1:o=s}return i}function s(t){var e=parseFloat(t);return isNaN(e)?0:e}var a=Object.freeze({__proto__:null,sortedIndex:o,requestIdleCallback:function(t,e){if(window.requestIdleCallback)return window.requestIdleCallback(t,e);var r=Date.now(),n=e?e.timeout:50;return setTimeout(function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,n-(Date.now()-r))}})},1)},cancelIdleCallback:function(t){return window.cancelIdleCallback?window.cancelIdleCallback(t):clearTimeout(t)},getNumber:s}),u=0,p=1,c=2,l=function(){return(l=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function h(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}u((n=n.apply(t,e||[])).next())})}function d(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function f(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}exports.SongleSyncStageStatePaused=c,exports.SongleSyncStageStatePlaying=p,exports.SongleSyncStageStateStopped=u,exports.utils=a;var y=1280,g=720,v=[0,0,0,0],m=50,b=function(){function t(t){this.wait=50,this.lastPosition=0,this.lastTime=0,this.elapsedTimes=[],this.options=t}return Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this.swPlayer&&this.swPlayer.isPlaying},enumerable:!0,configurable:!0}),t.prototype.initialize=function(t,e){var r=this;this.player=t,this.emitter=e;var n=this.options||{},i=n.accessToken,o=n.secretToken,s=n.headless;if(!this.swPlayer){if(!window.SW)return void this.load(t);window.SW.System.showLicense=!1;var a=n.accessToken||n.secretToken?"SyncPlayer":"Player";this.swPlayer=new window.SW[a]({mediaElement:this.player.mediaElement,accessToken:i,secretToken:o}),this.swPlayer.on("play",function(){r.startPolling(),r.emitter.onPlay()}),this.swPlayer.on("pause",function(){r.stopPolling(),r.emitter.onPause()}),this.swPlayer.on("finish",function(){r.stopPolling(),r.emitter.onStop()}),this.swPlayer.on("seek",function(){r.player.setMediaPosition(r.swPlayer.position)})}this.swPlayer.useMedia(this.player.data.song.permalink,{headless:s}),this.swPlayer.play(),this.swPlayer.stop()},t.prototype.load=function(t){var e=this;window.onSongleWidgetAPIReady=function(){return e.initialize(t,e.emitter)},setTimeout(function(){var t=[];document.querySelectorAll("script").forEach(function(e){var r=e.getAttribute("src");r&&r.indexOf("songle.jp/v2/api.js")>=0&&t.push(e)}),t.forEach(function(t){return t.parentElement.removeChild(t)});var e=document.createElement("script");e.src="//api.songle.jp/v2/api.js",document.head.appendChild(e)},1e3)},t.prototype.play=function(){return this.swPlayer?this.swPlayer.play():(this.emitter.onPlay(),null)},t.prototype.stop=function(){return this.swPlayer?this.swPlayer.stop():(this.emitter.onStop(),null)},t.prototype.pause=function(){return this.swPlayer?this.swPlayer.pause():(this.emitter.onPause(),null)},t.prototype.seek=function(t){return this.swPlayer?this.swPlayer.seekTo(t):(this.player.setMediaPosition(t),null)},t.prototype.startPolling=function(){var t,e=this;if(this.lastTime>0){var r=Date.now()-this.lastTime;t=Math.max(0,this.wait-r)}else t=this.wait;this.handler=setTimeout(function(){return h(e,void 0,void 0,function(){var e,r,n,i,o,s;return d(this,function(a){switch(a.label){case 0:return r=(e=this).lastTime,n=e.lastPosition,i=r>0?Date.now()-r:t,o=n>0?n+i:this.swPlayer.position,Math.abs(this.swPlayer.position-o)>2*this.wait?this.lastPosition=this.swPlayer.position:this.lastPosition<=this.swPlayer.position&&(this.lastPosition=.8*o+.2*this.swPlayer.position),this.lastTime=Date.now(),this.elapsedTimes.unshift(i),this.elapsedTimes=this.elapsedTimes.slice(0,10),this.elapsedTimes.length>=10&&((s=this.elapsedTimes.reduce(function(t,e){return t+e})/10)>5*this.wait&&(this.player.stageScale=Math.max(.25,.9*this.player.stageScale),this.elapsedTimes=[]),s<1.2*this.wait&&this.player.stageScale<1&&(this.player.stageScale=Math.min(1,this.player.stageScale/.9),this.elapsedTimes=[])),[4,this.player.setMediaPosition(o)];case 1:return a.sent(),this.handler>=0&&this.startPolling(),[2]}})})},t)},t.prototype.stopPolling=function(){this.handler>=0&&(clearTimeout(this.handler),this.lastTime=0,this.swPlayer&&(this.lastPosition=this.swPlayer.position)),this.handler=-1},t.prototype.dispose=function(){this.swPlayer&&(this.swPlayer.stop(),this.swPlayer=null)},t}(),E=function(){function t(){this.position=0,this._wait=50}return Object.defineProperty(t.prototype,"wait",{get:function(){return this._wait},set:function(t){this._wait=t,this._isPlaying&&this.start()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!0,configurable:!0}),t.prototype.initialize=function(t,e){this.player=t,this.emitter=e,this.update=this.update.bind(this)},t.prototype.play=function(){this.start(),this.emitter.onPlay()},t.prototype.stop=function(){this.clearInterval(),this._isPlaying=!1,this.position=0,this.emitter.onStop()},t.prototype.pause=function(){this.clearInterval(),this._isPlaying=!1,this.emitter.onPause()},t.prototype.seek=function(t){this.position=t,this.player.setMediaPosition(t),this.isPlaying&&this.start()},t.prototype.dispose=function(){this.clearInterval()},t.prototype.clearInterval=function(){window.clearInterval(this.intervalId)},t.prototype.start=function(){this.clearInterval(),this._isPlaying=!0,this.basePosition={time:(new Date).getTime(),position:this.position},this.intervalId=window.setInterval(this.update,this.wait)},t.prototype.update=function(){this.player.video||this.stop();var t=(new Date).getTime(),e=this.basePosition.position+(t-this.basePosition.time);this.position=Math.min(e,this.player.video.duration),this.player.setMediaPosition(this.position),this.position>=this.player.video.duration&&this.stop()},t}(),P=Object.freeze({__proto__:null,SongleSyncTimer:b,BasicTimer:E}),_=function(){function t(t,e,r){var n=this;this.player=t,this.manager=e,this.emitter=r,this._background=null,this._defaultBackgroundCss=null,t.addListener({onVideoLoad:this.onVideoLoad.bind(this),onStageElementSet:function(t){return n.doUpdateBackground(n.background)}})}return Object.defineProperty(t.prototype,"background",{get:function(){return this._background},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultBackgroundCss",{get:function(){return this._defaultBackgroundCss?this._defaultBackgroundCss:""},set:function(t){this._defaultBackgroundCss=t,this.updateBackground(this._background)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return null!==this._background},enumerable:!0,configurable:!0}),t.prototype.onVideoLoad=function(t){t.originalBackground=t.background},t.prototype.settingBackground=function(t){return h(this,void 0,void 0,function(){var e=this;return d(this,function(r){return this.doSetBackground(t,function(t){return e.updatingBackground(t)}),[2]})})},t.prototype.setBackground=function(t){return h(this,void 0,void 0,function(){var e=this;return d(this,function(r){return this.doSetBackground(t,function(t){return e.updateBackground(t)}),[2]})})},t.prototype.doSetBackground=function(t,e){return h(this,void 0,void 0,function(){var r,n,i;return d(this,function(o){switch(o.label){case 0:return r=t&&t.originalUrl?t.originalUrl:"",this.manager.isBackgroundColorAsset(t)?(e({css:r,originalUrl:r}),[2,this._background]):this.manager.isBackgroundPiaproImageAsset(t)?[4,this.manager.read(r)]:[3,2];case 1:return(n=o.sent())&&n.url&&this.manager.checkBackgroundImageLicense(n.license)?(n.originalUrl=r,t&&(n.x=t.x,n.y=t.y),e(n),[2,this._background]):(e({css:"",originalUrl:r,x:t?t.x:void 0,y:t?t.y:void 0,license:n?n.license:void 0}),[2,this._background]);case 2:return this.manager.isBackgroundSpecialImageAsset(t)?(i=/^snowmiku2016-([0-9]{2})$/.exec(r),e({css:'url("//api.textalive.jp/images/backgrounds/snowmiku2016/'+i[1]+'.jpg")',contentUrl:"//api.textalive.jp/images/backgrounds/snowmiku2016/"+i[1]+".jpg",url:"http://snowmiku.com/2016/info_chara.html",name:"SNOW MIKU 2016",authorName:"",originalUrl:r,x:t?t.x:void 0,y:t?t.y:void 0,defaultY:0}),[2,this._background]):(e({originalUrl:null,css:"",x:t?t.x:void 0,y:t?t.y:void 0}),[2,this._background])}})})},t.prototype.updatingBackground=function(t){this.doUpdateBackground(t)},t.prototype.updateBackground=function(t){this.doUpdateBackground(t)&&this.emitter&&this.emitter.onBackgroundGraphicsUpdate&&this.emitter.onBackgroundGraphicsUpdate(t)},t.prototype.doUpdateBackground=function(t){if(!this.player.stageElement||!t)return!1;var e=this.player.stageElement.style;return t.css.length<=0?e.background=this.defaultBackgroundCss:e.background=t.css,"number"==typeof t.x||this._background&&"number"==typeof this._background.x?("number"!=typeof t.x&&(t.x=this._background.x),e.backgroundPositionX=e.backgroundPositionX+"%"):e.backgroundPositionX="number"==typeof t.defaultX?t.defaultX+"%":"center","number"==typeof t.y||this._background&&"number"==typeof this._background.y?("number"!=typeof t.y&&(t.y=this._background.y),e.backgroundPositionY=e.backgroundPositionY+"%"):e.backgroundPositionY="number"==typeof t.defaultY?t.defaultY+"%":"center",e.backgroundSize="cover",this._background=t,this.player&&(this.player.data.video.background=t),!0},t.prototype.export=function(){if(!this.background)return null;var t={originalUrl:this.background.originalUrl};return void 0!==this.background.x&&(t.x=this.background.x),void 0!==this.background.y&&(t.y=this.background.y),t},t.prototype.exportPartialVideoEntry=function(){return{background:this.export()}},t}(),w=function(){function t(t,e){this.manager=t,this.listener=e,this.listener=e}return Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._video.json},enumerable:!0,configurable:!0}),t.prototype.loadVideo=function(t){return h(this,void 0,void 0,function(){var e,r=this;return d(this,function(n){switch(n.label){case 0:return[4,this.manager.load(t).catch(function(t){return r.setVideo(null,t)})];case 1:return(e=n.sent())&&this.setVideo(e,null),[2,e]}})})},t.prototype.useVideo=function(t){return this.setVideo(t)},t.prototype.setVideo=function(t,e){return this._video=t,t&&("string"==typeof t.json?t.json=JSON.parse(t.json):"object"==typeof t.json&&null!==t.json||(t.json={})),this.listener&&this.listener.onVideoLoad&&this.listener.onVideoLoad(t,e),t},t}(),O=function(){function t(t){this.beats=[],this.chords=[],this.segments=[],this.voice=[],this.parseBeats(t.beats),this.parseSegments(t.repetitive_segment),this.parseChords(t.chords),t.voice&&this.parseVoice(t.voice)}return t.prototype.parseBeats=function(t){var e=this;if(Array.isArray(t)&&Array.isArray(t[0])){var r=null,n=0;t[0].forEach(function(t){var i=new S;i.startTime=1e3*t[0],i.length=t[2],i.position=t[3],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.beats.push(i),r=i}),null!==r&&(r.next=null)}},t.prototype.parseChords=function(t){var e=this;if(Array.isArray(t)){var r=null,n=0;t.forEach(function(t){var i=new R;i.startTime=1e3*t[0],i.endTime=1e3*t[1],i.name=t[2],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.chords.push(i),r=i}),null!==r&&(r.next=null)}},t.prototype.parseSegments=function(t){var e=this;Array.isArray(t)&&t.forEach(function(t){var r={chorus:!!t.chorus,duration:10*t.segment_length,segments:null},n=null,i=0;r.segments=t.start_frames.map(function(t){var e=new N;return e.startTime=10*t,e.endTime=e.startTime+r.duration,e.previous=n,null!==n&&(n.next=e),e.index=i++,n=e,e}),null!==n&&(n.next=null),e.segments.push(r)})},t.prototype.parseVoice=function(t){var e=this;Array.isArray(t)&&t.forEach(function(t){var r=[],n=null,i=0,o=0;t.forEach(function(t){var e=new T;e.startTime=o,e.endTime=e.startTime+10*t[1],e.f0=t[0][0],e.initialF0=t[0][1],e.previous=n,null!==n&&(n.next=e),e.index=i++,r.push(e),n=e,o=e.endTime}),null!==n&&(n.next=null),e.voice.push(r)})},t}(),R=function(){function t(){this.previous=this.next=null}return t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t}(),T=function(){function t(){this.previous=this.next=null}return t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t}(),S=function(){function t(){this.previous=this.next=null}return Object.defineProperty(t.prototype,"endTime",{get:function(){return this.next?this.next.startTime:this.startTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!0,configurable:!0}),t.prototype.contains=function(t){return t>=this.startTime&&t<this.endTime},t.prototype.progress=function(t){return this.contains(t)?this.next?(t-this.startTime)/this.duration:0:-1},t}(),N=function(){function t(){this.previous=this.next=null}return t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?(t-this.startTime)/(this.endTime-this.startTime):-1},t}(),x=function(){function t(t,e){this.manager=t,this.listener=e}return Object.defineProperty(t.prototype,"song",{get:function(){return this._song},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"analysis",{get:function(){return this._analysis},enumerable:!0,configurable:!0}),t.prototype.loadSong=function(t){return h(this,void 0,void 0,function(){var e,r=this;return d(this,function(n){switch(n.label){case 0:return"number"==typeof t&&t<0||!t?(this.setSong(null,new Error("Neither Songle ID or code provided")),[2,null]):[4,this.manager.load("number"==typeof t?{id:t}:{code:t}).catch(function(t){return r.setSong(null,t)})];case 1:return(e=n.sent())?(this.setSong(e),[4,this.loadSongInfo(e.song.code)]):[2,null];case 2:return n.sent(),[2,e]}})})},t.prototype.setSong=function(t,e){this._song=t,this.listener&&this.listener.onSongLoad&&this.listener.onSongLoad(t,e)},t.prototype.loadSongInfo=function(t){return h(this,void 0,void 0,function(){var e,r=this;return d(this,function(n){switch(n.label){case 0:return[4,this.manager.loadInfo(String(t)).catch(function(t){return r.setSongInfo(null,t)})];case 1:return(e=n.sent())?[4,this.setSongInfo(e)]:[2,null];case 2:return n.sent(),[2,e]}})})},t.prototype.mockSongInfo=function(t){for(var e=t.beat,r=t.chorusSegment,n=t.duration,i=[],o=0;60*o/e.bpm<n/1e3;)i.push([60*o/e.bpm,1,e.length,o%e.length+1,1]),o++;var s={beats:[i],chords:null,repetitive_segment:[{chorus:!0,index:0,segment_length:r.duration/10,start_frames:r.startTimes.map(function(t){return t/10})}],voice:null};this._song=null,this.setSongInfo({analysis:s,info:null})},t.prototype.setSongInfo=function(t,e){this._info=t,this._analysis=new O(this._info.analysis),this.listener&&this.listener.onSongInfoLoad&&this.listener.onSongInfoLoad(t,e)},t}(),A=function(){function t(t,e,r){this.managers=t,this.listener=e,this.options=r}return Object.defineProperty(t.prototype,"lyricsId",{get:function(){return this._lyricsId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lyrics",{get:function(){return this._lyrics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),t.prototype.parse=function(t){return this.managers.text.parse(t)},t.prototype.loadRawText=function(t){var e;e=!t.phrases||t.phrases.length<0?"":t.phrases.map(function(t){return t.words.map(function(t){return t.characters.map(function(t){return t.char}).join("")}).join("")}).join(""),this.setText(e)},t.prototype.loadLyrics=function(t,e,r){return h(this,void 0,void 0,function(){var n,i;return d(this,function(o){switch(o.label){case 0:if(e<0)return this.setLyrics(null,"no lyrics information is available"),[2,null];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.managers.lyrics.loadDiff(t,e,r)];case 2:return n=o.sent(),[3,4];case 3:return i=o.sent(),this.setLyrics(null,i),[2,null];case 4:return n.data?(this._lyricsId=this._lyricsId,this.setLyrics(n,null),[4,this.loadLocalLyricsText(t)]):(this.setLyrics(null,"no timing information is available"),[2,null]);case 5:return o.sent()?[3,7]:[4,this.loadLyricsText(n)];case 6:o.sent(),o.label=7;case 7:return[2,n]}})})},t.prototype.setLyrics=function(t,e){this._lyrics=t,this.listener&&this.listener.onLyricsLoad&&this.listener.onLyricsLoad(t,e)},t.prototype.loadLocalLyricsText=function(t){return h(this,void 0,void 0,function(){var e,r=this;return d(this,function(n){switch(n.label){case 0:return[4,this.managers.lyrics.fetchLocalLyricBody(t).catch(function(t){return r.setText(null,t)})];case 1:return(e=n.sent())?(this.setText(e),[2,e]):[2,null]}})})},t.prototype.loadLyricsText=function(t){return h(this,void 0,void 0,function(){var e,r,n,i,o=this;return d(this,function(s){switch(s.label){case 0:return e=!1,r=this.options&&"number"==typeof this.options.lyricsFetchTimeout&&this.options.lyricsFetchTimeout>=0,n=this.managers.lyrics.fetchLyricBody(t.url,t.parser_path).catch(function(t){return e||o.setText(null,t),null}),[4,r?Promise.race([n,new Promise(function(t){setTimeout(function(){i||(e=!0,o.setText(null,new Error("fetching lyrics text timeout"))),t(null)},o.options.lyricsFetchTimeout)})]):n];case 1:return(i=s.sent())?(this.setText(i),[2,i]):[2,null]}})})},t.prototype.setText=function(t,e){this._text=t,this.listener&&this.listener.onTextLoad&&this.listener.onTextLoad(t,e)},t}();function I(t,e,r,n){return h(this,void 0,void 0,function(){var i,o,s,a,u,p,c,l,h,f,y,g;return d(this,function(d){switch(d.label){case 0:if(i={loaded:[],failed:[]},"undefined"==typeof window||!window.document||!window.document.head)return i.failed=e.slice(),[2,i];for(o=n.split("").filter(function(t,e,r){return r.indexOf(t)===e}).sort(),s=!0,a=0,o.forEach(function(t){var e=r.indexOf(t,a);s=s&&e>=0,a=e}),u=window.document.head,p=[],c=0;c<u.children.length;c++)"link"===(l=u.children.item(c)).tagName.toLowerCase()&&"stylesheet"===l.getAttribute("rel")&&p.push(l.getAttribute("href"));h=[],f=[],e.forEach(function(e){var r=t+"/"+(s?e.key:e.key+"-all")+".css";p.includes(r)||(f.push(e.en),h.push(r))}),y={classes:!1,custom:{families:f,urls:h},active:null,inactive:null,fontactive:function(t){i.loaded.push(e.find(function(e){return e.en===t})),i.failed=i.failed.filter(function(e){return e.en!==t})},fontinactive:function(t){i.failed.push(e.find(function(e){return e.en===t}))},timeout:5e3},d.label=1;case 1:return d.trys.push([1,4,,5]),[4,require("_bundle_loader")(require.resolve("webfontloader"))];case 2:return g=d.sent(),[4,new Promise(function(t){y.active=y.inactive=t,g.load(y)})];case 3:case 4:return d.sent(),[3,5];case 5:return[2,i]}})})}function C(t,e){return h(this,void 0,void 0,function(){var r,n,i,o,s,a,u,p;return d(this,function(c){switch(c.label){case 0:if(r={loaded:[],failed:[]},!("undefined"!=typeof window&&window.document&&window.document.head&&window.Ts&&window.Ts.loadFontAsync))return r.failed=t.slice(),[2,r];for(n=window.document.head,i={},o=function(t){var e=n.children.item(t);if("style"!==e.tagName.toLowerCase()||"text/css"!==e.getAttribute("type")||"stylesheet"!==e.getAttribute("rel")||!e.hasAttribute("data-cssName"))return"continue";var r=e.getAttribute("data-cssName");if(void 0===i[r])return i[r]=new Set(e.getAttribute("data-text")),{value:void 0};e.getAttribute("data-text").split("").forEach(function(t){return i[r].add(t)})},s=0;s<n.children.length;s++)if("object"==typeof(a=o(s)))return[2,a.value];return u=window.Ts,p=[],t.forEach(function(t){var n=new Set(e+t.en+t.ja);i[t.en]&&i[t.en].forEach(function(t){return n.delete(t)}),n.size<=0?r.loaded.push(t):p.push(new Promise(function(e){return function(t,e,r,n,i){var o=e.en;t.loadFontAsync({cssName:o,text:n,outputType:"json",callback:function(t){try{!function(t,e,r){var n=JSON.parse(r),i=JSON.parse(n.res),o=document.createElement("style");o.setAttribute("data-cssName",t),o.setAttribute("data-text",e),o.setAttribute("type","text/css"),o.setAttribute("rel","stylesheet"),o.innerHTML="@font-face {font-family: '"+i.fontFamily+"';font-weight: "+i["font-weight"]+";src: url(data:font/woff;base64,"+i.src+");}",document.head.appendChild(o)}(o,n,t.data),r.loaded.push(e)}catch(t){r.failed.push(e)}i()}})}(u,t,r,Array.from(n.values()).join(""),e)}))}),[4,Promise.all(p)];case 1:return c.sent(),[2,r]}})})}exports.timers=P,exports.defaultWait=m,exports.defaultMargin=v,exports.defaultResolutionHeight=g,exports.defaultResolutionWidth=y;var k=function(){function t(t,e,r){this.fontInfoManager=t,this.textFetcher=e,this.listener=r,this._failed=[],this._loaded=[]}return Object.defineProperty(t.prototype,"failed",{get:function(){return this._failed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),t.prototype.loadAll=function(){return h(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,this.fontInfoManager.listAvailableFonts()];case 1:return t=e.sent(),[2,this.loadFonts(t)]}})})},t.prototype.loadForVideo=function(t){return h(this,void 0,void 0,function(){var e,r;return d(this,function(n){switch(n.label){case 0:return(e=this.listFontFamiliesInVideo(t))?[4,this.fontInfoManager.listAvailableFonts()]:(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(this.loaded),[2,Promise.resolve(this.loaded)]);case 1:return r=n.sent(),[2,this.loadFonts(r.filter(function(t){return e.indexOf(t.en)>=0}))]}})})},t.prototype.listFontFamiliesInVideo=function(t){if(!t||!t.phrases)return null;var e=[];return t.phrases.forEach(function(t){return t.words.forEach(function(t){return t.characters.forEach(function(t){return e.push(t.fontFamily)})})}),e.filter(function(t,e,r){return r.indexOf(t)===e})},t.prototype.isLoading=function(){return!!this.queue},t.prototype.load=function(t){return h(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return[4,this.fontInfoManager.listAvailableFonts()];case 1:return e=r.sent(),[2,this.loadFonts(e.filter(function(e){return t.indexOf(e.key)>=0}))]}})})},t.prototype.loadFonts=function(t){return h(this,void 0,void 0,function(){var e=this;return d(this,function(r){return this.queue?(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(null,{error:"failed to load some fonts because there is an ongoing font loding process",fonts:this.failed}),[2,this.loaded]):(this.queue=this.doLoad(t).then(function(t){return e.queue=null,t}),[2,this.queue])})})},t.prototype.doLoad=function(t){return h(this,void 0,void 0,function(){var e,r,n,i,o=this;return d(this,function(s){switch(s.label){case 0:return e=[],r=[],[4,this.fontInfoManager.getFrequentChars()];case 1:return n=s.sent(),t.forEach(function(t){t.typekit||t.typesquare||e.push(t),t.typesquare&&r.push(t)}),i=(this.textFetcher&&this.textFetcher()||"").split("").filter(function(t,e,r){return r.indexOf(t)===e}).sort().join(""),[2,Promise.all([I(this.fontInfoManager.endpoint,e,n,i),C(r,i)]).then(function(t){var e=t[0],r=t[1],n=e.loaded.concat(r.loaded);if(o.addLoadedFonts(n),e.failed.length>0||r.failed.length>0){var i=e.failed.concat(r.failed);o.addFailedFonts(i),o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,{error:"failed to load some fonts",fonts:o.failed})}else o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(n);return o.loaded}).catch(function(t){return o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,{error:t,fonts:o.failed}),o.loaded})]}})})},t.prototype.addLoadedFonts=function(t){var e=this;this._loaded=this.loaded.concat(t.filter(function(t){return e.failed.findIndex(function(e){return e.key===t.key})<0}))},t.prototype.addFailedFonts=function(t){var e=this;this._failed=this.failed.concat(t.filter(function(t){return e.failed.findIndex(function(e){return e.key===t.key})<0}))},t}(),j=function(){function t(t,e,r){var n=this;void 0===e&&(e=null),this.listener=e,this.options=r,this.videoLoader=new w(t.video,e),this.songLoader=new x(t.song,e),this.textLoader=new A(t,{onLyricsLoad:e&&e.onLyricsLoad.bind(e),onTextLoad:e&&e.onTextLoad.bind(e)},r),this.fontLoader=new k(t.font,function(){return n.textLoader.text},e)}return Object.defineProperty(t.prototype,"video",{get:function(){return this.videoLoader.video},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"song",{get:function(){var t;return null===(t=this.songLoader.song)||void 0===t?void 0:t.song},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"songStatus",{get:function(){var t;return null===(t=this.songLoader.song)||void 0===t?void 0:t.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"songMap",{get:function(){return this.songLoader.analysis},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lyrics",{get:function(){return this.textLoader.lyrics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this.textLoader.text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fonts",{get:function(){return this.fontLoader},enumerable:!0,configurable:!0}),t.prototype.loadVideo=function(t){return h(this,void 0,void 0,function(){return d(this,function(e){return[2,this.videoLoader.loadVideo(t)]})})},t.prototype.useVideo=function(t){return this.videoLoader.useVideo(t)},t.prototype.initialize=function(){return h(this,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return this.video?[4,this.loadSong()]:[2,null];case 1:return t.sent(),[4,this.loadText()];case 2:return t.sent(),[4,this.loadFonts()];case 3:return t.sent(),[2,this.video]}})})},t.prototype.loadSong=function(){return h(this,void 0,void 0,function(){return d(this,function(t){return[2,this.songLoader.loadSong(this.video.songleCode||this.video.songleId)]})})},t.prototype.mockSongInfo=function(t){this.songLoader.mockSongInfo(t)},t.prototype.loadText=function(){return h(this,void 0,void 0,function(){var t,e,r,n;return d(this,function(i){switch(i.label){case 0:return t=this.video,e=t.lyricId,r=t.lyricDiffId,!(n=this.song?this.song.code:null)&&e<0?(this.textLoader.loadRawText(this.videoLoader.data),[3,3]):[3,1];case 1:return[4,this.textLoader.loadLyrics(n,e,r)];case 2:i.sent(),i.label=3;case 3:return[2,this.text]}})})},t.prototype.loadFonts=function(){return h(this,void 0,void 0,function(){return d(this,function(t){return"number"==typeof this.video.id&&this.video.id>=0?[2,this.fontLoader.loadForVideo(this.videoLoader.data)]:this.options&&this.options.fontFamilies?[2,this.fontLoader.load(this.options.fontFamilies)]:[2,this.fontLoader.loadAll()]})})},t.prototype.importLyrics=function(){var t=this.text.replace(/[\s\r\n]/g,""),e=0,r={phrases:this.lyrics.data.map(function(r){return{words:r.map(function(r){return{characters:r.map(function(r){return{char:t.charAt(e++),startTime:1e3*r.start_time,endTime:1e3*r.end_time}})}})}})};this.video.json&&Array.isArray(this.video.json.phrases)?this.video.json.phrases.forEach(function(t,e){t.words.forEach(function(t,n){t.characters.forEach(function(t,i){var o=r.phrases[e].words[n].characters[i];t.char=o.char,t.startTime=o.startTime,t.endTime=o.endTime})})}):this.video.json=r},t.prototype.parseText=function(){return h(this,void 0,void 0,function(){var t,e,r;return d(this,function(n){switch(n.label){case 0:return t=this.video.json.phrases.map(function(t){return t.words.map(function(t){return t.characters.map(function(t){return t.char}).join("")}).join(" ")}),e=t.join("\n"),[4,this.textLoader.parse(e)];case 1:return(r=n.sent())&&"success"===r.status?(this.video.json.phrases.forEach(function(e,n){var i=r.result[n],o=0;e.words.forEach(function(e){var r=e.characters.map(function(t){return t.char}).join(""),s=t[n].indexOf(r,o);if(!(s<0)){o=s;var a=i.find(function(t){return t.startPosition<=s&&t.endPosition>=s});a&&(e.pos=a.PoS,e.rawPoS=a.rawPoS,e.language=a.language)}})}),[2]):[2]}})})},t.prototype.exportPartialVideoEntry=function(){return{sourceId:this.video.id,sourceOriginId:this.video.sourceOriginId,songleId:this.song.id,lyricId:this.textLoader.lyricsId,lyricDiffId:this.lyrics?this.lyrics.id:-1,config:this.video.config?JSON.stringify(this.video.config):null}},t}(),L=Object.freeze({__proto__:null,BackgroundGraphicsLoader:_,DataLoader:j,TextLoader:A,VideoLoader:w,FontLoader:k,SongLoader:x}),F=function(){function t(){this.cursor=-1,this.widgets=[],this.instances=[],this.model={id:-1,type:e.UnitTypes.NONE,sourceId:-1,author:null,originalAuthor:null,className:null,createdDate:null}}return Object.defineProperty(t.prototype,"id",{get:function(){return this.model?this.model.id:-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"script",{get:function(){return this.model?this.model.script:null},enumerable:!0,configurable:!0}),t}(),U=function(){},B=function(){function t(e,r){"string"==typeof e&&(e=t.acorn.parse(e,t.PARSE_OPTIONS)),this.ast=e,this.initFunc_=r,this.paused_=!1,this.polyfills_=[],this.functionCounter_=0,this.stepFunctions_=Object.create(null);for(var n,i=/^step([A-Z]\w*)$/,o=Object.getOwnPropertyNames(t.prototype),s=0;s<o.length;s++){var a=o[s];"function"==typeof t.prototype[a]&&(n=a.match(i))&&(this.stepFunctions_[n[1]]=t.prototype[a].bind(this))}var u;this.global=this.createScope(this.ast,null),this.ast=t.acorn.parse(this.polyfills_.join("\n"),t.PARSE_OPTIONS),this.polyfills_=void 0,this.stripLocations_(this.ast,void 0,void 0),(u=new D(this.ast,this.global)).done=!1,this.stateStack=[u],this.run(),this.value=void 0,this.ast=e,(u=new D(this.ast,this.global)).done=!1,this.stateStack.length=0,this.stateStack[0]=u,this.nodeConstructor=u.node.constructor,this.stateStack=this.stateStack,this.OBJECT=this.OBJECT,this.OBJECT_PROTO=this.OBJECT_PROTO,this.FUNCTION=this.FUNCTION,this.FUNCTION_PROTO=this.FUNCTION_PROTO,this.ARRAY=this.ARRAY,this.ARRAY_PROTO=this.ARRAY_PROTO,this.REGEXP=this.REGEXP,this.REGEXP_PROTO=this.REGEXP_PROTO,this.UNDEFINED=void 0,this.NULL=null,this.NAN=NaN,this.TRUE=!0,this.FALSE=!1,this.STRING_EMPTY="",this.NUMBER_ZERO=0,this.NUMBER_ONE=1}return t.prototype.wrap=function(t){return t},t.prototype.unwrap=function(t,e){return t},t.prototype.appendCode=function(e){var r=this.stateStack[0];if(!r||"Program"!==r.node.type)throw Error("Expecting original AST to start with a Program node.");if("string"==typeof e&&(e=t.acorn.parse(e,t.PARSE_OPTIONS)),!e||"Program"!==e.type)throw Error("Expecting new AST to start with a Program node.");this.populateScope_(e,r.scope);for(var n,i=0;n=e.body[i];i++)r.node.body.push(n);r.done=!1},t.prototype.step=function(){var e=this.stateStack,r=e[e.length-1];if(!r)return!1;var n=r.node,i=n.type;if("Program"===i&&r.done)return!1;if(this.paused_)return!0;try{var o=this.stepFunctions_[i](e,r,n)}catch(e){if(e!==t.STEP_ERROR)throw e}return o&&e.push(o),!!n.end||this.step()},t.prototype.run=function(){for(;!this.paused_&&this.step(););return this.paused_},t.prototype.initGlobalScope=function(e){this.setProperty(e,"NaN",NaN,t.READONLY_DESCRIPTOR),this.setProperty(e,"Infinity",1/0,t.READONLY_DESCRIPTOR),this.setProperty(e,"undefined",void 0,t.READONLY_DESCRIPTOR),this.setProperty(e,"window",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"this",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"self",e),this.OBJECT_PROTO=new M(null),this.FUNCTION_PROTO=new M(this.OBJECT_PROTO),this.initFunction(e),this.initObject(e),e.proto=this.OBJECT_PROTO,this.setProperty(e,"constructor",this.OBJECT),this.initArray(e),this.initString(e),this.initBoolean(e),this.initNumber(e),this.initDate(e),this.initRegExp(e),this.initError(e),this.initMath(e),this.initJSON(e);var r=this,n=this.createNativeFunction(function(t){throw EvalError("Can't happen")},!1);n.eval=!0,this.setProperty(e,"eval",n),this.setProperty(e,"parseInt",this.createNativeFunction(parseInt,!1)),this.setProperty(e,"parseFloat",this.createNativeFunction(parseFloat,!1)),this.setProperty(e,"isNaN",this.createNativeFunction(isNaN,!1)),this.setProperty(e,"isFinite",this.createNativeFunction(isFinite,!1));for(var i=[[escape,"escape"],[unescape,"unescape"],[decodeURI,"decodeURI"],[decodeURIComponent,"decodeURIComponent"],[encodeURI,"encodeURI"],[encodeURIComponent,"encodeURIComponent"]],o=0;o<i.length;o++){var s=function(t){return function(e){try{return t(e)}catch(t){r.throwException(r.URI_ERROR,t.message)}}}(i[o][0]);this.setProperty(e,i[o][1],this.createNativeFunction(s,!1),t.NONENUMERABLE_DESCRIPTOR)}this.initFunc_&&this.initFunc_(this,e)},t.prototype.initFunction=function(e){var r,n=this,i=/^[A-Za-z_$][\w$]*$/;(r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.FUNCTION_PROTO);if(arguments.length)var o=String(arguments[arguments.length-1]);else o="";for(var s=[],a=0;a<arguments.length-1;a++){var u=String(arguments[a]);u.match(i)||n.throwException(n.SYNTAX_ERROR,"Invalid function argument: "+u),s.push(u)}s=s.join(", "),r.parentScope=n.global;try{var p=t.acorn.parse("$ = function("+s+") {"+o+"};",t.PARSE_OPTIONS)}catch(t){n.throwException(n.SYNTAX_ERROR,"Invalid code: "+t.message)}return 1!==p.body.length&&n.throwException(n.SYNTAX_ERROR,"Invalid code in function body."),r.node=p.body[0].expression.right,n.setProperty(r,"length",r.node.length,t.READONLY_DESCRIPTOR),r}).id=this.functionCounter_++,this.FUNCTION=this.createObjectProto(this.FUNCTION_PROTO),this.setProperty(e,"Function",this.FUNCTION),this.setProperty(this.FUNCTION,"prototype",this.FUNCTION_PROTO),this.FUNCTION.nativeFunc=r,this.setProperty(this.FUNCTION_PROTO,"constructor",this.FUNCTION,t.NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.nativeFunc=function(){},this.FUNCTION_PROTO.nativeFunc.id=this.functionCounter_++,this.setProperty(this.FUNCTION_PROTO,"length",0,t.READONLY_DESCRIPTOR);var o=function(t){if(!(t&&t.isObject||n.getScope().strict))if(null==t)t=n.global;else{var e=n.createObjectProto(n.getPrototype(t));e.data=t,t=e}return t};r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[],null!=e&&(e.isObject?r.arguments_=n.pseudoToNative(e):n.throwException(n.TYPE_ERROR,"CreateListFromArrayLike called on non-object")),r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"apply",r),r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[];for(var i=1;i<arguments.length;i++)r.arguments_.push(arguments[i]);r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"call",r),this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',","{configurable: true, writable: true, value:","function(oThis) {","if (typeof this !== 'function') {","throw TypeError('What is trying to be bound is not callable');","}","var aArgs   = Array.prototype.slice.call(arguments, 1),","fToBind = this,","fNOP    = function() {},","fBound  = function() {","return fToBind.apply(this instanceof fNOP","? this",": oThis,","aArgs.concat(Array.prototype.slice.call(arguments)));","};","if (this.prototype) {","fNOP.prototype = this.prototype;","}","fBound.prototype = new fNOP();","return fBound;","}","});",""),r=function(){return this.toString()},this.setNativeFunctionPrototype(this.FUNCTION,"toString",r),this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return this.valueOf()},this.setNativeFunctionPrototype(this.FUNCTION,"valueOf",r),this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initObject=function(e){var r,n=this;r=function(t){if(null==t)return n.calledWithNew()?this:n.createObjectProto(n.OBJECT_PROTO);if(!t.isObject){var e=n.createObjectProto(n.getPrototype(t));return e.data=t,e}return t},this.OBJECT=this.createNativeFunction(r,!0),this.setProperty(this.OBJECT,"prototype",this.OBJECT_PROTO),this.setProperty(this.OBJECT_PROTO,"constructor",this.OBJECT),this.setProperty(e,"Object",this.OBJECT);var i=function(t){null==t&&n.throwException(n.TYPE_ERROR,"Cannot convert '"+t+"' to object")};r=function(t){i(t);var e=t.isObject?t.properties:t;return n.nativeToPseudo(Object.getOwnPropertyNames(e))},this.setProperty(this.OBJECT,"getOwnPropertyNames",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),t.isObject?n.nativeToPseudo(Object.keys(t.properties)):n.nativeToPseudo(Object.keys(t))},this.setProperty(this.OBJECT,"keys",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return null===t?n.createObjectProto(null):(void 0!==t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object prototype may only be an Object or null"),n.createObjectProto(t))},this.setProperty(this.OBJECT,"create",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var create_ = Object.create;","Object.create = function(proto, props) {","var obj = create_(proto);","props && Object.defineProperties(obj, props);","return obj;","};","})();",""),r=function(t,e,r){return e=String(e),t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.defineProperty called on non-object"),r&&r.isObject||n.throwException(n.TYPE_ERROR,"Property description must be an object"),!t.properties[e]&&t.preventExtensions&&n.throwException(n.TYPE_ERROR,"Can't define property '"+e+"', object is not extensible"),n.setProperty(t,e,ReferenceError,r.properties),t},this.setProperty(this.OBJECT,"defineProperty",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var defineProperty_ = Object.defineProperty;","Object.defineProperty = function(obj, prop, d1) {","var d2 = {};","if ('configurable' in d1) d2.configurable = d1.configurable;","if ('enumerable' in d1) d2.enumerable = d1.enumerable;","if ('writable' in d1) d2.writable = d1.writable;","if ('value' in d1) d2.value = d1.value;","if ('get' in d1) d2.get = d1.get;","if ('set' in d1) d2.set = d1.set;","return defineProperty_(obj, prop, d2);","};","})();","Object.defineProperty(Object, 'defineProperties',","{configurable: true, writable: true, value:","function(obj, props) {","var keys = Object.keys(props);","for (var i = 0; i < keys.length; i++) {","Object.defineProperty(obj, keys[i], props[keys[i]]);","}","return obj;","}","});",""),r=function(t,e){if(t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.getOwnPropertyDescriptor called on non-object"),(e=String(e))in t.properties){var r=Object.getOwnPropertyDescriptor(t.properties,e),i=t.getter[e],o=t.setter[e];(i||o)&&(r.get=i,r.set=o,delete r.value,delete r.writable);var s=n.nativeToPseudo(r);return"value"in r&&n.setProperty(s,"value",r.value),s}},this.setProperty(this.OBJECT,"getOwnPropertyDescriptor",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),n.getPrototype(t)},this.setProperty(this.OBJECT,"getPrototypeOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return Boolean(t)&&!t.preventExtensions},this.setProperty(this.OBJECT,"isExtensible",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return t&&t.isObject&&(t.preventExtensions=!0),t},this.setProperty(this.OBJECT,"preventExtensions",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.setNativeFunctionPrototype(this.OBJECT,"toString",M.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"toLocaleString",M.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"valueOf",M.prototype.valueOf),r=function(t){return i(this),this.isObject?String(t)in this.properties:this.hasOwnProperty(t)},this.setNativeFunctionPrototype(this.OBJECT,"hasOwnProperty",r),r=function(t){return i(this),Object.prototype.propertyIsEnumerable.call(this.properties,t)},this.setNativeFunctionPrototype(this.OBJECT,"propertyIsEnumerable",r),r=function(t){for(;;){if(!(t=n.getPrototype(t)))return!1;if(t===this)return!0}},this.setNativeFunctionPrototype(this.OBJECT,"isPrototypeOf",r)},t.prototype.initArray=function(e){var r,n=this;r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.ARRAY_PROTO);var i=arguments[0];if(1===arguments.length&&"number"==typeof i)isNaN(t.legalArrayLength(i))&&n.throwException(n.RANGE_ERROR,"Invalid array length"),r.properties.length=i;else{for(var o=0;o<arguments.length;o++)r.properties[o]=arguments[o];r.properties.length=o}return r},this.ARRAY=this.createNativeFunction(r,!0),this.ARRAY_PROTO=this.ARRAY.properties.prototype,this.setProperty(e,"Array",this.ARRAY),r=function(t){return t&&"Array"===t.class},this.setProperty(this.ARRAY,"isArray",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return Array.prototype.pop.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"pop",r),r=function(t){return Array.prototype.push.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"push",r),r=function(){return Array.prototype.shift.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"shift",r),r=function(t){return Array.prototype.unshift.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"unshift",r),r=function(){return Array.prototype.reverse.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"reverse",r),r=function(t,e){var r=Array.prototype.splice.apply(this.properties,arguments);return n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"splice",r),r=function(t,e){var r=Array.prototype.slice.call(this.properties,t,e);return n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"slice",r),r=function(t){return Array.prototype.join.call(this.properties,t)},this.setNativeFunctionPrototype(this.ARRAY,"join",r),r=function(t){for(var e=[],r=0,i=n.getProperty(this,"length"),o=0;o<i;o++){if(n.hasProperty(this,o)){var s=n.getProperty(this,o);e[r]=s}r++}for(o=0;o<arguments.length;o++){var a=arguments[o];if(n.isa(a,n.ARRAY))for(var u=n.getProperty(a,"length"),p=0;p<u;p++)n.hasProperty(a,p)&&(e[r]=n.getProperty(a,p)),r++;else e[r]=a}return n.nativeToPseudo(e)},this.setNativeFunctionPrototype(this.ARRAY,"concat",r),r=function(t,e){return Array.prototype.indexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"indexOf",r),r=function(t,e){return Array.prototype.lastIndexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"lastIndexOf",r),r=function(){return Array.prototype.sort.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"sort",r),this.polyfills_.push("Object.defineProperty(Array.prototype, 'every',","{configurable: true, writable: true, value:","function(callbackfn, thisArg) {","if (!this || typeof callbackfn !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O && !callbackfn.call(T, O[k], k, O)) return false;","k++;","}","return true;","}","});","Object.defineProperty(Array.prototype, 'filter',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (this === void 0 || this === null || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var res = [];","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t) {","var val = t[i];","if (fun.call(thisArg, val, i, t)) res.push(val);","}","}","return res;","}","});","Object.defineProperty(Array.prototype, 'forEach',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O) callback.call(T, O[k], k, O);","k++;","}","}","});","Object.defineProperty(Array.prototype, 'map',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') new TypeError;","var T, A, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","A = new Array(len);","k = 0;","while (k < len) {","if (k in O) A[k] = callback.call(T, O[k], k, O);","k++;","}","return A;","}","});","Object.defineProperty(Array.prototype, 'reduce',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var t = Object(this), len = t.length >>> 0, k = 0, value;","if (arguments.length === 2) {","value = arguments[1];","} else {","while (k < len && !(k in t)) k++;","if (k >= len) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k++];","}","for (; k < len; k++) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'reduceRight',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (null === this || 'undefined' === typeof this || 'function' !== typeof callback) throw TypeError();","var t = Object(this), len = t.length >>> 0, k = len - 1, value;","if (arguments.length >= 2) {","value = arguments[1];","} else {","while (k >= 0 && !(k in t)) k--;","if (k < 0) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k--];","}","for (; k >= 0; k--) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'some',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (!this || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t && fun.call(thisArg, t[i], i, t)) {","return true;","}","}","return false;","}","});","(function() {","var sort_ = Array.prototype.sort;","Array.prototype.sort = function(opt_comp) {","if (typeof opt_comp !== 'function') {","return sort_.call(this);","}","for (var i = 0; i < this.length; i++) {","var changes = 0;","for (var j = 0; j < this.length - i - 1; j++) {","if (opt_comp(this[j], this[j + 1]) > 0) {","var swap = this[j];","this[j] = this[j + 1];","this[j + 1] = swap;","changes++;","}","}","if (!changes) break;","}","return this;","};","})();","Object.defineProperty(Array.prototype, 'toLocaleString',","{configurable: true, writable: true, value:","function() {","var out = [];","for (var i = 0; i < this.length; i++) {","out[i] = (this[i] === null || this[i] === undefined) ? '' : this[i].toLocaleString();","}","return out.join(',');","}","});","")},t.prototype.initString=function(e){var r,n=this;r=function(t){return t=String(t),n.calledWithNew()?(this.data=t,this):t},this.STRING=this.createNativeFunction(r,!0),this.setProperty(e,"String",this.STRING),this.setProperty(this.STRING,"fromCharCode",this.createNativeFunction(String.fromCharCode,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["trim","toLowerCase","toUpperCase","toLocaleLowerCase","toLocaleUpperCase","charAt","charCodeAt","substring","slice","substr","indexOf","lastIndexOf","concat"],o=0;o<i.length;o++)this.setNativeFunctionPrototype(this.STRING,i[o],String.prototype[i[o]]);r=function(t,e,r){return e=e?n.pseudoToNative(e):void 0,r=r?n.pseudoToNative(r):void 0,String(this).localeCompare(t,e,r)},this.setNativeFunctionPrototype(this.STRING,"localeCompare",r),r=function(t,e){n.isa(t,n.REGEXP)&&(t=t.data);var r=String(this).split(t,e);return n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.STRING,"split",r),r=function(t){t=t?t.data:void 0;var e=String(this).match(t);return e?n.nativeToPseudo(e):null},this.setNativeFunctionPrototype(this.STRING,"match",r),r=function(t){return n.isa(t,n.REGEXP)&&(t=t.data),String(this).search(t)},this.setNativeFunctionPrototype(this.STRING,"search",r),r=function(t,e){return String(this).replace(t.data||t,e)},this.setNativeFunctionPrototype(this.STRING,"replace",r),this.polyfills_.push("(function() {","var replace_ = String.prototype.replace;","String.prototype.replace = function(substr, newSubstr) {","if (typeof newSubstr !== 'function') {","return replace_.call(this, substr, newSubstr);","}","var str = this;","if (substr instanceof RegExp) {","var subs = [];","var m = substr.exec(str);","while (m) {","m.push(m.index, str);","var inject = newSubstr.apply(null, m);","subs.push([m.index, m[0].length, inject]);","m = substr.global ? substr.exec(str) : null;","}","for (var i = subs.length - 1; i >= 0; i--) {","str = str.substring(0, subs[i][0]) + subs[i][2] + str.substring(subs[i][0] + subs[i][1]);","}","} else {","var i = str.indexOf(substr);","if (i !== -1) {","var inject = newSubstr(str.substr(i, substr.length), i, str);","str = str.substring(0, i) + inject + str.substring(i + substr.length);","}","}","return str;","};","})();","")},t.prototype.initBoolean=function(t){var e,r=this;e=function(t){return t=Boolean(t),r.calledWithNew()?(this.data=t,this):t},this.BOOLEAN=this.createNativeFunction(e,!0),this.setProperty(t,"Boolean",this.BOOLEAN)},t.prototype.initNumber=function(e){var r,n=this;r=function(t){return t=Number(t),n.calledWithNew()?(this.data=t,this):t},this.NUMBER=this.createNativeFunction(r,!0),this.setProperty(e,"Number",this.NUMBER);for(var i=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"],o=0;o<i.length;o++)this.setProperty(this.NUMBER,i[o],Number[i[o]],t.READONLY_NONENUMERABLE_DESCRIPTOR);r=function(t){try{return Number(this).toExponential(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toExponential",r),r=function(t){try{return Number(this).toFixed(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toFixed",r),r=function(t){try{return Number(this).toPrecision(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toPrecision",r),r=function(t){try{return Number(this).toString(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toString",r),r=function(t,e){return t=t?n.pseudoToNative(t):void 0,e=e?n.pseudoToNative(e):void 0,Number(this).toLocaleString(t,e)},this.setNativeFunctionPrototype(this.NUMBER,"toLocaleString",r)},t.prototype.initDate=function(e){var r,n=this;r=function(t,e){if(!n.calledWithNew())return Date();var r=[null].concat([].slice.call(arguments));return this.data=new(Function.prototype.bind.apply(Date,r)),this},this.DATE=this.createNativeFunction(r,!0),this.setProperty(e,"Date",this.DATE),this.setProperty(this.DATE,"now",this.createNativeFunction(Date.now,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"parse",this.createNativeFunction(Date.parse,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"UTC",this.createNativeFunction(Date.UTC,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toISOString","toJSON","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"],o=0;o<i.length;o++)r=function(t){return function(e){for(var r=[],i=0;i<arguments.length;i++)r[i]=n.pseudoToNative(arguments[i]);return this.data[t].apply(this.data,r)}}(i[o]),this.setNativeFunctionPrototype(this.DATE,i[o],r)},t.prototype.initRegExp=function(e){var r,n=this;r=function(t,e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.REGEXP_PROTO);return t=t?t.toString():"",e=e?e.toString():"",n.populateRegExp(r,new RegExp(t,e)),r},this.REGEXP=this.createNativeFunction(r,!0),this.REGEXP_PROTO=this.REGEXP.properties.prototype,this.setProperty(e,"RegExp",this.REGEXP),this.setProperty(this.REGEXP.properties.prototype,"global",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"ignoreCase",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"multiline",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"source","(?:)",t.READONLY_NONENUMERABLE_DESCRIPTOR),r=function(t){return this.data.test(t)},this.setNativeFunctionPrototype(this.REGEXP,"test",r),r=function(t){t=t.toString(),this.data.lastIndex=Number(n.getProperty(this,"lastIndex"));var e=this.data.exec(t);if(n.setProperty(this,"lastIndex",this.data.lastIndex),e){for(var r=n.createObjectProto(n.ARRAY_PROTO),i=0;i<e.length;i++)n.setProperty(r,i,e[i]);return n.setProperty(r,"index",e.index),n.setProperty(r,"input",e.input),r}return null},this.setNativeFunctionPrototype(this.REGEXP,"exec",r)},t.prototype.initError=function(e){var r=this;this.ERROR=this.createNativeFunction(function(e){if(r.calledWithNew())var n=this;else n=r.createObject(r.ERROR);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n},!0),this.setProperty(e,"Error",this.ERROR),this.setProperty(this.ERROR.properties.prototype,"message","",t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"name","Error",t.NONENUMERABLE_DESCRIPTOR);var n=function(n){var i=r.createNativeFunction(function(e){if(r.calledWithNew())var n=this;else n=r.createObject(i);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n},!0);return r.setProperty(i,"prototype",r.createObject(r.ERROR)),r.setProperty(i.properties.prototype,"name",n,t.NONENUMERABLE_DESCRIPTOR),r.setProperty(e,n,i),i};this.EVAL_ERROR=n("EvalError"),this.RANGE_ERROR=n("RangeError"),this.REFERENCE_ERROR=n("ReferenceError"),this.SYNTAX_ERROR=n("SyntaxError"),this.TYPE_ERROR=n("TypeError"),this.URI_ERROR=n("URIError")},t.prototype.initMath=function(e){var r=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(e,"Math",r);for(var n=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],i=0;i<n.length;i++)this.setProperty(r,n[i],Math[n[i]],t.READONLY_NONENUMERABLE_DESCRIPTOR);var o=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(i=0;i<o.length;i++)this.setProperty(r,o[i],this.createNativeFunction(Math[o[i]],!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initJSON=function(t){var e=this,r=e.createObjectProto(this.OBJECT_PROTO);this.setProperty(t,"JSON",r);var n=function(t){try{var r=JSON.parse(t.toString())}catch(t){e.throwException(e.SYNTAX_ERROR,t.message)}return e.nativeToPseudo(r)};this.setProperty(r,"parse",this.createNativeFunction(n,!1)),n=function(t){var r=e.pseudoToNative(t);try{var n=JSON.stringify(r)}catch(t){e.throwException(e.TYPE_ERROR,t.message)}return n},this.setProperty(r,"stringify",this.createNativeFunction(n,!1))},t.prototype.isa=function(t,e){if(null==t||!e)return!1;var r=e.properties.prototype;if(t===r)return!0;for(var n=this.getPrototype(t);n;){if(n===r)return!0;n=n.proto}return!1},t.legalArrayLength=function(t){var e=t>>>0;return e===Number(t)?e:NaN},t.legalArrayIndex=function(t){var e=t>>>0;return String(e)===String(t)&&4294967295!==e?e:NaN},t.prototype.createObject=function(t){return this.createObjectProto(t&&t.properties.prototype)},t.prototype.createObjectProto=function(t){var e=new M(t);return this.isa(e,this.FUNCTION)&&(this.setProperty(e,"prototype",this.createObjectProto(this.OBJECT_PROTO||null)),e.class="Function"),this.isa(e,this.ARRAY)&&(this.setProperty(e,"length",0,{configurable:!1,enumerable:!1,writable:!0}),e.class="Array"),this.isa(e,this.ERROR)&&(e.class="Error"),e},t.prototype.populateRegExp=function(e,r){e.data=r,this.setProperty(e,"lastIndex",r.lastIndex,t.NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"source",r.source,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"global",r.global,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"ignoreCase",r.ignoreCase,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"multiline",r.multiline,t.READONLY_NONENUMERABLE_DESCRIPTOR)},t.prototype.createFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.parentScope=r,n.node=e,this.setProperty(n,"length",n.node.params.length,t.READONLY_DESCRIPTOR),n},t.prototype.createNativeFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.nativeFunc=e,e.id=this.functionCounter_++,this.setProperty(n,"length",e.length,t.READONLY_DESCRIPTOR),r?this.setProperty(n.properties.prototype,"constructor",n,t.NONENUMERABLE_DESCRIPTOR):!1===r&&(n.illegalConstructor=!0,this.setProperty(n,"prototype",void 0)),n},t.prototype.createAsyncFunction=function(e){var r=this.createObjectProto(this.FUNCTION_PROTO);return r.asyncFunc=e,e.id=this.functionCounter_++,this.setProperty(r,"length",e.length,t.READONLY_DESCRIPTOR),r},t.prototype.nativeToPseudo=function(t){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(t instanceof RegExp){var e=this.createObjectProto(this.REGEXP_PROTO);return this.populateRegExp(e,t),e}if(t instanceof Function){var r=this;return this.createNativeFunction(function(){return r.nativeToPseudo(t.apply(r,Array.prototype.slice.call(arguments).map(function(t){return r.pseudoToNative(t)})))},void 0)}var n;if(Array.isArray(t)){n=this.createObjectProto(this.ARRAY_PROTO);for(var i=0;i<t.length;i++)i in t&&this.setProperty(n,i,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]))}else for(var o in n=this.createObjectProto(this.OBJECT_PROTO),t)this.setProperty(n,o,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]));return n},t.prototype.pseudoToNative=function(t,e){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(this.isa(t,this.REGEXP))return t.data;var r,n=e||{pseudo:[],native:[]};if(-1!==(o=n.pseudo.indexOf(t)))return n.native[o];if(n.pseudo.push(t),this.isa(t,this.ARRAY)){r=[],n.native.push(r);for(var i=this.getProperty(t,"length"),o=0;o<i;o++)this.hasProperty(t,o)&&(r[o]=this.unwrap?this.unwrap(this.getProperty(t,o),n):this.pseudoToNative(this.getProperty(t,o),n))}else{if(t._native)return t._native;var s;for(var a in r={},n.native.push(r),t.properties)s=t.properties[a],r[a]=this.unwrap?this.unwrap(s,n):this.pseudoToNative(s,n)}return n.pseudo.pop(),n.native.pop(),r},t.prototype.getPrototype=function(t){switch(typeof t){case"number":return this.NUMBER.properties.prototype;case"boolean":return this.BOOLEAN.properties.prototype;case"string":return this.STRING.properties.prototype}return t?t.proto:null},t.prototype.getProperty=function(e,r){if(r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot read property '"+r+"' of "+e),"length"===r){if(this.isa(e,this.STRING))return String(e).length}else if(r.charCodeAt(0)<64&&this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return String(e)[n]}do{var i=e;if(i.properties&&r in i.properties){var o=i.getter[r];return o?(o.isGetter=!0,o):i.properties[r]}if(void 0!==i._native&&"_"!==r.charAt(0)&&"function"!=typeof i._native[r])return this.wrap?this.wrap(i._native[r]):i._native[r]}while(e=this.getPrototype(e))},t.prototype.hasProperty=function(e,r){if(!e.isObject)throw TypeError("Primitive data type has no properties");if("length"===(r=String(r))&&this.isa(e,this.STRING))return!0;if(this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return!0}do{var i=e;if(i.properties&&r in i.properties)return!0;if(void 0!==i._native&&"_"!=r.charAt(0)){var o=typeof i._native[r];return"function"!==o&&("undefined"!==o||V(i._native.constructor,r))}}while(e=this.getPrototype(e));return!1},t.prototype.setProperty=function(e,r,n,i){r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of "+e),i&&("get"in i||"set"in i)&&("value"in i||"writable"in i)&&this.throwException(this.TYPE_ERROR,"Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");var o=!this.stateStack||this.getScope().strict;if(e.isObject){if(this.isa(e,this.STRING)){var s=t.legalArrayIndex(r);if("length"===r||!isNaN(s)&&s<String(e).length)return void(o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of String '"+e.data+"'"))}if("Array"===e.class){var a,u=e.properties.length;if("length"===r){if(n=t.legalArrayLength(n),isNaN(n)&&this.throwException(this.RANGE_ERROR,"Invalid array length"),n<u)for(a in e.properties)a=t.legalArrayIndex(a),!isNaN(a)&&n<=a&&delete e.properties[a]}else isNaN(a=t.legalArrayIndex(r))||(e.properties.length=Math.max(u,a+1))}if(!e.preventExtensions||r in e.properties)if(i){"get"in i&&(i.get?e.getter[r]=i.get:delete e.getter[r]),"set"in i&&(i.set?e.setter[r]=i.set:delete e.setter[r]);var p={};"configurable"in i&&(p.configurable=i.configurable),"enumerable"in i&&(p.enumerable=i.enumerable),"writable"in i&&(p.writable=i.writable,delete e.getter[r],delete e.setter[r]),"value"in i?(p.value=i.value,delete e.getter[r],delete e.setter[r]):n!==ReferenceError&&(p.value=n,delete e.getter[r],delete e.setter[r]);try{Object.defineProperty(e.properties,r,p)}catch(t){this.throwException(this.TYPE_ERROR,"Cannot redefine property: "+r)}}else{if(n===ReferenceError)throw ReferenceError("Value not specified.");if(void 0!==e._native&&"_"!=r.charAt(0)){var c=typeof e._native[r];if("function"!==c&&("undefined"!==c||V(e._native.constructor,r))){var l=this.unwrap?this.unwrap(n):n;return void(e._native[r]=l)}}for(var h=e;!(r in h.properties);)if(!(h=this.getPrototype(h))){h=e;break}if(h.setter&&h.setter[r])return h.setter[r];if(h.getter&&h.getter[r])o&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of object '"+e+"' which only has a getter");else try{e.properties[r]=n}catch(t){o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of object '"+e+"'")}}else o&&this.throwException(this.TYPE_ERROR,"Can't add property '"+r+"', object is not extensible")}else o&&this.throwException(this.TYPE_ERROR,"Can't create property '"+r+"' on '"+e+"'")},t.prototype.setNativeFunctionPrototype=function(e,r,n){this.setProperty(e.properties.prototype,r,this.createNativeFunction(n,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.getScope=function(){var t=this.stateStack[this.stateStack.length-1].scope;if(!t)throw Error("No scope found.");return t},t.prototype.createScope=function(t,e){var r=this.createObjectProto(null);if(r.parentScope=e,e||this.initGlobalScope(r),this.populateScope_(t,r),r.strict=!1,e&&e.strict)r.strict=!0;else{var n=t.body&&t.body[0];n&&n.expression&&"Literal"===n.expression.type&&"use strict"===n.expression.value&&(r.strict=!0)}return r},t.prototype.createSpecialScope=function(t,e){if(!t)throw Error("parentScope required");var r=e||this.createObjectProto(null);return r.parentScope=t,r.strict=t.strict,r},t.prototype.getValueFromScope=function(t){for(var e=this.getScope();e&&e!==this.global;){if(t in e.properties)return e.properties[t];e=e.parentScope}if(e===this.global&&this.hasProperty(e,t))return this.getProperty(e,t);var r=this.stateStack[this.stateStack.length-1].node;"UnaryExpression"===r.type&&"typeof"===r.operator||this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.setValueToScope=function(t,e){for(var r=this.getScope(),n=r.strict;r&&r!==this.global;){if(t in r.properties)return void(r.properties[t]=e);r=r.parentScope}if(r===this.global&&(!n||this.hasProperty(r,t)))return this.setProperty(r,t,e);this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.populateScope_=function(e,r){if("VariableDeclaration"===e.type)for(var n=0;n<e.declarations.length;n++)this.setProperty(r,e.declarations[n].id.name,void 0,t.VARIABLE_DESCRIPTOR);else{if("FunctionDeclaration"===e.type)return void this.setProperty(r,e.id.name,this.createFunction(e,r),t.VARIABLE_DESCRIPTOR);if("FunctionExpression"===e.type)return;if("ExpressionStatement"===e.type)return}var i=e.constructor;for(var o in e){var s=e[o];if(s&&"object"==typeof s)if(Array.isArray(s))for(n=0;n<s.length;n++)s[n]&&s[n].constructor===i&&this.populateScope_(s[n],r);else s.constructor===i&&this.populateScope_(s,r)}},t.prototype.stripLocations_=function(t,e,r){for(var n in e?t.start=e:delete t.start,r?t.end=r:delete t.end,t)if(t.hasOwnProperty(n)){var i=t[n];i&&"object"==typeof i&&this.stripLocations_(i,e,r)}},t.prototype.calledWithNew=function(){return this.stateStack[this.stateStack.length-1].isConstructor},t.prototype.getValue=function(e){return e[0]===t.SCOPE_REFERENCE?this.getValueFromScope(e[1]):this.getProperty(e[0],e[1])},t.prototype.setValue=function(e,r){return e[0]===t.SCOPE_REFERENCE?this.setValueToScope(e[1],r):this.setProperty(e[0],e[1],r)},t.prototype.throwException=function(e,r){if(void 0===r)var n=e;else n=this.createObject(e),this.setProperty(n,"message",r,t.NONENUMERABLE_DESCRIPTOR);throw this.executeException(n),t.STEP_ERROR},t.prototype.executeException=function(t){var e,r=this.stateStack.slice();do{this.stateStack.pop();var n=this.stateStack[this.stateStack.length-1];if("TryStatement"===n.node.type)return void(n.throwValue=t)}while(n&&"Program"!==n.node.type);if(this.isa(t,this.ERROR)){var i={EvalError:EvalError,RangeError:RangeError,ReferenceError:ReferenceError,SyntaxError:SyntaxError,TypeError:TypeError,URIError:URIError},o=this.getProperty(t,"name").toString(),s=this.getProperty(t,"message").valueOf();e=(i[o]||Error)(s)}else e=t.toString();throw this.stateStack=r,e},t.prototype.createGetter_=function(t,e){var r=Array.isArray(e)?e[0]:e,n=new this.nodeConstructor;n.type="CallExpression";var i=new D(n,this.stateStack[this.stateStack.length-1].scope);return i.doneCallee_=!0,i.funcThis_=r,i.func_=t,i.doneArgs_=!0,i.arguments_=[],i},t.prototype.createSetter_=function(t,e,r){var n=Array.isArray(e)?e[0]:this.global,i=new this.nodeConstructor;i.type="CallExpression";var o=new D(i,this.stateStack[this.stateStack.length-1].scope);return o.doneCallee_=!0,o.funcThis_=n,o.func_=t,o.doneArgs_=!0,o.arguments_=[r],o},t.prototype.stepArrayExpression=function(t,e,r){var n=r.elements,i=e.n_||0;for(e.array_?(this.setProperty(e.array_,i,e.value),i++):(e.array_=this.createObjectProto(this.ARRAY_PROTO),e.array_.properties.length=n.length);i<n.length;){if(n[i])return e.n_=i,new D(n[i],e.scope);i++}t.pop(),t[t.length-1].value=e.array_},t.prototype.stepAssignmentExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new D(r.left,e.scope);return n.components=!0,n}if(!e.doneRight_){if(e.leftReference_||(e.leftReference_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_&&"="!==r.operator){var i=this.getValue(e.leftReference_);if(e.leftValue_=i,i&&"object"==typeof i&&i.isGetter){i.isGetter=!1,e.doneGetter_=!0;var o=i;return this.createGetter_(o,e.leftReference_)}}return e.doneRight_=!0,new D(r.right,e.scope)}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);var s=e.leftValue_,a=e.value;switch(r.operator){case"=":s=a;break;case"+=":s+=a;break;case"-=":s-=a;break;case"*=":s*=a;break;case"/=":s/=a;break;case"%=":s%=a;break;case"<<=":s<<=a;break;case">>=":s>>=a;break;case">>>=":s>>>=a;break;case"&=":s&=a;break;case"^=":s^=a;break;case"|=":s|=a;break;default:throw SyntaxError("Unknown assignment expression: "+r.operator)}var u=this.setValue(e.leftReference_,s);if(u)return e.doneSetter_=s,this.createSetter_(u,e.leftReference_,s);t.pop(),t[t.length-1].value=s},t.prototype.stepBinaryExpression=function(t,e,r){if(!e.doneLeft_)return e.doneLeft_=!0,new D(r.left,e.scope);if(!e.doneRight_)return e.doneRight_=!0,e.leftValue_=e.value,new D(r.right,e.scope);t.pop();var n,i=e.leftValue_,o=e.value;switch(r.operator){case"==":n=i==o;break;case"!=":n=i!=o;break;case"===":n=i===o;break;case"!==":n=i!==o;break;case">":n=i>o;break;case">=":n=i>=o;break;case"<":n=i<o;break;case"<=":n=i<=o;break;case"+":n=i+o;break;case"-":n=i-o;break;case"*":n=i*o;break;case"/":n=i/o;break;case"%":n=i%o;break;case"&":n=i&o;break;case"|":n=i|o;break;case"^":n=i^o;break;case"<<":n=i<<o;break;case">>":n=i>>o;break;case">>>":n=i>>>o;break;case"in":o&&o.isObject||this.throwException(this.TYPE_ERROR,"'in' expects an object, not '"+o+"'"),n=this.hasProperty(o,i);break;case"instanceof":this.isa(o,this.FUNCTION)||this.throwException(this.TYPE_ERROR,"Right-hand side of instanceof is not an object"),n=!!i.isObject&&this.isa(i,o);break;default:throw SyntaxError("Unknown binary operator: "+r.operator)}t[t.length-1].value=n},t.prototype.stepBlockStatement=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new D(i,e.scope);t.pop()},t.prototype.stepBreakStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name);e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(n){if(e.labels&&-1!==e.labels.indexOf(n))return}else if(e.isLoop||e.isSwitch)return;e=t.pop()}throw SyntaxError("Illegal break statement")},t.prototype.stepCallExpression=function(e,r,n){if(!r.doneCallee_){r.doneCallee_=1;var i=new D(n.callee,r.scope);return i.components=!0,i}if(1===r.doneCallee_){r.doneCallee_=2;var o=r.value;if(Array.isArray(o)){if(r.func_=this.getValue(o),o[0]!==t.SCOPE_REFERENCE&&(r.funcThis_=o[0]),(o=r.func_)&&"object"==typeof o&&o.isGetter)return o.isGetter=!1,r.doneCallee_=1,this.createGetter_(o,r.value)}else r.func_=o;r.arguments_=[],r.n_=0}if(o=r.func_,!r.doneArgs_){if(0!==r.n_&&r.arguments_.push(r.value),n.arguments[r.n_])return new D(n.arguments[r.n_++],r.scope);"NewExpression"===n.type?(o.illegalConstructor&&this.throwException(this.TYPE_ERROR,o+" is not a constructor"),r.funcThis_=this.createObject(o),r.isConstructor=!0):void 0===r.funcThis_&&(r.funcThis_=r.scope.strict?void 0:this.global),r.doneArgs_=!0}if(r.doneExec_)e.pop(),r.isConstructor&&"object"!=typeof r.value?e[e.length-1].value=r.funcThis_:e[e.length-1].value=r.value;else{r.doneExec_=!0,o&&o.isObject||(console.log("non-function called",o,r),this.throwException(this.TYPE_ERROR,o+" is not a function"));var s=o.node;if(s){for(var a=this.createScope(s.body,o.parentScope),u=0;u<s.params.length;u++){var p=s.params[u].name,c=r.arguments_.length>u?r.arguments_[u]:void 0;this.setProperty(a,p,c)}var l=this.createObjectProto(this.ARRAY_PROTO);for(u=0;u<r.arguments_.length;u++)this.setProperty(l,u,r.arguments_[u]);this.setProperty(a,"arguments",l);var h=s.id&&s.id.name;return h&&this.setProperty(a,h,o),this.setProperty(a,"this",r.funcThis_,t.READONLY_DESCRIPTOR),r.value=void 0,new D(s.body,a)}if(o.eval){var d=r.arguments_[0];if("string"==typeof d){try{var f=t.acorn.parse(d.toString(),t.PARSE_OPTIONS)}catch(t){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+t.message)}var y=new this.nodeConstructor;return y.type="EvalProgram_",y.body=f.body,this.stripLocations_(y,n.start,n.end),(a=r.scope).strict?a=this.createScope(f,a):this.populateScope_(f,a),this.value=void 0,new D(y,a)}r.value=d}else if(o.nativeFunc)void 0!==r.funcThis_&&void 0!==r.funcThis_._native?r.value=o.nativeFunc.call(r.funcThis_,r.arguments_):r.value=o.nativeFunc.apply(r.funcThis_,r.arguments_);else{if(o.asyncFunc){var g=this,v=r.arguments_.concat(function(t){r.value=t,g.paused_=!1});return this.paused_=!0,void o.asyncFunc.apply(r.funcThis_,v)}this.throwException(this.TYPE_ERROR,o.class+" is not a function")}}},t.prototype.stepCatchClause=function(t,e,r){if(!e.done_){e.done_=!0;var n=this.createSpecialScope(e.scope);return this.setProperty(n,r.param.name,e.throwValue),new D(r.body,n)}t.pop()},t.prototype.stepConditionalExpression=function(t,e,r){var n=e.mode_||0;if(0===n)return e.mode_=1,new D(r.test,e.scope);if(1===n){e.mode_=2;var i=Boolean(e.value);if(i&&r.consequent)return new D(r.consequent,e.scope);if(!i&&r.alternate)return new D(r.alternate,e.scope);this.value=void 0}t.pop(),"ConditionalExpression"===r.type&&(t[t.length-1].value=e.value)},t.prototype.stepContinueStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name),e=t[t.length-1];e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(e.isLoop&&(!n||e.labels&&-1!==e.labels.indexOf(n)))return;t.pop(),e=t[t.length-1]}throw SyntaxError("Illegal continue statement")},t.prototype.stepDebuggerStatement=function(t,e,r){t.pop()},t.prototype.stepDoWhileStatement=function(t,e,r){if("DoWhileStatement"===r.type&&void 0===e.test_&&(e.value=!0,e.test_=!0),!e.test_)return e.test_=!0,new D(r.test,e.scope);if(e.value){if(r.body)return e.test_=!1,e.isLoop=!0,new D(r.body,e.scope)}else t.pop()},t.prototype.stepEmptyStatement=function(t,e,r){t.pop()},t.prototype.stepEvalProgram_=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new D(i,e.scope);t.pop(),t[t.length-1].value=this.value},t.prototype.stepExpressionStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new D(r.expression,e.scope);t.pop(),this.value=e.value},t.prototype.stepForInStatement=function(e,r,n){if(!r.doneInit_&&(r.doneInit_=!0,n.left.declarations&&n.left.declarations[0].init))return r.scope.strict&&this.throwException(this.SYNTAX_ERROR,"for-in loop variable declaration may not have an initializer."),new D(n.left,r.scope);if(!r.doneObject_)return r.doneObject_=!0,r.variable_||(r.variable_=r.value),new D(n.right,r.scope);if(r.isLoop||(r.isLoop=!0,r.object_=r.value,r.visited_=Object.create(null)),void 0===r.name_){t:do{if(r.object_&&r.object_.isObject){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_.properties));do{var i=r.props_.shift()}while(i&&(r.visited_[i]||!Object.prototype.hasOwnProperty.call(r.object_.properties,i)));if(i&&(r.visited_[i]=!0,Object.prototype.propertyIsEnumerable.call(r.object_.properties,i))){r.name_=i;break t}}else if(null!==r.object_){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_));do{i=r.props_.shift()}while(i&&r.visited_[i]);if(i){r.visited_[i]=!0,r.name_=i;break t}}r.object_=this.getPrototype(r.object_),r.props_=null}while(null!==r.object_);if(null===r.object_)return void e.pop()}if(!r.doneVariable_){r.doneVariable_=!0;var o=n.left;if("VariableDeclaration"!==o.type){r.variable_=null;var s=new D(o,r.scope);return s.components=!0,s}r.variable_=[t.SCOPE_REFERENCE,o.declarations[0].id.name]}if(r.variable_||(r.variable_=r.value),!r.doneSetter_){r.doneSetter_=!0;var a=r.name_,u=this.setValue(r.variable_,a);if(u)return this.createSetter_(u,r.variable_,a)}return r.name_=void 0,r.doneVariable_=!1,r.doneSetter_=!1,n.body?new D(n.body,r.scope):void 0},t.prototype.stepForStatement=function(t,e,r){var n=e.mode_||0;if(0===n){if(e.mode_=1,r.init)return new D(r.init,e.scope)}else if(1===n){if(e.mode_=2,r.test)return new D(r.test,e.scope)}else if(2===n){if(e.mode_=3,!r.test||e.value)return e.isLoop=!0,new D(r.body,e.scope);t.pop()}else if(3===n&&(e.mode_=1,r.update))return new D(r.update,e.scope)},t.prototype.stepFunctionDeclaration=function(t,e,r){t.pop()},t.prototype.stepFunctionExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.createFunction(r,e.scope)},t.prototype.stepIdentifier=function(e,r,n){if(e.pop(),r.components)e[e.length-1].value=[t.SCOPE_REFERENCE,n.name];else{var i=this.getValueFromScope(n.name);if(i&&"object"==typeof i&&i.isGetter){i.isGetter=!1;for(var o=r.scope;!this.hasProperty(o,n.name);)o=o.parentScope;var s=i;return this.createGetter_(s,this.global)}e[e.length-1].value=i}},t.prototype.stepIfStatement=function(t,e,r){return this.stepConditionalExpression(t,e,r)},t.prototype.stepLabeledStatement=function(t,e,r){t.pop();var n=e.labels||[];n.push(r.label.name);var i=new D(r.body,e.scope);return i.labels=n,i},t.prototype.stepLiteral=function(t,e,r){t.pop();var n=r.value;if(n instanceof RegExp){var i=this.createObjectProto(this.REGEXP_PROTO);this.populateRegExp(i,n),n=i}t[t.length-1].value=n},t.prototype.stepLogicalExpression=function(t,e,r){if("&&"!==r.operator&&"||"!==r.operator)throw SyntaxError("Unknown logical operator: "+r.operator);if(!e.doneLeft_)return e.doneLeft_=!0,new D(r.left,e.scope);if(e.doneRight_)t.pop(),t[t.length-1].value=e.value;else{if(!("&&"===r.operator&&!e.value||"||"===r.operator&&e.value))return e.doneRight_=!0,new D(r.right,e.scope);t.pop(),t[t.length-1].value=e.value}},t.prototype.stepMemberExpression=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new D(r.object,e.scope);var n;if(r.computed){if(!e.doneProperty_)return e.object_=e.value,e.doneProperty_=!0,new D(r.property,e.scope);n=e.value}else e.object_=e.value,n=r.property.name;if(t.pop(),e.components)t[t.length-1].value=[e.object_,n];else{var i=this.getProperty(e.object_,n);if(i&&"object"==typeof i&&i.isGetter){i.isGetter=!1;var o=i;return this.createGetter_(o,e.object_)}t[t.length-1].value=i}},t.prototype.stepNewExpression=function(t,e,r){return this.stepCallExpression(t,e,r)},t.prototype.stepObjectExpression=function(t,e,r){var n=e.n_||0,i=r.properties[n];if(e.object_){var o=i.key;if("Identifier"===o.type)var s=o.name;else{if("Literal"!==o.type)throw SyntaxError("Unknown object structure: "+o.type);s=o.value}e.properties_[s]||(e.properties_[s]={}),e.properties_[s][i.kind]=e.value,e.n_=++n,i=r.properties[n]}else e.object_=this.createObjectProto(this.OBJECT_PROTO),e.properties_=Object.create(null);if(i)return new D(i.value,e.scope);for(var a in e.properties_){var u=e.properties_[a];if("get"in u||"set"in u){var p={configurable:!0,enumerable:!0,get:u.get,set:u.set};this.setProperty(e.object_,a,null,p)}else this.setProperty(e.object_,a,u.init)}t.pop(),t[t.length-1].value=e.object_},t.prototype.stepProgram=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.done=!1,e.n_=n+1,new D(i,e.scope);e.done=!0},t.prototype.stepReturnStatement=function(t,e,r){if(r.argument&&!e.done_)return e.done_=!0,new D(r.argument,e.scope);var n=e.value,i=t.length-1;for(e=t[i];"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if("TryStatement"!==e.node.type&&t.splice(i,1),--i<0)throw SyntaxError("Illegal return statement");e=t[i]}e.value=n},t.prototype.stepSequenceExpression=function(t,e,r){var n=e.n_||0,i=r.expressions[n];if(i)return e.n_=n+1,new D(i,e.scope);t.pop(),t[t.length-1].value=e.value},t.prototype.stepSwitchStatement=function(t,e,r){if(!e.test_)return e.test_=1,new D(r.discriminant,e.scope);for(1===e.test_&&(e.test_=2,e.switchValue_=e.value);;){var n=e.index_||0,i=r.cases[n];if(e.matched_||!i||i.test)if(i||e.matched_||!e.defaultCase_){if(!i)return void t.pop();if(!e.matched_&&!e.tested_&&i.test)return e.tested_=!0,new D(i.test,e.scope);if(e.matched_||e.value===e.switchValue_){e.matched_=!0;var o=e.n_||0;if(i.consequent[o])return e.isSwitch=!0,e.n_=o+1,new D(i.consequent[o],e.scope)}e.tested_=!1,e.n_=0,e.index_=n+1}else e.matched_=!0,e.index_=e.defaultCase_;else e.defaultCase_=n,e.index_=n+1}},t.prototype.stepThisExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.getValueFromScope("this")},t.prototype.stepThrowStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new D(r.argument,e.scope);this.throwException(e.value)},t.prototype.stepTryStatement=function(t,e,r){if(!e.doneBlock_)return e.doneBlock_=!0,new D(r.block,e.scope);if(e.throwValue&&!e.doneHandler_&&r.handler){e.doneHandler_=!0;var n=new D(r.handler,e.scope);return n.throwValue=e.throwValue,e.throwValue=null,n}if(!e.doneFinalizer_&&r.finalizer)return e.doneFinalizer_=!0,new D(r.finalizer,e.scope);e.throwValue?this.executeException(e.throwValue):t.pop()},t.prototype.stepUnaryExpression=function(e,r,n){if(!r.done_){r.done_=!0;var i=new D(n.argument,r.scope);return i.components="delete"===n.operator,i}e.pop();var o=r.value;if("-"===n.operator)o=-o;else if("+"===n.operator)o=+o;else if("!"===n.operator)o=!o;else if("~"===n.operator)o=~o;else if("delete"===n.operator){var s=!0;if(Array.isArray(o)){var a=o[0];a===t.SCOPE_REFERENCE&&(a=r.scope);var u=String(o[1]);try{delete a.properties[u]}catch(t){r.scope.strict?this.throwException(this.TYPE_ERROR,"Cannot delete property '"+u+"' of '"+a+"'"):s=!1}}o=s}else if("typeof"===n.operator)o=o&&"Function"===o.class?"function":typeof o;else{if("void"!==n.operator)throw SyntaxError("Unknown unary operator: "+n.operator);o=void 0}e[e.length-1].value=o},t.prototype.stepUpdateExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new D(r.argument,e.scope);return n.components=!0,n}if(e.leftSide_||(e.leftSide_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_){var i=this.getValue(e.leftSide_);if(e.leftValue_=i,i&&"object"==typeof i&&i.isGetter){i.isGetter=!1,e.doneGetter_=!0;var o=i;return this.createGetter_(o,e.leftSide_)}}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);var s;if(i=Number(e.leftValue_),"++"===r.operator)s=i+1;else{if("--"!==r.operator)throw SyntaxError("Unknown update expression: "+r.operator);s=i-1}var a=r.prefix?s:i,u=this.setValue(e.leftSide_,s);if(u)return e.doneSetter_=a,this.createSetter_(u,e.leftSide_,s);t.pop(),t[t.length-1].value=a},t.prototype.stepVariableDeclaration=function(t,e,r){var n=r.declarations,i=e.n_||0,o=n[i];for(e.init_&&o&&(this.setValueToScope(o.id.name,e.value),e.init_=!1,o=n[++i]);o;){if(o.init)return e.n_=i,e.init_=!0,new D(o.init,e.scope);o=n[++i]}t.pop()},t.prototype.stepWithStatement=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new D(r.object,e.scope);if(!e.doneBody_){e.doneBody_=!0;var n=this.createSpecialScope(e.scope,e.value);return new D(r.body,n)}t.pop()},t.prototype.stepWhileStatement=function(t,e,r){return this.stepDoWhileStatement(t,e,r)},t.PARSE_OPTIONS={ecmaVersion:5},t.READONLY_DESCRIPTOR={configurable:!0,enumerable:!0,writable:!1},t.NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!0},t.READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!1},t.VARIABLE_DESCRIPTOR={configurable:!1,enumerable:!0,writable:!0},t.STEP_ERROR={},t.SCOPE_REFERENCE={},t.toStringCycles_=[],t}(),M=function(){function t(t){this.proto=null,this.isObject=!0,this.class="Object",this.data=null,this._native=void 0,this.getter=Object.create(null),this.setter=Object.create(null),this.properties=Object.create(null),this.proto=t}return t.prototype.toString=function(){if("Array"===this.class){(n=B.toStringCycles_).push(this);try{for(var t=[],e=0;e<this.properties.length;e++){var r=this.properties[e];t[e]=r&&r.isObject&&-1!==n.indexOf(r)?"...":r}}finally{n.pop()}return t.join(",")}if("Error"===this.class){var n,i,o;if(-1!==(n=B.toStringCycles_).indexOf(this))return"[object Error]";var s=this;do{if("name"in s.properties){i=s.properties.name;break}}while(s=s.proto);s=this;do{if("message"in s.properties){o=s.properties.message;break}}while(s=s.proto);n.push(this);try{i=i&&i.toString(),o=o&&o.toString()}finally{n.pop()}return o?i+": "+o:String(i)}return null!==this.data?String(this.data):"[object "+this.class+"]"},t.prototype.valueOf=function(){return void 0===this.data||null===this.data||this.data instanceof RegExp?this:this.data instanceof Date?this.data.valueOf():this.data},t}(),D=function(t,e){this.node=t,this.scope=e},V=function(t,e){for(var r=t;r&&r.prototype;){if(Object.getOwnPropertyNames(r.prototype).indexOf(e)>=0)return!0;r=Object.getPrototypeOf(r)}return!1};exports.TemplateClass=F,exports.loaders=L,B.Object=M,B.State=D;try{B.acorn=(self||t).acorn}catch(Mt){}function G(t,e){var r={},i=n.default.parse(t,{locations:!0,onComment:function(t,e,n,i,o,s){r[s.line]=e}});if("Program"!==i.type||1!==i.body.length||"FunctionDeclaration"!==i.body[0].type)throw new Error("this function does not follow the definition rule.");var o=i.body[0].body.body,s=[],a=[];return o.forEach(function(t){if("ExpressionStatement"===t.type){var n=t.expression;if("AssignmentExpression"===n.type&&"="===n.operator&&"MemberExpression"===n.left.type&&"ThisExpression"===n.left.object.type&&"Identifier"===n.left.property.type){for(var i=[],o=n.loc.start.line-1;o>=0&&void 0!==r[o];o--)i.push(r[o]);if(!(i.length<=0)){var u=n.left.property.name;if(!(Array.isArray(e)&&e.indexOf(u)>=0)&&"FunctionExpression"!==n.right.type){var p=function(t,e,r){var n={name:u,title:{},className:null,proposed:!1,initialValue:null};if(e.forEach(function(t){var e=t.indexOf("@ui ");if(e>=0)n.description=t.substring(e+"@ui ".length).trim();else{var r=t.indexOf("@title ");if(r>=0){var i=t.substring(r+"@title ".length).trim();0===i.indexOf("@ja ")?n.title.ja=i.substring("@ja ".length).trim():n.title.default=i}else if(t.indexOf("@proposed")>=0)n.proposed=!0;else{var o=t.indexOf("@comment ");if(o>=0){var s=t.substring(o+"@comment ".length).trim();return n.comment||(n.comment={}),void(0===s.indexOf("@ja ")?n.comment.ja=s.substring("@ja ".length).trim():n.comment.default=s)}}}}),!n.description&&!n.comment)return null;if(n.proposed||n.comment)return n;var i=n.description.indexOf("("),o=n.description.indexOf(")",i);if(!(i<0||o<0)){n.className=n.description.substr(0,i);try{var s=new B("["+n.description.substr(i+1,o-i-1)+"]"),a=Date.now();for(s.unwrap=null,s.wrap=null;s.step()&&!(Date.now()-a>100););n.params=s.pseudoToNative(s.value)}catch(t){}return n.params||(n.params=[]),n}}(0,i);a.push(n),p&&s.push(p)}}}}}),{widgets:s,fields:a,ast:i}}function Y(t,e){if(void 0===e&&(e=-1),!t)return{dependencyAtCursor:null,dependencies:[]};for(var r=[],i=null,o=("string"==typeof t?n.default.parse(t):t).body[0].body.body.slice(0);o.length>0;){var s=o.shift();if(null!=s)if("CallExpression"!==s.type)s.expression&&o.push(s.expression),s.object&&o.push(s.object),s.property&&o.push(s.property),s.name&&"string"!=typeof name&&o.push(s.name),s.left&&o.push(s.left),s.right&&o.push(s.right),s.id&&o.push(s.id),s.init&&o.push(s.init),s.callee&&o.push(s.callee),s.body&&Array.isArray(s.body)&&o.push.apply(o,s.body),s.declarations&&Array.isArray(s.declarations)&&o.push.apply(o,s.declarations),s.arguments&&Array.isArray(s.arguments)&&o.push.apply(o,s.arguments),s.params&&Array.isArray(s.params)&&o.push.apply(o,s.params);else if(s.callee.name&&"require"===s.callee.name){var a=s.arguments;if(a&&Array.isArray(a)&&1===a.length){var u=a[0];if("Literal"===u.type){var p=u.value;r.push(p),s.start&&s.end&&s.start<=e&&s.end>=e&&(i=p)}}}}return{dependencyAtCursor:i,dependencies:r}}B.acorn=n.default;var q=function(){function t(t,e,r){this.onTemplateLoad=r,this._emitter=null,this._loaded=null,this._loading=null,this.verbose=!1,this._emitter=e,this.clear(),t.addListener(this)}return Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._loaded={},this._loading={}},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),h(this,void 0,void 0,function(){var e;return d(this,function(n){switch(n.label){case 0:return[4,r.TemplateManager.list({maxResults:t,withoutAuthors:!0,withoutOriginalAuthors:!0,script:!0})];case 1:return(e=n.sent())&&e.list?(this.verbose&&console.log("--- loading template classes ---"),[2,this.registerMany(e.list)]):[2]}})})},t.prototype.loadForVideo=function(t){return h(this,void 0,void 0,function(){var e,n=this;return d(this,function(i){switch(i.label){case 0:return[4,r.TemplateManager.loadForVideo(t)];case 1:return(e=i.sent())&&e.list?(this.verbose&&console.log("--- loading template classes for vid:"+t+" ---"),[4,this.registerMany(e.list)]):[2,null];case 2:return[2,i.sent().map(function(t){return t?n.getByName(t):null})]}})})},t.prototype.loadByNames=function(t){return h(this,void 0,void 0,function(){var e,r=this;return d(this,function(n){switch(n.label){case 0:return!Array.isArray(t)||t.length<=0?[2,[]]:(this.verbose&&console.log("--- loading template classes ---"),[4,Promise.all(t.map(function(t){return r.doLoadByName(t)}))]);case 1:return(e=n.sent())&&this._emitter.onTemplatesLoad(e.filter(function(t){return!!t}).map(function(t){return t.className})),[2,e]}})})},t.prototype.loadByName=function(t){return h(this,void 0,void 0,function(){var e,r,n;return d(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.doLoadByName(t)];case 1:return e=i.sent(),r=null,[3,3];case 2:return n=i.sent(),r=n,[3,3];case 3:return this._emitter.onTemplatesLoad(e?[e.className]:null,r),[2,e]}})})},t.prototype.doLoadByName=function(t){return h(this,void 0,void 0,function(){var e,n,i=this;return d(this,function(o){return null!==(e=this.getByName(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(n=new Promise(function(e,n){return r.TemplateManager.loadByName(t).then(function(t){return i.onTemplateLoad(t)}).then(e)}),this._loading[t]=n,n.then(function(){return delete i._loading[t]}).catch(function(){return delete i._loading[t]}),[2,n])})})},t.prototype.loadById=function(t){return h(this,void 0,void 0,function(){var e,r,n;return d(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.doLoadById(t)];case 1:return e=i.sent(),r=null,[3,3];case 2:return n=i.sent(),r=n,[3,3];case 3:return this._emitter.onTemplatesLoad(e?[e.className]:null,r),[2,e]}})})},t.prototype.doLoadById=function(t){return h(this,void 0,void 0,function(){var e,n,i=this;return d(this,function(o){return(e=this.getById(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(n=new Promise(function(e,n){return h(i,void 0,void 0,function(){var n,i;return d(this,function(o){switch(o.label){case 0:return[4,r.TemplateManager.load(t)];case 1:return n=o.sent(),[4,this.onTemplateLoad(n)];case 2:return i=o.sent(),e(i),[2]}})})}),this._loading[t]=n,n.then(function(){return delete i._loading[t]}).catch(function(){return delete i._loading[t]}),[2,n])})})},t.prototype.registerMany=function(t){return h(this,void 0,void 0,function(){var e,r=this;return d(this,function(n){switch(n.label){case 0:return[4,Promise.all(t.map(function(t){return r.onTemplateLoad(t).then(function(t){return t.className}).catch(function(){return null})}))];case 1:return e=n.sent().filter(function(t){return!!t}),this._emitter.onTemplatesLoad(e),[2,e]}})})},t.prototype.commit=function(t,e){return h(this,void 0,void 0,function(){var n;return d(this,function(i){switch(i.label){case 0:return[4,r.TemplateManager.create({sourceId:t.model.sourceId,script:t.model.script,log:e})];case 1:return(n=i.sent()).success&&(t.model.id=n.id,this._emitter.onTemplateCommit(t.className)),[2,n]}})})},t.prototype.getByName=function(t,e){var r;if(void 0===e&&(e=!1),t&&(r=t.match(/(.+)@([0-9]+)/))){t=r[1];var n=parseInt(r[2]);if(!this._loaded[t])return null;var i=this._loaded[t].model;if(i.id!==n){if(!e)return null;this.verbose&&console.log("[warning] template "+t+" version "+n+" is requested but "+i.id+" is used")}}return this._loaded[t]?this._loaded[t]:null},t.prototype.getById=function(t){var e=null;for(var r in this._loaded)if(this._loaded[r].model.id===t){e=this._loaded[r];break}return e},t}();function z(t,r){if("object"!=typeof t||null===t)return t;if(t.type&&r[t.type]){var n;if("Color"===t.type){var i=new e.Color;i.r=Number(t.value.r),i.g=Number(t.value.g),i.b=Number(t.value.b),i.a=Number(t.value.a),n=i}else{for(var o=new r[t.type],s=0,a=Object.keys(t.value);s<a.length;s++){var u=a[s];o[u]=t.value[u]}n=o}return n}}function J(t){if(void 0!==t&&"function"!=typeof t){if("object"!=typeof t)return t;if(null===t)return null;if(t instanceof e.Color)return{type:"Color",value:{r:t.r,g:t.g,b:t.b,a:t.a}};throw new Error}}function W(t){return"boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t}B.acorn=n.default;var X={type:"ExpressionStatement",start:null,end:null,expression:{type:"CallExpression",start:null,end:null,expression:null,arguments:null},arguments:null},H=function(){function t(t,e,r){this.verbose=!1,this.wrapperTable=t,this.ignoredPropNames=e,this.isGraphics=r,this.initialize()}return t.prototype.initialize=function(){var t=this,e=new B("",function(e,r){t.globalScope=r});this.interpreter=e,this.interpreter.wrap=function(e){return t.wrap(e)},this.interpreter.unwrap=function(e,r){return t.unwrap(e,r)},this.wrappers={},Object.keys(this.wrapperTable).forEach(function(e){return t.wrapClass(t.wrapperTable[e],e)})},t.prototype.createGlobalFunction=function(t,e){var r,n=e.func,i=e.raw,o=e.isConstructor,s=e.async,a=this,u=function(){var t=Array.prototype.slice.call(arguments),e=n(i?t:t.map(function(e,r){return r<t.length-1||!s?a.unwrap(e):e}));return i?e:a.wrap(e)};r=s?this.interpreter.createAsyncFunction(u):this.interpreter.createNativeFunction(u,o),this.interpreter.setProperty(this.globalScope,t,r)},t.prototype.attachGetAssignedUnitMethod=function(t){var e=this,r=this.interpreter.createNativeFunction(function(r){return e.wrap(t.assignedUnit)});this.interpreter.setProperty(t.templateInstance,"getAssignedUnit",r)},t.prototype.setSizeProperties=function(t,e,r){this.interpreter.setProperty(this.globalScope,"width",t),this.interpreter.setProperty(this.globalScope,"height",e),this.interpreter.setProperty(this.globalScope,"margin",this.interpreter.wrap(r))},t.prototype.setDurationProperty=function(t){this.interpreter.setProperty(this.globalScope,"duration",t)},t.prototype.setProperty=function(t,e,r){this.interpreter.setProperty(t,e,this.wrap(r))},t.prototype.getProperty=function(t,e){return this.unwrap(this.interpreter.getProperty(t,e))},t.prototype.getRawProperty=function(t,e){return this.interpreter.getProperty(t,e)},t.prototype.prepareNewTemplate=function(t){var e=this.interpreter.createScope(t,this.globalScope);return this.interpreter.stateStack=[{node:t,scope:e,done:!1}],e},t.prototype.prepareNewTemplateStatement=function(t){return n.default.parse("new "+t+"();")},t.prototype.prepareNewInstance=function(t,e){var r=this.interpreter.createScope(n.default.parse(""),e);return this.interpreter.stateStack=[{node:t,scope:r,thisExpression:r}],r},t.prototype.exec=function(t,e,r,n){var i=this,o=this.interpreter;X.expression.arguments=[];var s=[];return r.forEach(function(t){X.expression.arguments.push(null),s.push(i.wrap(t))}),o.stateStack=[{node:{type:"Program",body:[X]},scope:this.globalScope,done:!0,n_:1},{node:X,scope:this.globalScope,done_:!0},{node:X.expression,doneCallee_:2,doneArgs_:!0,arguments_:s,funcThis_:t,func_:o.getProperty(t,e),scope:t,n_:s.length,value:[t,e]}],this.run(700,"call a method ("+t.className+"."+e+(n?" assigned to "+n.toString():"")+")")},t.prototype.run=function(t,e){var r=this.interpreter,n=Date.now(),i=!1;try{for(;r.step();)if(Date.now()-n>t){i=!0;break}}catch(o){throw this.verbose&&console.log(r.stateStack),"string"==typeof o&&(o=new Error(o)),r.stateStack.length>0&&(o.node=r.stateStack[r.stateStack.length-1].node),o}if(i){var o=new Error("timeout: spent too long time (> "+t+"ms) to "+e);throw r.stateStack.length>0&&(o.node=r.stateStack[0].node),o}return this.interpreter.value},t.prototype.getPrimitiveProperty=function(t,e){return"object"==typeof t&&"object"==typeof t.properties&&W(t.properties[e])?t.properties[e]:null},t.prototype.cleanupProperties=function(t){for(var e in this.ignoredPropNames.forEach(function(e){void 0!==t.properties[e]&&delete t.properties[e]}),t.properties)this.cleanupProperty(t.properties[e])||delete t.properties[e];return t.properties},t.prototype.cleanupProperty=function(t){if(W(t))return!0;var e=t;if(e._native)return!0;var r=this.globalScope.properties;if(e.parent===r.Array){for(var n=e.length,i=0;i<e.length;i++)this.cleanupProperty(e.properties[i])||(delete e.properties[i],n--);return e.length=n,n>0}if(e.parent===r.Object){var o=!0;for(var s in e.properties)this.cleanupProperty(e.properties[s])?o=!1:delete e.properties[s];return!o}return!1},t.prototype.restoreProperties=function(t,e){t.properties=l(l({},t.properties),e)},t.prototype.wrap=function(t){if("object"==typeof t&&null!==t&&void 0!==t.constructor&&"string"==typeof t.constructor.className){var e=t.constructor.className,r=this.wrappers[e];if(void 0===r)return;var n=this.interpreter.createObject(r);return n._native=t,n}return this.verbose&&(W(t)||Array.isArray(t)||console.log("wrap complex obj:",String(t))),this.interpreter.nativeToPseudo(t)},t.prototype.unwrap=function(t,e){return"object"==typeof t&&null!==t&&t._native?t._native:this.interpreter.pseudoToNative(t,e)},t.prototype.wrapClass=function(t,e){this.verbose&&console.log("--- wrapping "+e+" ---"),t.className=e;var r=this,n=this.interpreter.createNativeFunction(function(e){var i,o;if(i=r.interpreter.calledWithNew()?this:r.interpreter.createObjectProto(n.properties.prototype),void 0!==e)if(Array.isArray(e))for(var s=0;s<e.length;s++)o[s]=r.unwrap(e[s]);else o=r.unwrap(e);if(t){var a=Object.create(t.prototype),u=t.apply(a,[null].concat(o).splice(1));i._native=null!==u&&"object"==typeof u?u:a}return i});return this.interpreter.setProperty(this.globalScope,e,n),this.wrapStaticMembers(n,t),this.wrapInstanceMembers(n,t),this.wrappers[e]=n,n},t.prototype.wrapStaticMembers=function(t,e){var r=this,n=function(n){var o=n;if(i.interpreter.setProperty(t,n,ReferenceError,{get:function(){return r.wrap(e[o])},set:function(t){return e[o]=r.unwrap(t)}}),i.verbose){var s=void 0;try{s=typeof e[o]}catch(t){s="not accessible"}console.log("static "+o+" ("+s+")")}},i=this;for(var o in e)n(o)},t.prototype.wrapInstanceMembers=function(t,r){for(var n,i=new r,o=this.isGraphics(t),s=0,a=f(Object.keys(i),function(t){for(var e=t,r=[];e&&e.prototype;)r=f(r,Object.getOwnPropertyNames(e.prototype)),e=Object.getPrototypeOf(e);return r}(r)).filter(function(t,e,r){return r.indexOf(t)===e});s<a.length;s++){var u=a[s];if("constructor"!==u&&!this.interpreter.hasProperty(t,u)&&!this.interpreter.hasProperty(t.properties.prototype,u)&&"_"!==u.charAt(0)){if(this.verbose){var p=void 0;try{p=typeof i[u]}catch(t){p="not accessible"}n=u+" ("+p+")"}try{if("function"==typeof i[u]){var c;c=o?function(t,r){return function(n){return r.wrap(this._native[t].apply(this._native,n.map(function(t){var n=r.unwrap(t);return n instanceof e.Color?n.toString():n})))}}(u,this):function(t,e){return function(r){return e.wrap(this._native[t].apply(this._native,r.map(function(t){return e.unwrap(t)})))}}(u,this),this.interpreter.setProperty(t.properties.prototype,u,this.interpreter.createNativeFunction(c)),this.verbose&&(n+=" native method")}}catch(t){}this.verbose&&console.log(n)}}},t}();function $(t){return function(e){return Math.pow(e,t)}}function Z(t){return function(e){return 1-Math.pow(1-e,t)}}function Q(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}var K=$(2),tt=Z(2),et=Q(2),rt=$(3),nt=Z(3),it=Q(3),ot=$(4),st=Z(4),at=Q(4),ut=$(5),pt=Z(5),ct=Q(5);function lt(t){return function(e){return e*e*((t+1)*e-t)}}var ht=lt(1.7);function dt(t){return function(e){return--e*e*((t+1)*e+t)+1}}var ft=dt(1.7);function yt(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}var gt=yt(1.7);function vt(t){return 1-mt(1-t)}function mt(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function bt(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return-t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)}}var Et=bt(1,.3);function Pt(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return t*Math.pow(2,-10*n)*Math.sin((n-i)*r/e)+1}}var _t=Pt(1,.3);function wt(t,e){var r=2*Math.PI;return function(n){var i=e/r*Math.asin(1/t);return(n*=2)<1?t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)*-.5:t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*r/e)*.5+1}}var Ot=wt(1,.3*1.5),Rt=Object.freeze({__proto__:null,linear:function(t){return t},get:function(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0==t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},getPowIn:$,getPowOut:Z,getPowInOut:Q,quadIn:K,quadOut:tt,quadInOut:et,cubicIn:rt,cubicOut:nt,cubicInOut:it,quartIn:ot,quartOut:st,quartInOut:at,quintIn:ut,quintOut:pt,quintInOut:ct,sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return-.5*(Math.cos(Math.PI*t)-1)},getBackIn:lt,backIn:ht,getBackOut:dt,backOut:ft,getBackInOut:yt,backInOut:gt,circIn:function(t){return-(Math.sqrt(1-t*t)-1)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},bounceIn:vt,bounceOut:mt,bounceInOut:function(t){return t<.5?.5*vt(2*t):.5*mt(2*t-1)+.5},getElasticIn:bt,elasticIn:Et,getElasticOut:Pt,elasticOut:_t,getElasticInOut:wt,elasticInOut:Ot}),Tt={Matrix2D:e.Matrix2D,Point:e.Point,Color:e.Color,Font:e.Font,RenderingUnit:e.RenderingUnit,TextUnit:e.TextUnit,Graphic:e.Graphic,Phrase:e.Phrase,Word:e.Word,Char:e.Char,Beat:S,Segment:N,Voice:T},St=["headTime","tailTime","insomnia"],Nt=["animate","getAssignedUnit","name","type"],xt=function(){function t(t,e,r){this._emitter=null,this._player=null,this.interpreter=null,this.unsafeAcceleration=!1,this._verbose=!1,this.rawConsole=!1,this._player=t,this._emitter=e,this.unsafeAcceleration=r,this.loader=new q(t,e,this.register.bind(this)),t.addListener(this)}return Object.defineProperty(t.prototype,"verbose",{get:function(){return this._verbose},set:function(t){this._verbose=this.loader.verbose=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return!!this.interpreter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this.loader.loaded},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var t=this;if(!this.ready){var r=function(t){var r=t.player,n=t.ignoredPropNames,i=t.rawConsole,o=t.templateGetter,s=r.graphics.wrapperTable,a=new H(l(l({},Tt),s),n,function(t){return r.graphics.isGraphics(t)}),u={require:{func:function(t){if(!(t.length<1||"string"!=typeof t[0])){var e=t[0],r=o(e);return null===r?void 0:r.functionDefinition}},raw:!0,isConstructor:!0},print:{func:function(t){r.isEditing&&console.log.apply(console,t)},raw:i},findChorus:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:r.findChorus(t[0])}},findBeat:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:r.findBeat(t[0])}},findVoice:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:r.findVoice(t[0])}},getAmplitude:{func:function(t){return t.length<1||"number"!=typeof t[0]?-1:r.getAmplitude(t[0])}},getMaxAmplitude:{func:function(t){return r.getMaxAmplitude()}}};Object.keys(e.UnitTypes).forEach(function(t){a.setProperty(a.globalScope,t,e.UnitTypes[t]),u[t]={value:e.UnitTypes[t]}}),Object.keys(Rt).forEach(function(t){var e=Rt[t];0!==t.indexOf("get")&&(u[t]={func:e})});var p=Object.keys(a.wrapperTable);return p&&p.forEach(function(t){return u[t]={cls:a.wrapperTable[t]}}),Object.keys(u).forEach(function(t){var e=u[t];e.func?a.createGlobalFunction(t,e):e.value&&a.setProperty(a.globalScope,t,e.value)}),{interpreter:a,unsafeGlobalScope:u}}({player:this._player,ignoredPropNames:Nt,rawConsole:this.rawConsole,templateGetter:function(e){return t.getByName(e,!0)}}),n=r.interpreter,i=r.unsafeGlobalScope;this.unsafeGlobalScope=i,this.interpreter=n,this.onVideoReady(this._player.video)}},t.prototype.getByName=function(t,e){return void 0===e&&(e=!1),this.loader.getByName(t,e)},t.prototype.getById=function(t){return this.loader.getById(t)},t.prototype.clear=function(){this.loader.clear()},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),h(this,void 0,void 0,function(){return d(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadLatest(t)]})})},t.prototype.loadForVideo=function(t){return h(this,void 0,void 0,function(){return d(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadForVideo(t)]})})},t.prototype.loadByNames=function(t){return h(this,void 0,void 0,function(){return d(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadByNames(t)]})})},t.prototype.loadByName=function(t){return h(this,void 0,void 0,function(){return d(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadByName(t)]})})},t.prototype.loadById=function(t){return h(this,void 0,void 0,function(){return d(this,function(e){return this.ready||this.initialize(),[2,this.loader.loadById(t)]})})},t.prototype.commit=function(t,e){return h(this,void 0,void 0,function(){return d(this,function(r){return[2,this.loader.commit(t,e)]})})},t.prototype.register=function(t){return h(this,void 0,void 0,function(){var e,r,n,i,o=this;return d(this,function(s){switch(s.label){case 0:if(!t)return[2,null];if(!(e=this.createClass(t.script)))return[2,null];r=Y(e.ast).dependencies,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Promise.all(r.map(function(t){var e=o.getByName(t);return e?Promise.resolve(e):o.loadByName(t)}))];case 2:return s.sent(),this.verbose&&console.log("load dependencies for",e.className,r),[3,4];case 3:return n=s.sent(),this.verbose&&console.error("failed loading dependencies for",e.className,n),[3,4];case 4:try{if(!this.newRawInstance(e))throw new Error("failed to create a template instance");return e.model=t,[2,this.registerClass(e)]}catch(e){throw delete(i=l({},t)).script,{error:e.message,stack:e.stack,cause:i}}return[2]}})})},t.prototype.updateClassScript=function(t,e){var r=this.createClass(e);return this.updateClass(t,r)},t.prototype.registerClass=function(t){if(!t)return null;if(this.loader.loaded[t.className]){this.verbose&&console.log("updating",t.className,t.model.id);var e=this.updateClass(this.loader.loaded[t.className],t);return this.verbose&&console.log("updated",e.className,e.id),e}return this.loader.loaded[t.className]=t,this.verbose&&console.log("loaded",t.className,t.model.id),t},t.prototype.updateClass=function(t,e){var r=t,n=e;if(!n)return null;if(r.model.script===n.model.script&&n.id<0)return r;var i=this.newRawInstance(n);if(null===i)return null;if(n.id<0){var o=i.templateInstance,s=n.model.script;n.model={id:-1,sourceId:-1,className:n.className,prettyName:o?this.interpreter.getPrimitiveProperty(o,"name"):i.unsafeTemplateInstance.name,type:o?this.interpreter.getPrimitiveProperty(o,"type"):i.unsafeTemplateInstance.type,script:s,author:null,originalAuthor:null,createdDate:null}}if(r.className!==n.className){var a=this.getByName(n.className);if(!a)return n.cursor=r.cursor,this.loader.loaded[n.className]=n,this.verbose&&console.log("create",n.className),n;r=a}return r.newStatement=n.newStatement,r.widgets=n.widgets,r.scope=n.scope,r.functionDefinition=n.functionDefinition,r.newStatement=n.newStatement,r.unsafeConstructorGenerator=n.unsafeConstructorGenerator,r.ast=n.ast,r.cursor<0&&(r.cursor=n.cursor),n.id>=0?(this.verbose&&console.log("replace",n.className,r.id,n.id),r.model=n.model):(this.verbose&&console.log("update",n.className,r.id,n.id),r.model.type=n.model.type,r.model.className=n.model.className,r.model.prettyName=n.model.prettyName,r.model.script=n.model.script,r.model.createdDate=null,r.id>=0&&(r.model.sourceId=r.model.id,r.model.id=-1)),n=r,this.updateInstances(r.instances.slice(),n),this._emitter.onTemplateUpdate(n.className),n},t.prototype.updateInstances=function(t,e){var r=this;t.forEach(function(t){try{r.updateInstance(t,e)}catch(r){console.log("failed updating template for",t.assignedUnit,":",e)}}),this._player.isPlaying||this._player.requestStageUpdate()},t.prototype.createClass=function(t){var e=this;this.ready||this.initialize();var r=new F;r.model={id:-1,sourceId:-1,className:null,prettyName:null,type:0,script:t,author:null,originalAuthor:null,createdDate:null};var n=G(t,Nt),i=n.ast,o=n.widgets;if(r.ast=i,r.widgets=o,r.className=r.ast.body[0].id.name,r.scope=this.interpreter.prepareNewTemplate(r.ast),this.interpreter.run(1e3,"to define "+r.className),r.functionDefinition=this.interpreter.getRawProperty(r.scope,r.className),r.newStatement=this.interpreter.prepareNewTemplateStatement(r.className),this.unsafeAcceleration){var s=Object.keys(this.unsafeGlobalScope),a="return function(props){var "+Object.keys(this.getGlobalProperties()).map(function(t){return t+"=props."+t}).join(",")+";"+t+"return "+r.className+";}",u=new(Function.bind.apply(Function,f([void 0],s,[a]))),p=function(t){var r=e.getByName(t);return r?r.unsafeConstructorGenerator(e.getGlobalProperties()):null},c=s.map(function(t){if("require"===t)return p;var r=e.unsafeGlobalScope[t];return r.func?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.func(t)}:r.cls||r.value});r.unsafeConstructorGenerator=u.apply({},c)}return r},t.prototype.getGlobalProperties=function(){return{width:this._player.videoWidth,height:this._player.videoHeight,margin:this._player.margin,duration:this._player.video.duration}},t.prototype.newRawInstance=function(t){var e=t,r=new U;if(this.unsafeAcceleration){var n=new(e.unsafeConstructorGenerator(this.getGlobalProperties()));r.unsafeTemplateInstance=n}else{this.interpreter.prepareNewInstance(e.newStatement,e.scope);var i=this.interpreter.run(700,"to instantiate "+e.className);r.templateInstance=i,r.templateInstance._nativeInstance=r}return r.templateClass=e,r.ignore=!1,r},t.prototype.setProperty=function(t,e,r){this.unsafeAcceleration?t.unsafeTemplateInstance[e]=r:this.interpreter.setProperty(t.templateInstance,e,r)},t.prototype.getProperty=function(t,e){return this.unsafeAcceleration?t.unsafeTemplateInstance[e]:this.interpreter.getProperty(t.templateInstance,e)},t.prototype.exportInstance=function(t){for(var e={},r=0,n=t.templateClass.widgets.map(function(t){return t.name}).concat(St);r<n.length;r++){var i=n[r],o=this.getProperty(t,i);try{var s=J(o);void 0!==s&&(e[i]=s)}catch(e){console.error("cannot export "+t.templateClass.className+"."+i,o,"assigned to",t.assignedUnit)}}return{type:t.templateClass.className,value:e}},t.prototype.importInstances=function(t,e){try{for(var r=e.phrases,n=t.firstPhrase,i=0;null!==n;){var o=r[i++];this.importTemplates(n,o.templates);for(var s=n.firstWord,a=0;a<n.wordCount;a++){var u=o.words[a];this.importTemplates(s,u.templates);for(var p=s.firstChar,c=0;c<s.charCount;c++){var l=u.characters[c];this.importTemplates(p,l.templates),p=p.next}s=s.next}n=n.next}for(var h=e.graphics,d=t.firstGraphic,f=0;null!==d;){var y=h[f++];this.importTemplates(d,y.templates),d=d.next}}catch(t){return console.error("restoring templates failed",t),!1}return!0},t.prototype.importTemplates=function(t,e){if(Array.isArray(e))for(var r=0,n=e;r<n.length;r++){var i=n[r],o=this.importInstance(i);o&&t.addTemplate(o)}},t.prototype.importInstance=function(t){var e=this.getByName(t.type),r=this.newInstance(e);if(!r||!t.value)return null;for(var n=0,i=Object.keys(t.value);n<i.length;n++){var o=i[n],s=z(t.value[o],this.interpreter.wrapperTable);void 0!==s&&this.setProperty(r,o,s)}return r},t.prototype.updateInstance=function(t,e){var r=t,n=e,i=this.newRawInstance(n),o=r.templateInstance,s=this.interpreter.cleanupProperties(o);r.templateClass!==n&&(this.disposeInstance(r),n.instances.push(r)),r.templateClass=n,r.scope=i.scope,r.templateInstance=i.templateInstance,r.ignore=i.ignore,this.interpreter.restoreProperties(r.templateInstance,s),this.attachGetAssignedUnitMethod(r)},t.prototype.newInstance=function(t){var e;try{if(null===(e=this.newRawInstance(t)))return null}catch(t){return null}return this.attachGetAssignedUnitMethod(e),t.instances.push(e),e},t.prototype.attachGetAssignedUnitMethod=function(t){this.unsafeAcceleration?t.unsafeTemplateInstance.getAssignedUnit=function(){return t.assignedUnit}:this.interpreter.attachGetAssignedUnitMethod(t)},t.prototype.disposeInstance=function(t){var e=t.templateClass;e.instances=e.instances.filter(function(e){return e!==t})},t.prototype.disposeInstances=function(t){var e=this;t.forEach(function(t){return e.disposeInstance(t)})},t.prototype.setTemplate=function(t,e){this.clearTemplates(t),t.addTemplate(e)},t.prototype.removeTemplateAt=function(t,e){var r=t.removeTemplateAt(e);r&&this.disposeInstance(r)},t.prototype.clearTemplate=function(t){this.clearTemplates(t)},t.prototype.clearTemplates=function(t){var e=t.clearTemplates();this.disposeInstances(e)},t.prototype.getRequiredTemplates=function(t){return Y(t).dependencies},t.prototype.getRequiredTemplateAt=function(t,e){return Y(t,e).dependencyAtCursor},t.prototype.exec=function(t,e,r){if(t.unsafeTemplateInstance){var n=t.unsafeTemplateInstance;return n[e].apply(n,r)}var i=this.interpreter.exec(t.templateInstance,e,r,t.assignedUnit);return this.interpreter.unwrap(i)},t.prototype.declareVariable=function(t,e,r,n){return this.updateClassScript(t,function(t,e,r,n){try{var i=G(t),o=i.ast,s=i.fields,a=s[s.length-1],u=t.match(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/),p=u?u.pop():"\n",c=t.split(p),l=a?Array(a.loc.start.column+1).join(" "):"  ",h=a?a.loc.end.line:0;if(h<=0){var d=o.body[0].body,f=c[d.loc.start.line-1],y=f.substring(0,d.loc.start.column+1),g=f.substring(d.loc.start.column+1);c[d.loc.start.line-1]=y,c.splice(d.loc.start.line,0,g),h=d.loc.start.line}for(var v=void 0;(v="var"+Math.random().toString().substring(2)).length>8&&(v=v.substring(0,8)),!(t.indexOf(v)<0););c.length>h&&c[h].length>0&&c.splice(h,0,""),c.splice(h,0,"",l+"// @proposed",l+"// @title "+e,l+"// "+function(t,e){if("Slider"===t)return"@ui Slider("+e.min+", "+e.max+")";if("Check"===t)return"@ui Check()";if("Color"===t)return"@ui Color()";var r=e.etc;return"@comment "+(r=r.replace(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/g,"")).replace(/\/[\*\/]/g,"")}(r,n),l+"this."+v+" = "+function(t,e){return"Slider"===t?((e.min+e.max)/2).toString():"Check"===t?"false":"Color"===t?'new Color("#000000")':"null"}(r,n)+";"),t=c.join(p)}catch(t){}return t}(t.model.script,e,r,n))},t.prototype.onVideoReady=function(t){this.ready&&(this.interpreter.setSizeProperties(this._player.resolutionWidth,this._player.resolutionHeight,this._player.margin),this.interpreter.setDurationProperty(t?t.duration:0))},t}(),At=100,It=function(){function t(t){this.listeners=[],this.throttleInterval=t&&t.throttleInterval?Number(t.throttleInterval):100}return t.prototype.onVideoLoad=function(t,e){this.listeners.forEach(function(r){return r.onVideoLoad&&r.onVideoLoad(t,e)})},t.prototype.onSongLoad=function(t,e){this.listeners.forEach(function(r){return r.onSongLoad&&r.onSongLoad(t,e)})},t.prototype.onSongInfoLoad=function(t,e){this.listeners.forEach(function(r){return r.onSongInfoLoad&&r.onSongInfoLoad(t,e)})},t.prototype.onLyricsLoad=function(t,e){this.listeners.forEach(function(r){return r.onLyricsLoad&&r.onLyricsLoad(t,e)})},t.prototype.onTextLoad=function(t,e){this.listeners.forEach(function(r){return r.onTextLoad&&r.onTextLoad(t,e)})},t.prototype.onAppReady=function(t){this.listeners.forEach(function(e){return e.onAppReady&&e.onAppReady(t)})},t.prototype.onAppParameterUpdate=function(t,e){this.listeners.forEach(function(r){return r.onAppParameterUpdate&&r.onAppParameterUpdate(t,e)})},t.prototype.onAppMediaChange=function(t){this.listeners.forEach(function(e){return e.onAppMediaChange&&e.onAppMediaChange(t)})},t.prototype.onTemplateUpdate=function(t){this.listeners.forEach(function(e){return e.onTemplateUpdate&&e.onTemplateUpdate(t)})},t.prototype.onTemplateCommit=function(t){this.listeners.forEach(function(e){return e.onTemplateCommit&&e.onTemplateCommit(t)})},t.prototype.onTemplatesLoad=function(t,e){this.listeners.forEach(function(r){return r.onTemplatesLoad&&r.onTemplatesLoad(t,e)})},t.prototype.onFontsLoad=function(t,e){this.listeners.forEach(function(r){return r.onFontsLoad&&r.onFontsLoad(t,e)})},t.prototype.onVideoReady=function(t){this.listeners.forEach(function(e){return e.onVideoReady&&e.onVideoReady(t)})},t.prototype.onStageElementSet=function(t){this.listeners.forEach(function(e){return e.onStageElementSet&&e.onStageElementSet(t)})},t.prototype.onMediaElementSet=function(t){this.listeners.forEach(function(e){return e.onMediaElementSet&&e.onMediaElementSet(t)})},t.prototype.onTimeUpdate=function(t){var e=this;this.listeners.forEach(function(e){return e.onTimeUpdate&&e.onTimeUpdate(t)}),this.position=t,this.throttledTimeUpdate||(this.throttledTimeUpdate=new Promise(function(t,r){setTimeout(function(){e.onThrottledTimeUpdate(e.position),e.throttledTimeUpdate=null,t()},e.throttleInterval)}))},t.prototype.onThrottledTimeUpdate=function(t){this.listeners.forEach(function(e){return e.onThrottledTimeUpdate&&e.onThrottledTimeUpdate(t)})},t.prototype.onBackgroundGraphicsUpdate=function(t){this.listeners.forEach(function(e){return e.onBackgroundGraphicsUpdate&&e.onBackgroundGraphicsUpdate(t)})},t.prototype.onMediaSeek=function(t){this.listeners.forEach(function(e){return e.onMediaSeek&&e.onMediaSeek(t)})},t.prototype.onVideoSeek=function(t){this.listeners.forEach(function(e){return e.onVideoSeek&&e.onVideoSeek(t)})},t.prototype.onPlay=function(){this.listeners.forEach(function(t){return t.onPlay&&t.onPlay()})},t.prototype.onPause=function(){this.listeners.forEach(function(t){return t.onPause&&t.onPause()})},t.prototype.onStop=function(){this.listeners.forEach(function(t){return t.onStop&&t.onStop()})},t.prototype.onDispose=function(){this.listeners.forEach(function(t){return t.onDispose&&t.onDispose()})},t.prototype.onResize=function(t){this.listeners.forEach(function(e){return e.onResize&&e.onResize(t)})},t.prototype.addListener=function(t){!t||this.listeners.indexOf(t)>=0||this.listeners.push(t)},t.prototype.removeListener=function(t){this.listeners=this.listeners.filter(function(e){return e!==t})},t}(),Ct=function(){this.halted=[],this.errors=[]},kt=function(){function t(t){var e=this;this.player=null,this._scale=1,this.requestedTime=0,this.request=null,this.player=t,t.addListener({onResize:function(t){e.elementWidth=t.width,e.updateSize()},onVideoReady:function(){e.elementWidth=e.calcWidth(),e.updateSize()},onStageElementSet:function(t){e.elementWidth=e.calcWidth(),e.updateSize(),e.player.graphics.setCanvas(t)}})}return Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.updateSize()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.player.graphics.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.player.graphics.height},enumerable:!0,configurable:!0}),t.prototype.requestUpdate=function(t){return h(this,void 0,void 0,function(){var e=this;return d(this,function(r){return this.requestedTime=void 0===t?this.player.videoPosition:t,this.request||(this.request=new Promise(function(t,r){setTimeout(function(){try{e.update(e.requestedTime)}catch(t){}e.request=null,t(e.requestedTime)},0)})),[2,this.request]})})},t.prototype.update=function(t){t||(t=this.player.mediaPosition),"number"==typeof t&&(this.player.graphics.reset(),this.animate(t),this.player.graphics.update(),this.player.onStageUpdate(t))},t.prototype.animate=function(t){for(var e=new Ct,r=e.errors,n=e.halted,i=0,o=[this.player.video.firstPhrase,this.player.video.firstWord,this.player.video.firstChar,this.player.video.firstGraphic];i<o.length;i++)for(var s=o[i];s;)this.animateRenderingUnit(t,s,e),s=s.next;if(n.length>0){console.error("---");for(var a=0;a<n.length;a++)console.error("halted",n[a],r[a])}},t.prototype.animateRenderingUnit=function(t,r,n){if(r.animate)r.animate(t,r);else if(r.getNumTemplates()<=0)jt(r)&&r.getType()===e.UnitTypes.CHAR&&(r.rendering.visible=!1);else for(var i=0;i<r.getNumTemplates();i++)this.animateTemplate(t,r,r.getTemplate(i),n)},t.prototype.animateTemplate=function(t,r,n,i){var o=this;if(n.ignore)r.rendering.visible=!1;else{if(r.getType()!==e.UnitTypes.GRAPHIC)for(var s=r._parent;s;){if(s.getNumTemplates()>0&&(!s.rendering.visible||0===s.rendering.alpha))return void(r.rendering.visible=!1);s=s.parent}var a=this.player.templates.getProperty(n,"insomnia"),u=jt(r);if(!a&&u&&function(t,r,n,i){var o=i&&t(i,"headTime")||500,s=i&&t(i,"tailTime")||500;return!(n.startTime-o<=r&&n.endTime+s>=r)&&(n.getType()!==e.UnitTypes.GRAPHIC&&(n.rendering.visible=!1),!0)}(function(t,e){return o.player.templates.getProperty(t,e)},t,r,n))return;this.doAnimateTemplate(t,n,i)}},t.prototype.doAnimateTemplate=function(t,e,r){var n=r.errors,i=r.halted;try{this.player.templates.exec(e,"animate",[t])}catch(t){n.push(t),i.push(e)}},t.prototype.calcWidth=function(){var t=this.player.stageElement;if(!t)return 0;var e=window.getComputedStyle(t);return t.offsetWidth-s(e.borderLeftWidth)-s(e.borderRightWidth)-s(e.paddingLeft)-s(e.paddingRight)},t.prototype.updateSize=function(){var t=this.player.stageElement;if(t){var e=this.elementWidth*this.player.videoProportion;if(t.style.height=e+"px",t.width=this.elementWidth*this._scale,t.height=e*this._scale,this.player.video){var r=t.width/this.player.videoWidth;this.player.graphics.updateStageTx(r,this.player.margin),this.player.isPlaying||this.requestUpdate()}}},t}();function jt(t){if(t.getType()===e.UnitTypes.GRAPHIC)return!0;for(var r=!0,n=t.parent;n;){if(n.getNumTemplates()>0){r=!1;break}n=n.parent}return r}exports.defaultThrottleInterval=At;var Lt=function(){function t(t){this.managers=t}return t.prototype.createFromVideoId=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.managers.video.load(t)];case 1:return(r=n.sent())&&e?[2,l(l({},r),e)]:[2,r]}})})},t.prototype.createFromSongUrl=function(t,e){return h(this,void 0,void 0,function(){return d(this,function(r){return[2,this.createFromSongPath(this.managers.song.getSongPathFromUrl(t),e)]})})},t.prototype.createFromSongPath=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.managers.song.load({songPath:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}})})},t.prototype.createFromSongId=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.managers.song.load({id:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}})})},t.prototype.createFromSongCode=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.managers.song.load({code:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}})})},t.prototype.createFromSong=function(t,e){return h(this,void 0,void 0,function(){var r,n,i,o;return d(this,function(s){switch(s.label){case 0:return[4,this.managers.lyrics.load(t.code)];case 1:return r=s.sent(),(i=r&&!r.status.failed&&!r.status.processing&&Array.isArray(r.lyrics)&&r.lyrics.length>0)?[4,this.managers.lyrics.loadDetail(t.code,r.lyrics[0].id)]:[3,3];case 2:i=s.sent(),s.label=3;case 3:return n=i,o={id:-1,sourceId:-1,sourceOriginId:-1,songleId:t.id,songleCode:t.code,lyricId:n?n.id:-1,lyricDiffId:n&&n.diff?n.diff.id:-1,title:null,log:null,background:null,config:null,json:null,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null},e?[2,l(l({},o),e)]:[2,o]}})})},t.prototype.createFromText=function(t,e){return h(this,void 0,void 0,function(){var r,n,i,o,s,a;return d(this,function(u){switch(u.label){case 0:return[4,this.managers.text.parse(t)];case 1:return r=u.sent(),n=r&&"success"===r.status?this.createVideoDataFromParsedText(r,t):this.createVideoDataFromText(t),i=n[n.length-1],o=i&&i.words[i.words.length-1],s=o&&o.characters[o.characters.length-1],a=s?s.endTime:0,[2,this.createFromJSON({phrases:n,startTime:0,endTime:a,duration:a},e)]}})})},t.prototype.createFromJSON=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){return r={id:-1,sourceId:-1,sourceOriginId:-1,songleId:-1,lyricId:-1,lyricDiffId:-1,title:null,log:null,background:null,config:null,json:t,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null},e?[2,l(l({},r),e)]:[2,r]})})},t.prototype.createVideoDataFromParsedText=function(t,e){var r=0,n=e.split(/\r\n|[\n\v\f\r\x85\u2028\u2029]/);return t.result.map(function(t,e){return{words:t.map(function(t){return{characters:n[e].substr(t.startPosition,t.wordLength).split("").map(function(t){return{char:t,startTime:300*r,endTime:300*++r}}),pos:t.PoS,rawPoS:t.rawPoS,language:t.language}}),templates:[{type:"DefaultAlignment"}]}})},t.prototype.createVideoDataFromText=function(t){for(var e,r={characters:[]},n={words:[r],templates:[{type:"DefaultAlignment"}]},i=0,o=[n],s=0;s<t.length;s++){var a=t.charAt(s);"\n"!==a?" "!==a?(e={char:a,startTime:300*i,endTime:300*++i},r.characters.push(e)):(r={characters:[]},n.words.push(r)):(n={words:[r={characters:[]}],templates:[{type:"DefaultAlignment"}]},o.push(n))}return r.characters.length<=0&&n.words.pop(),n.words.length<=0&&o.pop(),o},t}(),Ft=function(){function t(t,e){var r=this;this.player=t,this.listener=e,"undefined"!=typeof window&&t.options&&t.options.app?this.initialize():setTimeout(function(){r.listener.onAppReady(r)},100)}return Object.defineProperty(t.prototype,"options",{get:function(){return this.player&&this.player.options&&this.player.options.app?"boolean"==typeof this.player.options.app?{}:l({},this.player.options.app):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"managed",{get:function(){return!!this._host},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"songUrl",{get:function(){return this._songUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var t=this;this._songUrl=function(t){for(var e=0,r=window.location.search.substring(1).split("&");e<r.length;e++){var n=r[e].split("=");if("ta_song_url"===decodeURIComponent(n[0]))return decodeURIComponent(n[1])}return null}(),this._parameters={},this.playerListener={onVideoReady:function(e){window!==window.parent&&window.parent.postMessage({kind:"ta_video",options:{lyrics:!!t.player.data.lyrics,duration:t.player.video.duration}},"*")},onThrottledTimeUpdate:function(t){window!==window.parent&&window.parent.postMessage({kind:"ta_position",options:{position:t}},"*")},onPlay:function(){window!==window.parent&&window.parent.postMessage({kind:"ta_status",options:{status:"play"}},"*")},onPause:function(){window!==window.parent&&window.parent.postMessage({kind:"ta_status",options:{status:"pause"}},"*")},onStop:function(){window!==window.parent&&window.parent.postMessage({kind:"ta_status",options:{status:"stop"}},"*")},onDispose:function(){t.dispose()}},this.messageListener=function(e){if(e.data.kind&&/^ta_/.test(e.data.kind)){var r=t.player;switch(e.data.kind.substring("ta_".length)){case"ack":t._host=e.data.options,t.listener.onAppReady(t);break;case"status":switch(e.data.options.status){case"play":r.requestPlay();break;case"pause":r.requestPause();break;case"stop":r.requestStop()}break;case"seek":r.requestMediaSeek(e.data.options.position);break;case"parameter":var n=e.data.options,i=n.name,o=n.value;t.parameters[i]=o,t.listener.onAppParameterUpdate(i,o);break;case"media":t._songUrl=e.data.options.url,r.requestStop(),r.createFromSongUrl(t._songUrl),t.listener.onAppMediaChange(t._songUrl)}}},window.addEventListener("message",this.messageListener),window.parent&&window!==window.parent?(this.player.addListener(this.playerListener),window.parent.postMessage({kind:"ta_connect",options:this.options},"*"),setTimeout(function(){t._host||t.listener.onAppReady(t)},500)):setTimeout(function(){t.listener.onAppReady(t)},100),this._songUrl&&this.player.createFromSongUrl(this._songUrl)},t.prototype.dispose=function(){"undefined"!=typeof window&&(window.parent&&window!==window.parent&&this.player&&this.player.removeListener(this.playerListener),window.removeEventListener("message",this.messageListener)),this._host=null,this.player=null},t}();exports.VideoBuilder=Lt;var Ut=function(){function t(t){this._options=t,this._mediaPosition=0,this._videoPosition=0,this.isEditing=!1,this.isVideoSeeking=!1,this.emitter=new It(t),this._templates=new xt(this,this.emitter,t&&t.unsafeAcceleration);var e=Object.assign({},r.Managers);t&&t.managers&&(e=Object.assign(e,t.managers)),this._managers=e,this.timer=t&&t.timer||this.createDefaultTimer(),this._data=new j(e,this.emitter,t),this._backgroundGraphics=new _(this,e.asset,this.emitter),this._graphics=t&&t.graphics||this.createDefaultGraphicsDriver(),this.stage=new kt(this),t&&t.stageElement&&this.setStageElement(t.stageElement),t&&t.mediaElement&&this.setMediaElement(t.mediaElement),this.videoBuilder=new Lt(e),this._app=new Ft(this,this.emitter)}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options?l({},this._options):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"app",{get:function(){return this._app},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"managers",{get:function(){return this._managers},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"templates",{get:function(){return this._templates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backgroundGraphics",{get:function(){return this._backgroundGraphics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageElement",{get:function(){return this._stageElement},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageScale",{get:function(){return this.stage.scale},set:function(t){this.stage.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._graphics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mediaElement",{get:function(){return this._mediaElement},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mediaPosition",{get:function(){return this._mediaPosition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoPosition",{get:function(){return this._videoPosition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this.timer&&this.timer.isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wait",{get:function(){return this.timer?this.timer.wait:0},set:function(t){this.timer&&(this.timer.wait=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fps",{get:function(){return 1e3/this.wait},set:function(t){this.wait=1e3/t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolutionWidth",{get:function(){return this.data.video&&this.data.video.config&&"object"==typeof this.data.video.config&&"number"==typeof this.data.video.config.width?this.data.video.config.width:this._options&&this._options.defaultVideoSize&&"number"==typeof this._options.defaultVideoSize.width?this._options.defaultVideoSize.width:1280},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolutionHeight",{get:function(){return this.data.video&&this.data.video.config&&"object"==typeof this.data.video.config&&"number"==typeof this.data.video.config.height?this.data.video.config.height:this._options&&this._options.defaultVideoSize&&"number"==typeof this._options.defaultVideoSize.height?this._options.defaultVideoSize.height:720},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolutionProportion",{get:function(){return this.resolutionHeight/this.resolutionWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"margin",{get:function(){return this.data.video&&this.data.video.config&&"object"==typeof this.data.video.config&&this.data.video.config.margin?this.data.video.config.margin:this._options&&this._options.defaultVideoSize&&this._options.defaultVideoSize.margin||v},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoWidth",{get:function(){var t=this.resolutionWidth,e=this.margin;return t+e[1]+e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoHeight",{get:function(){var t=this.resolutionHeight,e=this.margin;return t+e[0]+e[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoProportion",{get:function(){return this.videoHeight/this.videoWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageWidth",{get:function(){return this.stage.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageHeight",{get:function(){return this.stage.height},enumerable:!0,configurable:!0}),t.prototype.createDefaultTimer=function(){try{if("undefined"!=typeof window)return new b}catch(t){}return new E},t.prototype.createDefaultGraphicsDriver=function(){return new e.NullGraphicsDriver},t.prototype.onResize=function(t){this.emitter.onResize(t)},t.prototype.createFromVideoId=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.videoBuilder.createFromVideoId(t,e)];case 1:return r=n.sent(),[2,this.finalize(r)]}})})},t.prototype.createFromVideo=function(t){return h(this,void 0,void 0,function(){return d(this,function(e){return[2,this.finalize(t)]})})},t.prototype.createFromSongUrl=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.videoBuilder.createFromSongUrl(t,e)];case 1:return r=n.sent(),[2,this.finalize(r)]}})})},t.prototype.createFromSongPath=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.videoBuilder.createFromSongPath(t,e)];case 1:return r=n.sent(),[2,this.finalize(r)]}})})},t.prototype.createFromSongId=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.videoBuilder.createFromSongId(t,e)];case 1:return r=n.sent(),[2,this.finalize(r)]}})})},t.prototype.createFromSongCode=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.videoBuilder.createFromSongCode(t,e)];case 1:return r=n.sent(),[2,this.finalize(r)]}})})},t.prototype.createFromText=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.videoBuilder.createFromText(t,e)];case 1:return r=n.sent(),[2,this.finalize(r)]}})})},t.prototype.createFromJSON=function(t,e){return h(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return[4,this.videoBuilder.createFromJSON(t,e)];case 1:return r=n.sent(),[2,this.finalize(r)]}})})},t.prototype.finalize=function(t){return h(this,void 0,void 0,function(){var r,n,i,o=this;return d(this,function(s){switch(s.label){case 0:return t?(this.data.useVideo(t),[4,Promise.all([this.data.initialize(),this.backgroundGraphics.setBackground(this.data.video.background)])]):[2,null];case 1:return s.sent(),this.data.lyrics&&this.data.text&&this.data.importLyrics(),r=this.data.video.json,n=new e.Video(r),this._video=n,this.updateVideoDuration(),i=r.phrases&&r.phrases.length>0&&r.phrases[0].words&&r.phrases[0].words.length>0&&r.phrases[0].words[0]&&!r.phrases[0].words[0].pos,[4,Promise.all([this.loadTemplates().then(function(){return o.templates.importInstances(n,r)}),this.graphics.createRuntime(n),i?this.data.parseText():Promise.resolve()])];case 2:return s.sent(),this.emitter.onVideoReady(n),this.createTimer(),[2,n]}})})},t.prototype.loadTemplates=function(){return h(this,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return this.data.video.id&&this.data.video.id>=0?[4,this.templates.loadForVideo(this.data.video.id)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.updateVideoDuration=function(){var t=this.video,e=this.data.video.config;e&&"object"==typeof e&&"number"==typeof e.duration?t.duration=e.duration:this.data.song?t.duration=1e3*this.data.song.length:t.duration||(t.duration=t.endTime)},t.prototype.exportVideo=function(){return h(this,void 0,void 0,function(){var t,e,r;return d(this,function(n){return t=this.data.exportPartialVideoEntry(),e=this.backgroundGraphics.exportPartialVideoEntry(),r=JSON.stringify(this.video.exportData(this.templates)),[2,l(l(l({},t),e),{json:r})]})})},t.prototype.getChoruses=function(){if(!this.data.songMap)return[];var t=this.data.songMap.segments.filter(function(t){return t.chorus});return t.length<=0?[]:t[0].segments},t.prototype.findChorus=function(t){var e=this.getChorusSegmentsAndIndex(t),r=e.segments,n=e.index;return n<0?null:r[n].contains(t)?r[n]:null},t.prototype.findChorusBetween=function(t,e){var r=this.getChorusSegmentsAndIndex(t),n=r.segments,i=r.index;return i<0?null:(i>=n.length&&(i=n.length-1),n[i].overlaps(t,e)?n[i]:i<1?null:n[i-1].overlaps(t,e)?n[i-1]:null)},t.prototype.getChorusSegmentsAndIndex=function(t){if(!this.data.songMap)return{segments:[],index:-1};var e=this.data.songMap.segments.filter(function(t){return t.chorus});if(e.length<=0)return{segments:null,index:-1};var r=e[0].segments,n=o(r,t,function(t){return t.endTime});return n<0||n>=r.length?{segments:r,index:-1}:{segments:r,index:n}},t.prototype.getBeats=function(){return this.data.songMap?this.data.songMap.beats:[]},t.prototype.findBeat=function(t){if(!this.data.songMap)return null;var e=this.data.songMap.beats;if(!e||e.length<=0)return null;var r=o(e,t,function(t){return t.startTime})-1;return r<0?null:e[r].contains(t)?e[r]:null},t.prototype.findVoice=function(t){var e=this.data.songMap.voice[0];if(e.length<=0)return null;var r=o(e,t,function(t){return t.endTime});return e[r].contains(t)?e[r]:null},t.prototype.getAmplitude=function(t){return-1},t.prototype.getMaxAmplitude=function(){return-1},t.prototype.addListener=function(t){return this.emitter.addListener(t)},t.prototype.removeListener=function(t){return this.emitter.removeListener(t)},t.prototype.createTimer=function(){this.timer.initialize(this,this.emitter)},t.prototype.setStageElement=function(t){this._stageElement=t,this.emitter.onStageElementSet(t)},t.prototype.setMediaElement=function(t){this._mediaElement=t,this.emitter.onMediaElementSet(t)},t.prototype.setVideoPosition=function(t){return h(this,void 0,void 0,function(){var e=this;return d(this,function(r){return[2,this.stage.requestUpdate(t).then(function(t){return e._videoPosition=t,t})]})})},t.prototype.setMediaPosition=function(t){return h(this,void 0,void 0,function(){var e=this;return d(this,function(r){return this.isVideoSeeking?(this._mediaPosition=t,this.emitter.onMediaSeek(t),[2,t]):[2,this.stage.requestUpdate(t).then(function(t){return e._mediaPosition=t,e._videoPosition=t,e.emitter.onMediaSeek(t),t})]})})},t.prototype.requestPlay=function(){return this.timer.play(),!0},t.prototype.requestStop=function(){return this.timer.stop(),!0},t.prototype.requestPause=function(){return this.timer.pause(),!0},t.prototype.requestMediaSeek=function(t){return this.timer.seek(t),!0},t.prototype.startVideoSeek=function(){this.isVideoSeeking=!0},t.prototype.endVideoSeek=function(){this.isVideoSeeking=!1},t.prototype.requestSettingBackground=function(t){return h(this,void 0,void 0,function(){return d(this,function(e){return[2,this.backgroundGraphics.settingBackground(t)]})})},t.prototype.requestSetBackground=function(t){return h(this,void 0,void 0,function(){return d(this,function(e){return[2,this.backgroundGraphics.setBackground(t)]})})},t.prototype.requestStageUpdate=function(){return h(this,void 0,void 0,function(){return d(this,function(t){return[2,this.stage.requestUpdate()]})})},t.prototype.onStageUpdate=function(t){this.isVideoSeeking||this.emitter.onTimeUpdate(t)},t.prototype.dispose=function(){if(this.timer&&(this.timer.dispose(),this.timer=null),this.mediaElement){for(;this.mediaElement.firstElementChild;)this.mediaElement.removeChild(this.mediaElement.firstElementChild);this._mediaElement=null}this.stageElement&&(this._stageElement=null),this.emitter.onDispose()},t}(),Bt={findRequires:Y,getMetaCode:G};exports.parser=Bt,exports.Player=Ut;
},{"textalive-graphics":"Z8sE","textalive-data-web":"SXFP","acorn":"lAPL","_bundle_loader":"TUK3","webfontloader":[["webfontloader.950546d8.js","FryP"],"FryP"]}],"Focm":[function(require,module,exports) {
"use strict";var t=require("textalive-api");function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function s(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}var n=function(){function i(){var t=this;e(this,i);var s=new r;this._canMng=s,this._initPlayer(),window.addEventListener("resize",function(){return t._resize()}),this._update()}return s(i,[{key:"_initPlayer",value:function(){var e=this,i=new t.Player({app:{appAuthor:"daniwell",appName:"Lyric Tiles"},mediaElement:document.querySelector("#media")});i.addListener({onAppReady:function(t){return e._onAppReady(t)},onVideoReady:function(t){return e._onVideoReady(t)},onTimeUpdate:function(t){return e._onTimeUpdate(t)}}),this._player=i}},{key:"_onAppReady",value:function(t){var e=this;t.songUrl||this._player.createFromSongUrl("https://www.youtube.com/watch?v=-6oxY-quTOA"),document.getElementById("view").addEventListener("click",function(){var t;(t=e._player).isPlaying?t.requestPause():t.requestPlay()})}},{key:"_onVideoReady",value:function(t){var e=[];if(t.firstChar)for(var i=t.firstChar;i;)e.push(new a(i)),i=i.next;this._canMng.setLyrics(e)}},{key:"_onTimeUpdate",value:function(t){this._position=t,this._updateTime=Date.now(),this._canMng.update(t)}},{key:"_update",value:function(){var t=this;if(this._player.isPlaying&&0<=this._updateTime&&0<=this._position){var e=Date.now()-this._updateTime+this._position;this._canMng.update(e)}window.requestAnimationFrame(function(){return t._update()})}},{key:"_resize",value:function(){this._canMng.resize()}}]),i}(),a=function t(i){e(this,t),this.text=i.text,this.startTime=i.startTime,this.endTime=i.endTime,this.duration=i.duration,this.x=0,this.y=0,this.isDraw=!1},r=function(){function t(){var i=this;e(this,t),this._px=0,this._py=0,this._rx=0,this._ry=0,this._space=160,this._speed=1500,this._position=0,this._isOver=!1,this._can=document.createElement("canvas"),this._ctx=this._can.getContext("2d"),document.getElementById("view").append(this._can),document.addEventListener("mousemove",function(t){return i._move(t)}),document.addEventListener("mouseleave",function(t){return i._leave(t)}),"ontouchstart"in window&&(this._space*=.5,this._speed*=.5,document.addEventListener("touchmove",function(t){return i._move(t)}),document.addEventListener("touchend",function(t){return i._leave(t)})),this.resize()}return s(t,[{key:"setLyrics",value:function(t){this._lyrics=t}},{key:"update",value:function(t){this._isOver||(this._rx=.3*Math.sin(t/1234+.123)+.2,this._ry=.5*Math.cos(t/1011+.111),this._mouseX=this._stw*(this._rx+1)/2,this._mouseY=this._sth*(this._ry+1)/2);var e=(t-this._position)/1e3;this._px+=-this._rx*e*this._speed,this._py+=-this._ry*e*this._speed,this._drawBg(),this._drawLyrics(),this._position=t}},{key:"resize",value:function(){this._can.width=this._stw=document.documentElement.clientWidth,this._can.height=this._sth=document.documentElement.clientHeight}},{key:"_move",value:function(t){var e=0,i=0;t.touches?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._mouseX=e,this._mouseY=i,this._rx=e/this._stw*2-1,this._ry=i/this._sth*2-1,this._isOver=!0}},{key:"_leave",value:function(t){this._isOver=!1}},{key:"_drawBg",value:function(){var t=this._space,e=this._px%t,i=this._py%t,s=this._stw/t+1,n=this._sth/t+1,a=this._ctx;a.clearRect(0,0,this._stw,this._sth),a.strokeStyle="#000",a.lineWidth=1,a.beginPath();for(var r=0;r<=n;r++)for(var o=0;o<=s;o++){var h=o*t+e,u=r*t+i;a.moveTo(h-8,u),a.lineTo(h+8,u),a.moveTo(h,u-8),a.lineTo(h,u+8)}a.stroke()}},{key:"_drawLyrics",value:function(){if(this._lyrics){var t=this._position,e=this._space,i=.5*e,s=this._ctx;s.textAlign="center",s.fillStyle="#000";for(var n=0,a=this._lyrics.length;n<a;n++){var r=this._lyrics[n];if(r.startTime<t){if(t<r.endTime&&!isNaN(this._mouseX)&&!r.isDraw){var o=Math.floor((-this._px+this._mouseX)/e),h=Math.floor((-this._py+this._mouseY)/e),u=0,_=0,c=!0;t:for(var l=0;l<=100;l++){u=l,_=0;for(var d=-1,v=1,p=0==l?1:4*l,y=0;y<p;y++){c=!0;for(var f=0;f<n;f++){var m=this._lyrics[f];if(m.isDraw&&m.x==o+u&&m.y==h+_){c=!1;break}}if(c)break t;(u+=d)!=l&&u!=-l||(d=-d),(_+=v)!=l&&_!=-l||(v=-v)}}r.x=o+u,r.y=h+_,r.isDraw=!0}if(r.isDraw){var w=r.x*e,x=r.y*e;if(w+e<-this._px||-this._px+this._stw<w)continue;if(x+e<-this._py||-this._py+this._sth<x)continue;w=this._px+w+e/2,x=this._py+x+e/2,i=.5*e*this._easeOutBack(Math.min((t-r.startTime)/200,1)),s.font="bold "+i+"px sans-serif",s.fillText(r.text,w,x+.37*i)}}else r.isDraw=!1}}}},{key:"_easeOutBack",value:function(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)}}]),t}();new n;
},{"textalive-api":"LU4Z"}],"Yi9z":[function(require,module,exports) {
module.exports=function(n){return new Promise(function(e,o){var r=document.createElement("script");r.async=!0,r.type="text/javascript",r.charset="utf-8",r.src=n,r.onerror=function(n){r.onerror=r.onload=null,o(n)},r.onload=function(){r.onerror=r.onload=null,e()},document.getElementsByTagName("head")[0].appendChild(r)})};
},{}],0:[function(require,module,exports) {
var b=require("TUK3");b.register("js",require("Yi9z"));
},{}]},{},[0,"Focm"], null)